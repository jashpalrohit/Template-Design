;(function () {
    'use strict';

    /**
     * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
     *
     * @codingstandard ftlabs-jsv2
     * @copyright The Financial Times Limited [All Rights Reserved]
     * @license MIT License (see LICENSE.txt)
     */

    /*jslint browser:true, node:true*/
    /*global define, Event, Node*/


    /**
     * Instantiate fast-clicking listeners on the specified layer.
     *
     * @constructor
     * @param {Element} layer The layer to listen on
     * @param {Object} [options={}] The options to override the defaults
     */
    function FastClick(layer, options) {
        var oldOnClick;

        options = options || {};

        /**
         * Whether a click is currently being tracked.
         *
         * @type boolean
         */
        this.trackingClick = false;


        /**
         * Timestamp for when click tracking started.
         *
         * @type number
         */
        this.trackingClickStart = 0;


        /**
         * The element being tracked for a click.
         *
         * @type EventTarget
         */
        this.targetElement = null;


        /**
         * X-coordinate of touch start event.
         *
         * @type number
         */
        this.touchStartX = 0;


        /**
         * Y-coordinate of touch start event.
         *
         * @type number
         */
        this.touchStartY = 0;


        /**
         * ID of the last touch, retrieved from Touch.identifier.
         *
         * @type number
         */
        this.lastTouchIdentifier = 0;


        /**
         * Touchmove boundary, beyond which a click will be cancelled.
         *
         * @type number
         */
        this.touchBoundary = options.touchBoundary || 10;


        /**
         * The FastClick layer.
         *
         * @type Element
         */
        this.layer = layer;

        /**
         * The minimum time between tap(touchstart and touchend) events
         *
         * @type number
         */
        this.tapDelay = options.tapDelay || 200;

        /**
         * The maximum time for a tap
         *
         * @type number
         */
        this.tapTimeout = options.tapTimeout || 700;

        if (FastClick.notNeeded(layer)) {
            return;
        }

        // Some old versions of Android don't have Function.prototype.bind
        function bind(method, context) {
            return function() { return method.apply(context, arguments); };
        }


        var methods = ['onMouse', 'onClick', 'onTouchStart', 'onTouchMove', 'onTouchEnd', 'onTouchCancel'];
        var context = this;
        for (var i = 0, l = methods.length; i < l; i++) {
            context[methods[i]] = bind(context[methods[i]], context);
        }

        // Set up event handlers as required
        if (deviceIsAndroid) {
            layer.addEventListener('mouseover', this.onMouse, true);
            layer.addEventListener('mousedown', this.onMouse, true);
            layer.addEventListener('mouseup', this.onMouse, true);
        }

        layer.addEventListener('click', this.onClick, true);
        layer.addEventListener('touchstart', this.onTouchStart, false);
        layer.addEventListener('touchmove', this.onTouchMove, false);
        layer.addEventListener('touchend', this.onTouchEnd, false);
        layer.addEventListener('touchcancel', this.onTouchCancel, false);

        // Hack is required for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
        // which is how FastClick normally stops click events bubbling to callbacks registered on the FastClick
        // layer when they are cancelled.
        if (!Event.prototype.stopImmediatePropagation) {
            layer.removeEventListener = function(type, callback, capture) {
                var rmv = Node.prototype.removeEventListener;
                if (type === 'click') {
                    rmv.call(layer, type, callback.hijacked || callback, capture);
                } else {
                    rmv.call(layer, type, callback, capture);
                }
            };

            layer.addEventListener = function(type, callback, capture) {
                var adv = Node.prototype.addEventListener;
                if (type === 'click') {
                    adv.call(layer, type, callback.hijacked || (callback.hijacked = function(event) {
                            if (!event.propagationStopped) {
                                callback(event);
                            }
                        }), capture);
                } else {
                    adv.call(layer, type, callback, capture);
                }
            };
        }

        // If a handler is already declared in the element's onclick attribute, it will be fired before
        // FastClick's onClick handler. Fix this by pulling out the user-defined handler function and
        // adding it as listener.
        if (typeof layer.onclick === 'function') {

            // Android browser on at least 3.2 requires a new reference to the function in layer.onclick
            // - the old one won't work if passed to addEventListener directly.
            oldOnClick = layer.onclick;
            layer.addEventListener('click', function(event) {
                oldOnClick(event);
            }, false);
            layer.onclick = null;
        }
    }

    /**
     * Windows Phone 8.1 fakes user agent string to look like Android and iPhone.
     *
     * @type boolean
     */
    var deviceIsWindowsPhone = navigator.userAgent.indexOf("Windows Phone") >= 0;

    /**
     * Android requires exceptions.
     *
     * @type boolean
     */
    var deviceIsAndroid = navigator.userAgent.indexOf('Android') > 0 && !deviceIsWindowsPhone;


    /**
     * iOS requires exceptions.
     *
     * @type boolean
     */
    var deviceIsIOS = /iP(ad|hone|od)/.test(navigator.userAgent) && !deviceIsWindowsPhone;


    /**
     * iOS 4 requires an exception for select elements.
     *
     * @type boolean
     */
    var deviceIsIOS4 = deviceIsIOS && (/OS 4_\d(_\d)?/).test(navigator.userAgent);


    /**
     * iOS 6.0-7.* requires the target element to be manually derived
     *
     * @type boolean
     */
    var deviceIsIOSWithBadTarget = deviceIsIOS && (/OS [6-7]_\d/).test(navigator.userAgent);

    /**
     * BlackBerry requires exceptions.
     *
     * @type boolean
     */
    var deviceIsBlackBerry10 = navigator.userAgent.indexOf('BB10') > 0;

    /**
     * Determine whether a given element requires a native click.
     *
     * @param {EventTarget|Element} target Target DOM element
     * @returns {boolean} Returns true if the element needs a native click
     */
    FastClick.prototype.needsClick = function(target) {
        switch (target.nodeName.toLowerCase()) {

            // Don't send a synthetic click to disabled inputs (issue #62)
            case 'button':
            case 'select':
            case 'textarea':
                if (target.disabled) {
                    return true;
                }

                break;
            case 'input':

                // File inputs need real clicks on iOS 6 due to a browser bug (issue #68)
                if ((deviceIsIOS && target.type === 'file') || target.disabled) {
                    return true;
                }

                break;
            case 'label':
            case 'iframe': // iOS8 homescreen apps can prevent events bubbling into frames
            case 'video':
                return true;
        }

        return (/\bneedsclick\b/).test(target.className);
    };


    /**
     * Determine whether a given element requires a call to focus to simulate click into element.
     *
     * @param {EventTarget|Element} target Target DOM element
     * @returns {boolean} Returns true if the element requires a call to focus to simulate native click.
     */
    FastClick.prototype.needsFocus = function(target) {
        switch (target.nodeName.toLowerCase()) {
            case 'textarea':
                return true;
            case 'select':
                return !deviceIsAndroid;
            case 'input':
                switch (target.type) {
                    case 'button':
                    case 'checkbox':
                    case 'file':
                    case 'image':
                    case 'radio':
                    case 'submit':
                        return false;
                }

                // No point in attempting to focus disabled inputs
                return !target.disabled && !target.readOnly;
            default:
                return (/\bneedsfocus\b/).test(target.className);
        }
    };


    /**
     * Send a click event to the specified element.
     *
     * @param {EventTarget|Element} targetElement
     * @param {Event} event
     */
    FastClick.prototype.sendClick = function(targetElement, event) {
        var clickEvent, touch;

        // On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect (#24)
        if (document.activeElement && document.activeElement !== targetElement) {
            document.activeElement.blur();
        }

        touch = event.changedTouches[0];

        // Synthesise a click event, with an extra attribute so it can be tracked
        clickEvent = document.createEvent('MouseEvents');
        clickEvent.initMouseEvent(this.determineEventType(targetElement), true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);
        clickEvent.forwardedTouchEvent = true;
        targetElement.dispatchEvent(clickEvent);
    };

    FastClick.prototype.determineEventType = function(targetElement) {

        //Issue #159: Android Chrome Select Box does not open with a synthetic click event
        if (deviceIsAndroid && targetElement.tagName.toLowerCase() === 'select') {
            return 'mousedown';
        }

        return 'click';
    };


    /**
     * @param {EventTarget|Element} targetElement
     */
    FastClick.prototype.focus = function(targetElement) {
        var length;

        // Issue #160: on iOS 7, some input elements (e.g. date datetime month) throw a vague TypeError on setSelectionRange. These elements don't have an integer value for the selectionStart and selectionEnd properties, but unfortunately that can't be used for detection because accessing the properties also throws a TypeError. Just check the type instead. Filed as Apple bug #15122724.
        if (deviceIsIOS && targetElement.setSelectionRange && targetElement.type.indexOf('date') !== 0 && targetElement.type !== 'time' && targetElement.type !== 'month') {
            length = targetElement.value.length;
            targetElement.setSelectionRange(length, length);
        } else {
            targetElement.focus();
        }
    };


    /**
     * Check whether the given target element is a child of a scrollable layer and if so, set a flag on it.
     *
     * @param {EventTarget|Element} targetElement
     */
    FastClick.prototype.updateScrollParent = function(targetElement) {
        var scrollParent, parentElement;

        scrollParent = targetElement.fastClickScrollParent;

        // Attempt to discover whether the target element is contained within a scrollable layer. Re-check if the
        // target element was moved to another parent.
        if (!scrollParent || !scrollParent.contains(targetElement)) {
            parentElement = targetElement;
            do {
                if (parentElement.scrollHeight > parentElement.offsetHeight) {
                    scrollParent = parentElement;
                    targetElement.fastClickScrollParent = parentElement;
                    break;
                }

                parentElement = parentElement.parentElement;
            } while (parentElement);
        }

        // Always update the scroll top tracker if possible.
        if (scrollParent) {
            scrollParent.fastClickLastScrollTop = scrollParent.scrollTop;
        }
    };


    /**
     * @param {EventTarget} targetElement
     * @returns {Element|EventTarget}
     */
    FastClick.prototype.getTargetElementFromEventTarget = function(eventTarget) {

        // On some older browsers (notably Safari on iOS 4.1 - see issue #56) the event target may be a text node.
        if (eventTarget.nodeType === Node.TEXT_NODE) {
            return eventTarget.parentNode;
        }

        return eventTarget;
    };


    /**
     * On touch start, record the position and scroll offset.
     *
     * @param {Event} event
     * @returns {boolean}
     */
    FastClick.prototype.onTouchStart = function(event) {
        var targetElement, touch, selection;

        // Ignore multiple touches, otherwise pinch-to-zoom is prevented if both fingers are on the FastClick element (issue #111).
        if (event.targetTouches.length > 1) {
            return true;
        }

        targetElement = this.getTargetElementFromEventTarget(event.target);
        touch = event.targetTouches[0];

        if (deviceIsIOS) {

            // Only trusted events will deselect text on iOS (issue #49)
            selection = window.getSelection();
            if (selection.rangeCount && !selection.isCollapsed) {
                return true;
            }

            if (!deviceIsIOS4) {

                // Weird things happen on iOS when an alert or confirm dialog is opened from a click event callback (issue #23):
                // when the user next taps anywhere else on the page, new touchstart and touchend events are dispatched
                // with the same identifier as the touch event that previously triggered the click that triggered the alert.
                // Sadly, there is an issue on iOS 4 that causes some normal touch events to have the same identifier as an
                // immediately preceeding touch event (issue #52), so this fix is unavailable on that platform.
                // Issue 120: touch.identifier is 0 when Chrome dev tools 'Emulate touch events' is set with an iOS device UA string,
                // which causes all touch events to be ignored. As this block only applies to iOS, and iOS identifiers are always long,
                // random integers, it's safe to to continue if the identifier is 0 here.
                if (touch.identifier && touch.identifier === this.lastTouchIdentifier) {
                    event.preventDefault();
                    return false;
                }

                this.lastTouchIdentifier = touch.identifier;

                // If the target element is a child of a scrollable layer (using -webkit-overflow-scrolling: touch) and:
                // 1) the user does a fling scroll on the scrollable layer
                // 2) the user stops the fling scroll with another tap
                // then the event.target of the last 'touchend' event will be the element that was under the user's finger
                // when the fling scroll was started, causing FastClick to send a click event to that layer - unless a check
                // is made to ensure that a parent layer was not scrolled before sending a synthetic click (issue #42).
                this.updateScrollParent(targetElement);
            }
        }

        this.trackingClick = true;
        this.trackingClickStart = event.timeStamp;
        this.targetElement = targetElement;

        this.touchStartX = touch.pageX;
        this.touchStartY = touch.pageY;

        // Prevent phantom clicks on fast double-tap (issue #36)
        if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
            event.preventDefault();
        }

        return true;
    };


    /**
     * Based on a touchmove event object, check whether the touch has moved past a boundary since it started.
     *
     * @param {Event} event
     * @returns {boolean}
     */
    FastClick.prototype.touchHasMoved = function(event) {
        var touch = event.changedTouches[0], boundary = this.touchBoundary;

        if (Math.abs(touch.pageX - this.touchStartX) > boundary || Math.abs(touch.pageY - this.touchStartY) > boundary) {
            return true;
        }

        return false;
    };


    /**
     * Update the last position.
     *
     * @param {Event} event
     * @returns {boolean}
     */
    FastClick.prototype.onTouchMove = function(event) {
        if (!this.trackingClick) {
            return true;
        }

        // If the touch has moved, cancel the click tracking
        if (this.targetElement !== this.getTargetElementFromEventTarget(event.target) || this.touchHasMoved(event)) {
            this.trackingClick = false;
            this.targetElement = null;
        }

        return true;
    };


    /**
     * Attempt to find the labelled control for the given label element.
     *
     * @param {EventTarget|HTMLLabelElement} labelElement
     * @returns {Element|null}
     */
    FastClick.prototype.findControl = function(labelElement) {

        // Fast path for newer browsers supporting the HTML5 control attribute
        if (labelElement.control !== undefined) {
            return labelElement.control;
        }

        // All browsers under test that support touch events also support the HTML5 htmlFor attribute
        if (labelElement.htmlFor) {
            return document.getElementById(labelElement.htmlFor);
        }

        // If no for attribute exists, attempt to retrieve the first labellable descendant element
        // the list of which is defined here: http://www.w3.org/TR/html5/forms.html#category-label
        return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');
    };


    /**
     * On touch end, determine whether to send a click event at once.
     *
     * @param {Event} event
     * @returns {boolean}
     */
    FastClick.prototype.onTouchEnd = function(event) {
        var forElement, trackingClickStart, targetTagName, scrollParent, touch, targetElement = this.targetElement;

        if (!this.trackingClick) {
            return true;
        }

        // Prevent phantom clicks on fast double-tap (issue #36)
        if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
            this.cancelNextClick = true;
            return true;
        }

        if ((event.timeStamp - this.trackingClickStart) > this.tapTimeout) {
            return true;
        }

        // Reset to prevent wrong click cancel on input (issue #156).
        this.cancelNextClick = false;

        this.lastClickTime = event.timeStamp;

        trackingClickStart = this.trackingClickStart;
        this.trackingClick = false;
        this.trackingClickStart = 0;

        // On some iOS devices, the targetElement supplied with the event is invalid if the layer
        // is performing a transition or scroll, and has to be re-detected manually. Note that
        // for this to function correctly, it must be called *after* the event target is checked!
        // See issue #57; also filed as rdar://13048589 .
        if (deviceIsIOSWithBadTarget) {
            touch = event.changedTouches[0];

            // In certain cases arguments of elementFromPoint can be negative, so prevent setting targetElement to null
            targetElement = document.elementFromPoint(touch.pageX - window.pageXOffset, touch.pageY - window.pageYOffset) || targetElement;
            targetElement.fastClickScrollParent = this.targetElement.fastClickScrollParent;
        }

        targetTagName = targetElement.tagName.toLowerCase();
        if (targetTagName === 'label') {
            forElement = this.findControl(targetElement);
            if (forElement) {
                this.focus(targetElement);
                if (deviceIsAndroid) {
                    return false;
                }

                targetElement = forElement;
            }
        } else if (this.needsFocus(targetElement)) {

            // Case 1: If the touch started a while ago (best guess is 100ms based on tests for issue #36) then focus will be triggered anyway. Return early and unset the target element reference so that the subsequent click will be allowed through.
            // Case 2: Without this exception for input elements tapped when the document is contained in an iframe, then any inputted text won't be visible even though the value attribute is updated as the user types (issue #37).
            if ((event.timeStamp - trackingClickStart) > 100 || (deviceIsIOS && window.top !== window && targetTagName === 'input')) {
                this.targetElement = null;
                return false;
            }

            this.focus(targetElement);
            this.sendClick(targetElement, event);

            // Select elements need the event to go through on iOS 4, otherwise the selector menu won't open.
            // Also this breaks opening selects when VoiceOver is active on iOS6, iOS7 (and possibly others)
            if (!deviceIsIOS || targetTagName !== 'select') {
                this.targetElement = null;
                event.preventDefault();
            }

            return false;
        }

        if (deviceIsIOS && !deviceIsIOS4) {

            // Don't send a synthetic click event if the target element is contained within a parent layer that was scrolled
            // and this tap is being used to stop the scrolling (usually initiated by a fling - issue #42).
            scrollParent = targetElement.fastClickScrollParent;
            if (scrollParent && scrollParent.fastClickLastScrollTop !== scrollParent.scrollTop) {
                return true;
            }
        }

        // Prevent the actual click from going though - unless the target node is marked as requiring
        // real clicks or if it is in the whitelist in which case only non-programmatic clicks are permitted.
        if (!this.needsClick(targetElement)) {
            event.preventDefault();
            this.sendClick(targetElement, event);
        }

        return false;
    };


    /**
     * On touch cancel, stop tracking the click.
     *
     * @returns {void}
     */
    FastClick.prototype.onTouchCancel = function() {
        this.trackingClick = false;
        this.targetElement = null;
    };


    /**
     * Determine mouse events which should be permitted.
     *
     * @param {Event} event
     * @returns {boolean}
     */
    FastClick.prototype.onMouse = function(event) {

        // If a target element was never set (because a touch event was never fired) allow the event
        if (!this.targetElement) {
            return true;
        }

        if (event.forwardedTouchEvent) {
            return true;
        }

        // Programmatically generated events targeting a specific element should be permitted
        if (!event.cancelable) {
            return true;
        }

        // Derive and check the target element to see whether the mouse event needs to be permitted;
        // unless explicitly enabled, prevent non-touch click events from triggering actions,
        // to prevent ghost/doubleclicks.
        if (!this.needsClick(this.targetElement) || this.cancelNextClick) {

            // Prevent any user-added listeners declared on FastClick element from being fired.
            if (event.stopImmediatePropagation) {
                event.stopImmediatePropagation();
            } else {

                // Part of the hack for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
                event.propagationStopped = true;
            }

            // Cancel the event
            event.stopPropagation();
            event.preventDefault();

            return false;
        }

        // If the mouse event is permitted, return true for the action to go through.
        return true;
    };


    /**
     * On actual clicks, determine whether this is a touch-generated click, a click action occurring
     * naturally after a delay after a touch (which needs to be cancelled to avoid duplication), or
     * an actual click which should be permitted.
     *
     * @param {Event} event
     * @returns {boolean}
     */
    FastClick.prototype.onClick = function(event) {
        var permitted;

        // It's possible for another FastClick-like library delivered with third-party code to fire a click event before FastClick does (issue #44). In that case, set the click-tracking flag back to false and return early. This will cause onTouchEnd to return early.
        if (this.trackingClick) {
            this.targetElement = null;
            this.trackingClick = false;
            return true;
        }

        // Very odd behaviour on iOS (issue #18): if a submit element is present inside a form and the user hits enter in the iOS simulator or clicks the Go button on the pop-up OS keyboard the a kind of 'fake' click event will be triggered with the submit-type input element as the target.
        if (event.target.type === 'submit' && event.detail === 0) {
            return true;
        }

        permitted = this.onMouse(event);

        // Only unset targetElement if the click is not permitted. This will ensure that the check for !targetElement in onMouse fails and the browser's click doesn't go through.
        if (!permitted) {
            this.targetElement = null;
        }

        // If clicks are permitted, return true for the action to go through.
        return permitted;
    };


    /**
     * Remove all FastClick's event listeners.
     *
     * @returns {void}
     */
    FastClick.prototype.destroy = function() {
        var layer = this.layer;

        if (deviceIsAndroid) {
            layer.removeEventListener('mouseover', this.onMouse, true);
            layer.removeEventListener('mousedown', this.onMouse, true);
            layer.removeEventListener('mouseup', this.onMouse, true);
        }

        layer.removeEventListener('click', this.onClick, true);
        layer.removeEventListener('touchstart', this.onTouchStart, false);
        layer.removeEventListener('touchmove', this.onTouchMove, false);
        layer.removeEventListener('touchend', this.onTouchEnd, false);
        layer.removeEventListener('touchcancel', this.onTouchCancel, false);
    };


    /**
     * Check whether FastClick is needed.
     *
     * @param {Element} layer The layer to listen on
     */
    FastClick.notNeeded = function(layer) {
        var metaViewport;
        var chromeVersion;
        var blackberryVersion;
        var firefoxVersion;

        // Devices that don't support touch don't need FastClick
        if (typeof window.ontouchstart === 'undefined') {
            return true;
        }

        // Chrome version - zero for other browsers
        chromeVersion = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

        if (chromeVersion) {

            if (deviceIsAndroid) {
                metaViewport = document.querySelector('meta[name=viewport]');

                if (metaViewport) {
                    // Chrome on Android with user-scalable="no" doesn't need FastClick (issue #89)
                    if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
                        return true;
                    }
                    // Chrome 32 and above with width=device-width or less don't need FastClick
                    if (chromeVersion > 31 && document.documentElement.scrollWidth <= window.outerWidth) {
                        return true;
                    }
                }

                // Chrome desktop doesn't need FastClick (issue #15)
            } else {
                return true;
            }
        }

        if (deviceIsBlackBerry10) {
            blackberryVersion = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);

            // BlackBerry 10.3+ does not require Fastclick library.
            // https://github.com/ftlabs/fastclick/issues/251
            if (blackberryVersion[1] >= 10 && blackberryVersion[2] >= 3) {
                metaViewport = document.querySelector('meta[name=viewport]');

                if (metaViewport) {
                    // user-scalable=no eliminates click delay.
                    if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
                        return true;
                    }
                    // width=device-width (or less than device-width) eliminates click delay.
                    if (document.documentElement.scrollWidth <= window.outerWidth) {
                        return true;
                    }
                }
            }
        }

        // IE10 with -ms-touch-action: none or manipulation, which disables double-tap-to-zoom (issue #97)
        if (layer.style.msTouchAction === 'none' || layer.style.touchAction === 'manipulation') {
            return true;
        }

        // Firefox version - zero for other browsers
        firefoxVersion = +(/Firefox\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

        if (firefoxVersion >= 27) {
            // Firefox 27+ does not have tap delay if the content is not zoomable - https://bugzilla.mozilla.org/show_bug.cgi?id=922896

            metaViewport = document.querySelector('meta[name=viewport]');
            if (metaViewport && (metaViewport.content.indexOf('user-scalable=no') !== -1 || document.documentElement.scrollWidth <= window.outerWidth)) {
                return true;
            }
        }

        // IE11: prefixed -ms-touch-action is no longer supported and it's recomended to use non-prefixed version
        // http://msdn.microsoft.com/en-us/library/windows/apps/Hh767313.aspx
        if (layer.style.touchAction === 'none' || layer.style.touchAction === 'manipulation') {
            return true;
        }

        return false;
    };


    /**
     * Factory method for creating a FastClick object
     *
     * @param {Element} layer The layer to listen on
     * @param {Object} [options={}] The options to override the defaults
     */
    FastClick.attach = function(layer, options) {
        return new FastClick(layer, options);
    };


    if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {

        // AMD. Register as an anonymous module.
        define(function() {
            return FastClick;
        });
    } else if (typeof module !== 'undefined' && module.exports) {
        module.exports = FastClick.attach;
        module.exports.FastClick = FastClick;
    } else {
        window.FastClick = FastClick;
    }
}());
/*!
 * Name    : Just Another Parallax [Jarallax]
 * Version : 1.8.0
 * Author  : _nK https://nkdev.info
 * GitHub  : https://github.com/nk-o/jarallax
 */
(function (window) {
    'use strict';

    // Adapted from https://gist.github.com/paulirish/1579671
    if(!Date.now) {
        Date.now = function () { return new Date().getTime(); };
    }
    if(!window.requestAnimationFrame) {
        (function () {

            var vendors = ['webkit', 'moz'];
            for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {
                var vp = vendors[i];
                window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];
                window.cancelAnimationFrame = window[vp+'CancelAnimationFrame']
                    || window[vp+'CancelRequestAnimationFrame'];
            }
            if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) // iOS6 is buggy
                || !window.requestAnimationFrame || !window.cancelAnimationFrame) {
                var lastTime = 0;
                window.requestAnimationFrame = function (callback) {
                    var now = Date.now();
                    var nextTime = Math.max(lastTime + 16, now);
                    return setTimeout(function () { callback(lastTime = nextTime); },
                        nextTime - now);
                };
                window.cancelAnimationFrame = clearTimeout;
            }
        }());
    }

    // test if css property supported by browser
    // like "transform"
    var tempDiv = document.createElement('div');
    function isPropertySupported (property) {
        var prefixes = ['O','Moz','ms','Ms','Webkit'];
        var i = prefixes.length;
        if (tempDiv.style[property] !== undefined) {
            return true;
        }
        property = property.charAt(0).toUpperCase() + property.substr(1);
        while (--i > -1 && tempDiv.style[prefixes[i] + property] === undefined) { }
        return i >= 0;
    }

    var supportTransform = isPropertySupported('transform');
    var supportTransform3D = isPropertySupported('perspective');

    var ua = navigator.userAgent;
    var isAndroid = ua.toLowerCase().indexOf('android') > -1;
    var isIOs = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
    var isFirefox = ua.toLowerCase().indexOf('firefox') > -1;
    var isIE = ua.indexOf('MSIE ') > -1    // IE 10 or older
        || ua.indexOf('Trident/') > -1 // IE 11
        || ua.indexOf('Edge/') > -1;   // Edge
    var isIElt10 = document.all && !window.atob; // IE 9 or older

    var wndW;
    var wndH;
    function updateWndVars () {
        wndW = window.innerWidth || document.documentElement.clientWidth;
        wndH = window.innerHeight || document.documentElement.clientHeight;
    }
    updateWndVars();

    // list with all jarallax instances
    // need to render all in one scroll/resize event
    var jarallaxList = [];

    // Jarallax instance
    var Jarallax = (function () {
        var instanceID = 0;

        function Jarallax_inner (item, userOptions) {
            var _this = this,
                dataOptions;

            _this.$item      = item;

            _this.defaults   = {
                type              : 'scroll', // type of parallax: scroll, scale, opacity, scale-opacity, scroll-opacity
                speed             : 0.5, // supported value from -1 to 2
                imgSrc            : null,
                imgWidth          : null,
                imgHeight         : null,
                elementInViewport : null,
                zIndex            : -100,
                noAndroid         : false,
                noIos             : true,

                // events
                onScroll          : null, // function(calculations) {}
                onInit            : null, // function() {}
                onDestroy         : null, // function() {}
                onCoverImage      : null  // function() {}
            };
            dataOptions      = JSON.parse(_this.$item.getAttribute('data-jarallax') || '{}');
            _this.options    = _this.extend({}, _this.defaults, dataOptions, userOptions);

            // stop init if android or ios
            if(!supportTransform || isAndroid && _this.options.noAndroid || isIOs && _this.options.noIos) {
                return;
            }

            // fix speed option [-1.0, 2.0]
            _this.options.speed = Math.min(2, Math.max(-1, parseFloat(_this.options.speed)));

            // custom element to check if parallax in viewport
            var elementInVP = _this.options.elementInViewport;
            // get first item from array
            if(elementInVP && typeof elementInVP === 'object' && typeof elementInVP.length !== 'undefined') {
                elementInVP = elementInVP[0];
            }
            // check if dom element
            if(!elementInVP instanceof Element) {
                elementInVP = null;
            }
            _this.options.elementInViewport = elementInVP;

            _this.instanceID = instanceID++;

            _this.image      = {
                src        : _this.options.imgSrc || null,
                $container : null,
                $item      : null,
                width      : _this.options.imgWidth || null,
                height     : _this.options.imgHeight || null,
                // fix for some devices
                // use <img> instead of background image - more smoothly
                useImgTag  : isIOs || isAndroid || isIE,

                // position absolute is needed on IE9 and FireFox because fixed position have glitches
                position   : !supportTransform3D || isFirefox ? 'absolute' : 'fixed'
            };

            if(_this.initImg()) {
                _this.init();
            }
        }

        return Jarallax_inner;
    }());

    // add styles to element
    Jarallax.prototype.css = function (el, styles) {
        if(typeof styles === 'string') {
            if(window.getComputedStyle) {
                return window.getComputedStyle(el).getPropertyValue(styles);
            }
            return el.style[styles];
        }

        // add transform property with vendor prefixes
        if(styles.transform) {
            if (supportTransform3D) {
                styles.transform += ' translateZ(0)';
            }
            styles.WebkitTransform = styles.MozTransform = styles.msTransform = styles.OTransform = styles.transform;
        }

        for(var k in styles) {
            el.style[k] = styles[k];
        }
        return el;
    };
    // Extend like jQuery.extend
    Jarallax.prototype.extend = function (out) {
        out = out || {};
        for (var i = 1; i < arguments.length; i++) {
            if (!arguments[i]) {
                continue;
            }
            for (var key in arguments[i]) {
                if (arguments[i].hasOwnProperty(key)) {
                    out[key] = arguments[i][key];
                }
            }
        }
        return out;
    };

    // Jarallax functions
    Jarallax.prototype.initImg = function () {
        var _this = this;

        // get image src
        if(_this.image.src === null) {
            _this.image.src = _this.css(_this.$item, 'background-image').replace(/^url\(['"]?/g,'').replace(/['"]?\)$/g,'');
        }
        return !(!_this.image.src || _this.image.src === 'none');
    };

    Jarallax.prototype.init = function () {
        var _this = this,
            containerStyles = {
                position         : 'absolute',
                top              : 0,
                left             : 0,
                width            : '100%',
                height           : '100%',
                overflow         : 'hidden',
                pointerEvents    : 'none'
            },
            imageStyles = {};

        // save default user styles
        _this.$item.setAttribute('data-jarallax-original-styles', _this.$item.getAttribute('style'));

        // set relative position and z-index to the parent
        if (_this.css(_this.$item, 'position') === 'static') {
            _this.css(_this.$item, {
                position: 'relative'
            });
        }
        if (_this.css(_this.$item, 'z-index') === 'auto') {
            _this.css(_this.$item, {
                zIndex: 0
            });
        }

        // container for parallax image
        _this.image.$container = document.createElement('div');
        _this.css(_this.image.$container, containerStyles);
        _this.css(_this.image.$container, {
            visibility : 'hidden',
            'z-index'  : _this.options.zIndex
        });
        _this.image.$container.setAttribute('id', 'jarallax-container-' + _this.instanceID);
        _this.$item.appendChild(_this.image.$container);

        // use img tag
        if(_this.image.useImgTag) {
            _this.image.$item = document.createElement('img');
            _this.image.$item.setAttribute('src', _this.image.src);
            imageStyles = _this.extend({
                'max-width' : 'none'
            }, containerStyles, imageStyles);
        }

        // use div with background image
        else {
            _this.image.$item = document.createElement('div');
            imageStyles = _this.extend({
                'background-position' : '50% 50%',
                'background-size'     : '100% auto',
                'background-repeat'   : 'no-repeat no-repeat',
                'background-image'    : 'url("' + _this.image.src + '")'
            }, containerStyles, imageStyles);
        }

        // check if one of parents have transform style (without this check, scroll transform will be inverted)
        // discussion - https://github.com/nk-o/jarallax/issues/9
        var parentWithTransform = 0;
        var $itemParents = _this.$item;
        while ($itemParents !== null && $itemParents !== document && parentWithTransform === 0) {
            var parent_transform = _this.css($itemParents, '-webkit-transform') || _this.css($itemParents, '-moz-transform') || _this.css($itemParents, 'transform');
            if(parent_transform && parent_transform !== 'none') {
                parentWithTransform = 1;

                // add transform on parallax container if there is parent with transform
                _this.css(_this.image.$container, {
                    transform: 'translateX(0) translateY(0)'
                });
            }
            $itemParents = $itemParents.parentNode;
        }

        // absolute position if one of parents have transformations or parallax without scroll
        if (parentWithTransform || _this.options.type === 'opacity'|| _this.options.type === 'scale' || _this.options.type === 'scale-opacity') {
            _this.image.position = 'absolute';
        }

        // add position to parallax block
        imageStyles.position = _this.image.position;

        // parallax image
        _this.css(_this.image.$item, imageStyles);
        _this.image.$container.appendChild(_this.image.$item);

        // cover image if width and height is ready
        function initAfterReady () {
            _this.coverImage();
            _this.clipContainer();
            _this.onScroll(true);

            // call onInit event
            if(_this.options.onInit) {
                _this.options.onInit.call(_this);
            }

            // timeout to fix IE blinking
            setTimeout(function () {
                if(_this.$item) {
                    // remove default user background
                    _this.css(_this.$item, {
                        'background-image'      : 'none',
                        'background-attachment' : 'scroll',
                        'background-size'       : 'auto'
                    });
                }
            }, 0);
        }

        if(_this.image.width && _this.image.height) {
            // init if width and height already exists
            initAfterReady();
        } else {
            // load image and get width and height
            _this.getImageSize(_this.image.src, function (width, height) {
                _this.image.width  = width;
                _this.image.height = height;
                initAfterReady();
            });
        }

        jarallaxList.push(_this);
    };

    Jarallax.prototype.destroy = function () {
        var _this = this;

        // remove from instances list
        for(var k = 0, len = jarallaxList.length; k < len; k++) {
            if(jarallaxList[k].instanceID === _this.instanceID) {
                jarallaxList.splice(k, 1);
                break;
            }
        }

        // return styles on container as before jarallax init
        var originalStylesTag = _this.$item.getAttribute('data-jarallax-original-styles');
        _this.$item.removeAttribute('data-jarallax-original-styles');
        // null occurs if there is no style tag before jarallax init
        if(originalStylesTag === 'null') {
            _this.$item.removeAttribute('style');
        } else {
            _this.$item.setAttribute('style', originalStylesTag);
        }

        // remove additional dom elements
        if(_this.$clipStyles) {
            _this.$clipStyles.parentNode.removeChild(_this.$clipStyles);
        }
        _this.image.$container.parentNode.removeChild(_this.image.$container);

        // call onDestroy event
        if(_this.options.onDestroy) {
            _this.options.onDestroy.call(_this);
        }

        // delete jarallax from item
        delete _this.$item.jarallax;

        // delete all variables
        for(var n in _this) {
            delete _this[n];
        }
    };

    Jarallax.prototype.getImageSize = function (src, callback) {
        if(!src || !callback) {
            return;
        }

        var tempImg = new Image();
        tempImg.onload = function () {
            callback(tempImg.width, tempImg.height);
        };
        tempImg.src = src;
    };

    // it will remove some image overlapping
    // overlapping occur due to an image position fixed inside absolute position element (webkit based browsers works without any fix)
    Jarallax.prototype.clipContainer = function () {
        // clip is not working properly on real IE9 and less
        if(isIElt10) {
            return;
        }

        var _this  = this,
            rect   = _this.image.$container.getBoundingClientRect(),
            width  = rect.width,
            height = rect.height;

        if(!_this.$clipStyles) {
            _this.$clipStyles = document.createElement('style');
            _this.$clipStyles.setAttribute('type', 'text/css');
            _this.$clipStyles.setAttribute('id', '#jarallax-clip-' + _this.instanceID);
            var head = document.head || document.getElementsByTagName('head')[0];
            head.appendChild(_this.$clipStyles);
        }

        var styles = [
            '#jarallax-container-' + _this.instanceID + ' {',
            '   clip: rect(0 ' + width + 'px ' + height + 'px 0);',
            '   clip: rect(0, ' + width + 'px, ' + height + 'px, 0);',
            '}'
        ].join('\n');

        // add clip styles inline (this method need for support IE8 and less browsers)
        if (_this.$clipStyles.styleSheet){
            _this.$clipStyles.styleSheet.cssText = styles;
        } else {
            _this.$clipStyles.innerHTML = styles;
        }
    };

    Jarallax.prototype.coverImage = function () {
        var _this = this;

        if(!_this.image.width || !_this.image.height) {
            return;
        }

        var rect       = _this.image.$container.getBoundingClientRect(),
            contW      = rect.width,
            contH      = rect.height,
            contL      = rect.left,
            imgW       = _this.image.width,
            imgH       = _this.image.height,
            speed      = _this.options.speed,
            isScroll   = _this.options.type === 'scroll' || _this.options.type === 'scroll-opacity',
            scrollDist = 0,
            resultW    = 0,
            resultH    = contH,
            resultML   = 0,
            resultMT   = 0;

        // scroll parallax
        if(isScroll) {
            // scroll distance and height for image
            if (speed < 0) {
                scrollDist = speed * Math.max(contH, wndH);
            } else {
                scrollDist = speed * (contH + wndH);
            }

            // size for scroll parallax
            if (speed > 1) {
                resultH = Math.abs(scrollDist - wndH);
            } else if (speed < 0) {
                resultH = scrollDist / speed + Math.abs(scrollDist);
            }  else {
                resultH += Math.abs(wndH - contH) * (1 - speed);
            }

            scrollDist /= 2;
        }

        // calculate width relative to height and image size
        resultW = resultH * imgW / imgH;
        if(resultW < contW) {
            resultW = contW;
            resultH = resultW * imgH / imgW;
        }

        // center parallax image
        if(isScroll) {
            resultML = contL + (contW - resultW) / 2;
            resultMT = (wndH - resultH) / 2;
        } else {
            resultML = (contW - resultW) / 2;
            resultMT = (contH - resultH) / 2;
        }

        // fix if parallax block in absolute position
        if(_this.image.position === 'absolute') {
            resultML -= contL;
        }

        // store scroll distance
        _this.parallaxScrollDistance = scrollDist;

        // apply result to item
        _this.css(_this.image.$item, {
            width: resultW + 'px',
            height: resultH + 'px',
            marginLeft: resultML + 'px',
            marginTop: resultMT + 'px'
        });

        // call onCoverImage event
        if(_this.options.onCoverImage) {
            _this.options.onCoverImage.call(_this);
        }
    };

    Jarallax.prototype.isVisible = function () {
        return this.isElementInViewport || false;
    };

    Jarallax.prototype.onScroll = function (force) {
        var _this = this;

        if(!_this.image.width || !_this.image.height) {
            return;
        }

        var rect   = _this.$item.getBoundingClientRect(),
            contT  = rect.top,
            contH  = rect.height,
            styles = {
                visibility         : 'visible',
                backgroundPosition : '50% 50%'
            };

        // check if in viewport
        var viewportRect = rect;
        if(_this.options.elementInViewport) {
            viewportRect = _this.options.elementInViewport.getBoundingClientRect();
        }
        _this.isElementInViewport =
            viewportRect.bottom >= 0 &&
            viewportRect.right >= 0 &&
            viewportRect.top <= wndH &&
            viewportRect.left <= wndW;

        // stop calculations if item is not in viewport
        if (force ? false : !_this.isElementInViewport) {
            return;
        }

        // calculate parallax helping variables
        var beforeTop = Math.max(0, contT),
            beforeTopEnd = Math.max(0, contH + contT),
            afterTop = Math.max(0, -contT),
            beforeBottom = Math.max(0, contT + contH - wndH),
            beforeBottomEnd = Math.max(0, contH - (contT + contH - wndH)),
            afterBottom = Math.max(0, -contT + wndH - contH),
            fromViewportCenter = 1 - 2 * (wndH - contT) / (wndH + contH);

        // calculate on how percent of section is visible
        var visiblePercent = 1;
        if(contH < wndH) {
            visiblePercent = 1 - (afterTop || beforeBottom) / contH;
        } else {
            if(beforeTopEnd <= wndH) {
                visiblePercent = beforeTopEnd / wndH;
            } else if (beforeBottomEnd <= wndH) {
                visiblePercent = beforeBottomEnd / wndH;
            }
        }

        // opacity
        if(_this.options.type === 'opacity' || _this.options.type === 'scale-opacity' || _this.options.type === 'scroll-opacity') {
            styles.transform = ''; // empty to add translateZ(0) where it is possible
            styles.opacity = visiblePercent;
        }

        // scale
        if(_this.options.type === 'scale' || _this.options.type === 'scale-opacity') {
            var scale = 1;
            if(_this.options.speed < 0) {
                scale -= _this.options.speed * visiblePercent;
            } else {
                scale += _this.options.speed * (1 - visiblePercent);
            }
            styles.transform = 'scale(' + scale + ')';
        }

        // scroll
        if(_this.options.type === 'scroll' || _this.options.type === 'scroll-opacity') {
            var positionY = _this.parallaxScrollDistance * fromViewportCenter;

            // fix if parallax block in absolute position
            if(_this.image.position === 'absolute') {
                positionY -= contT;
            }

            styles.transform = 'translateY(' + positionY + 'px)';
        }

        _this.css(_this.image.$item, styles);

        // call onScroll event
        if(_this.options.onScroll) {
            _this.options.onScroll.call(_this, {
                section: rect,

                beforeTop: beforeTop,
                beforeTopEnd: beforeTopEnd,
                afterTop: afterTop,
                beforeBottom: beforeBottom,
                beforeBottomEnd: beforeBottomEnd,
                afterBottom: afterBottom,

                visiblePercent: visiblePercent,
                fromViewportCenter: fromViewportCenter
            });
        }
    };


    // init events
    function addEventListener (el, eventName, handler) {
        if (el.addEventListener) {
            el.addEventListener(eventName, handler);
        } else {
            el.attachEvent('on' + eventName, function (){
                handler.call(el);
            });
        }
    }

    function update (e) {
        window.requestAnimationFrame(function () {
            if(e.type !== 'scroll') {
                updateWndVars();
            }
            for(var k = 0, len = jarallaxList.length; k < len; k++) {
                // cover image and clip needed only when parallax container was changed
                if(e.type !== 'scroll') {
                    jarallaxList[k].coverImage();
                    jarallaxList[k].clipContainer();
                }
                jarallaxList[k].onScroll();
            }
        });
    }
    addEventListener(window, 'scroll', update);
    addEventListener(window, 'resize', update);
    addEventListener(window, 'orientationchange', update);
    addEventListener(window, 'load', update);


    // global definition
    var plugin = function (items) {
        // check for dom element
        // thanks: http://stackoverflow.com/questions/384286/javascript-isdom-how-do-you-check-if-a-javascript-object-is-a-dom-object
        if(typeof HTMLElement === "object" ? items instanceof HTMLElement : items && typeof items === "object" && items !== null && items.nodeType === 1 && typeof items.nodeName==="string") {
            items = [items];
        }

        var options = arguments[1],
            args = Array.prototype.slice.call(arguments, 2),
            len = items.length,
            k = 0,
            ret;

        for (k; k < len; k++) {
            if (typeof options === 'object' || typeof options === 'undefined') {
                if(!items[k].jarallax) {
                    items[k].jarallax = new Jarallax(items[k], options);
                }
            }
            else if(items[k].jarallax) {
                ret = items[k].jarallax[options].apply(items[k].jarallax, args);
            }
            if (typeof ret !== 'undefined') {
                return ret;
            }
        }

        return items;
    };
    plugin.constructor = Jarallax;

    // no conflict
    var oldPlugin = window.jarallax;
    window.jarallax = plugin;
    window.jarallax.noConflict = function () {
        window.jarallax = oldPlugin;
        return this;
    };

    // jQuery support
    if(typeof jQuery !== 'undefined') {
        var jQueryPlugin = function () {
            var args = arguments || [];
            Array.prototype.unshift.call(args, this);
            var res = plugin.apply(window, args);
            return typeof res !== 'object' ? res : this;
        };
        jQueryPlugin.constructor = Jarallax;

        // no conflict
        var oldJqPlugin = jQuery.fn.jarallax;
        jQuery.fn.jarallax = jQueryPlugin;
        jQuery.fn.jarallax.noConflict = function () {
            jQuery.fn.jarallax = oldJqPlugin;
            return this;
        };
    }

    // data-jarallax initialization
    addEventListener(window, 'DOMContentLoaded', function () {
        plugin(document.querySelectorAll('[data-jarallax], [data-jarallax-video]'));
    });
}(window));
/*!
 Mailchimp Ajax Submit
 jQuery Plugin
 Author: Siddharth Doshi

 Use:
 ===
 $('#form_id').ajaxchimp(options);

 - Form should have one <input> element with attribute 'type=email'
 - Form should have one label element with attribute 'for=email_input_id' (used to display error/success message)
 - All options are optional.

 Options:
 =======
 options = {
 language: 'en',
 callback: callbackFunction,
 url: 'http://blahblah.us1.list-manage.com/subscribe/post?u=5afsdhfuhdsiufdba6f8802&id=4djhfdsh99f'
 }

 Notes:
 =====
 To get the mailchimp JSONP url (undocumented), change 'post?' to 'post-json?' and add '&c=?' to the end.
 For e.g. 'http://blahblah.us1.list-manage.com/subscribe/post-json?u=5afsdhfuhdsiufdba6f8802&id=4djhfdsh99f&c=?',
 */

(function ($) {
    'use strict';

    $.ajaxChimp = {
        responses: {
            0: 'We have sent you a confirmation email',
            1: 'Please enter a value',
            2: 'An email address must contain a single @',
            3: 'The domain portion of the email address is invalid',
            4: 'The username portion of the email address is invalid',
            5: 'This email address looks fake or invalid. Please enter a real email address',
            6: 'is already subscribed to list'
        },
        translations: {
            'en': null
        },
        init: function (selector, options) {
            $(selector).ajaxChimp(options);
        }
    };

    $.fn.ajaxChimp = function (options) {
        $(this).each(function(i, elem) {
            var form = $(elem);
            var email = form.find('input[type=email]');

            var label;
            if (options.label) {
                label = options.label;
            } else {
                label = form.find('label[for=' + email.attr('id') + ']');
            }

            var settings = $.extend({
                'url': form.attr('action'),
                'language': 'en'
            }, options);

            var url = settings.url.replace('/post?', '/post-json?').concat('&c=?');

            form.attr('novalidate', 'true');
            email.attr('name', 'EMAIL');

            form.submit(function () {
                var msg;
                function successCallback(resp) {
                    if (resp.result === 'success') {
                        msg = 'We have sent you a confirmation email';
                        label.removeClass('error').addClass('valid');
                        email.removeClass('error').addClass('valid');
                    } else {
                        email.removeClass('valid').addClass('error');
                        label.removeClass('valid').addClass('error');
                        var index = -1;
                        try {
                            var parts = resp.msg.split(' - ', 2);
                            if (parts[1] === undefined) {
                                msg = resp.msg;
                            } else {
                                var i = parseInt(parts[0], 10);
                                if (i.toString() === parts[0]) {
                                    index = parts[0];
                                    msg = parts[1];
                                } else {
                                    index = -1;
                                    msg = resp.msg;
                                }
                            }
                        }
                        catch (e) {
                            index = -1;
                            msg = resp.msg;
                        }
                    }


                    // Translate and display message
                    var length = 0, msgnr;

                    if(Object.keys){
                        length = Object.keys($.ajaxChimp.responses).length
                    }
                    else {
                        for (var key in $.ajaxChimp.responses){
                            if ($.ajaxChimp.responses.hasOwnProperty(key)) {
                                length++;
                            }
                        }
                    }

                    while(length--) {
                        if (msg.indexOf($.ajaxChimp.responses[length])!==-1) {
                            msgnr = length;
                        }
                    }

                    if (
                        settings.language !== 'en' && msgnr > -1 && $.ajaxChimp.translations && $.ajaxChimp.translations[settings.language] && $.ajaxChimp.translations[settings.language][msgnr]
                    ) {
                        msg = $.ajaxChimp.translations[settings.language][msgnr];
                    }
                    label.html(msg);

                    label.show(2000);
                    if (settings.callback) {
                        settings.callback(resp);
                    }
                }

                var data = {};
                var dataArray = form.serializeArray();
                $.each(dataArray, function (index, item) {
                    data[item.name] = item.value;
                });

                $.ajax({
                    url: url,
                    data: data,
                    success: successCallback,
                    dataType: 'jsonp',
                    error: function (resp, text) {
                        window.console.log('mailchimp ajax submit error: ' + text);
                    }
                });

                // Translate and display submit message
                var submitMsg = 'Submitting...';
                if(
                    settings.language !== 'en' && $.ajaxChimp.translations && $.ajaxChimp.translations[settings.language] && $.ajaxChimp.translations[settings.language].submit
                ) {
                    submitMsg = $.ajaxChimp.translations[settings.language].submit;
                }
                label.html(submitMsg).show(2000);

                return false;
            });
        });
        return this;
    };
})(jQuery);
/*
 * jQuery appear plugin
 *
 * Copyright (c) 2012 Andrey Sidorov
 * licensed under MIT license.
 *
 * https://github.com/morr/jquery.appear/
 *
 * Version: 0.3.6
 */
(function($) {
    var selectors = [];

    var check_binded = false;
    var check_lock = false;
    var defaults = {
        interval: 250,
        force_process: false
    };
    var $window = $(window);

    var $prior_appeared = [];

    function appeared(selector) {
        return $(selector).filter(function() {
            return $(this).is(':appeared');
        });
    }

    function process() {
        check_lock = false;
        for (var index = 0, selectorsLength = selectors.length; index < selectorsLength; index++) {
            var $appeared = appeared(selectors[index]);

            $appeared.trigger('appear', [$appeared]);

            if ($prior_appeared[index]) {
                var $disappeared = $prior_appeared[index].not($appeared);
                $disappeared.trigger('disappear', [$disappeared]);
            }
            $prior_appeared[index] = $appeared;
        }
    }

    function add_selector(selector) {
        selectors.push(selector);
        $prior_appeared.push();
    }

    // "appeared" custom filter
    $.expr[':'].appeared = function(element) {
        var $element = $(element);
        if (!$element.is(':visible')) {
            return false;
        }

        var window_left = $window.scrollLeft();
        var window_top = $window.scrollTop();
        var offset = $element.offset();
        var left = offset.left;
        var top = offset.top;

        if (top + $element.height() >= window_top &&
            top - ($element.data('appear-top-offset') || 0) <= window_top + $window.height() &&
            left + $element.width() >= window_left &&
            left - ($element.data('appear-left-offset') || 0) <= window_left + $window.width()) {
            return true;
        } else {
            return false;
        }
    };

    $.fn.extend({
        // watching for element's appearance in browser viewport
        appear: function(options) {
            var opts = $.extend({}, defaults, options || {});
            var selector = this.selector || this;
            if (!check_binded) {
                var on_check = function() {
                    if (check_lock) {
                        return;
                    }
                    check_lock = true;

                    setTimeout(process, opts.interval);
                };

                $(window).scroll(on_check).resize(on_check);
                check_binded = true;
            }

            if (opts.force_process) {
                setTimeout(process, opts.interval);
            }
            add_selector(selector);
            return $(selector);
        }
    });

    $.extend({
        // force elements's appearance check
        force_appear: function() {
            if (check_binded) {
                process();
                return true;
            }
            return false;
        }
    });
})(function() {
    if (typeof module !== 'undefined') {
        // Node
        return require('jquery');
    } else {
        return jQuery;
    }
}());
/**
 * jquery-circle-progress - jQuery Plugin to draw animated circular progress bars:
 * {@link http://kottenator.github.io/jquery-circle-progress/}
 *
 * @author Rostyslav Bryzgunov <kottenator@gmail.com>
 * @version 1.2.2
 * @licence MIT
 * @preserve
 */
// UMD factory - https://github.com/umdjs/umd/blob/d31bb6ee7098715e019f52bdfe27b3e4bfd2b97e/templates/jqueryPlugin.js
// Uses AMD, CommonJS or browser globals to create a jQuery plugin.
(function(factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD - register as an anonymous module
        define(['jquery'], factory);
    } else if (typeof module === 'object' && module.exports) {
        // Node/CommonJS
        var $ = require('jquery');
        factory($);
        module.exports = $;
    } else {
        // Browser globals
        factory(jQuery);
    }
})(function($) {
    /**
     * Inner implementation of the circle progress bar.
     * The class is not exposed _yet_ but you can create an instance through jQuery method call.
     *
     * @param {object} config - You can customize any class member (property or method).
     * @class
     * @alias CircleProgress
     */
    function CircleProgress(config) {
        this.init(config);
    }

    CircleProgress.prototype = {
        //--------------------------------------- public options ---------------------------------------
        /**
         * This is the only required option. It should be from `0.0` to `1.0`.
         * @type {number}
         * @default 0.0
         */
        value: 0.0,

        /**
         * Size of the canvas in pixels.
         * It's a square so we need only one dimension.
         * @type {number}
         * @default 100.0
         */
        size: 100.0,

        /**
         * Initial angle for `0.0` value in radians.
         * @type {number}
         * @default -Math.PI
         */
        startAngle: -Math.PI,

        /**
         * Width of the arc in pixels.
         * If it's `'auto'` - the value is calculated as `[this.size]{@link CircleProgress#size} / 14`.
         * @type {number|string}
         * @default 'auto'
         */
        thickness: 'auto',

        /**
         * Fill of the arc. You may set it to:
         *
         *   - solid color:
         *     - `'#3aeabb'`
         *     - `{ color: '#3aeabb' }`
         *     - `{ color: 'rgba(255, 255, 255, .3)' }`
         *   - linear gradient _(left to right)_:
         *     - `{ gradient: ['#3aeabb', '#fdd250'], gradientAngle: Math.PI / 4 }`
         *     - `{ gradient: ['red', 'green', 'blue'], gradientDirection: [x0, y0, x1, y1] }`
         *     - `{ gradient: [["red", .2], ["green", .3], ["blue", .8]] }`
         *   - image:
         *     - `{ image: 'http://i.imgur.com/pT0i89v.png' }`
         *     - `{ image: imageObject }`
         *     - `{ color: 'lime', image: 'http://i.imgur.com/pT0i89v.png' }` -
         *       color displayed until the image is loaded
         *
         * @default {gradient: ['#3aeabb', '#fdd250']}
         */
        fill: {
            gradient: ['#3aeabb', '#fdd250']
        },

        /**
         * Color of the "empty" arc. Only a color fill supported by now.
         * @type {string}
         * @default 'rgba(0, 0, 0, .1)'
         */
        emptyFill: 'rgba(0, 0, 0, .1)',

        /**
         * jQuery Animation config.
         * You can pass `false` to disable the animation.
         * @see http://api.jquery.com/animate/
         * @type {object|boolean}
         * @default {duration: 1200, easing: 'circleProgressEasing'}
         */
        animation: {
            duration: 1200,
            easing: 'circleProgressEasing'
        },

        /**
         * Default animation starts at `0.0` and ends at specified `value`. Let's call this _direct animation_.
         * If you want to make _reversed animation_ - set `animationStartValue: 1.0`.
         * Also you may specify any other value from `0.0` to `1.0`.
         * @type {number}
         * @default 0.0
         */
        animationStartValue: 0.0,

        /**
         * Reverse animation and arc draw.
         * By default, the arc is filled from `0.0` to `value`, _clockwise_.
         * With `reverse: true` the arc is filled from `1.0` to `value`, _counter-clockwise_.
         * @type {boolean}
         * @default false
         */
        reverse: false,

        /**
         * Arc line cap: `'butt'`, `'round'` or `'square'` -
         * [read more]{@link https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D.lineCap}.
         * @type {string}
         * @default 'butt'
         */
        lineCap: 'butt',

        /**
         * Canvas insertion mode: append or prepend it into the parent element?
         * @type {string}
         * @default 'prepend'
         */
        insertMode: 'prepend',

        //------------------------------ protected properties and methods ------------------------------
        /**
         * Link to {@link CircleProgress} constructor.
         * @protected
         */
        constructor: CircleProgress,

        /**
         * Container element. Should be passed into constructor config.
         * @protected
         * @type {jQuery}
         */
        el: null,

        /**
         * Canvas element. Automatically generated and prepended to [this.el]{@link CircleProgress#el}.
         * @protected
         * @type {HTMLCanvasElement}
         */
        canvas: null,

        /**
         * 2D-context of [this.canvas]{@link CircleProgress#canvas}.
         * @protected
         * @type {CanvasRenderingContext2D}
         */
        ctx: null,

        /**
         * Radius of the outer circle. Automatically calculated as `[this.size]{@link CircleProgress#size} / 2`.
         * @protected
         * @type {number}
         */
        radius: 0.0,

        /**
         * Fill of the main arc. Automatically calculated, depending on [this.fill]{@link CircleProgress#fill} option.
         * @protected
         * @type {string|CanvasGradient|CanvasPattern}
         */
        arcFill: null,

        /**
         * Last rendered frame value.
         * @protected
         * @type {number}
         */
        lastFrameValue: 0.0,

        /**
         * Init/re-init the widget.
         *
         * Throws a jQuery event:
         *
         * - `circle-inited(jqEvent)`
         *
         * @param {object} config - You can customize any class member (property or method).
         */
        init: function(config) {
            $.extend(this, config);
            this.radius = this.size / 2;
            this.initWidget();
            this.initFill();
            this.draw();
            this.el.trigger('circle-inited');
        },

        /**
         * Initialize `<canvas>`.
         * @protected
         */
        initWidget: function() {
            if (!this.canvas)
                this.canvas = $('<canvas>')[this.insertMode == 'prepend' ? 'prependTo' : 'appendTo'](this.el)[0];

            var canvas = this.canvas;
            canvas.width = this.size;
            canvas.height = this.size;
            this.ctx = canvas.getContext('2d');

            if (window.devicePixelRatio > 1) {
                var scaleBy = window.devicePixelRatio;
                canvas.style.width = canvas.style.height = this.size + 'px';
                canvas.width = canvas.height = this.size * scaleBy;
                this.ctx.scale(scaleBy, scaleBy);
            }
        },

        /**
         * This method sets [this.arcFill]{@link CircleProgress#arcFill}.
         * It could do this async (on image load).
         * @protected
         */
        initFill: function() {
            var self = this,
                fill = this.fill,
                ctx = this.ctx,
                size = this.size;

            if (!fill)
                throw Error("The fill is not specified!");

            if (typeof fill == 'string')
                fill = {color: fill};

            if (fill.color)
                this.arcFill = fill.color;

            if (fill.gradient) {
                var gr = fill.gradient;

                if (gr.length == 1) {
                    this.arcFill = gr[0];
                } else if (gr.length > 1) {
                    var ga = fill.gradientAngle || 0, // gradient direction angle; 0 by default
                        gd = fill.gradientDirection || [
                                size / 2 * (1 - Math.cos(ga)), // x0
                                size / 2 * (1 + Math.sin(ga)), // y0
                                size / 2 * (1 + Math.cos(ga)), // x1
                                size / 2 * (1 - Math.sin(ga))  // y1
                            ];

                    var lg = ctx.createLinearGradient.apply(ctx, gd);

                    for (var i = 0; i < gr.length; i++) {
                        var color = gr[i],
                            pos = i / (gr.length - 1);

                        if ($.isArray(color)) {
                            pos = color[1];
                            color = color[0];
                        }

                        lg.addColorStop(pos, color);
                    }

                    this.arcFill = lg;
                }
            }

            if (fill.image) {
                var img;

                if (fill.image instanceof Image) {
                    img = fill.image;
                } else {
                    img = new Image();
                    img.src = fill.image;
                }

                if (img.complete)
                    setImageFill();
                else
                    img.onload = setImageFill;
            }

            function setImageFill() {
                var bg = $('<canvas>')[0];
                bg.width = self.size;
                bg.height = self.size;
                bg.getContext('2d').drawImage(img, 0, 0, size, size);
                self.arcFill = self.ctx.createPattern(bg, 'no-repeat');
                self.drawFrame(self.lastFrameValue);
            }
        },

        /**
         * Draw the circle.
         * @protected
         */
        draw: function() {
            if (this.animation)
                this.drawAnimated(this.value);
            else
                this.drawFrame(this.value);
        },

        /**
         * Draw a single animation frame.
         * @protected
         * @param {number} v - Frame value.
         */
        drawFrame: function(v) {
            this.lastFrameValue = v;
            this.ctx.clearRect(0, 0, this.size, this.size);
            this.drawEmptyArc(v);
            this.drawArc(v);
        },

        /**
         * Draw the arc (part of the circle).
         * @protected
         * @param {number} v - Frame value.
         */
        drawArc: function(v) {
            if (v === 0)
                return;

            var ctx = this.ctx,
                r = this.radius,
                t = this.getThickness(),
                a = this.startAngle;

            ctx.save();
            ctx.beginPath();

            if (!this.reverse) {
                ctx.arc(r, r, r - t / 2, a, a + Math.PI * 2 * v);
            } else {
                ctx.arc(r, r, r - t / 2, a - Math.PI * 2 * v, a);
            }

            ctx.lineWidth = t;
            ctx.lineCap = this.lineCap;
            ctx.strokeStyle = this.arcFill;
            ctx.stroke();
            ctx.restore();
        },

        /**
         * Draw the _empty (background)_ arc (part of the circle).
         * @protected
         * @param {number} v - Frame value.
         */
        drawEmptyArc: function(v) {
            var ctx = this.ctx,
                r = this.radius,
                t = this.getThickness(),
                a = this.startAngle;

            if (v < 1) {
                ctx.save();
                ctx.beginPath();

                if (v <= 0) {
                    ctx.arc(r, r, r - t / 2, 0, Math.PI * 2);
                } else {
                    if (!this.reverse) {
                        ctx.arc(r, r, r - t / 2, a + Math.PI * 2 * v, a);
                    } else {
                        ctx.arc(r, r, r - t / 2, a, a - Math.PI * 2 * v);
                    }
                }

                ctx.lineWidth = t;
                ctx.strokeStyle = this.emptyFill;
                ctx.stroke();
                ctx.restore();
            }
        },

        /**
         * Animate the progress bar.
         *
         * Throws 3 jQuery events:
         *
         * - `circle-animation-start(jqEvent)`
         * - `circle-animation-progress(jqEvent, animationProgress, stepValue)` - multiple event
         *   animationProgress: from `0.0` to `1.0`; stepValue: from `0.0` to `value`
         * - `circle-animation-end(jqEvent)`
         *
         * @protected
         * @param {number} v - Final value.
         */
        drawAnimated: function(v) {
            var self = this,
                el = this.el,
                canvas = $(this.canvas);

            // stop previous animation before new "start" event is triggered
            canvas.stop(true, false);
            el.trigger('circle-animation-start');

            canvas
                .css({animationProgress: 0})
                .animate({animationProgress: 1}, $.extend({}, this.animation, {
                    step: function(animationProgress) {
                        var stepValue = self.animationStartValue * (1 - animationProgress) + v * animationProgress;
                        self.drawFrame(stepValue);
                        el.trigger('circle-animation-progress', [animationProgress, stepValue]);
                    }
                }))
                .promise()
                .always(function() {
                    // trigger on both successful & failure animation end
                    el.trigger('circle-animation-end');
                });
        },

        /**
         * Get the circle thickness.
         * @see CircleProgress#thickness
         * @protected
         * @returns {number}
         */
        getThickness: function() {
            return $.isNumeric(this.thickness) ? this.thickness : this.size / 14;
        },

        /**
         * Get current value.
         * @protected
         * @return {number}
         */
        getValue: function() {
            return this.value;
        },

        /**
         * Set current value (with smooth animation transition).
         * @protected
         * @param {number} newValue
         */
        setValue: function(newValue) {
            if (this.animation)
                this.animationStartValue = this.lastFrameValue;
            this.value = newValue;
            this.draw();
        }
    };

    //----------------------------------- Initiating jQuery plugin -----------------------------------
    $.circleProgress = {
        // Default options (you may override them)
        defaults: CircleProgress.prototype
    };

    // ease-in-out-cubic
    $.easing.circleProgressEasing = function(x) {
        if (x < 0.5) {
            x = 2 * x;
            return 0.5 * x * x * x;
        } else {
            x = 2 - 2 * x;
            return 1 - 0.5 * x * x * x;
        }
    };

    /**
     * Creates an instance of {@link CircleProgress}.
     * Produces [init event]{@link CircleProgress#init} and [animation events]{@link CircleProgress#drawAnimated}.
     *
     * @param {object} [configOrCommand] - Config object or command name.
     *
     * Config example (you can specify any {@link CircleProgress} property):
     *
     * ```js
     * { value: 0.75, size: 50, animation: false }
     * ```
     *
     * Commands:
     *
     * ```js
     * el.circleProgress('widget'); // get the <canvas>
     * el.circleProgress('value'); // get the value
     * el.circleProgress('value', newValue); // update the value
     * el.circleProgress('redraw'); // redraw the circle
     * el.circleProgress(); // the same as 'redraw'
     * ```
     *
     * @param {string} [commandArgument] - Some commands (like `'value'`) may require an argument.
     * @see CircleProgress
     * @alias "$(...).circleProgress"
     */
    $.fn.circleProgress = function(configOrCommand, commandArgument) {
        var dataName = 'circle-progress',
            firstInstance = this.data(dataName);

        if (configOrCommand == 'widget') {
            if (!firstInstance)
                throw Error('Calling "widget" method on not initialized instance is forbidden');
            return firstInstance.canvas;
        }

        if (configOrCommand == 'value') {
            if (!firstInstance)
                throw Error('Calling "value" method on not initialized instance is forbidden');
            if (typeof commandArgument == 'undefined') {
                return firstInstance.getValue();
            } else {
                var newValue = arguments[1];
                return this.each(function() {
                    $(this).data(dataName).setValue(newValue);
                });
            }
        }

        return this.each(function() {
            var el = $(this),
                instance = el.data(dataName),
                config = $.isPlainObject(configOrCommand) ? configOrCommand : {};

            if (instance) {
                instance.init(config);
            } else {
                var initialConfig = $.extend({}, el.data());
                if (typeof initialConfig.fill == 'string')
                    initialConfig.fill = JSON.parse(initialConfig.fill);
                if (typeof initialConfig.animation == 'string')
                    initialConfig.animation = JSON.parse(initialConfig.animation);
                config = $.extend(initialConfig, config);
                config.el = el;
                instance = new CircleProgress(config);
                el.data(dataName, instance);
            }
        });
    };
});

/*!
 * The Final Countdown for jQuery v2.2.0 (http://hilios.github.io/jQuery.countdown/)
 * Copyright (c) 2016 Edson Hilios
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(factory) {
    "use strict";
    if (typeof define === "function" && define.amd) {
        define([ "jquery" ], factory);
    } else {
        factory(jQuery);
    }
})(function($) {
    "use strict";
    var instances = [], matchers = [], defaultOptions = {
        precision: 100,
        elapse: false,
        defer: false
    };
    matchers.push(/^[0-9]*$/.source);
    matchers.push(/([0-9]{1,2}\/){2}[0-9]{4}( [0-9]{1,2}(:[0-9]{2}){2})?/.source);
    matchers.push(/[0-9]{4}([\/\-][0-9]{1,2}){2}( [0-9]{1,2}(:[0-9]{2}){2})?/.source);
    matchers = new RegExp(matchers.join("|"));
    function parseDateString(dateString) {
        if (dateString instanceof Date) {
            return dateString;
        }
        if (String(dateString).match(matchers)) {
            if (String(dateString).match(/^[0-9]*$/)) {
                dateString = Number(dateString);
            }
            if (String(dateString).match(/\-/)) {
                dateString = String(dateString).replace(/\-/g, "/");
            }
            return new Date(dateString);
        } else {
            throw new Error("Couldn't cast `" + dateString + "` to a date object.");
        }
    }
    var DIRECTIVE_KEY_MAP = {
        Y: "years",
        m: "months",
        n: "daysToMonth",
        d: "daysToWeek",
        w: "weeks",
        W: "weeksToMonth",
        H: "hours",
        M: "minutes",
        S: "seconds",
        D: "totalDays",
        I: "totalHours",
        N: "totalMinutes",
        T: "totalSeconds"
    };
    function escapedRegExp(str) {
        var sanitize = str.toString().replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
        return new RegExp(sanitize);
    }
    function strftime(offsetObject) {
        return function(format) {
            var directives = format.match(/%(-|!)?[A-Z]{1}(:[^;]+;)?/gi);
            if (directives) {
                for (var i = 0, len = directives.length; i < len; ++i) {
                    var directive = directives[i].match(/%(-|!)?([a-zA-Z]{1})(:[^;]+;)?/), regexp = escapedRegExp(directive[0]), modifier = directive[1] || "", plural = directive[3] || "", value = null;
                    directive = directive[2];
                    if (DIRECTIVE_KEY_MAP.hasOwnProperty(directive)) {
                        value = DIRECTIVE_KEY_MAP[directive];
                        value = Number(offsetObject[value]);
                    }
                    if (value !== null) {
                        if (modifier === "!") {
                            value = pluralize(plural, value);
                        }
                        if (modifier === "") {
                            if (value < 10) {
                                value = "0" + value.toString();
                            }
                        }
                        format = format.replace(regexp, value.toString());
                    }
                }
            }
            format = format.replace(/%%/, "%");
            return format;
        };
    }
    function pluralize(format, count) {
        var plural = "s", singular = "";
        if (format) {
            format = format.replace(/(:|;|\s)/gi, "").split(/\,/);
            if (format.length === 1) {
                plural = format[0];
            } else {
                singular = format[0];
                plural = format[1];
            }
        }
        if (Math.abs(count) > 1) {
            return plural;
        } else {
            return singular;
        }
    }
    var Countdown = function(el, finalDate, options) {
        this.el = el;
        this.$el = $(el);
        this.interval = null;
        this.offset = {};
        this.options = $.extend({}, defaultOptions);
        this.instanceNumber = instances.length;
        instances.push(this);
        this.$el.data("countdown-instance", this.instanceNumber);
        if (options) {
            if (typeof options === "function") {
                this.$el.on("update.countdown", options);
                this.$el.on("stoped.countdown", options);
                this.$el.on("finish.countdown", options);
            } else {
                this.options = $.extend({}, defaultOptions, options);
            }
        }
        this.setFinalDate(finalDate);
        if (this.options.defer === false) {
            this.start();
        }
    };
    $.extend(Countdown.prototype, {
        start: function() {
            if (this.interval !== null) {
                clearInterval(this.interval);
            }
            var self = this;
            this.update();
            this.interval = setInterval(function() {
                self.update.call(self);
            }, this.options.precision);
        },
        stop: function() {
            clearInterval(this.interval);
            this.interval = null;
            this.dispatchEvent("stoped");
        },
        toggle: function() {
            if (this.interval) {
                this.stop();
            } else {
                this.start();
            }
        },
        pause: function() {
            this.stop();
        },
        resume: function() {
            this.start();
        },
        remove: function() {
            this.stop.call(this);
            instances[this.instanceNumber] = null;
            delete this.$el.data().countdownInstance;
        },
        setFinalDate: function(value) {
            this.finalDate = parseDateString(value);
        },
        update: function() {
            if (this.$el.closest("html").length === 0) {
                this.remove();
                return;
            }
            var hasEventsAttached = $._data(this.el, "events") !== undefined, now = new Date(), newTotalSecsLeft;
            newTotalSecsLeft = this.finalDate.getTime() - now.getTime();
            newTotalSecsLeft = Math.ceil(newTotalSecsLeft / 1e3);
            newTotalSecsLeft = !this.options.elapse && newTotalSecsLeft < 0 ? 0 : Math.abs(newTotalSecsLeft);
            if (this.totalSecsLeft === newTotalSecsLeft || !hasEventsAttached) {
                return;
            } else {
                this.totalSecsLeft = newTotalSecsLeft;
            }
            this.elapsed = now >= this.finalDate;
            this.offset = {
                seconds: this.totalSecsLeft % 60,
                minutes: Math.floor(this.totalSecsLeft / 60) % 60,
                hours: Math.floor(this.totalSecsLeft / 60 / 60) % 24,
                days: Math.floor(this.totalSecsLeft / 60 / 60 / 24) % 7,
                daysToWeek: Math.floor(this.totalSecsLeft / 60 / 60 / 24) % 7,
                daysToMonth: Math.floor(this.totalSecsLeft / 60 / 60 / 24 % 30.4368),
                weeks: Math.floor(this.totalSecsLeft / 60 / 60 / 24 / 7),
                weeksToMonth: Math.floor(this.totalSecsLeft / 60 / 60 / 24 / 7) % 4,
                months: Math.floor(this.totalSecsLeft / 60 / 60 / 24 / 30.4368),
                years: Math.abs(this.finalDate.getFullYear() - now.getFullYear()),
                totalDays: Math.floor(this.totalSecsLeft / 60 / 60 / 24),
                totalHours: Math.floor(this.totalSecsLeft / 60 / 60),
                totalMinutes: Math.floor(this.totalSecsLeft / 60),
                totalSeconds: this.totalSecsLeft
            };
            if (!this.options.elapse && this.totalSecsLeft === 0) {
                this.stop();
                this.dispatchEvent("finish");
            } else {
                this.dispatchEvent("update");
            }
        },
        dispatchEvent: function(eventName) {
            var event = $.Event(eventName + ".countdown");
            event.finalDate = this.finalDate;
            event.elapsed = this.elapsed;
            event.offset = $.extend({}, this.offset);
            event.strftime = strftime(this.offset);
            this.$el.trigger(event);
        }
    });
    $.fn.countdown = function() {
        var argumentsArray = Array.prototype.slice.call(arguments, 0);
        return this.each(function() {
            var instanceNumber = $(this).data("countdown-instance");
            if (instanceNumber !== undefined) {
                var instance = instances[instanceNumber], method = argumentsArray[0];
                if (Countdown.prototype.hasOwnProperty(method)) {
                    instance[method].apply(instance, argumentsArray.slice(1));
                } else if (String(method).match(/^[$A-Z_][0-9A-Z_$]*$/i) === null) {
                    instance.setFinalDate.call(instance, method);
                    instance.start();
                } else {
                    $.error("Method %s does not exist on jQuery.countdown".replace(/\%s/gi, method));
                }
            } else {
                new Countdown(this, argumentsArray[0], argumentsArray[1]);
            }
        });
    };
});
/*
 * $ Easing v1.3 - http://gsgd.co.uk/sandbox/$/easing/
 *
 * Uses the built in easing capabilities added In $ 1.1
 * to offer multiple easing options
 *
 * TERMS OF USE - $ Easing
 *
 * Open source under the BSD License.
 *
 * Copyright  2008 George McGinley Smith
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * Neither the name of the author nor the names of contributors may be used to endorse
 * or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */

(function($, undefined) {
    // t: current time, b: begInnIng value, c: change In value, d: duration
    $.easing['jswing'] = $.easing['swing'];

    $.extend(
        $.easing,
        {
            def: 'easeOutQuad',
            swing: function (x, t, b, c, d) {
                //alert($.easing.default);
                return $.easing[$.easing.def](x, t, b, c, d);
            },
            easeInQuad: function (x, t, b, c, d) {
                return c*(t/=d)*t + b;
            },
            easeOutQuad: function (x, t, b, c, d) {
                return -c *(t/=d)*(t-2) + b;
            },
            easeInOutQuad: function (x, t, b, c, d) {
                if ((t/=d/2) < 1) return c/2*t*t + b;
                return -c/2 * ((--t)*(t-2) - 1) + b;
            },
            easeInCubic: function (x, t, b, c, d) {
                return c*(t/=d)*t*t + b;
            },
            easeOutCubic: function (x, t, b, c, d) {
                return c*((t=t/d-1)*t*t + 1) + b;
            },
            easeInOutCubic: function (x, t, b, c, d) {
                if ((t/=d/2) < 1) return c/2*t*t*t + b;
                return c/2*((t-=2)*t*t + 2) + b;
            },
            easeInQuart: function (x, t, b, c, d) {
                return c*(t/=d)*t*t*t + b;
            },
            easeOutQuart: function (x, t, b, c, d) {
                return -c * ((t=t/d-1)*t*t*t - 1) + b;
            },
            easeInOutQuart: function (x, t, b, c, d) {
                if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
                return -c/2 * ((t-=2)*t*t*t - 2) + b;
            },
            easeInQuint: function (x, t, b, c, d) {
                return c*(t/=d)*t*t*t*t + b;
            },
            easeOutQuint: function (x, t, b, c, d) {
                return c*((t=t/d-1)*t*t*t*t + 1) + b;
            },
            easeInOutQuint: function (x, t, b, c, d) {
                if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
                return c/2*((t-=2)*t*t*t*t + 2) + b;
            },
            easeInSine: function (x, t, b, c, d) {
                return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
            },
            easeOutSine: function (x, t, b, c, d) {
                return c * Math.sin(t/d * (Math.PI/2)) + b;
            },
            easeInOutSine: function (x, t, b, c, d) {
                return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
            },
            easeInExpo: function (x, t, b, c, d) {
                return (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;
            },
            easeOutExpo: function (x, t, b, c, d) {
                return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
            },
            easeInOutExpo: function (x, t, b, c, d) {
                if (t==0) return b;
                if (t==d) return b+c;
                if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;
                return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;
            },
            easeInCirc: function (x, t, b, c, d) {
                return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;
            },
            easeOutCirc: function (x, t, b, c, d) {
                return c * Math.sqrt(1 - (t=t/d-1)*t) + b;
            },
            easeInOutCirc: function (x, t, b, c, d) {
                if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;
                return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;
            },
            easeInElastic: function (x, t, b, c, d) {
                var s=1.70158;var p=0;var a=c;
                if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
                if (a < Math.abs(c)) { a=c; var s=p/4; }
                else var s = p/(2*Math.PI) * Math.asin (c/a);
                return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
            },
            easeOutElastic: function (x, t, b, c, d) {
                var s=1.70158;var p=0;var a=c;
                if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
                if (a < Math.abs(c)) { a=c; var s=p/4; }
                else var s = p/(2*Math.PI) * Math.asin (c/a);
                return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;
            },
            easeInOutElastic: function (x, t, b, c, d) {
                var s=1.70158;var p=0;var a=c;
                if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);
                if (a < Math.abs(c)) { a=c; var s=p/4; }
                else var s = p/(2*Math.PI) * Math.asin (c/a);
                if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
                return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;
            },
            easeInBack: function (x, t, b, c, d, s) {
                if (s == undefined) s = 1.70158;
                return c*(t/=d)*t*((s+1)*t - s) + b;
            },
            easeOutBack: function (x, t, b, c, d, s) {
                if (s == undefined) s = 1.70158;
                return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
            },
            easeInOutBack: function (x, t, b, c, d, s) {
                if (s == undefined) s = 1.70158;
                if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
                return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
            },
            easeInBounce: function (x, t, b, c, d) {
                return c - $.easing.easeOutBounce (x, d-t, 0, c, d) + b;
            },
            easeOutBounce: function (x, t, b, c, d) {
                if ((t/=d) < (1/2.75)) {
                    return c*(7.5625*t*t) + b;
                } else if (t < (2/2.75)) {
                    return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
                } else if (t < (2.5/2.75)) {
                    return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
                } else {
                    return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
                }
            },
            easeInOutBounce: function (x, t, b, c, d) {
                if (t < d/2) return $.easing.easeInBounce (x, t*2, 0, c, d) * .5 + b;
                return $.easing.easeOutBounce (x, t*2-d, 0, c, d) * .5 + c*.5 + b;
            }
        }
    );
})(jQuery);

/*
 *
 * TERMS OF USE - EASING EQUATIONS
 *
 * Open source under the BSD License.
 *
 * Copyright  2001 Robert Penner
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * Neither the name of the author nor the names of contributors may be used to endorse
 * or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
/*___________________________________________________________________________________________________________________________________________________
 _ jquery.mb.components                                                                                                                             _
 _                                                                                                                                                  _
 _ file: jquery.mb.YTPlayer.src.js                                                                                                                  _
 _ last modified: 11/05/17 19.54                                                                                                                    _
 _                                                                                                                                                  _
 _ Open Lab s.r.l., Florence - Italy                                                                                                                _
 _                                                                                                                                                  _
 _ email: matteo@open-lab.com                                                                                                                       _
 _ site: http://pupunzi.com                                                                                                                         _
 _       http://open-lab.com                                                                                                                        _
 _ blog: http://pupunzi.open-lab.com                                                                                                                _
 _ Q&A:  http://jquery.pupunzi.com                                                                                                                  _
 _                                                                                                                                                  _
 _ Licences: MIT, GPL                                                                                                                               _
 _    http://www.opensource.org/licenses/mit-license.php                                                                                            _
 _    http://www.gnu.org/licenses/gpl.html                                                                                                          _
 _                                                                                                                                                  _
 _ Copyright (c) 2001-2017. Matteo Bicocchi (Pupunzi);                                                                                              _
 ___________________________________________________________________________________________________________________________________________________*/
var ytp = ytp || {};

function onYouTubeIframeAPIReady() {
	if( ytp.YTAPIReady ) return;
	ytp.YTAPIReady = true;
	jQuery( document ).trigger( "YTAPIReady" );
}

//window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

var getYTPVideoID = function( url ) {
	var videoID, playlistID;
	if( url.indexOf( "youtu.be" ) > 0 ) {
		videoID = url.substr( url.lastIndexOf( "/" ) + 1, url.length );
		playlistID = videoID.indexOf( "?list=" ) > 0 ? videoID.substr( videoID.lastIndexOf( "=" ), videoID.length ) : null;
		videoID = playlistID ? videoID.substr( 0, videoID.lastIndexOf( "?" ) ) : videoID;
	} else if( url.indexOf( "http" ) > -1 ) {
		//videoID = url.match( /([\/&]v\/([^&#]*))|([\\?&]v=([^&#]*))/ )[ 1 ];
		videoID = url.match( /[\\?&]v=([^&#]*)/ )[ 1 ];
		playlistID = url.indexOf( "list=" ) > 0 ? url.match( /[\\?&]list=([^&#]*)/ )[ 1 ] : null;
	} else {
		videoID = url.length > 15 ? null : url;
		playlistID = videoID ? null : url;
	}
	return {
		videoID: videoID,
		playlistID: playlistID
	};
};

( function( jQuery, ytp ) {

	jQuery.mbYTPlayer = {
		name: "jquery.mb.YTPlayer",
		version: "3.0.20",
		build: "6308",
		author: "Matteo Bicocchi (pupunzi)",
		apiKey: "",
		defaults: {
			containment: "body",
			ratio: "auto", // "auto", "16/9", "4/3" or number: 4/3, 16/9
			videoURL: null,
			playlistURL: null,
			startAt: 0,
			stopAt: 0,
			autoPlay: true,
			vol: 50, // 1 to 100
			addRaster: false,
			mask: false,
			opacity: 1,
			quality: "default", //or small, medium, large, hd720, hd1080, highres
			mute: false,
			loop: true,
			fadeOnStartTime: 500, //fade in timing at video start
			showControls: true,
			showAnnotations: false,
			showYTLogo: true,
			stopMovieOnBlur: true,
			realfullscreen: true,
			mobileFallbackImage: null,
			gaTrack: true,
			optimizeDisplay: true,
			remember_last_time: false,
			playOnlyIfVisible: false,
			anchor: "center,center", // top,bottom,left,right combined in pair
			onReady: function( player ) {},
			onError: function( player, err ) {}
		},
		/**
		 *  @fontface icons
		 *  */
		controls: {
			play: "P",
			pause: "p",
			mute: "M",
			unmute: "A",
			onlyYT: "O",
			showSite: "R",
			ytLogo: "Y"
		},
		controlBar: null,
		loading: null,
		locationProtocol: "https:",

		filters: {
			grayscale: {
				value: 0,
				unit: "%"
			},
			hue_rotate: {
				value: 0,
				unit: "deg"
			},
			invert: {
				value: 0,
				unit: "%"
			},
			opacity: {
				value: 0,
				unit: "%"
			},
			saturate: {
				value: 0,
				unit: "%"
			},
			sepia: {
				value: 0,
				unit: "%"
			},
			brightness: {
				value: 0,
				unit: "%"
			},
			contrast: {
				value: 0,
				unit: "%"
			},
			blur: {
				value: 0,
				unit: "px"
			}
		},
		/**
		 *
		 * @param options
		 * @returns [players]
		 */
		buildPlayer: function( options ) {
			return this.each( function() {
				var YTPlayer = this;
				var $YTPlayer = jQuery( YTPlayer );
				YTPlayer.loop = 0;
				YTPlayer.opt = {};
				YTPlayer.state = 0;
				YTPlayer.filters = jQuery.mbYTPlayer.filters;
				YTPlayer.filtersEnabled = true;
				YTPlayer.id = YTPlayer.id || "YTP_" + new Date().getTime();
				$YTPlayer.addClass( "mb_YTPlayer" );

				var property = $YTPlayer.data( "property" ) && typeof $YTPlayer.data( "property" ) == "string" ? eval( '(' + $YTPlayer.data( "property" ) + ')' ) : $YTPlayer.data( "property" );

				if( typeof property != "undefined" && typeof property.vol != "undefined" ) {
					if( property.vol === 0 ) {
						property.vol = 1;
						property.mute = true;
					}
				}

				jQuery.extend( YTPlayer.opt, jQuery.mbYTPlayer.defaults, options, property );

				if( !YTPlayer.hasChanged ) {
					YTPlayer.defaultOpt = {};
					jQuery.extend( YTPlayer.defaultOpt, jQuery.mbYTPlayer.defaults, options );
				}

				if( YTPlayer.opt.loop == "true" )
					YTPlayer.opt.loop = 9999;

				YTPlayer.isRetina = ( window.retina || window.devicePixelRatio > 1 );
				var isIframe = function() {
					var isIfr = false;
					try {
						if( self.location.href != top.location.href ) isIfr = true;
					} catch( e ) {
						isIfr = true;
					}
					return isIfr;
				};

				YTPlayer.canGoFullScreen = !( jQuery.mbBrowser.msie || jQuery.mbBrowser.opera || isIframe() );
				if( !YTPlayer.canGoFullScreen ) YTPlayer.opt.realfullscreen = false;
				if( !$YTPlayer.attr( "id" ) ) $YTPlayer.attr( "id", "ytp_" + new Date().getTime() );
				var playerID = "iframe_" + YTPlayer.id;
				YTPlayer.isAlone = false;
				YTPlayer.hasFocus = true;
				YTPlayer.videoID = this.opt.videoURL ? getYTPVideoID( this.opt.videoURL ).videoID : $YTPlayer.attr( "href" ) ? getYTPVideoID( $YTPlayer.attr( "href" ) ).videoID : false;
				YTPlayer.playlistID = this.opt.videoURL ? getYTPVideoID( this.opt.videoURL ).playlistID : $YTPlayer.attr( "href" ) ? getYTPVideoID( $YTPlayer.attr( "href" ) ).playlistID : false;

				YTPlayer.opt.showAnnotations = YTPlayer.opt.showAnnotations ? '1' : '3';

				var start_from_last = 0;

				if( jQuery.mbCookie.get( "YTPlayer_start_from" + YTPlayer.videoID ) )
					start_from_last = parseFloat( jQuery.mbCookie.get( "YTPlayer_start_from" + YTPlayer.videoID ) );

				if( YTPlayer.opt.remember_last_time && start_from_last ) {
					YTPlayer.start_from_last = start_from_last;
					jQuery.mbCookie.remove( "YTPlayer_start_from" + YTPlayer.videoID );
				}

				if( jQuery.isTablet )
					YTPlayer.opt.autoPlay = false;

				var playerVars = {
					'modestbranding': 1,
					'autoplay': jQuery.isTablet ? 0 : 0,
					'controls': 0,
					'showinfo': 0,
					'rel': 0,
					'enablejsapi': 1,
					'version': 3,
					'playerapiid': playerID,
					'origin': '*',
					'allowfullscreen': true,
					'wmode': 'transparent',
					'iv_load_policy': YTPlayer.opt.showAnnotations,
					'playsinline': 1
				};


				if( document.createElement( 'video' ).canPlayType ) jQuery.extend( playerVars, {
					'html5': 1
				} );
				if( jQuery.mbBrowser.msie && jQuery.mbBrowser.version < 9 ) this.opt.opacity = 1;

				YTPlayer.isSelf = YTPlayer.opt.containment == "self";
				YTPlayer.defaultOpt.containment = YTPlayer.opt.containment = YTPlayer.opt.containment == "self" ? jQuery( this ) : jQuery( YTPlayer.opt.containment );
				YTPlayer.isBackground = YTPlayer.opt.containment.is( "body" );

				if( YTPlayer.isBackground && ytp.backgroundIsInited )
					return;

				var isPlayer = YTPlayer.opt.containment.is( jQuery( this ) );

				YTPlayer.canPlayOnMobile = isPlayer && jQuery( this ).children().length === 0;
				YTPlayer.isPlayer = false;

				/**
				 * Hide the placeholder if it's not the target of the player
				 */
				if( !isPlayer ) {
					$YTPlayer.hide();
				} else {
					YTPlayer.isPlayer = true;
				}

				var overlay = jQuery( "<div/>" ).css( {
					position: "absolute",
					top: 0,
					left: 0,
					width: "100%",
					height: "100%"
				} ).addClass( "YTPOverlay" );

				if( YTPlayer.isPlayer ) {
					overlay.on( "click", function() {
						$YTPlayer.YTPTogglePlay();
					} );
				}

				var wrapper = jQuery( "<div/>" ).addClass( "mbYTP_wrapper" ).attr( "id", "wrapper_" + YTPlayer.id );
				wrapper.css( {
					position: "absolute",
					zIndex: 0,
					minWidth: "100%",
					minHeight: "100%",
					left: 0,
					top: 0,
					overflow: "hidden",
					opacity: 0
				} );

				var playerBox = jQuery( "<div/>" ).attr( "id", playerID ).addClass( "playerBox" );
				playerBox.css( {
					position: "absolute",
					zIndex: 0,
					width: "100%",
					height: "100%",
					top: 0,
					left: 0,
					overflow: "hidden"
				} );

				wrapper.append( playerBox );

				YTPlayer.opt.containment.children().not( "script, style" ).each( function() {
					if( jQuery( this ).css( "position" ) == "static" ) jQuery( this ).css( "position", "relative" );
				} );

				if( YTPlayer.isBackground ) {
					jQuery( "body" ).css( {
						boxSizing: "border-box"
					} );

					wrapper.css( {
						position: "fixed",
						top: 0,
						left: 0,
						zIndex: 0
					} );

					$YTPlayer.hide();

				} else if( YTPlayer.opt.containment.css( "position" ) == "static" )
					YTPlayer.opt.containment.css( {
						position: "relative"
					} );

				YTPlayer.opt.containment.prepend( wrapper );
				YTPlayer.wrapper = wrapper;

				playerBox.css( {
					opacity: 1
				} );

				//if( !jQuery.mbBrowser.mobile ) {
				playerBox.after( overlay );
				YTPlayer.overlay = overlay;
				//	}

				if( jQuery.isTablet )
					jQuery( "body" ).one( "touchstart", function() {
						YTPlayer.player.playVideo();
					} );

				if( !YTPlayer.isBackground ) {
					overlay.on( "mouseenter", function() {
						if( YTPlayer.controlBar && YTPlayer.controlBar.length )
							YTPlayer.controlBar.addClass( "visible" );
					} ).on( "mouseleave", function() {
						if( YTPlayer.controlBar && YTPlayer.controlBar.length )
							YTPlayer.controlBar.removeClass( "visible" );
					} );
				}

				if( !ytp.YTAPIReady ) {
					jQuery( "#YTAPI" ).remove();
					var tag = jQuery( "<script/>" ).attr( {
						"async": "async",
						"src": jQuery.mbYTPlayer.locationProtocol + "//www.youtube.com/iframe_api?v=" + jQuery.mbYTPlayer.version,
						"id": "YTAPI"
					} );
					jQuery( "head" ).prepend( tag );
				} else {
					setTimeout( function() {
						jQuery( document ).trigger( "YTAPIReady" );
					}, 100 );
				}

				console.debug( jQuery.mbBrowser.mobile, jQuery.isTablet, YTPlayer.canPlayOnMobile );
				if( jQuery.mbBrowser.mobile && !jQuery.isTablet && !YTPlayer.canPlayOnMobile ) {

					if( YTPlayer.opt.mobileFallbackImage ) {
						wrapper.css( {
							backgroundImage: "url(" + YTPlayer.opt.mobileFallbackImage + ")",
							backgroundPosition: "center center",
							backgroundSize: "cover",
							backgroundRepeat: "no-repeat",
							opacity: 1
						} );
					}

					if( !YTPlayer.isPlayer )
						$YTPlayer.remove();
					jQuery( document ).trigger( "YTPUnavailable" );
					return;
				}

				jQuery( document ).on( "YTAPIReady", function() {
					if( ( YTPlayer.isBackground && ytp.backgroundIsInited ) || YTPlayer.isInit ) return;
					if( YTPlayer.isBackground ) {
						ytp.backgroundIsInited = true;
					}

					YTPlayer.opt.autoPlay = typeof YTPlayer.opt.autoPlay == "undefined" ? ( YTPlayer.isBackground ? true : false ) : YTPlayer.opt.autoPlay;
					YTPlayer.opt.vol = YTPlayer.opt.vol ? YTPlayer.opt.vol : 100;
					jQuery.mbYTPlayer.getDataFromAPI( YTPlayer );
					jQuery( YTPlayer ).on( "YTPChanged", function() {

						if( YTPlayer.isInit )
							return;

						YTPlayer.isInit = true;

						//if is mobile && isPlayer fallback to the default YT player
						if( jQuery.mbBrowser.mobile && YTPlayer.canPlayOnMobile && !jQuery.isTablet ) {
							// Try to adjust the player dimention
							if( YTPlayer.opt.containment.outerWidth() > jQuery( window ).width() ) {
								YTPlayer.opt.containment.css( {
									maxWidth: "100%"
								} );
								var h = YTPlayer.opt.containment.outerWidth() * .563;
								YTPlayer.opt.containment.css( {
									maxHeight: h
								} );
							}
							new YT.Player( playerID, {
								videoId: YTPlayer.videoID.toString(),
								width: '100%',
								height: h,
								playerVars: playerVars,
								events: {
									'onReady': function( event ) {
										YTPlayer.player = event.target;
										playerBox.css( {
											opacity: 1
										} );
										YTPlayer.wrapper.css( {
											opacity: 1
										} );
									}
								}
							} );
							return;
						}

						new YT.Player( playerID, {
							videoId: YTPlayer.videoID.toString(),
							playerVars: playerVars,
							events: {
								'onReady': function( event ) {
									YTPlayer.player = event.target;
									if( YTPlayer.isReady ) return;
									YTPlayer.isReady = YTPlayer.isPlayer && !YTPlayer.opt.autoPlay ? false : true;
									YTPlayer.playerEl = YTPlayer.player.getIframe();

									jQuery( YTPlayer.playerEl ).unselectable();

									$YTPlayer.optimizeDisplay();
									jQuery( window ).off( "resize.YTP_" + YTPlayer.id ).on( "resize.YTP_" + YTPlayer.id, function() {
										$YTPlayer.optimizeDisplay();
									} );

									if( YTPlayer.opt.remember_last_time ) {

										jQuery( window ).on( "unload.YTP_" + YTPlayer.id, function() {
											var current_time = YTPlayer.player.getCurrentTime();

											jQuery.mbCookie.set( "YTPlayer_start_from" + YTPlayer.videoID, current_time, 0 );
										} );

									}

									jQuery.mbYTPlayer.checkForState( YTPlayer );
								},
								/**
								 *
								 * @param event
								 *
								 * -1 (unstarted)
								 * 0 (ended)
								 * 1 (playing)
								 * 2 (paused)
								 * 3 (buffering)
								 * 5 (video cued).
								 *
								 *
								 */
								'onStateChange': function( event ) {
									if( typeof event.target.getPlayerState != "function" ) return;
									var state = event.target.getPlayerState();

									if( YTPlayer.preventTrigger ) {
										YTPlayer.preventTrigger = false;
										return;
									}

									YTPlayer.state = state;

									var eventType;
									switch( state ) {
										case -1: //----------------------------------------------- unstarted
											eventType = "YTPUnstarted";
											break;
										case 0: //------------------------------------------------ ended
											eventType = "YTPRealEnd";
											break;
										case 1: //------------------------------------------------ play
											eventType = "YTPPlay";
											if( YTPlayer.controlBar.length )
												YTPlayer.controlBar.find( ".mb_YTPPlaypause" ).html( jQuery.mbYTPlayer.controls.pause );
											if( typeof _gaq != "undefined" && eval( YTPlayer.opt.gaTrack ) ) _gaq.push( [ '_trackEvent', 'YTPlayer', 'Play', ( YTPlayer.hasData ? YTPlayer.videoData.title : YTPlayer.videoID.toString() ) ] );
											if( typeof ga != "undefined" && eval( YTPlayer.opt.gaTrack ) ) ga( 'send', 'event', 'YTPlayer', 'play', ( YTPlayer.hasData ? YTPlayer.videoData.title : YTPlayer.videoID.toString() ) );
											break;
										case 2: //------------------------------------------------ pause
											eventType = "YTPPause";
											if( YTPlayer.controlBar.length )
												YTPlayer.controlBar.find( ".mb_YTPPlaypause" ).html( jQuery.mbYTPlayer.controls.play );
											break;
										case 3: //------------------------------------------------ buffer
											YTPlayer.player.setPlaybackQuality( YTPlayer.opt.quality );
											eventType = "YTPBuffering";
											if( YTPlayer.controlBar.length )
												YTPlayer.controlBar.find( ".mb_YTPPlaypause" ).html( jQuery.mbYTPlayer.controls.play );
											break;
										case 5: //------------------------------------------------ cued
											eventType = "YTPCued";
											break;
										default:
											break;
									}

									// Trigger state events
									var YTPEvent = jQuery.Event( eventType );
									YTPEvent.time = YTPlayer.currentTime;
									if( YTPlayer.canTrigger )
										jQuery( YTPlayer ).trigger( YTPEvent );
								},
								/**
								 *
								 * @param e
								 */
								'onPlaybackQualityChange': function( e ) {
									var quality = e.target.getPlaybackQuality();
									var YTPQualityChange = jQuery.Event( "YTPQualityChange" );
									YTPQualityChange.quality = quality;
									jQuery( YTPlayer ).trigger( YTPQualityChange );
								},
								/**
								 *
								 * @param err
								 */
								'onError': function( err ) {

									if( err.data == 150 ) {
										console.log( "Embedding this video is restricted by Youtube." );
										if( YTPlayer.isPlayList )
											jQuery( YTPlayer ).playNext();
									}

									if( err.data == 2 && YTPlayer.isPlayList ) {
										jQuery( YTPlayer ).playNext();
									}

									if( typeof YTPlayer.opt.onError == "function" )
										YTPlayer.opt.onError( $YTPlayer, err );
								}
							}
						} );
					} );
				} );

				$YTPlayer.off( "YTPTime.mask" );

				jQuery.mbYTPlayer.applyMask( YTPlayer );

			} );
		},

		/**
		 * Check if the YTPlayer is on screen
		 */
		isOnScreen: function( YTPlayer ) {

			var playerBox = YTPlayer.wrapper;

			var winTop = $( window ).scrollTop();
			var winBottom = winTop + $( window ).height();
			var elTop = playerBox.offset().top;
			var elBottom = elTop + playerBox.height();
			return( ( elBottom <= winBottom ) && ( elTop >= winTop ) );

		},

		/**
		 *
		 * @param YTPlayer
		 */
		getDataFromAPI: function( YTPlayer ) {
			YTPlayer.videoData = jQuery.mbStorage.get( "YTPlayer_data_" + YTPlayer.videoID );
			jQuery( YTPlayer ).off( "YTPData.YTPlayer" ).on( "YTPData.YTPlayer", function() {
				if( YTPlayer.hasData ) {

					if( YTPlayer.isPlayer && !YTPlayer.opt.autoPlay ) {
						var bgndURL = YTPlayer.videoData.thumb_max || YTPlayer.videoData.thumb_high || YTPlayer.videoData.thumb_medium;

						YTPlayer.opt.containment.css( {
							background: "rgba(0,0,0,0.5) url(" + bgndURL + ") center center",
							backgroundSize: "cover"
						} );
						YTPlayer.opt.backgroundUrl = bgndURL;
					}
				}
			} );

			if( YTPlayer.videoData ) {

				setTimeout( function() {
					YTPlayer.opt.ratio = YTPlayer.opt.ratio == "auto" ? "16/9" : YTPlayer.opt.ratio;
					YTPlayer.dataReceived = true;
					jQuery( YTPlayer ).trigger( "YTPChanged" );
					var YTPData = jQuery.Event( "YTPData" );
					YTPData.prop = {};
					for( var x in YTPlayer.videoData ) YTPData.prop[ x ] = YTPlayer.videoData[ x ];
					jQuery( YTPlayer ).trigger( YTPData );
				}, YTPlayer.opt.fadeOnStartTime );

				YTPlayer.hasData = true;
			} else if( jQuery.mbYTPlayer.apiKey ) {
				// Get video info from API3 (needs api key)
				// snippet,player,contentDetails,statistics,status
				jQuery.getJSON( jQuery.mbYTPlayer.locationProtocol + "//www.googleapis.com/youtube/v3/videos?id=" + YTPlayer.videoID + "&key=" + jQuery.mbYTPlayer.apiKey + "&part=snippet", function( data ) {
					YTPlayer.dataReceived = true;
					jQuery( YTPlayer ).trigger( "YTPChanged" );

					function parseYTPlayer_data( data ) {
						YTPlayer.videoData = {};
						YTPlayer.videoData.id = YTPlayer.videoID;
						YTPlayer.videoData.channelTitle = data.channelTitle;
						YTPlayer.videoData.title = data.title;
						YTPlayer.videoData.description = data.description.length < 400 ? data.description : data.description.substring( 0, 400 ) + " ...";
						YTPlayer.videoData.aspectratio = YTPlayer.opt.ratio == "auto" ? "16/9" : YTPlayer.opt.ratio;
						YTPlayer.opt.ratio = YTPlayer.videoData.aspectratio;
						YTPlayer.videoData.thumb_max = data.thumbnails.maxres ? data.thumbnails.maxres.url : null;
						YTPlayer.videoData.thumb_high = data.thumbnails.high ? data.thumbnails.high.url : null;
						YTPlayer.videoData.thumb_medium = data.thumbnails.medium ? data.thumbnails.medium.url : null;
						jQuery.mbStorage.set( "YTPlayer_data_" + YTPlayer.videoID, YTPlayer.videoData );
					}

					parseYTPlayer_data( data.items[ 0 ].snippet );
					YTPlayer.hasData = true;
					var YTPData = jQuery.Event( "YTPData" );
					YTPData.prop = {};
					for( var x in YTPlayer.videoData ) YTPData.prop[ x ] = YTPlayer.videoData[ x ];
					jQuery( YTPlayer ).trigger( YTPData );
				} );
			} else {
				setTimeout( function() {
					jQuery( YTPlayer ).trigger( "YTPChanged" );
				}, 50 );
				if( YTPlayer.isPlayer && !YTPlayer.opt.autoPlay ) {
					var bgndURL = jQuery.mbYTPlayer.locationProtocol + "//i.ytimg.com/vi/" + YTPlayer.videoID + "/hqdefault.jpg";

					if( bgndURL )
						YTPlayer.opt.containment.css( {
							background: "rgba(0,0,0,0.5) url(" + bgndURL + ") center center",
							backgroundSize: "cover"
						} );
					YTPlayer.opt.backgroundUrl = bgndURL;

				}
				YTPlayer.videoData = null;
				YTPlayer.opt.ratio = YTPlayer.opt.ratio == "auto" ? "16/9" : YTPlayer.opt.ratio;
			}
			if( YTPlayer.isPlayer && !YTPlayer.opt.autoPlay && ( !jQuery.mbBrowser.mobile && !jQuery.isTablet ) ) {
				YTPlayer.loading = jQuery( "<div/>" ).addClass( "loading" ).html( "Loading" ).hide();
				jQuery( YTPlayer ).append( YTPlayer.loading );
				YTPlayer.loading.fadeIn();
			}
		},
		/**
		 *
		 */
		removeStoredData: function() {
			jQuery.mbStorage.remove();
		},
		/**
		 *
		 * @returns {*|YTPlayer.videoData}
		 */
		getVideoData: function() {
			var YTPlayer = this.get( 0 );
			return YTPlayer.videoData;
		},
		/**
		 *
		 * @returns {*|YTPlayer.videoID|boolean}
		 */
		getVideoID: function() {
			var YTPlayer = this.get( 0 );
			return YTPlayer.videoID || false;
		},
		/**
		 *
		 * @param quality
		 */
		setVideoQuality: function( quality ) {
			var YTPlayer = this.get( 0 );
			YTPlayer.player.setPlaybackQuality( quality );
		},
		/**
		 *
		 * @param videos
		 * @param shuffle
		 * @param callback
		 * @returns {jQuery.mbYTPlayer}
		 */
		playlist: function( videos, shuffle, callback ) {
			var $YTPlayer = this;
			var YTPlayer = $YTPlayer.get( 0 );
			YTPlayer.isPlayList = true;
			if( shuffle ) videos = jQuery.shuffle( videos );
			if( !YTPlayer.videoID ) {
				YTPlayer.videos = videos;
				YTPlayer.videoCounter = 0;
				YTPlayer.videoLength = videos.length;
				jQuery( YTPlayer ).data( "property", videos[ 0 ] );
				jQuery( YTPlayer ).mb_YTPlayer();
			}
			if( typeof callback == "function" ) jQuery( YTPlayer ).one( "YTPChanged", function() {
				callback( YTPlayer );
			} );
			jQuery( YTPlayer ).on( "YTPEnd", function() {
				jQuery( YTPlayer ).playNext();
			} );
			return this;
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		playNext: function() {
			var YTPlayer = this.get( 0 );

			if( YTPlayer.checkForStartAt ) {
				clearInterval( YTPlayer.checkForStartAt );
				clearInterval( YTPlayer.getState );
			}

			YTPlayer.videoCounter++;

			if( YTPlayer.videoCounter >= YTPlayer.videoLength )
				YTPlayer.videoCounter = 0;

			jQuery( YTPlayer ).YTPChangeMovie( YTPlayer.videos[ YTPlayer.videoCounter ] );

			return this;
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		playPrev: function() {
			var YTPlayer = this.get( 0 );

			if( YTPlayer.checkForStartAt ) {
				clearInterval( YTPlayer.checkForStartAt );
				clearInterval( YTPlayer.getState );
			}

			YTPlayer.videoCounter--;

			if( YTPlayer.videoCounter < 0 )
				YTPlayer.videoCounter = YTPlayer.videoLength - 1;

			jQuery( YTPlayer ).YTPChangeMovie( YTPlayer.videos[ YTPlayer.videoCounter ] );

			return this;
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		playIndex: function( idx ) {
			var YTPlayer = this.get( 0 );

			idx = idx - 1;

			if( YTPlayer.checkForStartAt ) {
				clearInterval( YTPlayer.checkForStartAt );
				clearInterval( YTPlayer.getState );
			}

			YTPlayer.videoCounter = idx;
			if( YTPlayer.videoCounter >= YTPlayer.videoLength - 1 )
				YTPlayer.videoCounter = YTPlayer.videoLength - 1;
			jQuery( YTPlayer ).YTPChangeMovie( YTPlayer.videos[ YTPlayer.videoCounter ] );
			return this;
		},
		/**
		 *
		 * @param opt
		 */
		changeMovie: function( opt ) {

			var $YTPlayer = this;
			var YTPlayer = $YTPlayer.get( 0 );
			YTPlayer.opt.startAt = 0;
			YTPlayer.opt.stopAt = 0;
			YTPlayer.opt.mask = false;
			YTPlayer.opt.mute = true;
			YTPlayer.hasData = false;
			YTPlayer.hasChanged = true;
			YTPlayer.player.loopTime = undefined;

			if( opt )
				jQuery.extend( YTPlayer.opt, opt ); //YTPlayer.defaultOpt,
			YTPlayer.videoID = getYTPVideoID( YTPlayer.opt.videoURL ).videoID;

			if( YTPlayer.opt.loop == "true" )
				YTPlayer.opt.loop = 9999;

			jQuery( YTPlayer.playerEl ).CSSAnimate( {
				opacity: 0
			}, YTPlayer.opt.fadeOnStartTime, function() {

				var YTPChangeMovie = jQuery.Event( "YTPChangeMovie" );
				YTPChangeMovie.time = YTPlayer.currentTime;
				YTPChangeMovie.videoId = YTPlayer.videoID;
				jQuery( YTPlayer ).trigger( YTPChangeMovie );

				jQuery( YTPlayer ).YTPGetPlayer().cueVideoByUrl( encodeURI( jQuery.mbYTPlayer.locationProtocol + "//www.youtube.com/v/" + YTPlayer.videoID ), 1, YTPlayer.opt.quality );
				jQuery( YTPlayer ).optimizeDisplay();

				jQuery.mbYTPlayer.checkForState( YTPlayer );
				jQuery.mbYTPlayer.getDataFromAPI( YTPlayer );

			} );

			jQuery.mbYTPlayer.applyMask( YTPlayer );
		},
		/**
		 *
		 * @returns {player}
		 */
		getPlayer: function() {
			return jQuery( this ).get( 0 ).player;
		},

		playerDestroy: function() {
			var YTPlayer = this.get( 0 );
			ytp.YTAPIReady = true;
			ytp.backgroundIsInited = false;
			YTPlayer.isInit = false;
			YTPlayer.videoID = null;
			YTPlayer.isReady = false;
			var playerBox = YTPlayer.wrapper;
			playerBox.remove();
			jQuery( "#controlBar_" + YTPlayer.id ).remove();
			clearInterval( YTPlayer.checkForStartAt );
			clearInterval( YTPlayer.getState );
			return this;
		},

		/**
		 *
		 * @param real
		 * @returns {jQuery.mbYTPlayer}
		 */
		fullscreen: function( real ) {
			var YTPlayer = this.get( 0 );
			if( typeof real == "undefined" ) real = YTPlayer.opt.realfullscreen;
			real = eval( real );
			var controls = jQuery( "#controlBar_" + YTPlayer.id );
			var fullScreenBtn = controls.find( ".mb_OnlyYT" );
			var videoWrapper = YTPlayer.isSelf ? YTPlayer.opt.containment : YTPlayer.wrapper;
			//var videoWrapper = YTPlayer.wrapper;
			if( real ) {
				var fullscreenchange = jQuery.mbBrowser.mozilla ? "mozfullscreenchange" : jQuery.mbBrowser.webkit ? "webkitfullscreenchange" : "fullscreenchange";
				jQuery( document ).off( fullscreenchange ).on( fullscreenchange, function() {
					var isFullScreen = RunPrefixMethod( document, "IsFullScreen" ) || RunPrefixMethod( document, "FullScreen" );
					if( !isFullScreen ) {
						YTPlayer.isAlone = false;
						fullScreenBtn.html( jQuery.mbYTPlayer.controls.onlyYT );
						jQuery( YTPlayer ).YTPSetVideoQuality( YTPlayer.opt.quality );
						videoWrapper.removeClass( "YTPFullscreen" );
						videoWrapper.CSSAnimate( {
							opacity: YTPlayer.opt.opacity
						}, YTPlayer.opt.fadeOnStartTime );
						videoWrapper.css( {
							zIndex: 0
						} );
						if( YTPlayer.isBackground ) {
							jQuery( "body" ).after( controls );
						} else {
							YTPlayer.wrapper.before( controls );
						}
						jQuery( window ).resize();
						jQuery( YTPlayer ).trigger( "YTPFullScreenEnd" );
					} else {
						jQuery( YTPlayer ).YTPSetVideoQuality( "default" );
						jQuery( YTPlayer ).trigger( "YTPFullScreenStart" );
					}
				} );
			}
			if( !YTPlayer.isAlone ) {
				function hideMouse() {
					YTPlayer.overlay.css( {
						cursor: "none"
					} );
				}

				jQuery( document ).on( "mousemove.YTPlayer", function( e ) {
					YTPlayer.overlay.css( {
						cursor: "auto"
					} );
					clearTimeout( YTPlayer.hideCursor );
					if( !jQuery( e.target ).parents().is( ".mb_YTPBar" ) ) YTPlayer.hideCursor = setTimeout( hideMouse, 3000 );
				} );
				hideMouse();
				if( real ) {
					videoWrapper.css( {
						opacity: 0
					} );
					videoWrapper.addClass( "YTPFullscreen" );
					launchFullscreen( videoWrapper.get( 0 ) );
					setTimeout( function() {
						videoWrapper.CSSAnimate( {
							opacity: 1
						}, YTPlayer.opt.fadeOnStartTime * 2 );
						YTPlayer.wrapper.append( controls );
						jQuery( YTPlayer ).optimizeDisplay();
						YTPlayer.player.seekTo( YTPlayer.player.getCurrentTime() + .1, true );
					}, YTPlayer.opt.fadeOnStartTime );
				} else videoWrapper.css( {
					zIndex: 10000
				} ).CSSAnimate( {
					opacity: 1
				}, YTPlayer.opt.fadeOnStartTime * 2 );
				fullScreenBtn.html( jQuery.mbYTPlayer.controls.showSite );
				YTPlayer.isAlone = true;
			} else {
				jQuery( document ).off( "mousemove.YTPlayer" );
				clearTimeout( YTPlayer.hideCursor );
				YTPlayer.overlay.css( {
					cursor: "auto"
				} );
				if( real ) {
					cancelFullscreen();
				} else {
					videoWrapper.CSSAnimate( {
						opacity: YTPlayer.opt.opacity
					}, YTPlayer.opt.fadeOnStartTime );
					videoWrapper.css( {
						zIndex: 0
					} );
				}
				fullScreenBtn.html( jQuery.mbYTPlayer.controls.onlyYT );
				YTPlayer.isAlone = false;
			}

			function RunPrefixMethod( obj, method ) {
				var pfx = [ "webkit", "moz", "ms", "o", "" ];
				var p = 0,
					m, t;
				while( p < pfx.length && !obj[ m ] ) {
					m = method;
					if( pfx[ p ] == "" ) {
						m = m.substr( 0, 1 ).toLowerCase() + m.substr( 1 );
					}
					m = pfx[ p ] + m;
					t = typeof obj[ m ];
					if( t != "undefined" ) {
						pfx = [ pfx[ p ] ];
						return( t == "function" ? obj[ m ]() : obj[ m ] );
					}
					p++;
				}
			}

			function launchFullscreen( element ) {
				RunPrefixMethod( element, "RequestFullScreen" );
			}

			function cancelFullscreen() {
				if( RunPrefixMethod( document, "FullScreen" ) || RunPrefixMethod( document, "IsFullScreen" ) ) {
					RunPrefixMethod( document, "CancelFullScreen" );
				}
			}

			return this;
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		toggleLoops: function() {
			var YTPlayer = this.get( 0 );
			var data = YTPlayer.opt;
			if( data.loop == 1 ) {
				data.loop = 0;
			} else {
				if( data.startAt ) {
					YTPlayer.player.seekTo( data.startAt );
				} else {
					YTPlayer.player.playVideo();
				}
				data.loop = 1;
			}
			return this;
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		play: function() {
			var YTPlayer = this.get( 0 );
			if( !YTPlayer.isReady )
				return this;

			YTPlayer.player.playVideo();
			YTPlayer.wrapper.CSSAnimate( {
				opacity: YTPlayer.isAlone ? 1 : YTPlayer.opt.opacity
			}, YTPlayer.opt.fadeOnStartTime * 4 );

			jQuery( YTPlayer.playerEl ).CSSAnimate( {
				opacity: 1
			}, YTPlayer.opt.fadeOnStartTime * 2 );

			var controls = jQuery( "#controlBar_" + YTPlayer.id );
			var playBtn = controls.find( ".mb_YTPPlaypause" );
			playBtn.html( jQuery.mbYTPlayer.controls.pause );
			YTPlayer.state = 1;
			YTPlayer.orig_background = jQuery( YTPlayer ).css( "background-image" );

			return this;
		},
		/**
		 *
		 * @param callback
		 * @returns {jQuery.mbYTPlayer}
		 */
		togglePlay: function( callback ) {
			var YTPlayer = this.get( 0 );
			if( YTPlayer.state == 1 )
				this.YTPPause();
			else
				this.YTPPlay();

			if( typeof callback == "function" )
				callback( YTPlayer.state );

			return this;
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		stop: function() {
			var YTPlayer = this.get( 0 );
			var controls = jQuery( "#controlBar_" + YTPlayer.id );
			var playBtn = controls.find( ".mb_YTPPlaypause" );
			playBtn.html( jQuery.mbYTPlayer.controls.play );
			YTPlayer.player.stopVideo();
			return this;
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		pause: function() {
			var YTPlayer = this.get( 0 );
			YTPlayer.player.pauseVideo();
			YTPlayer.state = 2;
			return this;
		},
		/**
		 *
		 * @param val
		 * @returns {jQuery.mbYTPlayer}
		 */
		seekTo: function( val ) {
			var YTPlayer = this.get( 0 );
			YTPlayer.player.seekTo( val, true );
			return this;
		},
		/**
		 *
		 * @param val
		 * @returns {jQuery.mbYTPlayer}
		 */
		setVolume: function( val ) {
			var YTPlayer = this.get( 0 );
			if( !val && !YTPlayer.opt.vol && YTPlayer.player.getVolume() == 0 ) jQuery( YTPlayer ).YTPUnmute();
			else if( ( !val && YTPlayer.player.getVolume() > 0 ) || ( val && YTPlayer.opt.vol == val ) ) {
				if( !YTPlayer.isMute ) jQuery( YTPlayer ).YTPMute();
				else jQuery( YTPlayer ).YTPUnmute();
			} else {
				YTPlayer.opt.vol = val;
				YTPlayer.player.setVolume( YTPlayer.opt.vol );
				if( YTPlayer.volumeBar && YTPlayer.volumeBar.length ) YTPlayer.volumeBar.updateSliderVal( val );
			}
			return this;
		},
		/**
		 *
		 * @returns {boolean}
		 */
		toggleVolume: function() {
			var YTPlayer = this.get( 0 );
			if( !YTPlayer ) return;
			if( YTPlayer.player.isMuted() ) {
				jQuery( YTPlayer ).YTPUnmute();
				return true;
			} else {
				jQuery( YTPlayer ).YTPMute();
				return false;
			}
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		mute: function() {
			var YTPlayer = this.get( 0 );
			if( YTPlayer.isMute ) return;
			YTPlayer.player.mute();
			YTPlayer.isMute = true;
			YTPlayer.player.setVolume( 0 );
			if( YTPlayer.volumeBar && YTPlayer.volumeBar.length && YTPlayer.volumeBar.width() > 10 ) {
				YTPlayer.volumeBar.updateSliderVal( 0 );
			}
			var controls = jQuery( "#controlBar_" + YTPlayer.id );
			var muteBtn = controls.find( ".mb_YTPMuteUnmute" );
			muteBtn.html( jQuery.mbYTPlayer.controls.unmute );
			jQuery( YTPlayer ).addClass( "isMuted" );
			if( YTPlayer.volumeBar && YTPlayer.volumeBar.length ) YTPlayer.volumeBar.addClass( "muted" );
			var YTPEvent = jQuery.Event( "YTPMuted" );
			YTPEvent.time = YTPlayer.currentTime;
			if( YTPlayer.canTrigger ) jQuery( YTPlayer ).trigger( YTPEvent );
			return this;
		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		unmute: function() {
			var YTPlayer = this.get( 0 );
			if( !YTPlayer.isMute ) return;
			YTPlayer.player.unMute();
			YTPlayer.isMute = false;
			YTPlayer.player.setVolume( YTPlayer.opt.vol );
			if( YTPlayer.volumeBar && YTPlayer.volumeBar.length ) YTPlayer.volumeBar.updateSliderVal( YTPlayer.opt.vol > 10 ? YTPlayer.opt.vol : 10 );
			var controls = jQuery( "#controlBar_" + YTPlayer.id );
			var muteBtn = controls.find( ".mb_YTPMuteUnmute" );
			muteBtn.html( jQuery.mbYTPlayer.controls.mute );
			jQuery( YTPlayer ).removeClass( "isMuted" );
			if( YTPlayer.volumeBar && YTPlayer.volumeBar.length ) YTPlayer.volumeBar.removeClass( "muted" );
			var YTPEvent = jQuery.Event( "YTPUnmuted" );
			YTPEvent.time = YTPlayer.currentTime;
			if( YTPlayer.canTrigger ) jQuery( YTPlayer ).trigger( YTPEvent );
			return this;
		},
		/**
		 * FILTERS
		 *
		 *
		 * @param filter
		 * @param value
		 * @returns {jQuery.mbYTPlayer}
		 */
		applyFilter: function( filter, value ) {
			return this.each( function() {
				var YTPlayer = this;
				YTPlayer.filters[ filter ].value = value;
				if( YTPlayer.filtersEnabled )
					jQuery( YTPlayer ).YTPEnableFilters();
			} );
		},
		/**
		 *
		 * @param filters
		 * @returns {jQuery.mbYTPlayer}
		 */
		applyFilters: function( filters ) {
			return this.each( function() {
				var YTPlayer = this;
				if( !YTPlayer.isReady ) {
					jQuery( YTPlayer ).on( "YTPReady", function() {
						jQuery( YTPlayer ).YTPApplyFilters( filters );
					} );
					return;
				}

				for( var key in filters )
					jQuery( YTPlayer ).YTPApplyFilter( key, filters[ key ] );

				jQuery( YTPlayer ).trigger( "YTPFiltersApplied" );
			} );
		},
		/**
		 *
		 * @param filter
		 * @param value
		 * @returns {*}
		 */
		toggleFilter: function( filter, value ) {
			return this.each( function() {
				var YTPlayer = this;
				if( !YTPlayer.filters[ filter ].value ) YTPlayer.filters[ filter ].value = value;
				else YTPlayer.filters[ filter ].value = 0;
				if( YTPlayer.filtersEnabled ) jQuery( this ).YTPEnableFilters();
			} );
		},
		/**
		 *
		 * @param callback
		 * @returns {*}
		 */
		toggleFilters: function( callback ) {
			return this.each( function() {
				var YTPlayer = this;
				if( YTPlayer.filtersEnabled ) {
					jQuery( YTPlayer ).trigger( "YTPDisableFilters" );
					jQuery( YTPlayer ).YTPDisableFilters();
				} else {
					jQuery( YTPlayer ).YTPEnableFilters();
					jQuery( YTPlayer ).trigger( "YTPEnableFilters" );
				}
				if( typeof callback == "function" )
					callback( YTPlayer.filtersEnabled );
			} );
		},
		/**
		 *
		 * @returns {*}
		 */
		disableFilters: function() {
			return this.each( function() {
				var YTPlayer = this;
				var iframe = jQuery( YTPlayer.playerEl );
				iframe.css( "-webkit-filter", "" );
				iframe.css( "filter", "" );
				YTPlayer.filtersEnabled = false;
			} );
		},
		/**
		 *
		 * @returns {*}
		 */
		enableFilters: function() {
			return this.each( function() {
				var YTPlayer = this;
				var iframe = jQuery( YTPlayer.playerEl );
				var filterStyle = "";
				for( var key in YTPlayer.filters ) {
					if( YTPlayer.filters[ key ].value )
						filterStyle += key.replace( "_", "-" ) + "(" + YTPlayer.filters[ key ].value + YTPlayer.filters[ key ].unit + ") ";
				}
				iframe.css( "-webkit-filter", filterStyle );
				iframe.css( "filter", filterStyle );
				YTPlayer.filtersEnabled = true;
			} );
		},
		/**
		 *
		 * @param filter
		 * @param callback
		 * @returns {*}
		 */
		removeFilter: function( filter, callback ) {
			return this.each( function() {
				var YTPlayer = this;
				if( typeof filter == "function" ) {
					callback = filter;
					filter = null;
				}
				if( !filter )
					for( var key in YTPlayer.filters ) {
						jQuery( this ).YTPApplyFilter( key, 0 );
						if( typeof callback == "function" ) callback( key );
					} else {
						jQuery( this ).YTPApplyFilter( filter, 0 );
						if( typeof callback == "function" ) callback( filter );
					}
			} );

		},
		/**
		 *
		 * @returns {*}
		 */
		getFilters: function() {
			var YTPlayer = this.get( 0 );
			return YTPlayer.filters;
		},
		/**
		 * MASK
		 *
		 *
		 * @param mask
		 * @returns {jQuery.mbYTPlayer}
		 */
		addMask: function( mask ) {
			var YTPlayer = this.get( 0 );
			var overlay = YTPlayer.overlay;

			if( !mask ) {
				mask = YTPlayer.actualMask;
			}

			var tempImg = jQuery( "<img/>" ).attr( "src", mask ).on( "load", function() {

				overlay.CSSAnimate( {
					opacity: 0
				}, YTPlayer.opt.fadeOnStartTime, function() {

					YTPlayer.hasMask = true;

					tempImg.remove();

					overlay.css( {
						backgroundImage: "url(" + mask + ")",
						backgroundRepeat: "no-repeat",
						backgroundPosition: "center center",
						backgroundSize: "cover"
					} );

					overlay.CSSAnimate( {
						opacity: 1
					}, YTPlayer.opt.fadeOnStartTime );

				} );

			} );

			return this;

		},
		/**
		 *
		 * @returns {jQuery.mbYTPlayer}
		 */
		removeMask: function() {
			var YTPlayer = this.get( 0 );
			var overlay = YTPlayer.overlay;
			overlay.CSSAnimate( {
				opacity: 0
			}, YTPlayer.opt.fadeOnStartTime, function() {

				YTPlayer.hasMask = false;

				overlay.css( {
					backgroundImage: "",
					backgroundRepeat: "",
					backgroundPosition: "",
					backgroundSize: ""
				} );
				overlay.CSSAnimate( {
					opacity: 1
				}, YTPlayer.opt.fadeOnStartTime );

			} );

			return this;

		},
		/**
		 *
		 * @param YTPlayer
		 */
		applyMask: function( YTPlayer ) {
			var $YTPlayer = jQuery( YTPlayer );
			$YTPlayer.off( "YTPTime.mask" );

			if( YTPlayer.opt.mask ) {

				if( typeof YTPlayer.opt.mask == "string" ) {
					$YTPlayer.YTPAddMask( YTPlayer.opt.mask );

					YTPlayer.actualMask = YTPlayer.opt.mask;

				} else if( typeof YTPlayer.opt.mask == "object" ) {

					for( var time in YTPlayer.opt.mask ) {
						if( YTPlayer.opt.mask[ time ] )
							var img = jQuery( "<img/>" ).attr( "src", YTPlayer.opt.mask[ time ] );
					}

					if( YTPlayer.opt.mask[ 0 ] )
						$YTPlayer.YTPAddMask( YTPlayer.opt.mask[ 0 ] );

					$YTPlayer.on( "YTPTime.mask", function( e ) {
						for( var time in YTPlayer.opt.mask ) {
							if( e.time == time )
								if( !YTPlayer.opt.mask[ time ] ) {
									$YTPlayer.YTPRemoveMask();
								} else {

									$YTPlayer.YTPAddMask( YTPlayer.opt.mask[ time ] );
									YTPlayer.actualMask = YTPlayer.opt.mask[ time ];
								}

						}
					} );

				}


			}
		},
		/**
		 *
		 */
		toggleMask: function() {
			var YTPlayer = this.get( 0 );
			var $YTPlayer = $( YTPlayer );
			if( YTPlayer.hasMask )
				$YTPlayer.YTPRemoveMask();
			else
				$YTPlayer.YTPAddMask();

			return this;
		},
		/**
		 *
		 * @returns {{totalTime: number, currentTime: number}}
		 */
		manageProgress: function() {
			var YTPlayer = this.get( 0 );
			var controls = jQuery( "#controlBar_" + YTPlayer.id );
			var progressBar = controls.find( ".mb_YTPProgress" );
			var loadedBar = controls.find( ".mb_YTPLoaded" );
			var timeBar = controls.find( ".mb_YTPseekbar" );
			var totW = progressBar.outerWidth();
			var currentTime = Math.floor( YTPlayer.player.getCurrentTime() );
			var totalTime = Math.floor( YTPlayer.player.getDuration() );
			var timeW = ( currentTime * totW ) / totalTime;
			var startLeft = 0;
			var loadedW = YTPlayer.player.getVideoLoadedFraction() * 100;
			loadedBar.css( {
				left: startLeft,
				width: loadedW + "%"
			} );
			timeBar.css( {
				left: 0,
				width: timeW
			} );
			return {
				totalTime: totalTime,
				currentTime: currentTime
			};
		},
		/**
		 *
		 * @param YTPlayer
		 */
		buildControls: function( YTPlayer ) {
			var data = YTPlayer.opt;
			// @data.printUrl: is deprecated; use data.showYTLogo
			data.showYTLogo = data.showYTLogo || data.printUrl;

			if( jQuery( "#controlBar_" + YTPlayer.id ).length )
				return;
			YTPlayer.controlBar = jQuery( "<span/>" ).attr( "id", "controlBar_" + YTPlayer.id ).addClass( "mb_YTPBar" ).css( {
				whiteSpace: "noWrap",
				position: YTPlayer.isBackground ? "fixed" : "absolute",
				zIndex: YTPlayer.isBackground ? 10000 : 1000
			} ).hide();
			var buttonBar = jQuery( "<div/>" ).addClass( "buttonBar" );
			/* play/pause button*/
			var playpause = jQuery( "<span>" + jQuery.mbYTPlayer.controls.play + "</span>" ).addClass( "mb_YTPPlaypause ytpicon" ).click( function() {
				if( YTPlayer.player.getPlayerState() == 1 ) jQuery( YTPlayer ).YTPPause();
				else jQuery( YTPlayer ).YTPPlay();
			} );
			/* mute/unmute button*/
			var MuteUnmute = jQuery( "<span>" + jQuery.mbYTPlayer.controls.mute + "</span>" ).addClass( "mb_YTPMuteUnmute ytpicon" ).click( function() {
				if( YTPlayer.player.getVolume() == 0 ) {
					jQuery( YTPlayer ).YTPUnmute();
				} else {
					jQuery( YTPlayer ).YTPMute();
				}
			} );
			/* volume bar*/
			var volumeBar = jQuery( "<div/>" ).addClass( "mb_YTPVolumeBar" ).css( {
				display: "inline-block"
			} );
			YTPlayer.volumeBar = volumeBar;
			/* time elapsed */
			var idx = jQuery( "<span/>" ).addClass( "mb_YTPTime" );
			var vURL = data.videoURL ? data.videoURL : "";
			if( vURL.indexOf( "http" ) < 0 ) vURL = jQuery.mbYTPlayer.locationProtocol + "//www.youtube.com/watch?v=" + data.videoURL;
			var movieUrl = jQuery( "<span/>" ).html( jQuery.mbYTPlayer.controls.ytLogo ).addClass( "mb_YTPUrl ytpicon" ).attr( "title", "view on YouTube" ).on( "click", function() {
				window.open( vURL, "viewOnYT" );
			} );
			var onlyVideo = jQuery( "<span/>" ).html( jQuery.mbYTPlayer.controls.onlyYT ).addClass( "mb_OnlyYT ytpicon" ).on( "click", function() {
				jQuery( YTPlayer ).YTPFullscreen( data.realfullscreen );
			} );
			var progressBar = jQuery( "<div/>" ).addClass( "mb_YTPProgress" ).css( "position", "absolute" ).click( function( e ) {
				timeBar.css( {
					width: ( e.clientX - timeBar.offset().left )
				} );
				YTPlayer.timeW = e.clientX - timeBar.offset().left;
				YTPlayer.controlBar.find( ".mb_YTPLoaded" ).css( {
					width: 0
				} );
				var totalTime = Math.floor( YTPlayer.player.getDuration() );
                var goto = ( timeBar.outerWidth() * totalTime ) / progressBar.outerWidth();
                YTPlayer.player.seekTo( parseFloat( goto ), true );
                YTPlayer.controlBar.find( ".mb_YTPLoaded" ).css( {
					width: 0
				} );
			} );
			var loadedBar = jQuery( "<div/>" ).addClass( "mb_YTPLoaded" ).css( "position", "absolute" );
			var timeBar = jQuery( "<div/>" ).addClass( "mb_YTPseekbar" ).css( "position", "absolute" );
			progressBar.append( loadedBar ).append( timeBar );
			buttonBar.append( playpause ).append( MuteUnmute ).append( volumeBar ).append( idx );
			if( data.showYTLogo ) {
				buttonBar.append( movieUrl );
			}
			if( YTPlayer.isBackground || ( eval( YTPlayer.opt.realfullscreen ) && !YTPlayer.isBackground ) ) buttonBar.append( onlyVideo );
			YTPlayer.controlBar.append( buttonBar ).append( progressBar );
			if( !YTPlayer.isBackground ) {
				YTPlayer.controlBar.addClass( "inlinePlayer" );
				YTPlayer.wrapper.before( YTPlayer.controlBar );
			} else {
				jQuery( "body" ).after( YTPlayer.controlBar );
			}
			volumeBar.simpleSlider( {
				initialval: YTPlayer.opt.vol,
				scale: 100,
				orientation: "h",
				callback: function( el ) {
					if( el.value == 0 ) {
						jQuery( YTPlayer ).YTPMute();
					} else {
						jQuery( YTPlayer ).YTPUnmute();
					}
					YTPlayer.player.setVolume( el.value );
					if( !YTPlayer.isMute ) YTPlayer.opt.vol = el.value;
				}
			} );
		},
		/**
		 *
		 * @param YTPlayer
		 */
		checkForState: function( YTPlayer ) {
			var interval = YTPlayer.opt.showControls ? 100 : 400;
			clearInterval( YTPlayer.getState );
			//Checking if player has been removed from scene
			if( !jQuery.contains( document, YTPlayer ) ) {
				jQuery( YTPlayer ).YTPPlayerDestroy();
				clearInterval( YTPlayer.getState );
				clearInterval( YTPlayer.checkForStartAt );
				return;
			}

			jQuery.mbYTPlayer.checkForStart( YTPlayer );

			YTPlayer.getState = setInterval( function() {

				var prog = jQuery( YTPlayer ).YTPManageProgress();
				var $YTPlayer = jQuery( YTPlayer );
				var data = YTPlayer.opt;

				var startAt = YTPlayer.start_from_last ? YTPlayer.start_from_last : YTPlayer.opt.startAt ? YTPlayer.opt.startAt : 1;

				YTPlayer.start_from_last = null;

				var stopAt = YTPlayer.opt.stopAt > YTPlayer.opt.startAt ? YTPlayer.opt.stopAt : 0;
				stopAt = stopAt < YTPlayer.player.getDuration() ? stopAt : 0;
				if( YTPlayer.currentTime != prog.currentTime ) {

					var YTPEvent = jQuery.Event( "YTPTime" );
					YTPEvent.time = YTPlayer.currentTime;
					jQuery( YTPlayer ).trigger( YTPEvent );

				}
				YTPlayer.currentTime = prog.currentTime;
				YTPlayer.totalTime = YTPlayer.player.getDuration();
				if( YTPlayer.player.getVolume() == 0 ) $YTPlayer.addClass( "isMuted" );
				else $YTPlayer.removeClass( "isMuted" );

				if( YTPlayer.opt.showControls )
					if( prog.totalTime ) {
						YTPlayer.controlBar.find( ".mb_YTPTime" ).html( jQuery.mbYTPlayer.formatTime( prog.currentTime ) + " / " + jQuery.mbYTPlayer.formatTime( prog.totalTime ) );
					} else {
						YTPlayer.controlBar.find( ".mb_YTPTime" ).html( "-- : -- / -- : --" );
					}


				if( eval( YTPlayer.opt.stopMovieOnBlur ) ) {
					if( !document.hasFocus() ) {
						if( YTPlayer.state == 1 ) {
							YTPlayer.hasFocus = false;
							$YTPlayer.YTPPause();
						}
					} else if( document.hasFocus() && !YTPlayer.hasFocus && !( YTPlayer.state == -1 || YTPlayer.state == 0 ) ) {
						YTPlayer.hasFocus = true;
						$YTPlayer.YTPPlay();
					}
				}

				if( YTPlayer.opt.playOnlyIfVisible ) {

					var isOnScreen = jQuery.mbYTPlayer.isOnScreen( YTPlayer );

					if( !isOnScreen && YTPlayer.state == 1 ) {

						YTPlayer.hasFocus = false;
						$YTPlayer.YTPPause();

						console.debug( YTPlayer.id, isOnScreen );
						console.debug( YTPlayer.state );

					} else if( !YTPlayer.hasFocus && !( YTPlayer.state == -1 || YTPlayer.state == 0 ) ) {

						YTPlayer.hasFocus = true;
						$YTPlayer.YTPPlay();

					}
				}


				if( YTPlayer.controlBar.length && YTPlayer.controlBar.outerWidth() <= 400 && !YTPlayer.isCompact ) {
					YTPlayer.controlBar.addClass( "compact" );
					YTPlayer.isCompact = true;
					if( !YTPlayer.isMute && YTPlayer.volumeBar ) YTPlayer.volumeBar.updateSliderVal( YTPlayer.opt.vol );
				} else if( YTPlayer.controlBar.length && YTPlayer.controlBar.outerWidth() > 400 && YTPlayer.isCompact ) {
					YTPlayer.controlBar.removeClass( "compact" );
					YTPlayer.isCompact = false;
					if( !YTPlayer.isMute && YTPlayer.volumeBar ) YTPlayer.volumeBar.updateSliderVal( YTPlayer.opt.vol );
				}

				if( YTPlayer.player.getPlayerState() == 1 && ( parseFloat( YTPlayer.player.getDuration() - .5 ) < YTPlayer.player.getCurrentTime() || ( stopAt > 0 && parseFloat( YTPlayer.player.getCurrentTime() ) > stopAt ) ) ) {
					if( YTPlayer.isEnded ) return;
					YTPlayer.isEnded = true;
					setTimeout( function() {
						YTPlayer.isEnded = false;
					}, 1000 );

					if( YTPlayer.isPlayList ) {

						if( !data.loop || ( data.loop > 0 && YTPlayer.player.loopTime === data.loop - 1 ) ) {

							YTPlayer.player.loopTime = undefined;
							clearInterval( YTPlayer.getState );
							var YTPEnd = jQuery.Event( "YTPEnd" );
							YTPEnd.time = YTPlayer.currentTime;
							jQuery( YTPlayer ).trigger( YTPEnd );
							//YTPlayer.state = 0;

							return;
						}

					} else if( !data.loop || ( data.loop > 0 && YTPlayer.player.loopTime === data.loop - 1 ) ) {

						YTPlayer.player.loopTime = undefined;
						YTPlayer.preventTrigger = true;
						YTPlayer.state = 2;
						jQuery( YTPlayer ).YTPPause();

						YTPlayer.wrapper.CSSAnimate( {
							opacity: 0
						}, YTPlayer.opt.fadeOnStartTime, function() {

							if( YTPlayer.controlBar.length )
								YTPlayer.controlBar.find( ".mb_YTPPlaypause" ).html( jQuery.mbYTPlayer.controls.play );

							var YTPEnd = jQuery.Event( "YTPEnd" );
							YTPEnd.time = YTPlayer.currentTime;
							jQuery( YTPlayer ).trigger( YTPEnd );

							YTPlayer.player.seekTo( startAt, true );
							if( !YTPlayer.isBackground ) {
								if( YTPlayer.opt.backgroundUrl && YTPlayer.isPlayer ) {
									YTPlayer.opt.backgroundUrl = YTPlayer.opt.backgroundUrl || YTPlayer.orig_background;
									YTPlayer.opt.containment.css( {
										background: "url(" + YTPlayer.opt.backgroundUrl + ") center center",
										backgroundSize: "cover"
									} );
								}
							} else {
								if( YTPlayer.orig_background )
									jQuery( YTPlayer ).css( "background-image", YTPlayer.orig_background );
							}
						} );

						return;

					}

					YTPlayer.player.loopTime = YTPlayer.player.loopTime ? ++YTPlayer.player.loopTime : 1;
					startAt = startAt || 1;
					YTPlayer.preventTrigger = true;
					YTPlayer.state = 2;
					jQuery( YTPlayer ).YTPPause();
					YTPlayer.player.seekTo( startAt, true );
					$YTPlayer.YTPPlay();


				}
			}, interval );
		},
		/**
		 *
		 * @returns {string} time
		 */
		getTime: function() {
			var YTPlayer = this.get( 0 );
			return jQuery.mbYTPlayer.formatTime( YTPlayer.currentTime );
		},
		/**
		 *
		 * @returns {string} total time
		 */
		getTotalTime: function() {
			var YTPlayer = this.get( 0 );
			return jQuery.mbYTPlayer.formatTime( YTPlayer.totalTime );
		},
		/**
		 *
		 * @param YTPlayer
		 */
		checkForStart: function( YTPlayer ) {

			var $YTPlayer = jQuery( YTPlayer );

			//Checking if player has been removed from scene
			if( !jQuery.contains( document, YTPlayer ) ) {
				jQuery( YTPlayer ).YTPPlayerDestroy();
				return;
			}

			YTPlayer.preventTrigger = true;
			YTPlayer.state = 2;
			jQuery( YTPlayer ).YTPPause();

			jQuery( YTPlayer ).muteYTPVolume();
			jQuery( "#controlBar_" + YTPlayer.id ).remove();

			YTPlayer.controlBar = false;

			if( YTPlayer.opt.showControls )
				jQuery.mbYTPlayer.buildControls( YTPlayer );

			if( YTPlayer.overlay )
				if( YTPlayer.opt.addRaster ) {

					var classN = YTPlayer.opt.addRaster == "dot" ? "raster-dot" : "raster";
					YTPlayer.overlay.addClass( YTPlayer.isRetina ? classN + " retina" : classN );

				} else {

					YTPlayer.overlay.removeClass( function( index, classNames ) {
						// change the list into an array
						var current_classes = classNames.split( " " ),
							// array of classes which are to be removed
							classes_to_remove = [];
						jQuery.each( current_classes, function( index, class_name ) {
							// if the classname begins with bg add it to the classes_to_remove array
							if( /raster.*/.test( class_name ) ) {
								classes_to_remove.push( class_name );
							}
						} );
						classes_to_remove.push( "retina" );
						// turn the array back into a string
						return classes_to_remove.join( " " );
					} );

				}

			var startAt = YTPlayer.start_from_last ? YTPlayer.start_from_last : YTPlayer.opt.startAt ? YTPlayer.opt.startAt : 1;

			YTPlayer.start_from_last = null;

			YTPlayer.player.playVideo();
			YTPlayer.player.seekTo( startAt, true );

			clearInterval( YTPlayer.checkForStartAt );
			YTPlayer.checkForStartAt = setInterval( function() {

				jQuery( YTPlayer ).YTPMute();

				var canPlayVideo = YTPlayer.player.getVideoLoadedFraction() >= startAt / YTPlayer.player.getDuration();

				if( YTPlayer.player.getDuration() > 0 && YTPlayer.player.getCurrentTime() >= startAt && canPlayVideo ) {

					clearInterval( YTPlayer.checkForStartAt );

					if( typeof YTPlayer.opt.onReady == "function" )
						YTPlayer.opt.onReady( YTPlayer );

					YTPlayer.isReady = true;

					var YTPready = jQuery.Event( "YTPReady" );
					YTPready.time = YTPlayer.currentTime;
					jQuery( YTPlayer ).trigger( YTPready );

					YTPlayer.preventTrigger = true;
					YTPlayer.state = 2;
					jQuery( YTPlayer ).YTPPause();

					if( !YTPlayer.opt.mute )
						jQuery( YTPlayer ).YTPUnmute();
					YTPlayer.canTrigger = true;

					if( YTPlayer.opt.autoPlay ) {

						var YTPStart = jQuery.Event( "YTPStart" );
						YTPStart.time = YTPlayer.currentTime;
						jQuery( YTPlayer ).trigger( YTPStart );

						jQuery( YTPlayer.playerEl ).CSSAnimate( {
							opacity: 1
						}, 1000 );

						$YTPlayer.YTPPlay();

						YTPlayer.wrapper.CSSAnimate( {
							opacity: YTPlayer.isAlone ? 1 : YTPlayer.opt.opacity
						}, YTPlayer.opt.fadeOnStartTime * 2 );

						/* Fix for Safari freeze */

						if( jQuery.mbBrowser.os.name == "mac" && jQuery.mbBrowser.safari && jQuery.mbBrowser.versionCompare( jQuery.mbBrowser.fullVersion, "10.1" ) < 0 ) { //jQuery.mbBrowser.os.minor_version < 11

							YTPlayer.safariPlay = setInterval( function() {
								if( YTPlayer.state != 1 )
									$YTPlayer.YTPPlay();
								else
									clearInterval( YTPlayer.safariPlay );
							}, 10 );
						}
						$YTPlayer.one( "YTPReady", function() {
							$YTPlayer.YTPPlay();
						} );

					} else {

						//$YTPlayer.YTPPause();
						YTPlayer.player.pauseVideo();
						if( !YTPlayer.isPlayer ) {
							jQuery( YTPlayer.playerEl ).CSSAnimate( {
								opacity: 1
							}, YTPlayer.opt.fadeOnStartTime );

							YTPlayer.wrapper.CSSAnimate( {
								opacity: YTPlayer.isAlone ? 1 : YTPlayer.opt.opacity
							}, YTPlayer.opt.fadeOnStartTime );
						}

						if( YTPlayer.controlBar.length )
							YTPlayer.controlBar.find( ".mb_YTPPlaypause" ).html( jQuery.mbYTPlayer.controls.play );
					}

					if( YTPlayer.isPlayer && !YTPlayer.opt.autoPlay && ( YTPlayer.loading && YTPlayer.loading.length ) ) {
						YTPlayer.loading.html( "Ready" );
						setTimeout( function() {
							YTPlayer.loading.fadeOut();
						}, 100 );
					}

					if( YTPlayer.controlBar && YTPlayer.controlBar.length )
						YTPlayer.controlBar.slideDown( 1000 );

				} else if( jQuery.mbBrowser.os.name == "mac" && jQuery.mbBrowser.safari && jQuery.mbBrowser.fullVersion && jQuery.mbBrowser.versionCompare( jQuery.mbBrowser.fullVersion, "10.1" ) < 0 ) { //jQuery.mbBrowser.os.minor_version < 11
					YTPlayer.player.playVideo();
					if( startAt >= 0 )
						YTPlayer.player.seekTo( startAt, true );
				}

			}, 10 );

		},
		/**
		 *
		 * @param anchor
		 */
		setAnchor: function( anchor ) {
			var $YTplayer = this;
			$YTplayer.optimizeDisplay( anchor );
		},
		/**
		 *
		 * @param anchor
		 */
		getAnchor: function() {
			var YTPlayer = this.get( 0 );
			return YTPlayer.opt.anchor;
		},
		/**
		 *
		 * @param s
		 * @returns {string}
		 */
		formatTime: function( s ) {
			var min = Math.floor( s / 60 );
			var sec = Math.floor( s - ( 60 * min ) );
			return( min <= 9 ? "0" + min : min ) + " : " + ( sec <= 9 ? "0" + sec : sec );
		}
	};

	/**
	 *
	 * @param anchor
	 * can be center, top, bottom, right, left; (default is center,center)
	 */
	jQuery.fn.optimizeDisplay = function( anchor ) {
		var YTPlayer = this.get( 0 );
		var playerBox = jQuery( YTPlayer.playerEl );
		var vid = {};

		YTPlayer.opt.anchor = anchor || YTPlayer.opt.anchor;

		YTPlayer.opt.anchor = typeof YTPlayer.opt.anchor != "undefined " ? YTPlayer.opt.anchor : "center,center";
		var YTPAlign = YTPlayer.opt.anchor.split( "," );

		//data.optimizeDisplay = YTPlayer.isPlayer ? false : data.optimizeDisplay;

		if( YTPlayer.opt.optimizeDisplay ) {
			var abundance = YTPlayer.isPlayer ? 0 : 180;
			var win = {};
			var el = YTPlayer.wrapper;

			win.width = el.outerWidth();
			win.height = el.outerHeight() + abundance;

			YTPlayer.opt.ratio = eval( YTPlayer.opt.ratio );

			vid.width = win.width;
			//			vid.height = YTPlayer.opt.ratio == "16/9" ? Math.ceil( vid.width * ( 9 / 16 ) ) : Math.ceil( vid.width * ( 3 / 4 ) );
			vid.height = Math.ceil( vid.width / YTPlayer.opt.ratio );

			vid.marginTop = Math.ceil( -( ( vid.height - win.height ) / 2 ) );
			vid.marginLeft = 0;

			var lowest = vid.height < win.height;

			if( lowest ) {

				vid.height = win.height;
				//				vid.width = YTPlayer.opt.ratio == "16/9" ? Math.floor( vid.height * ( 16 / 9 ) ) : Math.floor( vid.height * ( 4 / 3 ) );
				vid.width = Math.ceil( vid.height * YTPlayer.opt.ratio );

				vid.marginTop = 0;
				vid.marginLeft = Math.ceil( -( ( vid.width - win.width ) / 2 ) );

			}

			for( var a in YTPAlign ) {

				if( YTPAlign.hasOwnProperty( a ) ) {

					var al = YTPAlign[ a ].replace( / /g, "" );

					switch( al ) {

						case "top":
							vid.marginTop = lowest ? -( ( vid.height - win.height ) / 2 ) : 0;
							break;

						case "bottom":
							vid.marginTop = lowest ? 0 : -( vid.height - ( win.height ) );
							break;

						case "left":
							vid.marginLeft = 0;
							break;

						case "right":
							vid.marginLeft = lowest ? -( vid.width - win.width ) : 0;
							break;

						default:
							if( vid.width > win.width )
								vid.marginLeft = -( ( vid.width - win.width ) / 2 );
							break;
					}

				}

			}

		} else {
			vid.width = "100%";
			vid.height = "100%";
			vid.marginTop = 0;
			vid.marginLeft = 0;
		}

		playerBox.css( {
			width: vid.width,
			height: vid.height,
			marginTop: vid.marginTop,
			marginLeft: vid.marginLeft,
			maxWidth: "initial"
		} );

	};
	/**
	 *
	 * @param arr
	 * @returns {Array|string|Blob|*}
	 *
	 */
	jQuery.shuffle = function( arr ) {
		var newArray = arr.slice();
		var len = newArray.length;
		var i = len;
		while( i-- ) {
			var p = parseInt( Math.random() * len );
			var t = newArray[ i ];
			newArray[ i ] = newArray[ p ];
			newArray[ p ] = t;
		}
		return newArray;
	};

	jQuery.fn.unselectable = function() {
		return this.each( function() {
			jQuery( this ).css( {
				"-moz-user-select": "none",
				"-webkit-user-select": "none",
				"user-select": "none"
			} ).attr( "unselectable", "on" );
		} );
	};

	/* Exposed public method */
	jQuery.fn.YTPlayer = jQuery.mbYTPlayer.buildPlayer;
	jQuery.fn.YTPGetPlayer = jQuery.mbYTPlayer.getPlayer;
	jQuery.fn.YTPGetVideoID = jQuery.mbYTPlayer.getVideoID;
	jQuery.fn.YTPChangeMovie = jQuery.mbYTPlayer.changeMovie;
	jQuery.fn.YTPPlayerDestroy = jQuery.mbYTPlayer.playerDestroy;

	jQuery.fn.YTPPlay = jQuery.mbYTPlayer.play;
	jQuery.fn.YTPTogglePlay = jQuery.mbYTPlayer.togglePlay;
	jQuery.fn.YTPStop = jQuery.mbYTPlayer.stop;
	jQuery.fn.YTPPause = jQuery.mbYTPlayer.pause;
	jQuery.fn.YTPSeekTo = jQuery.mbYTPlayer.seekTo;

	jQuery.fn.YTPlaylist = jQuery.mbYTPlayer.playlist;
	jQuery.fn.YTPPlayNext = jQuery.mbYTPlayer.playNext;
	jQuery.fn.YTPPlayPrev = jQuery.mbYTPlayer.playPrev;
	jQuery.fn.YTPPlayIndex = jQuery.mbYTPlayer.playIndex;

	jQuery.fn.YTPMute = jQuery.mbYTPlayer.mute;
	jQuery.fn.YTPUnmute = jQuery.mbYTPlayer.unmute;
	jQuery.fn.YTPToggleVolume = jQuery.mbYTPlayer.toggleVolume;
	jQuery.fn.YTPSetVolume = jQuery.mbYTPlayer.setVolume;

	jQuery.fn.YTPGetVideoData = jQuery.mbYTPlayer.getVideoData;
	jQuery.fn.YTPFullscreen = jQuery.mbYTPlayer.fullscreen;
	jQuery.fn.YTPToggleLoops = jQuery.mbYTPlayer.toggleLoops;
	jQuery.fn.YTPSetVideoQuality = jQuery.mbYTPlayer.setVideoQuality;
	jQuery.fn.YTPManageProgress = jQuery.mbYTPlayer.manageProgress;

	jQuery.fn.YTPApplyFilter = jQuery.mbYTPlayer.applyFilter;
	jQuery.fn.YTPApplyFilters = jQuery.mbYTPlayer.applyFilters;
	jQuery.fn.YTPToggleFilter = jQuery.mbYTPlayer.toggleFilter;
	jQuery.fn.YTPToggleFilters = jQuery.mbYTPlayer.toggleFilters;
	jQuery.fn.YTPRemoveFilter = jQuery.mbYTPlayer.removeFilter;
	jQuery.fn.YTPDisableFilters = jQuery.mbYTPlayer.disableFilters;
	jQuery.fn.YTPEnableFilters = jQuery.mbYTPlayer.enableFilters;
	jQuery.fn.YTPGetFilters = jQuery.mbYTPlayer.getFilters;

	jQuery.fn.YTPGetTime = jQuery.mbYTPlayer.getTime;
	jQuery.fn.YTPGetTotalTime = jQuery.mbYTPlayer.getTotalTime;

	jQuery.fn.YTPAddMask = jQuery.mbYTPlayer.addMask;
	jQuery.fn.YTPRemoveMask = jQuery.mbYTPlayer.removeMask;
	jQuery.fn.YTPToggleMask = jQuery.mbYTPlayer.toggleMask;

	jQuery.fn.YTPSetAnchor = jQuery.mbYTPlayer.setAnchor;
	jQuery.fn.YTPGetAnchor = jQuery.mbYTPlayer.getAnchor;

	/**
	 *
	 * @deprecated
	 * todo: Above methods will be removed with version 3.5.0
	 *
	 **/
	jQuery.fn.mb_YTPlayer = jQuery.mbYTPlayer.buildPlayer;
	jQuery.fn.playNext = jQuery.mbYTPlayer.playNext;
	jQuery.fn.playPrev = jQuery.mbYTPlayer.playPrev;
	jQuery.fn.changeMovie = jQuery.mbYTPlayer.changeMovie;
	jQuery.fn.getVideoID = jQuery.mbYTPlayer.getVideoID;
	jQuery.fn.getPlayer = jQuery.mbYTPlayer.getPlayer;
	jQuery.fn.playerDestroy = jQuery.mbYTPlayer.playerDestroy;
	jQuery.fn.fullscreen = jQuery.mbYTPlayer.fullscreen;
	jQuery.fn.buildYTPControls = jQuery.mbYTPlayer.buildControls;
	jQuery.fn.playYTP = jQuery.mbYTPlayer.play;
	jQuery.fn.toggleLoops = jQuery.mbYTPlayer.toggleLoops;
	jQuery.fn.stopYTP = jQuery.mbYTPlayer.stop;
	jQuery.fn.pauseYTP = jQuery.mbYTPlayer.pause;
	jQuery.fn.seekToYTP = jQuery.mbYTPlayer.seekTo;
	jQuery.fn.muteYTPVolume = jQuery.mbYTPlayer.mute;
	jQuery.fn.unmuteYTPVolume = jQuery.mbYTPlayer.unmute;
	jQuery.fn.setYTPVolume = jQuery.mbYTPlayer.setVolume;
	jQuery.fn.setVideoQuality = jQuery.mbYTPlayer.setVideoQuality;
	jQuery.fn.manageYTPProgress = jQuery.mbYTPlayer.manageProgress;
	jQuery.fn.YTPGetDataFromFeed = jQuery.mbYTPlayer.getVideoData;


} )( jQuery, ytp );

/*
 * ******************************************************************************
 *  jquery.mb.components
 *  file: jquery.mb.CSSAnimate.min.js
 *
 *  Copyright (c) 2001-2014. Matteo Bicocchi (Pupunzi);
 *  Open lab srl, Firenze - Italy
 *  email: matteo@open-lab.com
 *  site: 	http://pupunzi.com
 *  blog:	http://pupunzi.open-lab.com
 * 	http://open-lab.com
 *
 *  Licences: MIT, GPL
 *  http://www.opensource.org/licenses/mit-license.php
 *  http://www.gnu.org/licenses/gpl.html
 *
 *  last modified: 26/03/14 21.40
 *  *****************************************************************************
 */

function uncamel(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase();});}function setUnit(e,t){return"string"!=typeof e||e.match(/^[\-0-9\.]+jQuery/)?""+e+t:e;}function setFilter(e,t,r){var i=uncamel(t),n=jQuery.browser.mozilla?"":jQuery.CSS.sfx;e[n+"filter"]=e[n+"filter"]||"",r=setUnit(r>jQuery.CSS.filters[t].max?jQuery.CSS.filters[t].max:r,jQuery.CSS.filters[t].unit),e[n+"filter"]+=i+"("+r+") ",delete e[t];}jQuery.support.CSStransition=function(){var e=document.body||document.documentElement,t=e.style;return void 0!==t.transition||void 0!==t.WebkitTransition||void 0!==t.MozTransition||void 0!==t.MsTransition||void 0!==t.OTransition;}(),jQuery.CSS={name:"mb.CSSAnimate",author:"Matteo Bicocchi",version:"2.0.0",transitionEnd:"transitionEnd",sfx:"",filters:{blur:{min:0,max:100,unit:"px"},brightness:{min:0,max:400,unit:"%"},contrast:{min:0,max:400,unit:"%"},grayscale:{min:0,max:100,unit:"%"},hueRotate:{min:0,max:360,unit:"deg"},invert:{min:0,max:100,unit:"%"},saturate:{min:0,max:400,unit:"%"},sepia:{min:0,max:100,unit:"%"}},normalizeCss:function(e){var t=jQuery.extend(!0,{},e);jQuery.browser.webkit||jQuery.browser.opera?jQuery.CSS.sfx="-webkit-":jQuery.browser.mozilla?jQuery.CSS.sfx="-moz-":jQuery.browser.msie&&(jQuery.CSS.sfx="-ms-");for(var r in t){"transform"===r&&(t[jQuery.CSS.sfx+"transform"]=t[r],delete t[r]),"transform-origin"===r&&(t[jQuery.CSS.sfx+"transform-origin"]=e[r],delete t[r]),"filter"!==r||jQuery.browser.mozilla||(t[jQuery.CSS.sfx+"filter"]=e[r],delete t[r]),"blur"===r&&setFilter(t,"blur",e[r]),"brightness"===r&&setFilter(t,"brightness",e[r]),"contrast"===r&&setFilter(t,"contrast",e[r]),"grayscale"===r&&setFilter(t,"grayscale",e[r]),"hueRotate"===r&&setFilter(t,"hueRotate",e[r]),"invert"===r&&setFilter(t,"invert",e[r]),"saturate"===r&&setFilter(t,"saturate",e[r]),"sepia"===r&&setFilter(t,"sepia",e[r]);var i="";"x"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" translateX("+setUnit(e[r],"px")+")",delete t[r]),"y"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" translateY("+setUnit(e[r],"px")+")",delete t[r]),"z"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" translateZ("+setUnit(e[r],"px")+")",delete t[r]),"rotate"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" rotate("+setUnit(e[r],"deg")+")",delete t[r]),"rotateX"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" rotateX("+setUnit(e[r],"deg")+")",delete t[r]),"rotateY"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" rotateY("+setUnit(e[r],"deg")+")",delete t[r]),"rotateZ"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" rotateZ("+setUnit(e[r],"deg")+")",delete t[r]),"scale"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" scale("+setUnit(e[r],"")+")",delete t[r]),"scaleX"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" scaleX("+setUnit(e[r],"")+")",delete t[r]),"scaleY"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" scaleY("+setUnit(e[r],"")+")",delete t[r]),"scaleZ"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" scaleZ("+setUnit(e[r],"")+")",delete t[r]),"skew"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" skew("+setUnit(e[r],"deg")+")",delete t[r]),"skewX"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" skewX("+setUnit(e[r],"deg")+")",delete t[r]),"skewY"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" skewY("+setUnit(e[r],"deg")+")",delete t[r]),"perspective"===r&&(i=jQuery.CSS.sfx+"transform",t[i]=t[i]||"",t[i]+=" perspective("+setUnit(e[r],"px")+")",delete t[r]);}return t;},getProp:function(e){var t=[];for(var r in e)t.indexOf(r)<0&&t.push(uncamel(r));return t.join(",");},animate:function(e,t,r,i,n){return this.each(function(){function s(){u.called=!0,u.CSSAIsRunning=!1,a.off(jQuery.CSS.transitionEnd+"."+u.id),clearTimeout(u.timeout),a.css(jQuery.CSS.sfx+"transition",""),"function"==typeof n&&n.apply(u),"function"==typeof u.CSSqueue&&(u.CSSqueue(),u.CSSqueue=null);}var u=this,a=jQuery(this);u.id=u.id||"CSSA_"+(new Date).getTime();var o=o||{type:"noEvent"};if(u.CSSAIsRunning&&u.eventType==o.type&&!jQuery.browser.msie&&jQuery.browser.version<=9)return void(u.CSSqueue=function(){a.CSSAnimate(e,t,r,i,n);});if(u.CSSqueue=null,u.eventType=o.type,0!==a.length&&e){if(e=jQuery.normalizeCss(e),u.CSSAIsRunning=!0,"function"==typeof t&&(n=t,t=jQuery.fx.speeds._default),"function"==typeof r&&(i=r,r=0),"string"==typeof r&&(n=r,r=0),"function"==typeof i&&(n=i,i="cubic-bezier(0.65,0.03,0.36,0.72)"),"string"==typeof t)for(var f in jQuery.fx.speeds){if(t==f){t=jQuery.fx.speeds[f];break;}t=jQuery.fx.speeds._default;}if(t||(t=jQuery.fx.speeds._default),"string"==typeof n&&(i=n,n=null),!jQuery.support.CSStransition){for(var c in e){if("transform"===c&&delete e[c],"filter"===c&&delete e[c],"transform-origin"===c&&delete e[c],"auto"===e[c]&&delete e[c],"x"===c){var S=e[c],l="left";e[l]=S,delete e[c];}if("y"===c){var S=e[c],l="top";e[l]=S,delete e[c];}("-ms-transform"===c||"-ms-filter"===c)&&delete e[c];}return void a.delay(r).animate(e,t,n);}var y={"default":"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"};y[i]&&(i=y[i]),a.off(jQuery.CSS.transitionEnd+"."+u.id);var m=jQuery.CSS.getProp(e),d={};jQuery.extend(d,e),d[jQuery.CSS.sfx+"transition-property"]=m,d[jQuery.CSS.sfx+"transition-duration"]=t+"ms",d[jQuery.CSS.sfx+"transition-delay"]=r+"ms",d[jQuery.CSS.sfx+"transition-timing-function"]=i,setTimeout(function(){a.one(jQuery.CSS.transitionEnd+"."+u.id,s),a.css(d);},1),u.timeout=setTimeout(function(){return u.called||!n?(u.called=!1,void(u.CSSAIsRunning=!1)):(a.css(jQuery.CSS.sfx+"transition",""),n.apply(u),u.CSSAIsRunning=!1,void("function"==typeof u.CSSqueue&&(u.CSSqueue(),u.CSSqueue=null)));},t+r+10);}});}},jQuery.fn.CSSAnimate=jQuery.CSS.animate,jQuery.normalizeCss=jQuery.CSS.normalizeCss,jQuery.fn.css3=function(e){return this.each(function(){var t=jQuery(this),r=jQuery.normalizeCss(e);t.css(r);});};
/*___________________________________________________________________________________________________________________________________________________
 _ jquery.mb.components                                                                                                                             _
 _                                                                                                                                                  _
 _ file: jquery.mb.browser.min.js                                                                                                                   _
 _ last modified: 24/05/17 19.56                                                                                                                    _
 _                                                                                                                                                  _
 _ Open Lab s.r.l., Florence - Italy                                                                                                                _
 _                                                                                                                                                  _
 _ email: matteo@open-lab.com                                                                                                                       _
 _ site: http://pupunzi.com                                                                                                                         _
 _       http://open-lab.com                                                                                                                        _
 _ blog: http://pupunzi.open-lab.com                                                                                                                _
 _ Q&A:  http://jquery.pupunzi.com                                                                                                                  _
 _                                                                                                                                                  _
 _ Licences: MIT, GPL                                                                                                                               _
 _    http://www.opensource.org/licenses/mit-license.php                                                                                            _
 _    http://www.gnu.org/licenses/gpl.html                                                                                                          _
 _                                                                                                                                                  _
 _ Copyright (c) 2001-2017. Matteo Bicocchi (Pupunzi);                                                                                              _
 ___________________________________________________________________________________________________________________________________________________*/

var nAgt=navigator.userAgent;jQuery.browser=jQuery.browser||{};jQuery.browser.mozilla=!1;jQuery.browser.webkit=!1;jQuery.browser.opera=!1;jQuery.browser.safari=!1;jQuery.browser.chrome=!1;jQuery.browser.androidStock=!1;jQuery.browser.msie=!1;jQuery.browser.edge=!1;jQuery.browser.ua=nAgt;function isTouchSupported(){var a=nAgt.msMaxTouchPoints,e="ontouchstart"in document.createElement("div");return a||e?!0:!1;}
var getOS=function(){var a={version:"Unknown version",name:"Unknown OS"};-1!=navigator.appVersion.indexOf("Win")&&(a.name="Windows");-1!=navigator.appVersion.indexOf("Mac")&&0>navigator.appVersion.indexOf("Mobile")&&(a.name="Mac");-1!=navigator.appVersion.indexOf("Linux")&&(a.name="Linux");/Mac OS X/.test(nAgt)&&!/Mobile/.test(nAgt)&&(a.version=/Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1],a.version=a.version.replace(/_/g,".").substring(0,5));/Windows/.test(nAgt)&&(a.version="Unknown.Unknown");/Windows NT 5.1/.test(nAgt)&&
(a.version="5.1");/Windows NT 6.0/.test(nAgt)&&(a.version="6.0");/Windows NT 6.1/.test(nAgt)&&(a.version="6.1");/Windows NT 6.2/.test(nAgt)&&(a.version="6.2");/Windows NT 10.0/.test(nAgt)&&(a.version="10.0");/Linux/.test(nAgt)&&/Linux/.test(nAgt)&&(a.version="Unknown.Unknown");a.name=a.name.toLowerCase();a.major_version="Unknown";a.minor_version="Unknown";"Unknown.Unknown"!=a.version&&(a.major_version=parseFloat(a.version.split(".")[0]),a.minor_version=parseFloat(a.version.split(".")[1]));return a;};
jQuery.browser.os=getOS();jQuery.browser.hasTouch=isTouchSupported();jQuery.browser.name=navigator.appName;jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion);jQuery.browser.majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;
if(-1!=(verOffset=nAgt.indexOf("Opera")))jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8));else if(-1!=(verOffset=nAgt.indexOf("OPR")))jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+4);else if(-1!=(verOffset=nAgt.indexOf("MSIE")))jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer",
		jQuery.browser.fullVersion=nAgt.substring(verOffset+5);else if(-1!=nAgt.indexOf("Trident")){jQuery.browser.msie=!0;jQuery.browser.name="Microsoft Internet Explorer";var start=nAgt.indexOf("rv:")+3,end=start+4;jQuery.browser.fullVersion=nAgt.substring(start,end);}else-1!=(verOffset=nAgt.indexOf("Edge"))?(jQuery.browser.edge=!0,jQuery.browser.name="Microsoft Edge",jQuery.browser.fullVersion=nAgt.substring(verOffset+5)):-1!=(verOffset=nAgt.indexOf("Chrome"))?(jQuery.browser.webkit=!0,jQuery.browser.chrome=
		!0,jQuery.browser.name="Chrome",jQuery.browser.fullVersion=nAgt.substring(verOffset+7)):-1<nAgt.indexOf("mozilla/5.0")&&-1<nAgt.indexOf("android ")&&-1<nAgt.indexOf("applewebkit")&&!(-1<nAgt.indexOf("chrome"))?(verOffset=nAgt.indexOf("Chrome"),jQuery.browser.webkit=!0,jQuery.browser.androidStock=!0,jQuery.browser.name="androidStock",jQuery.browser.fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(jQuery.browser.webkit=!0,jQuery.browser.safari=!0,jQuery.browser.name=
		"Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("AppleWebkit"))?(jQuery.browser.webkit=!0,jQuery.browser.safari=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(jQuery.browser.mozilla=
		!0,jQuery.browser.name="Firefox",jQuery.browser.fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(jQuery.browser.name=nAgt.substring(nameOffset,verOffset),jQuery.browser.fullVersion=nAgt.substring(verOffset+1),jQuery.browser.name.toLowerCase()==jQuery.browser.name.toUpperCase()&&(jQuery.browser.name=navigator.appName));
-1!=(ix=jQuery.browser.fullVersion.indexOf(";"))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix));-1!=(ix=jQuery.browser.fullVersion.indexOf(" "))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix));jQuery.browser.majorVersion=parseInt(""+jQuery.browser.fullVersion,10);isNaN(jQuery.browser.majorVersion)&&(jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10));
jQuery.browser.version=jQuery.browser.majorVersion;jQuery.browser.android=/Android/i.test(nAgt);jQuery.browser.blackberry=/BlackBerry|BB|PlayBook/i.test(nAgt);jQuery.browser.ios=/iPhone|iPad|iPod|webOS/i.test(nAgt);jQuery.browser.operaMobile=/Opera Mini/i.test(nAgt);jQuery.browser.windowsMobile=/IEMobile|Windows Phone/i.test(nAgt);jQuery.browser.kindle=/Kindle|Silk/i.test(nAgt);
jQuery.browser.mobile=jQuery.browser.android||jQuery.browser.blackberry||jQuery.browser.ios||jQuery.browser.windowsMobile||jQuery.browser.operaMobile||jQuery.browser.kindle;jQuery.isMobile=jQuery.browser.mobile;jQuery.isTablet=jQuery.browser.mobile&&765<jQuery(window).width();jQuery.isAndroidDefault=jQuery.browser.android&&!/chrome/i.test(nAgt);jQuery.mbBrowser=jQuery.browser;
jQuery.browser.versionCompare=function(a,e){if("stringstring"!=typeof a+typeof e)return!1;for(var c=a.split("."),d=e.split("."),b=0,f=Math.max(c.length,d.length);b<f;b++){if(c[b]&&!d[b]&&0<parseInt(c[b])||parseInt(c[b])>parseInt(d[b]))return 1;if(d[b]&&!c[b]&&0<parseInt(d[b])||parseInt(c[b])<parseInt(d[b]))return-1;}return 0;};
/*___________________________________________________________________________________________________________________________________________________
 _ jquery.mb.components                                                                                                                             _
 _                                                                                                                                                  _
 _ file: jquery.mb.simpleSlider.min.js                                                                                                              _
 _ last modified: 09/05/17 19.31                                                                                                                    _
 _                                                                                                                                                  _
 _ Open Lab s.r.l., Florence - Italy                                                                                                                _
 _                                                                                                                                                  _
 _ email: matteo@open-lab.com                                                                                                                       _
 _ site: http://pupunzi.com                                                                                                                         _
 _       http://open-lab.com                                                                                                                        _
 _ blog: http://pupunzi.open-lab.com                                                                                                                _
 _ Q&A:  http://jquery.pupunzi.com                                                                                                                  _
 _                                                                                                                                                  _
 _ Licences: MIT, GPL                                                                                                                               _
 _    http://www.opensource.org/licenses/mit-license.php                                                                                            _
 _    http://www.gnu.org/licenses/gpl.html                                                                                                          _
 _                                                                                                                                                  _
 _ Copyright (c) 2001-2017. Matteo Bicocchi (Pupunzi);                                                                                              _
 ___________________________________________________________________________________________________________________________________________________*/

(function(b){b.simpleSlider={defaults:{initialval:0,scale:100,orientation:"h",readonly:!1,callback:!1},events:{start:b.browser.mobile?"touchstart":"mousedown",end:b.browser.mobile?"touchend":"mouseup",move:b.browser.mobile?"touchmove":"mousemove"},init:function(c){return this.each(function(){var a=this,d=b(a);d.addClass("simpleSlider");a.opt={};b.extend(a.opt,b.simpleSlider.defaults,c);b.extend(a.opt,d.data());var e="h"==a.opt.orientation?"horizontal":"vertical",e=b("<div/>").addClass("level").addClass(e);
	d.prepend(e);a.level=e;d.css({cursor:"default"});"auto"==a.opt.scale&&(a.opt.scale=b(a).outerWidth());d.updateSliderVal();a.opt.readonly||(d.on(b.simpleSlider.events.start,function(c){b.browser.mobile&&(c=c.changedTouches[0]);a.canSlide=!0;d.updateSliderVal(c);"h"==a.opt.orientation?d.css({cursor:"col-resize"}):d.css({cursor:"row-resize"});c.preventDefault();c.stopPropagation();}),b(document).on(b.simpleSlider.events.move,function(c){b.browser.mobile&&(c=c.changedTouches[0]);a.canSlide&&(b(document).css({cursor:"default"}),
			d.updateSliderVal(c),c.preventDefault(),c.stopPropagation());}).on(b.simpleSlider.events.end,function(){b(document).css({cursor:"auto"});a.canSlide=!1;d.css({cursor:"auto"});}));});},updateSliderVal:function(c){var a=this.get(0);if(a.opt){a.opt.initialval="number"==typeof a.opt.initialval?a.opt.initialval:a.opt.initialval(a);var d=b(a).outerWidth(),e=b(a).outerHeight();a.x="object"==typeof c?c.clientX+document.body.scrollLeft-this.offset().left:"number"==typeof c?c*d/a.opt.scale:a.opt.initialval*d/a.opt.scale;
	a.y="object"==typeof c?c.clientY+document.body.scrollTop-this.offset().top:"number"==typeof c?(a.opt.scale-a.opt.initialval-c)*e/a.opt.scale:a.opt.initialval*e/a.opt.scale;a.y=this.outerHeight()-a.y;a.scaleX=a.x*a.opt.scale/d;a.scaleY=a.y*a.opt.scale/e;a.outOfRangeX=a.scaleX>a.opt.scale?a.scaleX-a.opt.scale:0>a.scaleX?a.scaleX:0;a.outOfRangeY=a.scaleY>a.opt.scale?a.scaleY-a.opt.scale:0>a.scaleY?a.scaleY:0;a.outOfRange="h"==a.opt.orientation?a.outOfRangeX:a.outOfRangeY;a.value="undefined"!=typeof c?
					"h"==a.opt.orientation?a.x>=this.outerWidth()?a.opt.scale:0>=a.x?0:a.scaleX:a.y>=this.outerHeight()?a.opt.scale:0>=a.y?0:a.scaleY:"h"==a.opt.orientation?a.scaleX:a.scaleY;"h"==a.opt.orientation?a.level.width(Math.floor(100*a.x/d)+"%"):a.level.height(Math.floor(100*a.y/e));"function"==typeof a.opt.callback&&a.opt.callback(a);}}};b.fn.simpleSlider=b.simpleSlider.init;b.fn.updateSliderVal=b.simpleSlider.updateSliderVal;})(jQuery);
/*___________________________________________________________________________________________________________________________________________________
 _ jquery.mb.components                                                                                                                             _
 _                                                                                                                                                  _
 _ file: jquery.mb.storage.min.js                                                                                                                   _
 _ last modified: 24/05/15 16.08                                                                                                                    _
 _                                                                                                                                                  _
 _ Open Lab s.r.l., Florence - Italy                                                                                                                _
 _                                                                                                                                                  _
 _ email: matteo@open-lab.com                                                                                                                       _
 _ site: http://pupunzi.com                                                                                                                         _
 _       http://open-lab.com                                                                                                                        _
 _ blog: http://pupunzi.open-lab.com                                                                                                                _
 _ Q&A:  http://jquery.pupunzi.com                                                                                                                  _
 _                                                                                                                                                  _
 _ Licences: MIT, GPL                                                                                                                               _
 _    http://www.opensource.org/licenses/mit-license.php                                                                                            _
 _    http://www.gnu.org/licenses/gpl.html                                                                                                          _
 _                                                                                                                                                  _
 _ Copyright (c) 2001-2015. Matteo Bicocchi (Pupunzi);                                                                                              _
 ___________________________________________________________________________________________________________________________________________________*/

(function(d){d.mbCookie={set:function(a,c,f,b){"object"==typeof c&&(c=JSON.stringify(c));b=b?"; domain="+b:"";var e=new Date,d="";0<f&&(e.setTime(e.getTime()+864E5*f),d="; expires="+e.toGMTString());document.cookie=a+"="+c+d+"; path=/"+b;},get:function(a){a+="=";for(var c=document.cookie.split(";"),d=0;d<c.length;d++){for(var b=c[d];" "==b.charAt(0);)b=b.substring(1,b.length);if(0==b.indexOf(a))try{return JSON.parse(b.substring(a.length,b.length));}catch(e){return b.substring(a.length,b.length);}}return null;},
	remove:function(a){d.mbCookie.set(a,"",-1);}};d.mbStorage={set:function(a,c){"object"==typeof c&&(c=JSON.stringify(c));localStorage.setItem(a,c);},get:function(a){if(localStorage[a])try{return JSON.parse(localStorage[a]);}catch(c){return localStorage[a];}else return null;},remove:function(a){a?localStorage.removeItem(a):localStorage.clear();}};})(jQuery);

/*! Swipebox v1.4.4 | Constantin Saguin csag.co | MIT License | github.com/brutaldesign/swipebox */

( function ( window, document, $, undefined ) {

	$.swipebox = function( elem, options ) {

		// Default options
		var ui,
			defaults = {
				useCSS : true,
				useSVG : true,
				initialIndexOnArray : 0,
				removeBarsOnMobile : true,
				hideCloseButtonOnMobile : false,
				hideBarsDelay : 3000,
				videoMaxWidth : 1140,
				vimeoColor : 'cccccc',
				beforeOpen: null,
				afterOpen: null,
				afterClose: null,
				afterMedia: null,
				nextSlide: null,
				prevSlide: null,
				loopAtEnd: false,
				autoplayVideos: false,
				queryStringData: {},
				toggleClassOnLoad: ''
			},

			plugin = this,
			elements = [], // slides array [ { href:'...', title:'...' }, ...],
			$elem,
			selector = elem.selector,
			isMobile = navigator.userAgent.match( /(iPad)|(iPhone)|(iPod)|(Android)|(PlayBook)|(BB10)|(BlackBerry)|(Opera Mini)|(IEMobile)|(webOS)|(MeeGo)/i ),
			isTouch = isMobile !== null || document.createTouch !== undefined || ( 'ontouchstart' in window ) || ( 'onmsgesturechange' in window ) || navigator.msMaxTouchPoints,
			supportSVG = !! document.createElementNS && !! document.createElementNS( 'http://www.w3.org/2000/svg', 'svg').createSVGRect,
			winWidth = window.innerWidth ? window.innerWidth : $( window ).width(),
			winHeight = window.innerHeight ? window.innerHeight : $( window ).height(),
			currentX = 0,
			/* jshint multistr: true */
			html = '<div id="swipebox-overlay">\
					<div id="swipebox-container">\
						<div id="swipebox-slider"></div>\
						<div id="swipebox-top-bar">\
							<div id="swipebox-title"></div>\
						</div>\
						<div id="swipebox-bottom-bar">\
							<div id="swipebox-arrows">\
								<a id="swipebox-prev"></a>\
								<a id="swipebox-next"></a>\
							</div>\
						</div>\
						<a id="swipebox-close"></a>\
					</div>\
			</div>';

		plugin.settings = {};

		$.swipebox.close = function () {
			ui.closeSlide();
		};

		$.swipebox.extend = function () {
			return ui;
		};

		plugin.init = function() {

			plugin.settings = $.extend( {}, defaults, options );

			if ( $.isArray( elem ) ) {

				elements = elem;
				ui.target = $( window );
				ui.init( plugin.settings.initialIndexOnArray );

			} else {

				$( document ).on( 'click', selector, function( event ) {

					// console.log( isTouch );

					if ( event.target.parentNode.className === 'slide current' ) {

						return false;
					}

					if ( ! $.isArray( elem ) ) {
						ui.destroy();
						$elem = $( selector );
						ui.actions();
					}

					elements = [];
					var index, relType, relVal;

					// Allow for HTML5 compliant attribute before legacy use of rel
					if ( ! relVal ) {
						relType = 'data-rel';
						relVal = $( this ).attr( relType );
					}

					if ( ! relVal ) {
						relType = 'rel';
						relVal = $( this ).attr( relType );
					}

					if ( relVal && relVal !== '' && relVal !== 'nofollow' ) {
						$elem = $( selector ).filter( '[' + relType + '="' + relVal + '"]' );
					} else {
						$elem = $( selector );
					}

					$elem.each( function() {

						var title = null,
							href = null;

						if ( $( this ).attr( 'title' ) ) {
							title = $( this ).attr( 'title' );
						}


						if ( $( this ).attr( 'href' ) ) {
							href = $( this ).attr( 'href' );
						}

						elements.push( {
							href: href,
							title: title
						} );
					} );

					index = $elem.index( $( this ) );
					event.preventDefault();
					event.stopPropagation();
					ui.target = $( event.target );
					ui.init( index );
				} );
			}
		};

		ui = {

			/**
			 * Initiate Swipebox
			 */
			init : function( index ) {
				if ( plugin.settings.beforeOpen ) {
					plugin.settings.beforeOpen();
				}
				this.target.trigger( 'swipebox-start' );
				$.swipebox.isOpen = true;
				this.build();
				this.openSlide( index );
				this.openMedia( index );
				this.preloadMedia( index+1 );
				this.preloadMedia( index-1 );
				if ( plugin.settings.afterOpen ) {
					plugin.settings.afterOpen(index);
				}
			},

			/**
			 * Built HTML containers and fire main functions
			 */
			build : function () {
				var $this = this, bg;

				$( 'body' ).append( html );

				if ( supportSVG && plugin.settings.useSVG === true ) {
					bg = $( '#swipebox-close' ).css( 'background-image' );
					bg = bg.replace( 'png', 'svg' );
					$( '#swipebox-prev, #swipebox-next, #swipebox-close' ).css( {
						'background-image' : bg
					} );
				}

				if ( isMobile && plugin.settings.removeBarsOnMobile ) {
					$( '#swipebox-bottom-bar, #swipebox-top-bar' ).remove();
				}

				$.each( elements,  function() {
					$( '#swipebox-slider' ).append( '<div class="slide"></div>' );
				} );

				$this.setDim();
				$this.actions();

				if ( isTouch ) {
					$this.gesture();
				}

				// Devices can have both touch and keyboard input so always allow key events
				$this.keyboard();

				$this.animBars();
				$this.resize();

			},

			/**
			 * Set dimensions depending on windows width and height
			 */
			setDim : function () {

				var width, height, sliderCss = {};

				// Reset dimensions on mobile orientation change
				if ( 'onorientationchange' in window ) {

					window.addEventListener( 'orientationchange', function() {
						if ( window.orientation === 0 ) {
							width = winWidth;
							height = winHeight;
						} else if ( window.orientation === 90 || window.orientation === -90 ) {
							width = winHeight;
							height = winWidth;
						}
					}, false );


				} else {

					width = window.innerWidth ? window.innerWidth : $( window ).width();
					height = window.innerHeight ? window.innerHeight : $( window ).height();
				}

				sliderCss = {
					width : width,
					height : height
				};

				$( '#swipebox-overlay' ).css( sliderCss );

			},

			/**
			 * Reset dimensions on window resize envent
			 */
			resize : function () {
				var $this = this;

				$( window ).resize( function() {
					$this.setDim();
				} ).resize();
			},

			/**
			 * Check if device supports CSS transitions
			 */
			supportTransition : function () {

				var prefixes = 'transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition'.split( ' ' ),
					i;

				for ( i = 0; i < prefixes.length; i++ ) {
					if ( document.createElement( 'div' ).style[ prefixes[i] ] !== undefined ) {
						return prefixes[i];
					}
				}
				return false;
			},

			/**
			 * Check if CSS transitions are allowed (options + devicesupport)
			 */
			doCssTrans : function () {
				if ( plugin.settings.useCSS && this.supportTransition() ) {
					return true;
				}
			},

			/**
			 * Touch navigation
			 */
			gesture : function () {

				var $this = this,
					index,
					hDistance,
					vDistance,
					hDistanceLast,
					vDistanceLast,
					hDistancePercent,
					vSwipe = false,
					hSwipe = false,
					hSwipMinDistance = 10,
					vSwipMinDistance = 50,
					startCoords = {},
					endCoords = {},
					bars = $( '#swipebox-top-bar, #swipebox-bottom-bar' ),
					slider = $( '#swipebox-slider' );

				bars.addClass( 'visible-bars' );
				$this.setTimeout();

				$( 'body' ).bind( 'touchstart', function( event ) {

					$( this ).addClass( 'touching' );
					index = $( '#swipebox-slider .slide' ).index( $( '#swipebox-slider .slide.current' ) );
					endCoords = event.originalEvent.targetTouches[0];
					startCoords.pageX = event.originalEvent.targetTouches[0].pageX;
					startCoords.pageY = event.originalEvent.targetTouches[0].pageY;

					$( '#swipebox-slider' ).css( {
						'-webkit-transform' : 'translate3d(' + currentX +'%, 0, 0)',
						'transform' : 'translate3d(' + currentX + '%, 0, 0)'
					} );

					$( '.touching' ).bind( 'touchmove',function( event ) {
						event.preventDefault();
						event.stopPropagation();
						endCoords = event.originalEvent.targetTouches[0];

						if ( ! hSwipe ) {
							vDistanceLast = vDistance;
							vDistance = endCoords.pageY - startCoords.pageY;
							if ( Math.abs( vDistance ) >= vSwipMinDistance || vSwipe ) {
								var opacity = 0.75 - Math.abs(vDistance) / slider.height();

								slider.css( { 'top': vDistance + 'px' } );
								slider.css( { 'opacity': opacity } );

								vSwipe = true;
							}
						}

						hDistanceLast = hDistance;
						hDistance = endCoords.pageX - startCoords.pageX;
						hDistancePercent = hDistance * 100 / winWidth;

						if ( ! hSwipe && ! vSwipe && Math.abs( hDistance ) >= hSwipMinDistance ) {
							$( '#swipebox-slider' ).css( {
								'-webkit-transition' : '',
								'transition' : ''
							} );
							hSwipe = true;
						}

						if ( hSwipe ) {

							// swipe left
							if ( 0 < hDistance ) {

								// first slide
								if ( 0 === index ) {
									// console.log( 'first' );
									$( '#swipebox-overlay' ).addClass( 'leftSpringTouch' );
								} else {
									// Follow gesture
									$( '#swipebox-overlay' ).removeClass( 'leftSpringTouch' ).removeClass( 'rightSpringTouch' );
									$( '#swipebox-slider' ).css( {
										'-webkit-transform' : 'translate3d(' + ( currentX + hDistancePercent ) +'%, 0, 0)',
										'transform' : 'translate3d(' + ( currentX + hDistancePercent ) + '%, 0, 0)'
									} );
								}

							// swipe rught
							} else if ( 0 > hDistance ) {

								// last Slide
								if ( elements.length === index +1 ) {
									// console.log( 'last' );
									$( '#swipebox-overlay' ).addClass( 'rightSpringTouch' );
								} else {
									$( '#swipebox-overlay' ).removeClass( 'leftSpringTouch' ).removeClass( 'rightSpringTouch' );
									$( '#swipebox-slider' ).css( {
										'-webkit-transform' : 'translate3d(' + ( currentX + hDistancePercent ) +'%, 0, 0)',
										'transform' : 'translate3d(' + ( currentX + hDistancePercent ) + '%, 0, 0)'
									} );
								}

							}
						}
					} );

					return false;

				} ).bind( 'touchend',function( event ) {
					event.preventDefault();
					event.stopPropagation();

					$( '#swipebox-slider' ).css( {
						'-webkit-transition' : '-webkit-transform 0.4s ease',
						'transition' : 'transform 0.4s ease'
					} );

					vDistance = endCoords.pageY - startCoords.pageY;
					hDistance = endCoords.pageX - startCoords.pageX;
					hDistancePercent = hDistance*100/winWidth;

					// Swipe to bottom to close
					if ( vSwipe ) {
						vSwipe = false;
						if ( Math.abs( vDistance ) >= 2 * vSwipMinDistance && Math.abs( vDistance ) > Math.abs( vDistanceLast ) ) {
							var vOffset = vDistance > 0 ? slider.height() : - slider.height();
							slider.animate( { top: vOffset + 'px', 'opacity': 0 },
								300,
								function () {
									$this.closeSlide();
								} );
						} else {
							slider.animate( { top: 0, 'opacity': 1 }, 300 );
						}

					} else if ( hSwipe ) {

						hSwipe = false;

						// swipeLeft
						if( hDistance >= hSwipMinDistance && hDistance >= hDistanceLast) {

							$this.getPrev();

						// swipeRight
						} else if ( hDistance <= -hSwipMinDistance && hDistance <= hDistanceLast) {

							$this.getNext();
						}

					} else { // Top and bottom bars have been removed on touchable devices
						// tap
						if ( ! bars.hasClass( 'visible-bars' ) ) {
							$this.showBars();
							$this.setTimeout();
						} else {
							$this.clearTimeout();
							$this.hideBars();
						}
					}

					$( '#swipebox-slider' ).css( {
						'-webkit-transform' : 'translate3d(' + currentX + '%, 0, 0)',
						'transform' : 'translate3d(' + currentX + '%, 0, 0)'
					} );

					$( '#swipebox-overlay' ).removeClass( 'leftSpringTouch' ).removeClass( 'rightSpringTouch' );
					$( '.touching' ).off( 'touchmove' ).removeClass( 'touching' );

				} );
			},

			/**
			 * Set timer to hide the action bars
			 */
			setTimeout: function () {
				if ( plugin.settings.hideBarsDelay > 0 ) {
					var $this = this;
					$this.clearTimeout();
					$this.timeout = window.setTimeout( function() {
							$this.hideBars();
						},

						plugin.settings.hideBarsDelay
					);
				}
			},

			/**
			 * Clear timer
			 */
			clearTimeout: function () {
				window.clearTimeout( this.timeout );
				this.timeout = null;
			},

			/**
			 * Show navigation and title bars
			 */
			showBars : function () {
				var bars = $( '#swipebox-top-bar, #swipebox-bottom-bar' );
				if ( this.doCssTrans() ) {
					bars.addClass( 'visible-bars' );
				} else {
					$( '#swipebox-top-bar' ).animate( { top : 0 }, 500 );
					$( '#swipebox-bottom-bar' ).animate( { bottom : 0 }, 500 );
					setTimeout( function() {
						bars.addClass( 'visible-bars' );
					}, 1000 );
				}
			},

			/**
			 * Hide navigation and title bars
			 */
			hideBars : function () {
				var bars = $( '#swipebox-top-bar, #swipebox-bottom-bar' );
				if ( this.doCssTrans() ) {
					bars.removeClass( 'visible-bars' );
				} else {
					$( '#swipebox-top-bar' ).animate( { top : '-50px' }, 500 );
					$( '#swipebox-bottom-bar' ).animate( { bottom : '-50px' }, 500 );
					setTimeout( function() {
						bars.removeClass( 'visible-bars' );
					}, 1000 );
				}
			},

			/**
			 * Animate navigation and top bars
			 */
			animBars : function () {
				var $this = this,
					bars = $( '#swipebox-top-bar, #swipebox-bottom-bar' );

				bars.addClass( 'visible-bars' );
				$this.setTimeout();

				$( '#swipebox-slider' ).click( function() {
					if ( ! bars.hasClass( 'visible-bars' ) ) {
						$this.showBars();
						$this.setTimeout();
					}
				} );

				$( '#swipebox-bottom-bar' ).hover( function() {
					$this.showBars();
					bars.addClass( 'visible-bars' );
					$this.clearTimeout();

				}, function() {
					if ( plugin.settings.hideBarsDelay > 0 ) {
						bars.removeClass( 'visible-bars' );
						$this.setTimeout();
					}

				} );
			},

			/**
			 * Keyboard navigation
			 */
			keyboard : function () {
				var $this = this;
				$( window ).bind( 'keyup', function( event ) {
					event.preventDefault();
					event.stopPropagation();

					if ( event.keyCode === 37 ) {

						$this.getPrev();

					} else if ( event.keyCode === 39 ) {

						$this.getNext();

					} else if ( event.keyCode === 27 ) {

						$this.closeSlide();
					}
				} );
			},

			/**
			 * Navigation events : go to next slide, go to prevous slide and close
			 */
			actions : function () {
				var $this = this,
					action = 'touchend click'; // Just detect for both event types to allow for multi-input

				if ( elements.length < 2 ) {

					$( '#swipebox-bottom-bar' ).hide();

					if ( undefined === elements[ 1 ] ) {
						$( '#swipebox-top-bar' ).hide();
					}

				} else {
					$( '#swipebox-prev' ).bind( action, function( event ) {
						event.preventDefault();
						event.stopPropagation();
						$this.getPrev();
						$this.setTimeout();
					} );

					$( '#swipebox-next' ).bind( action, function( event ) {
						event.preventDefault();
						event.stopPropagation();
						$this.getNext();
						$this.setTimeout();
					} );
				}

				$( '#swipebox-close' ).bind( action, function() {
					$this.closeSlide();
				} );
			},

			/**
			 * Set current slide
			 */
			setSlide : function ( index, isFirst ) {

				isFirst = isFirst || false;

				var slider = $( '#swipebox-slider' );

				currentX = -index*100;

				if ( this.doCssTrans() ) {
					slider.css( {
						'-webkit-transform' : 'translate3d(' + (-index*100)+'%, 0, 0)',
						'transform' : 'translate3d(' + (-index*100)+'%, 0, 0)'
					} );
				} else {
					slider.animate( { left : ( -index*100 )+'%' } );
				}

				$( '#swipebox-slider .slide' ).removeClass( 'current' );
				$( '#swipebox-slider .slide' ).eq( index ).addClass( 'current' );
				this.setTitle( index );

				if ( isFirst ) {
					slider.fadeIn();
				}

				$( '#swipebox-prev, #swipebox-next' ).removeClass( 'disabled' );

				if ( index === 0 ) {
					$( '#swipebox-prev' ).addClass( 'disabled' );
				} else if ( index === elements.length - 1 && plugin.settings.loopAtEnd !== true ) {
					$( '#swipebox-next' ).addClass( 'disabled' );
				}
			},

			/**
			 * Open slide
			 */
			openSlide : function ( index ) {
				$( 'html' ).addClass( 'swipebox-html' );
				if ( isTouch ) {
					$( 'html' ).addClass( 'swipebox-touch' );

					if ( plugin.settings.hideCloseButtonOnMobile ) {
						$( 'html' ).addClass( 'swipebox-no-close-button' );
					}
				} else {
					$( 'html' ).addClass( 'swipebox-no-touch' );
				}
				$( window ).trigger( 'resize' ); // fix scroll bar visibility on desktop
				this.setSlide( index, true );
			},

			/**
			 * Set a time out if the media is a video
			 */
			preloadMedia : function ( index ) {
				var $this = this,
					src = null;

				if ( elements[ index ] !== undefined ) {
					src = elements[ index ].href;
				}

				if ( ! $this.isVideo( src ) ) {
					setTimeout( function() {
						$this.openMedia( index );
					}, 1000);
				} else {
					$this.openMedia( index );
				}
			},

			/**
			 * Open
			 */
			openMedia : function ( index ) {
				var $this = this,
					src,
					slide;

				if ( elements[ index ] !== undefined ) {
					src = elements[ index ].href;
				}

				if ( index < 0 || index >= elements.length ) {
					return false;
				}

				slide = $( '#swipebox-slider .slide' ).eq( index );

				if ( ! $this.isVideo( src ) ) {
					slide.addClass( 'slide-loading' );
					$this.loadMedia( src, function() {
						slide.removeClass( 'slide-loading' );
						slide.html( this );

						if ( plugin.settings.afterMedia ) {
							plugin.settings.afterMedia( index );
						}
					} );
				} else {
					slide.html( $this.getVideo( src ) );

					if ( plugin.settings.afterMedia ) {
						plugin.settings.afterMedia( index );
					}
				}

			},

			/**
			 * Set link title attribute as caption
			 */
			setTitle : function ( index ) {
				var title = null;

				$( '#swipebox-title' ).empty();

				if ( elements[ index ] !== undefined ) {
					title = elements[ index ].title;
				}

				if ( title ) {
					$( '#swipebox-top-bar' ).show();
					$( '#swipebox-title' ).append( title );
				} else {
					$( '#swipebox-top-bar' ).hide();
				}
			},

			/**
			 * Check if the URL is a video
			 */
			isVideo : function ( src ) {

				if ( src ) {
					if ( src.match( /(youtube\.com|youtube-nocookie\.com)\/watch\?v=([a-zA-Z0-9\-_]+)/) || src.match( /vimeo\.com\/([0-9]*)/ ) || src.match( /youtu\.be\/([a-zA-Z0-9\-_]+)/ ) ) {
						return true;
					}

					if ( src.toLowerCase().indexOf( 'swipeboxvideo=1' ) >= 0 ) {

						return true;
					}
				}

			},

			/**
			 * Parse URI querystring and:
			 * - overrides value provided via dictionary
			 * - rebuild it again returning a string
			 */
			parseUri : function (uri, customData) {
				var a = document.createElement('a'),
					qs = {};

				// Decode the URI
				a.href = decodeURIComponent( uri );

				// QueryString to Object
				if ( a.search ) {
					qs = JSON.parse( '{"' + a.search.toLowerCase().replace('?','').replace(/&/g,'","').replace(/=/g,'":"') + '"}' );
				}
				
				// Extend with custom data
				if ( $.isPlainObject( customData ) ) {
					qs = $.extend( qs, customData, plugin.settings.queryStringData ); // The dev has always the final word
				}

				// Return querystring as a string
				return $
					.map( qs, function (val, key) {
						if ( val && val > '' ) {
							return encodeURIComponent( key ) + '=' + encodeURIComponent( val );
						}
					})
					.join('&');
			},

			/**
			 * Get video iframe code from URL
			 */
			getVideo : function( url ) {
				var iframe = '',
					youtubeUrl = url.match( /((?:www\.)?youtube\.com|(?:www\.)?youtube-nocookie\.com)\/watch\?v=([a-zA-Z0-9\-_]+)/ ),
					youtubeShortUrl = url.match(/(?:www\.)?youtu\.be\/([a-zA-Z0-9\-_]+)/),
					vimeoUrl = url.match( /(?:www\.)?vimeo\.com\/([0-9]*)/ ),
					qs = '';
				if ( youtubeUrl || youtubeShortUrl) {
					if ( youtubeShortUrl ) {
						youtubeUrl = youtubeShortUrl;
					}
					qs = ui.parseUri( url, {
						'autoplay' : ( plugin.settings.autoplayVideos ? '1' : '0' ),
						'v' : ''
					});
					iframe = '<iframe width="560" height="315" src="//' + youtubeUrl[1] + '/embed/' + youtubeUrl[2] + '?' + qs + '" frameborder="0" allowfullscreen></iframe>';

				} else if ( vimeoUrl ) {
					qs = ui.parseUri( url, {
						'autoplay' : ( plugin.settings.autoplayVideos ? '1' : '0' ),
						'byline' : '0',
						'portrait' : '0',
						'color': plugin.settings.vimeoColor
					});
					iframe = '<iframe width="560" height="315"  src="//player.vimeo.com/video/' + vimeoUrl[1] + '?' + qs + '" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';

				} else {
					iframe = '<iframe width="560" height="315" src="' + url + '" frameborder="0" allowfullscreen></iframe>';
				}

				return '<div class="swipebox-video-container" style="max-width:' + plugin.settings.videoMaxWidth + 'px"><div class="swipebox-video">' + iframe + '</div></div>';
			},

			/**
			 * Load image
			 */
			loadMedia : function ( src, callback ) {
                // Inline content
                if ( src.trim().indexOf('#') === 0 ) {
                    callback.call(
                    	$('<div>', {
                    		'class' : 'swipebox-inline-container'
                    	})
                    	.append(
                    		$(src)
	                    	.clone()
	                    	.toggleClass( plugin.settings.toggleClassOnLoad )
	                    )
                    );
                }
                // Everything else
                else {
    				if ( ! this.isVideo( src ) ) {
    					var img = $( '<img>' ).on( 'load', function() {
    						callback.call( img );
    					} );

    					img.attr( 'src', src );
    				}
                }
			},

			/**
			 * Get next slide
			 */
			getNext : function () {
				var $this = this,
					src,
					index = $( '#swipebox-slider .slide' ).index( $( '#swipebox-slider .slide.current' ) );
				if ( index + 1 < elements.length ) {

					src = $( '#swipebox-slider .slide' ).eq( index ).contents().find( 'iframe' ).attr( 'src' );
					$( '#swipebox-slider .slide' ).eq( index ).contents().find( 'iframe' ).attr( 'src', src );
					index++;
					$this.setSlide( index );
					$this.preloadMedia( index+1 );
					if ( plugin.settings.nextSlide ) {
						plugin.settings.nextSlide(index);
					}
				} else {

					if ( plugin.settings.loopAtEnd === true ) {
						src = $( '#swipebox-slider .slide' ).eq( index ).contents().find( 'iframe' ).attr( 'src' );
						$( '#swipebox-slider .slide' ).eq( index ).contents().find( 'iframe' ).attr( 'src', src );
						index = 0;
						$this.preloadMedia( index );
						$this.setSlide( index );
						$this.preloadMedia( index + 1 );
						if ( plugin.settings.nextSlide ) {
							plugin.settings.nextSlide(index);
						}
					} else {
						$( '#swipebox-overlay' ).addClass( 'rightSpring' );
						setTimeout( function() {
							$( '#swipebox-overlay' ).removeClass( 'rightSpring' );
						}, 500 );
					}
				}
			},

			/**
			 * Get previous slide
			 */
			getPrev : function () {
				var index = $( '#swipebox-slider .slide' ).index( $( '#swipebox-slider .slide.current' ) ),
					src;
				if ( index > 0 ) {
					src = $( '#swipebox-slider .slide' ).eq( index ).contents().find( 'iframe').attr( 'src' );
					$( '#swipebox-slider .slide' ).eq( index ).contents().find( 'iframe' ).attr( 'src', src );
					index--;
					this.setSlide( index );
					this.preloadMedia( index-1 );
					if ( plugin.settings.prevSlide ) {
						plugin.settings.prevSlide(index);
					}
				} else {
					$( '#swipebox-overlay' ).addClass( 'leftSpring' );
					setTimeout( function() {
						$( '#swipebox-overlay' ).removeClass( 'leftSpring' );
					}, 500 );
				}
			},
			/* jshint unused:false */
			nextSlide : function ( index ) {
				// Callback for next slide
			},

			prevSlide : function ( index ) {
				// Callback for prev slide
			},

			/**
			 * Close
			 */
			closeSlide : function () {
				$( 'html' ).removeClass( 'swipebox-html' );
				$( 'html' ).removeClass( 'swipebox-touch' );
				$( window ).trigger( 'resize' );
				this.destroy();
			},

			/**
			 * Destroy the whole thing
			 */
			destroy : function () {
				$( window ).unbind( 'keyup' );
				$( 'body' ).unbind( 'touchstart' );
				$( 'body' ).unbind( 'touchmove' );
				$( 'body' ).unbind( 'touchend' );
				$( '#swipebox-slider' ).unbind();
				$( '#swipebox-overlay' ).remove();

				if ( ! $.isArray( elem ) ) {
					elem.removeData( '_swipebox' );
				}

				if ( this.target ) {
					this.target.trigger( 'swipebox-destroy' );
				}

				$.swipebox.isOpen = false;

				if ( plugin.settings.afterClose ) {
					plugin.settings.afterClose();
				}
			}
		};

		plugin.init();
	};

	$.fn.swipebox = function( options ) {

		if ( ! $.data( this, '_swipebox' ) ) {
			var swipebox = new $.swipebox( this, options );
			this.data( '_swipebox', swipebox );
		}
		return this.data( '_swipebox' );

	};

}( window, document, jQuery ) );

/*!
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

// Script: jQuery throttle / debounce: Sometimes, less is more!
//
// *Version: 1.1, Last updated: 3/7/2010*
//
// Project Home - http://benalman.com/projects/jquery-throttle-debounce-plugin/
// GitHub       - http://github.com/cowboy/jquery-throttle-debounce/
// Source       - http://github.com/cowboy/jquery-throttle-debounce/raw/master/jquery.ba-throttle-debounce.js
// (Minified)   - http://github.com/cowboy/jquery-throttle-debounce/raw/master/jquery.ba-throttle-debounce.min.js (0.7kb)
//
// About: License
//
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
//
// About: Examples
//
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
//
// Throttle - http://benalman.com/code/projects/jquery-throttle-debounce/examples/throttle/
// Debounce - http://benalman.com/code/projects/jquery-throttle-debounce/examples/debounce/
//
// About: Support and Testing
//
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
//
// jQuery Versions - none, 1.3.2, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-3.6, Safari 3-4, Chrome 4-5, Opera 9.6-10.1.
// Unit Tests      - http://benalman.com/code/projects/jquery-throttle-debounce/unit/
//
// About: Release History
//
// 1.1 - (3/7/2010) Fixed a bug in <jQuery.throttle> where trailing callbacks
//       executed later than they should. Reworked a fair amount of internal
//       logic as well.
// 1.0 - (3/6/2010) Initial release as a stand-alone project. Migrated over
//       from jquery-misc repo v0.4 to jquery-throttle repo v1.0, added the
//       no_trailing throttle parameter and debounce functionality.
//
// Topic: Note for non-jQuery users
//
// jQuery isn't actually required for this plugin, because nothing internal
// uses any jQuery methods or properties. jQuery is just used as a namespace
// under which these methods can exist.
//
// Since jQuery isn't actually required for this plugin, if jQuery doesn't exist
// when this plugin is loaded, the method described below will be created in
// the `Cowboy` namespace. Usage will be exactly the same, but instead of
// $.method() or jQuery.method(), you'll need to use Cowboy.method().

(function(window,undefined){
    '$:nomunge'; // Used by YUI compressor.

    // Since jQuery really isn't required for this plugin, use `jQuery` as the
    // namespace only if it already exists, otherwise use the `Cowboy` namespace,
    // creating it if necessary.
    var $ = window.jQuery || window.Cowboy || ( window.Cowboy = {} ),

        // Internal method reference.
        jq_throttle;

    // Method: jQuery.throttle
    //
    // Throttle execution of a function. Especially useful for rate limiting
    // execution of handlers on events like resize and scroll. If you want to
    // rate-limit execution of a function to a single time, see the
    // <jQuery.debounce> method.
    //
    // In this visualization, | is a throttled-function call and X is the actual
    // callback execution:
    //
    // > Throttled with `no_trailing` specified as false or unspecified:
    // > ||||||||||||||||||||||||| (pause) |||||||||||||||||||||||||
    // > X    X    X    X    X    X        X    X    X    X    X    X
    // >
    // > Throttled with `no_trailing` specified as true:
    // > ||||||||||||||||||||||||| (pause) |||||||||||||||||||||||||
    // > X    X    X    X    X             X    X    X    X    X
    //
    // Usage:
    //
    // > var throttled = jQuery.throttle( delay, [ no_trailing, ] callback );
    // >
    // > jQuery('selector').bind( 'someevent', throttled );
    // > jQuery('selector').unbind( 'someevent', throttled );
    //
    // This also works in jQuery 1.4+:
    //
    // > jQuery('selector').bind( 'someevent', jQuery.throttle( delay, [ no_trailing, ] callback ) );
    // > jQuery('selector').unbind( 'someevent', callback );
    //
    // Arguments:
    //
    //  delay - (Number) A zero-or-greater delay in milliseconds. For event
    //    callbacks, values around 100 or 250 (or even higher) are most useful.
    //  no_trailing - (Boolean) Optional, defaults to false. If no_trailing is
    //    true, callback will only execute every `delay` milliseconds while the
    //    throttled-function is being called. If no_trailing is false or
    //    unspecified, callback will be executed one final time after the last
    //    throttled-function call. (After the throttled-function has not been
    //    called for `delay` milliseconds, the internal counter is reset)
    //  callback - (Function) A function to be executed after delay milliseconds.
    //    The `this` context and all arguments are passed through, as-is, to
    //    `callback` when the throttled-function is executed.
    //
    // Returns:
    //
    //  (Function) A new, throttled, function.

    $.throttle = jq_throttle = function( delay, no_trailing, callback, debounce_mode ) {
        // After wrapper has stopped being called, this timeout ensures that
        // `callback` is executed at the proper times in `throttle` and `end`
        // debounce modes.
        var timeout_id,

            // Keep track of the last time `callback` was executed.
            last_exec = 0;

        // `no_trailing` defaults to falsy.
        if ( typeof no_trailing !== 'boolean' ) {
            debounce_mode = callback;
            callback = no_trailing;
            no_trailing = undefined;
        }

        // The `wrapper` function encapsulates all of the throttling / debouncing
        // functionality and when executed will limit the rate at which `callback`
        // is executed.
        function wrapper() {
            var that = this,
                elapsed = +new Date() - last_exec,
                args = arguments;

            // Execute `callback` and update the `last_exec` timestamp.
            function exec() {
                last_exec = +new Date();
                callback.apply( that, args );
            };

            // If `debounce_mode` is true (at_begin) this is used to clear the flag
            // to allow future `callback` executions.
            function clear() {
                timeout_id = undefined;
            };

            if ( debounce_mode && !timeout_id ) {
                // Since `wrapper` is being called for the first time and
                // `debounce_mode` is true (at_begin), execute `callback`.
                exec();
            }

            // Clear any existing timeout.
            timeout_id && clearTimeout( timeout_id );

            if ( debounce_mode === undefined && elapsed > delay ) {
                // In throttle mode, if `delay` time has been exceeded, execute
                // `callback`.
                exec();

            } else if ( no_trailing !== true ) {
                // In trailing throttle mode, since `delay` time has not been
                // exceeded, schedule `callback` to execute `delay` ms after most
                // recent execution.
                //
                // If `debounce_mode` is true (at_begin), schedule `clear` to execute
                // after `delay` ms.
                //
                // If `debounce_mode` is false (at end), schedule `callback` to
                // execute after `delay` ms.
                timeout_id = setTimeout( debounce_mode ? clear : exec, debounce_mode === undefined ? delay - elapsed : delay );
            }
        };

        // Set the guid of `wrapper` function to the same of original callback, so
        // it can be removed in jQuery 1.4+ .unbind or .die by using the original
        // callback as a reference.
        if ( $.guid ) {
            wrapper.guid = callback.guid = callback.guid || $.guid++;
        }

        // Return the wrapper function.
        return wrapper;
    };

    // Method: jQuery.debounce
    //
    // Debounce execution of a function. Debouncing, unlike throttling,
    // guarantees that a function is only executed a single time, either at the
    // very beginning of a series of calls, or at the very end. If you want to
    // simply rate-limit execution of a function, see the <jQuery.throttle>
    // method.
    //
    // In this visualization, | is a debounced-function call and X is the actual
    // callback execution:
    //
    // > Debounced with `at_begin` specified as false or unspecified:
    // > ||||||||||||||||||||||||| (pause) |||||||||||||||||||||||||
    // >                          X                                 X
    // >
    // > Debounced with `at_begin` specified as true:
    // > ||||||||||||||||||||||||| (pause) |||||||||||||||||||||||||
    // > X                                 X
    //
    // Usage:
    //
    // > var debounced = jQuery.debounce( delay, [ at_begin, ] callback );
    // >
    // > jQuery('selector').bind( 'someevent', debounced );
    // > jQuery('selector').unbind( 'someevent', debounced );
    //
    // This also works in jQuery 1.4+:
    //
    // > jQuery('selector').bind( 'someevent', jQuery.debounce( delay, [ at_begin, ] callback ) );
    // > jQuery('selector').unbind( 'someevent', callback );
    //
    // Arguments:
    //
    //  delay - (Number) A zero-or-greater delay in milliseconds. For event
    //    callbacks, values around 100 or 250 (or even higher) are most useful.
    //  at_begin - (Boolean) Optional, defaults to false. If at_begin is false or
    //    unspecified, callback will only be executed `delay` milliseconds after
    //    the last debounced-function call. If at_begin is true, callback will be
    //    executed only at the first debounced-function call. (After the
    //    throttled-function has not been called for `delay` milliseconds, the
    //    internal counter is reset)
    //  callback - (Function) A function to be executed after delay milliseconds.
    //    The `this` context and all arguments are passed through, as-is, to
    //    `callback` when the debounced-function is executed.
    //
    // Returns:
    //
    //  (Function) A new, debounced, function.

    $.debounce = function( delay, at_begin, callback ) {
        return callback === undefined
            ? jq_throttle( delay, at_begin, false )
            : jq_throttle( delay, callback, at_begin !== false );
    };

})(this);
// The MIT License (MIT)

// Typed.js | Copyright (c) 2014 Matt Boldt | www.mattboldt.com

// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:

// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.




! function($) {

    "use strict";

    var Typed = function(el, options) {

        // chosen element to manipulate text
        this.el = $(el);

        // options
        this.options = $.extend({}, $.fn.typed.defaults, options);

        // attribute to type into
        this.isInput = this.el.is('input');
        this.attr = this.options.attr;

        // show cursor
        this.showCursor = this.isInput ? false : this.options.showCursor;

        // text content of element
        this.elContent = this.attr ? this.el.attr(this.attr) : this.el.text()

        // html or plain text
        this.contentType = this.options.contentType;

        // typing speed
        this.typeSpeed = this.options.typeSpeed;

        // add a delay before typing starts
        this.startDelay = this.options.startDelay;

        // backspacing speed
        this.backSpeed = this.options.backSpeed;

        // amount of time to wait before backspacing
        this.backDelay = this.options.backDelay;

        // div containing strings
        this.stringsElement = this.options.stringsElement;

        // input strings of text
        this.strings = this.options.strings;

        // character number position of current string
        this.strPos = 0;

        // current array position
        this.arrayPos = 0;

        // number to stop backspacing on.
        // default 0, can change depending on how many chars
        // you want to remove at the time
        this.stopNum = 0;

        // Looping logic
        this.loop = this.options.loop;
        this.loopCount = this.options.loopCount;
        this.curLoop = 0;

        // for stopping
        this.stop = false;

        // custom cursor
        this.cursorChar = this.options.cursorChar;

        // shuffle the strings
        this.shuffle = this.options.shuffle;
        // the order of strings
        this.sequence = [];

        // All systems go!
        this.build();
    };

    Typed.prototype = {

        constructor: Typed

        ,
        init: function() {
            // begin the loop w/ first current string (global self.strings)
            // current string will be passed as an argument each time after this
            var self = this;
            self.timeout = setTimeout(function() {
                for (var i=0;i<self.strings.length;++i) self.sequence[i]=i;

                // shuffle the array if true
                if(self.shuffle) self.sequence = self.shuffleArray(self.sequence);

                // Start typing
                self.typewrite(self.strings[self.sequence[self.arrayPos]], self.strPos);
            }, self.startDelay);
        }

        ,
        build: function() {
            var self = this;
            // Insert cursor
            if (this.showCursor === true) {
                this.cursor = $("<span class=\"typed-cursor\">" + this.cursorChar + "</span>");
                this.el.after(this.cursor);
            }
            if (this.stringsElement) {
                self.strings = [];
                this.stringsElement.hide();
                var strings = this.stringsElement.find('p');
                $.each(strings, function(key, value){
                    self.strings.push($(value).html());
                });
            }
            this.init();
        }

        // pass current string state to each function, types 1 char per call
        ,
        typewrite: function(curString, curStrPos) {
            // exit when stopped
            if (this.stop === true) {
                return;
            }

            // varying values for setTimeout during typing
            // can't be global since number changes each time loop is executed
            var humanize = Math.round(Math.random() * (100 - 30)) + this.typeSpeed;
            var self = this;

            // ------------- optional ------------- //
            // backpaces a certain string faster
            // ------------------------------------ //
            // if (self.arrayPos == 1){
            //  self.backDelay = 50;
            // }
            // else{ self.backDelay = 500; }

            // contain typing function in a timeout humanize'd delay
            self.timeout = setTimeout(function() {
                // check for an escape character before a pause value
                // format: \^\d+ .. eg: ^1000 .. should be able to print the ^ too using ^^
                // single ^ are removed from string
                var charPause = 0;
                var substr = curString.substr(curStrPos);
                if (substr.charAt(0) === '^') {
                    var skip = 1; // skip atleast 1
                    if (/^\^\d+/.test(substr)) {
                        substr = /\d+/.exec(substr)[0];
                        skip += substr.length;
                        charPause = parseInt(substr);
                    }

                    // strip out the escape character and pause value so they're not printed
                    curString = curString.substring(0, curStrPos) + curString.substring(curStrPos + skip);
                }

                if (self.contentType === 'html') {
                    // skip over html tags while typing
                    var curChar = curString.substr(curStrPos).charAt(0)
                    if (curChar === '<' || curChar === '&') {
                        var tag = '';
                        var endTag = '';
                        if (curChar === '<') {
                            endTag = '>'
                        } else {
                            endTag = ';'
                        }
                        while (curString.substr(curStrPos).charAt(0) !== endTag) {
                            tag += curString.substr(curStrPos).charAt(0);
                            curStrPos++;
                        }
                        curStrPos++;
                        tag += endTag;
                    }
                }

                // timeout for any pause after a character
                self.timeout = setTimeout(function() {
                    if (curStrPos === curString.length) {
                        // fires callback function
                        self.options.onStringTyped(self.arrayPos);

                        // is this the final string
                        if (self.arrayPos === self.strings.length - 1) {
                            // animation that occurs on the last typed string
                            self.options.callback();

                            self.curLoop++;

                            // quit if we wont loop back
                            if (self.loop === false || self.curLoop === self.loopCount)
                                return;
                        }

                        self.timeout = setTimeout(function() {
                            self.backspace(curString, curStrPos);
                        }, self.backDelay);
                    } else {

                        /* call before functions if applicable */
                        if (curStrPos === 0)
                            self.options.preStringTyped(self.arrayPos);

                        // start typing each new char into existing string
                        // curString: arg, self.el.html: original text inside element
                        var nextString = curString.substr(0, curStrPos + 1);
                        if (self.attr) {
                            self.el.attr(self.attr, nextString);
                        } else {
                            if (self.isInput) {
                                self.el.val(nextString);
                            } else if (self.contentType === 'html') {
                                self.el.html(nextString);
                            } else {
                                self.el.text(nextString);
                            }
                        }

                        // add characters one by one
                        curStrPos++;
                        // loop the function
                        self.typewrite(curString, curStrPos);
                    }
                    // end of character pause
                }, charPause);

                // humanized value for typing
            }, humanize);

        }

        ,
        backspace: function(curString, curStrPos) {
            // exit when stopped
            if (this.stop === true) {
                return;
            }

            // varying values for setTimeout during typing
            // can't be global since number changes each time loop is executed
            var humanize = Math.round(Math.random() * (100 - 30)) + this.backSpeed;
            var self = this;

            self.timeout = setTimeout(function() {

                // ----- this part is optional ----- //
                // check string array position
                // on the first string, only delete one word
                // the stopNum actually represents the amount of chars to
                // keep in the current string. In my case it's 14.
                // if (self.arrayPos == 1){
                //  self.stopNum = 14;
                // }
                //every other time, delete the whole typed string
                // else{
                //  self.stopNum = 0;
                // }

                if (self.contentType === 'html') {
                    // skip over html tags while backspacing
                    if (curString.substr(curStrPos).charAt(0) === '>') {
                        var tag = '';
                        while (curString.substr(curStrPos).charAt(0) !== '<') {
                            tag -= curString.substr(curStrPos).charAt(0);
                            curStrPos--;
                        }
                        curStrPos--;
                        tag += '<';
                    }
                }

                // ----- continue important stuff ----- //
                // replace text with base text + typed characters
                var nextString = curString.substr(0, curStrPos);
                if (self.attr) {
                    self.el.attr(self.attr, nextString);
                } else {
                    if (self.isInput) {
                        self.el.val(nextString);
                    } else if (self.contentType === 'html') {
                        self.el.html(nextString);
                    } else {
                        self.el.text(nextString);
                    }
                }

                // if the number (id of character in current string) is
                // less than the stop number, keep going
                if (curStrPos > self.stopNum) {
                    // subtract characters one by one
                    curStrPos--;
                    // loop the function
                    self.backspace(curString, curStrPos);
                }
                // if the stop number has been reached, increase
                // array position to next string
                else if (curStrPos <= self.stopNum) {
                    self.arrayPos++;

                    if (self.arrayPos === self.strings.length) {
                        self.arrayPos = 0;

                        // Shuffle sequence again
                        if(self.shuffle) self.sequence = self.shuffleArray(self.sequence);

                        self.init();
                    } else
                        self.typewrite(self.strings[self.sequence[self.arrayPos]], curStrPos);
                }

                // humanized value for typing
            }, humanize);

        }
        /**
         * Shuffles the numbers in the given array.
         * @param {Array} array
         * @returns {Array}
         */
        ,shuffleArray: function(array) {
            var tmp, current, top = array.length;
            if(top) while(--top) {
                current = Math.floor(Math.random() * (top + 1));
                tmp = array[current];
                array[current] = array[top];
                array[top] = tmp;
            }
            return array;
        }

        // Start & Stop currently not working

        // , stop: function() {
        //     var self = this;

        //     self.stop = true;
        //     clearInterval(self.timeout);
        // }

        // , start: function() {
        //     var self = this;
        //     if(self.stop === false)
        //        return;

        //     this.stop = false;
        //     this.init();
        // }

        // Reset and rebuild the element
        ,
        reset: function() {
            var self = this;
            clearInterval(self.timeout);
            var id = this.el.attr('id');
            this.el.after('<span id="' + id + '"/>')
            this.el.remove();
            if (typeof this.cursor !== 'undefined') {
                this.cursor.remove();
            }
            // Send the callback
            self.options.resetCallback();
        }

    };

    $.fn.typed = function(option) {
        return this.each(function() {
            var $this = $(this),
                data = $this.data('typed'),
                options = typeof option == 'object' && option;
            if (!data) $this.data('typed', (data = new Typed(this, options)));
            if (typeof option == 'string') data[option]();
        });
    };

    $.fn.typed.defaults = {
        strings: ["These are the default values...", "You know what you should do?", "Use your own!", "Have a great day!"],
        stringsElement: null,
        // typing speed
        typeSpeed: 0,
        // time before typing starts
        startDelay: 0,
        // backspacing speed
        backSpeed: 0,
        // shuffle the strings
        shuffle: false,
        // time before backspacing
        backDelay: 500,
        // loop
        loop: false,
        // false = infinite
        loopCount: false,
        // show cursor
        showCursor: true,
        // character for cursor
        cursorChar: "|",
        // attribute to type (null == text)
        attr: null,
        // either html or text
        contentType: 'html',
        // call when done callback function
        callback: function() {},
        // starting callback function before each string
        preStringTyped: function() {},
        //callback for every typed string
        onStringTyped: function() {},
        // callback for reset
        resetCallback: function() {}
    };


}(window.jQuery);
/*! ===================================
 *  Author: Roman Nazarkin, Egor Dankov
 *  -----------------------------------
 *  PuzzleThemes
 *  =================================== */

'use strict';

/**
 * Initialize main helper object
 */
var PZTJS = {
    is_safari    : /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
    is_firefox   : navigator.userAgent.toLowerCase().indexOf('firefox') > -1,
    is_chrome    : /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor),
    is_ie10      : navigator.appVersion.indexOf('MSIE 10') !== -1,
    transitionEnd: 'transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd',
    animIteration: 'animationiteration webkitAnimationIteration oAnimationIteration MSAnimationIteration',
    animationEnd : 'animationend webkitAnimationEnd'
};


/**
 * RequestAnimationFrame polyfill
 */
(function() {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame']
            || window[vendors[x]+'CancelRequestAnimationFrame'];
    }

    if (!window.requestAnimationFrame)
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); },
                timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };

    if (!window.cancelAnimationFrame)
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
}());


/**
 * Set proper transition & animation event names
 */
(function (m) {
    var transEndEventNames = {
            'WebkitTransition': 'webkitTransitionEnd',
            'MozTransition'   : 'transitionend',
            'OTransition'     : 'oTransitionEnd',
            'msTransition'    : 'MSTransitionEnd',
            'transition'      : 'transitionend'
        },
        animIterationEventNames = {
            'WebkitAnimation': 'webkitAnimationIteration',
            'MozAnimation'   : 'animationiteration',
            'OAnimation'     : 'oAnimationIteration',
            'msAnimation'    : 'MSAnimationIteration',
            'animation'      : 'animationiteration'
        },
        animEndEventNames = {
            'WebkitAnimation' : 'webkitAnimationEnd',
            'MozTAnimation'   : 'animationend',
            'animation'       : 'animationend'
        };

    PZTJS.transitionEnd = transEndEventNames[m.prefixed('transition')];
    PZTJS.animIteration = animIterationEventNames[m.prefixed('animation')];
    PZTJS.animationEnd = animEndEventNames[m.prefixed('animation')];
})(Modernizr);


/**
 * RequestAnimationFrame wrapper
 * @param callback
 * @constructor
 */
PZTJS.RAFit = function (callback) {
    var new_callback = function() {
        callback();
        window.requestAnimationFrame(new_callback);
    };

    new_callback();
};


/**
 * RequestAnimationFrame for scrolling-related callbacks
 */
PZTJS.scrollRAF = function(callback) {
    var lastScrollPos = -1;

    var new_callback = function() {
        var currentScrollPos = window.pageYOffset / document.body.clientHeight;

        if (lastScrollPos !== currentScrollPos) { // avoid calculations if not needed
            lastScrollPos = currentScrollPos;
            callback();
        }
    };

    PZTJS.RAFit(new_callback);
};


/**
 * Returns PHP-defined value
 */
PZTJS.phpData = function (key, default_value) {
    if (typeof default_value === 'undefined') {
        default_value = 'translation not found';
    }

    if (typeof PZT_PHP_DATA !== 'undefined' && PZT_PHP_DATA.hasOwnProperty(key)) {
        return PZT_PHP_DATA[key];
    }

    return default_value;
};


/**
 * Detects whether user is viewing site from a mobile device
 * @param agent
 * @returns {boolean}
 */
PZTJS.isMobile = function (agent) {
    agent = agent || navigator.userAgent;
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(agent);
};


/**
 * Date.now() polyfill
 */
if (!Date.now) {
    Date.now = function () { return new Date().getTime(); };
}


/**
 * Trigger document ready event on window element (shorthand)
 */
jQuery(document).ready(function () {
    jQuery(window).trigger('docready');
});


/**
 * Shuffle.js proper layout recalculation shorthand
 */
jQuery.fn.pzt_shuffle = function (options) {
    var $ = jQuery,
        $el = $(this);

    $el.each(function () {
        var $current = $(this),
            throttledLayout = $.throttle(300, function () {
                $current.shuffle('update');
            });

        // instantiate the plugin
        $el.shuffle(options);

        // rebuild shuffle layout everytime image gets loaded
        $el.find('img').each(function () {
            if (this.complete && this.naturalWidth !== undefined) {
                return;
            }

            var proxyImage = new Image();
            $(proxyImage).one('load', throttledLayout);
            proxyImage.src = this.src;
        });
    });

    // rebuild all shuffle grids on page load
    $(window).one('load', function () {
        $el.shuffle('update');
    });

    return this;
};


/**
 * Checks if element is visible in current viewport
 * @param el
 * @returns {boolean}
 */
PZTJS.isElementInViewport = function (el) {
    // special bonus for those using jQuery
    if (typeof jQuery === 'function' && el instanceof jQuery) {
        el = el[0];
    }

    var top = el.offsetTop;
    var left = el.offsetLeft;
    var width = el.offsetWidth;
    var height = el.offsetHeight;

    while (el.offsetParent) {
        el = el.offsetParent;
        top += el.offsetTop;
        left += el.offsetLeft;
    }

    return (
        top < (window.pageYOffset + window.innerHeight) &&
        left < (window.pageXOffset + window.innerWidth) &&
        (top + height) > window.pageYOffset &&
        (left + width) > window.pageXOffset
    );
};
(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
        typeof define === 'function' && define.amd ? define(factory) :
            (global.retinajs = factory());
}(this, (function () { 'use strict';

    var hasWindow = typeof window !== 'undefined';
    var environment = Math.round(hasWindow ? window.devicePixelRatio || 1 : 1);
    var srcReplace = /(\.[A-z]{3,4}\/?(\?.*)?)$/;
    var inlineReplace = /url\(('|")?([^)'"]+)('|")?\)/i;
    var selector = '[data-rjs]';
    var processedAttr = 'data-rjs-processed';
    function arrayify(object) {
        return Array.prototype.slice.call(object);
    }
    function chooseCap(cap) {
        var numericCap = parseInt(cap, 10);
        if (environment < numericCap) {
            return environment;
        } else {
            return numericCap;
        }
    }
    function forceOriginalDimensions(image) {
        if (!image.hasAttribute('data-no-resize')) {
            if (image.offsetWidth === 0 && image.offsetHeight === 0) {
                image.setAttribute('width', image.naturalWidth);
                image.setAttribute('height', image.naturalHeight);
            } else {
                image.setAttribute('width', image.offsetWidth);
                image.setAttribute('height', image.offsetHeight);
            }
        }
        return image;
    }
    function setSourceIfAvailable(image, retinaURL) {
        var imgType = image.nodeName.toLowerCase();
        var testImage = document.createElement('img');
        testImage.addEventListener('load', function () {
            if (imgType === 'img') {
                forceOriginalDimensions(image).setAttribute('src', retinaURL);
            } else {
                image.style.backgroundImage = 'url(' + retinaURL + ')';
            }
        });
        testImage.setAttribute('src', retinaURL);
        image.setAttribute(processedAttr, true);
    }
    function dynamicSwapImage(image, src) {
        var rjs = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
        var cap = chooseCap(rjs);
        if (src && cap > 1) {
            var newSrc = src.replace(srcReplace, '@' + cap + 'x$1');
            setSourceIfAvailable(image, newSrc);
        }
    }
    function manualSwapImage(image, src, hdsrc) {
        if (environment > 1) {
            setSourceIfAvailable(image, hdsrc);
        }
    }
    function getImages(images) {
        if (!images) {
            return typeof document !== 'undefined' ? arrayify(document.querySelectorAll(selector)) : [];
        } else {
            return typeof images.forEach === 'function' ? images : arrayify(images);
        }
    }
    function cleanBgImg(img) {
        return img.style.backgroundImage.replace(inlineReplace, '$2');
    }
    function retina(images) {
        getImages(images).forEach(function (img) {
            if (!img.getAttribute(processedAttr)) {
                var isImg = img.nodeName.toLowerCase() === 'img';
                var src = isImg ? img.getAttribute('src') : cleanBgImg(img);
                var rjs = img.getAttribute('data-rjs');
                var rjsIsNumber = !isNaN(parseInt(rjs, 10));
                if (rjs === null) {
                    return;
                }
                if (rjsIsNumber) {
                    dynamicSwapImage(img, src, rjs);
                } else {
                    manualSwapImage(img, src, rjs);
                }
            }
        });
    }
    if (hasWindow) {
        window.addEventListener('load', function () {
            retina();
        });
        window.retinajs = retina;
    }

    return retina;

})));
/*!
 * Shuffle.js by @Vestride
 * Categorize, sort, and filter a responsive grid of items.
 * Dependencies: jQuery 1.9+, Modernizr 2.6.2+
 * @license MIT license
 * @version 3.1.1
 */
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        define(['jquery', 'modernizr'], factory);
    } else if (typeof exports === 'object') {
        module.exports = factory(require('jquery'), window.Modernizr);
    } else {
        window.Shuffle = factory(window.jQuery, window.Modernizr);
    }
})(function($, Modernizr, undefined) {

    'use strict';


// Validate Modernizr exists.
// Shuffle requires `csstransitions`, `csstransforms`, `csstransforms3d`,
// and `prefixed` to exist on the Modernizr object.
    if (typeof Modernizr !== 'object') {
        throw new Error('Shuffle.js requires Modernizr.\n' +
            'http://vestride.github.io/Shuffle/#dependencies');
    }


    /**
     * Returns css prefixed properties like `-webkit-transition` or `box-sizing`
     * from `transition` or `boxSizing`, respectively.
     * @param {(string|boolean)} prop Property to be prefixed.
     * @return {string} The prefixed css property.
     */
    function dashify( prop ) {
        if (!prop) {
            return '';
        }

        // Replace upper case with dash-lowercase,
        // then fix ms- prefixes because they're not capitalized.
        return prop.replace(/([A-Z])/g, function( str, m1 ) {
            return '-' + m1.toLowerCase();
        }).replace(/^ms-/,'-ms-');
    }

// Constant, prefixed variables.
    var TRANSITION = Modernizr.prefixed('transition');
    var TRANSITION_DELAY = Modernizr.prefixed('transitionDelay');
    var TRANSITION_DURATION = Modernizr.prefixed('transitionDuration');

// Note(glen): Stock Android 4.1.x browser will fail here because it wrongly
// says it supports non-prefixed transitions.
// https://github.com/Modernizr/Modernizr/issues/897
    var TRANSITIONEND = {
        'WebkitTransition' : 'webkitTransitionEnd',
        'transition' : 'transitionend'
    }[ TRANSITION ];

    var TRANSFORM = Modernizr.prefixed('transform');
    var CSS_TRANSFORM = dashify(TRANSFORM);

// Constants
    var CAN_TRANSITION_TRANSFORMS = Modernizr.csstransforms && Modernizr.csstransitions;
    var HAS_TRANSFORMS_3D = Modernizr.csstransforms3d;
    var HAS_COMPUTED_STYLE = !!window.getComputedStyle;
    var SHUFFLE = 'shuffle';

// Configurable. You can change these constants to fit your application.
// The default scale and concealed scale, however, have to be different values.
    var ALL_ITEMS = 'all';
    var FILTER_ATTRIBUTE_KEY = 'groups';
    var DEFAULT_SCALE = 1;
    var CONCEALED_SCALE = 0.001;

// Underscore's throttle function.
    function throttle(func, wait, options) {
        var context, args, result;
        var timeout = null;
        var previous = 0;
        options = options || {};
        var later = function() {
            previous = options.leading === false ? 0 : $.now();
            timeout = null;
            result = func.apply(context, args);
            context = args = null;
        };
        return function() {
            var now = $.now();
            if (!previous && options.leading === false) {
                previous = now;
            }
            var remaining = wait - (now - previous);
            context = this;
            args = arguments;
            if (remaining <= 0 || remaining > wait) {
                clearTimeout(timeout);
                timeout = null;
                previous = now;
                result = func.apply(context, args);
                context = args = null;
            } else if (!timeout && options.trailing !== false) {
                timeout = setTimeout(later, remaining);
            }
            return result;
        };
    }

    function each(obj, iterator, context) {
        for (var i = 0, length = obj.length; i < length; i++) {
            if (iterator.call(context, obj[i], i, obj) === {}) {
                return;
            }
        }
    }

    function defer(fn, context, wait) {
        return setTimeout( $.proxy( fn, context ), wait );
    }

    function arrayMax( array ) {
        return Math.max.apply( Math, array );
    }

    function arrayMin( array ) {
        return Math.min.apply( Math, array );
    }


    /**
     * Always returns a numeric value, given a value.
     * @param {*} value Possibly numeric value.
     * @return {number} `value` or zero if `value` isn't numeric.
     * @private
     */
    function getNumber(value) {
        return $.isNumeric(value) ? value : 0;
    }

    var getStyles = window.getComputedStyle || function() {};

    /**
     * Represents a coordinate pair.
     * @param {number} [x=0] X.
     * @param {number} [y=0] Y.
     */
    var Point = function(x, y) {
        this.x = getNumber( x );
        this.y = getNumber( y );
    };


    /**
     * Whether two points are equal.
     * @param {Point} a Point A.
     * @param {Point} b Point B.
     * @return {boolean}
     */
    Point.equals = function(a, b) {
        return a.x === b.x && a.y === b.y;
    };

    var COMPUTED_SIZE_INCLUDES_PADDING = (function() {
        if (!HAS_COMPUTED_STYLE) {
            return false;
        }

        var parent = document.body || document.documentElement;
        var e = document.createElement('div');
        e.style.cssText = 'width:10px;padding:2px;' +
            '-webkit-box-sizing:border-box;box-sizing:border-box;';
        parent.appendChild(e);

        var width = getStyles(e, null).width;
        var ret = width === '10px';

        parent.removeChild(e);

        return ret;
    }());


// Used for unique instance variables
    var id = 0;
    var $window = $( window );


    /**
     * Categorize, sort, and filter a responsive grid of items.
     *
     * @param {Element} element An element which is the parent container for the grid items.
     * @param {Object} [options=Shuffle.options] Options object.
     * @constructor
     */
    var Shuffle = function( element, options ) {
        options = options || {};
        $.extend( this, Shuffle.options, options, Shuffle.settings );

        this.$el = $(element);
        this.element = element;
        this.unique = 'shuffle_' + id++;

        this._fire( Shuffle.EventType.LOADING );
        this._init();

        // Dispatch the done event asynchronously so that people can bind to it after
        // Shuffle has been initialized.
        defer(function() {
            this.initialized = true;
            this._fire( Shuffle.EventType.DONE );
        }, this, 16);
    };


    /**
     * Events the container element emits with the .shuffle namespace.
     * For example, "done.shuffle".
     * @enum {string}
     */
    Shuffle.EventType = {
        LOADING: 'loading',
        DONE: 'done',
        LAYOUT: 'layout',
        REMOVED: 'removed'
    };


    /** @enum {string} */
    Shuffle.ClassName = {
        BASE: SHUFFLE,
        SHUFFLE_ITEM: 'shuffle-item',
        FILTERED: 'filtered',
        CONCEALED: 'concealed'
    };


// Overrideable options
    Shuffle.options = {
        group: ALL_ITEMS, // Initial filter group.
        speed: 250, // Transition/animation speed (milliseconds).
        easing: 'ease-out', // CSS easing function to use.
        itemSelector: '', // e.g. '.picture-item'.
        sizer: null, // Sizer element. Use an element to determine the size of columns and gutters.
        gutterWidth: 0, // A static number or function that tells the plugin how wide the gutters between columns are (in pixels).
        columnWidth: 0, // A static number or function that returns a number which tells the plugin how wide the columns are (in pixels).
        delimeter: null, // If your group is not json, and is comma delimeted, you could set delimeter to ','.
        buffer: 0, // Useful for percentage based heights when they might not always be exactly the same (in pixels).
        columnThreshold: HAS_COMPUTED_STYLE ? 0.01 : 0.1, // Reading the width of elements isn't precise enough and can cause columns to jump between values.
        initialSort: null, // Shuffle can be initialized with a sort object. It is the same object given to the sort method.
        throttle: throttle, // By default, shuffle will throttle resize events. This can be changed or removed.
        throttleTime: 300, // How often shuffle can be called on resize (in milliseconds).
        sequentialFadeDelay: 150, // Delay between each item that fades in when adding items.
        supported: CAN_TRANSITION_TRANSFORMS // Whether to use transforms or absolute positioning.
    };


// Not overrideable
    Shuffle.settings = {
        useSizer: false,
        itemCss : { // default CSS for each item
            position: 'absolute',
            top: 0,
            left: 0,
            visibility: 'visible'
        },
        revealAppendedDelay: 300,
        lastSort: {},
        lastFilter: ALL_ITEMS,
        enabled: true,
        destroyed: false,
        initialized: false,
        _animations: [],
        _transitions: [],
        _isMovementCanceled: false,
        styleQueue: []
    };


// Expose for testing.
    Shuffle.Point = Point;


    /**
     * Static methods.
     */

    /**
     * If the browser has 3d transforms available, build a string with those,
     * otherwise use 2d transforms.
     * @param {Point} point X and Y positions.
     * @param {number} scale Scale amount.
     * @return {string} A normalized string which can be used with the transform style.
     * @private
     */
    Shuffle._getItemTransformString = function(point, scale) {
        if ( HAS_TRANSFORMS_3D ) {
            return 'translate3d(' + point.x + 'px, ' + point.y + 'px, 0) scale3d(' + scale + ', ' + scale + ', 1)';
        } else {
            return 'translate(' + point.x + 'px, ' + point.y + 'px) scale(' + scale + ')';
        }
    };


    /**
     * Retrieve the computed style for an element, parsed as a float.
     * @param {Element} element Element to get style for.
     * @param {string} style Style property.
     * @param {CSSStyleDeclaration} [styles] Optionally include clean styles to
     *     use instead of asking for them again.
     * @return {number} The parsed computed value or zero if that fails because IE
     *     will return 'auto' when the element doesn't have margins instead of
     *     the computed style.
     * @private
     */
    Shuffle._getNumberStyle = function( element, style, styles ) {
        if ( HAS_COMPUTED_STYLE ) {
            styles = styles || getStyles( element, null );
            var value = Shuffle._getFloat( styles[ style ] );

            // Support IE<=11 and W3C spec.
            if ( !COMPUTED_SIZE_INCLUDES_PADDING && style === 'width' ) {
                value += Shuffle._getFloat( styles.paddingLeft ) +
                    Shuffle._getFloat( styles.paddingRight ) +
                    Shuffle._getFloat( styles.borderLeftWidth ) +
                    Shuffle._getFloat( styles.borderRightWidth );
            } else if ( !COMPUTED_SIZE_INCLUDES_PADDING && style === 'height' ) {
                value += Shuffle._getFloat( styles.paddingTop ) +
                    Shuffle._getFloat( styles.paddingBottom ) +
                    Shuffle._getFloat( styles.borderTopWidth ) +
                    Shuffle._getFloat( styles.borderBottomWidth );
            }

            return value;
        } else {
            return Shuffle._getFloat( $( element ).css( style )  );
        }
    };


    /**
     * Parse a string as an float.
     * @param {string} value String float.
     * @return {number} The string as an float or zero.
     * @private
     */
    Shuffle._getFloat = function(value) {
        return getNumber( parseFloat( value ) );
    };


    /**
     * Returns the outer width of an element, optionally including its margins.
     *
     * There are a few different methods for getting the width of an element, none of
     * which work perfectly for all Shuffle's use cases.
     *
     * 1. getBoundingClientRect() `left` and `right` properties.
     *   - Accounts for transform scaled elements, making it useless for Shuffle
     *   elements which have shrunk.
     * 2. The `offsetWidth` property (or jQuery's CSS).
     *   - This value stays the same regardless of the elements transform property,
     *   however, it does not return subpixel values.
     * 3. getComputedStyle()
     *   - This works great Chrome, Firefox, Safari, but IE<=11 does not include
     *   padding and border when box-sizing: border-box is set, requiring a feature
     *   test and extra work to add the padding back for IE and other browsers which
     *   follow the W3C spec here.
     *
     * @param {Element} element The element.
     * @param {boolean} [includeMargins] Whether to include margins. Default is false.
     * @return {number} The width.
     */
    Shuffle._getOuterWidth = function( element, includeMargins ) {
        // Store the styles so that they can be used by others without asking for it again.
        var styles = getStyles( element, null );
        var width = Shuffle._getNumberStyle( element, 'width', styles );

        // Use jQuery here because it uses getComputedStyle internally and is
        // cross-browser. Using the style property of the element will only work
        // if there are inline styles.
        if ( includeMargins ) {
            var marginLeft = Shuffle._getNumberStyle( element, 'marginLeft', styles );
            var marginRight = Shuffle._getNumberStyle( element, 'marginRight', styles );
            width += marginLeft + marginRight;
        }

        return width;
    };


    /**
     * Returns the outer height of an element, optionally including its margins.
     * @param {Element} element The element.
     * @param {boolean} [includeMargins] Whether to include margins. Default is false.
     * @return {number} The height.
     */
    Shuffle._getOuterHeight = function( element, includeMargins ) {
        var styles = getStyles( element, null );
        var height = Shuffle._getNumberStyle( element, 'height', styles );

        if ( includeMargins ) {
            var marginTop = Shuffle._getNumberStyle( element, 'marginTop', styles );
            var marginBottom = Shuffle._getNumberStyle( element, 'marginBottom', styles );
            height += marginTop + marginBottom;
        }

        return height;
    };


    /**
     * Change a property or execute a function which will not have a transition
     * @param {Element} element DOM element that won't be transitioned
     * @param {Function} callback A function which will be called while transition
     *     is set to 0ms.
     * @param {Object} [context] Optional context for the callback function.
     * @private
     */
    Shuffle._skipTransition = function( element, callback, context ) {
        var duration = element.style[ TRANSITION_DURATION ];

        // Set the duration to zero so it happens immediately
        element.style[ TRANSITION_DURATION ] = '0ms'; // ms needed for firefox!

        callback.call( context );

        // Force reflow
        var reflow = element.offsetWidth;
        // Avoid jshint warnings: unused variables and expressions.
        reflow = null;

        // Put the duration back
        element.style[ TRANSITION_DURATION ] = duration;
    };


    /**
     * Instance methods.
     */

    Shuffle.prototype._init = function() {
        this.$items = this._getItems();

        this.sizer = this._getElementOption( this.sizer );

        if ( this.sizer ) {
            this.useSizer = true;
        }

        // Add class and invalidate styles
        this.$el.addClass( Shuffle.ClassName.BASE );

        // Set initial css for each item
        this._initItems();

        // Bind resize events
        // http://stackoverflow.com/questions/1852751/window-resize-event-firing-in-internet-explorer
        $window.on('resize.' + SHUFFLE + '.' + this.unique, this._getResizeFunction());

        // Get container css all in one request. Causes reflow
        var containerCSS = this.$el.css(['position', 'overflow']);
        var containerWidth = Shuffle._getOuterWidth( this.element );

        // Add styles to the container if it doesn't have them.
        this._validateStyles( containerCSS );

        // We already got the container's width above, no need to cause another reflow getting it again...
        // Calculate the number of columns there will be
        this._setColumns( containerWidth );

        // Kick off!
        this.shuffle( this.group, this.initialSort );

        // The shuffle items haven't had transitions set on them yet
        // so the user doesn't see the first layout. Set them now that the first layout is done.
        if ( this.supported ) {
            defer(function() {
                this._setTransitions();
                this.element.style[ TRANSITION ] = 'height ' + this.speed + 'ms ' + this.easing;
            }, this);
        }
    };


    /**
     * Returns a throttled and proxied function for the resize handler.
     * @return {Function}
     * @private
     */
    Shuffle.prototype._getResizeFunction = function() {
        var resizeFunction = $.proxy( this._onResize, this );
        return this.throttle ?
            this.throttle( resizeFunction, this.throttleTime ) :
            resizeFunction;
    };


    /**
     * Retrieve an element from an option.
     * @param {string|jQuery|Element} option The option to check.
     * @return {?Element} The plain element or null.
     * @private
     */
    Shuffle.prototype._getElementOption = function( option ) {
        // If column width is a string, treat is as a selector and search for the
        // sizer element within the outermost container
        if ( typeof option === 'string' ) {
            return this.$el.find( option )[0] || null;

            // Check for an element
        } else if ( option && option.nodeType && option.nodeType === 1 ) {
            return option;

            // Check for jQuery object
        } else if ( option && option.jquery ) {
            return option[0];
        }

        return null;
    };


    /**
     * Ensures the shuffle container has the css styles it needs applied to it.
     * @param {Object} styles Key value pairs for position and overflow.
     * @private
     */
    Shuffle.prototype._validateStyles = function(styles) {
        // Position cannot be static.
        if ( styles.position === 'static' ) {
            this.element.style.position = 'relative';
        }

        // Overflow has to be hidden
        if ( styles.overflow !== 'hidden' ) {
            this.element.style.overflow = 'hidden';
        }
    };


    /**
     * Filter the elements by a category.
     * @param {string} [category] Category to filter by. If it's given, the last
     *     category will be used to filter the items.
     * @param {ArrayLike} [$collection] Optionally filter a collection. Defaults to
     *     all the items.
     * @return {jQuery} Filtered items.
     * @private
     */
    Shuffle.prototype._filter = function( category, $collection ) {
        category = category || this.lastFilter;
        $collection = $collection || this.$items;

        var set = this._getFilteredSets( category, $collection );

        // Individually add/remove concealed/filtered classes
        this._toggleFilterClasses( set.filtered, set.concealed );

        // Save the last filter in case elements are appended.
        this.lastFilter = category;

        // This is saved mainly because providing a filter function (like searching)
        // will overwrite the `lastFilter` property every time its called.
        if ( typeof category === 'string' ) {
            this.group = category;
        }

        return set.filtered;
    };


    /**
     * Returns an object containing the filtered and concealed elements.
     * @param {string|Function} category Category or function to filter by.
     * @param {ArrayLike.<Element>} $items A collection of items to filter.
     * @return {!{filtered: jQuery, concealed: jQuery}}
     * @private
     */
    Shuffle.prototype._getFilteredSets = function( category, $items ) {
        var $filtered = $();
        var $concealed = $();

        // category === 'all', add filtered class to everything
        if ( category === ALL_ITEMS ) {
            $filtered = $items;

            // Loop through each item and use provided function to determine
            // whether to hide it or not.
        } else {
            each($items, function( el ) {
                var $item = $(el);
                if ( this._doesPassFilter( category, $item ) ) {
                    $filtered = $filtered.add( $item );
                } else {
                    $concealed = $concealed.add( $item );
                }
            }, this);
        }

        return {
            filtered: $filtered,
            concealed: $concealed
        };
    };


    /**
     * Test an item to see if it passes a category.
     * @param {string|Function} category Category or function to filter by.
     * @param {jQuery} $item A single item, wrapped with jQuery.
     * @return {boolean} Whether it passes the category/filter.
     * @private
     */
    Shuffle.prototype._doesPassFilter = function( category, $item ) {
        if ( $.isFunction( category ) ) {
            return category.call( $item[0], $item, this );

            // Check each element's data-groups attribute against the given category.
        } else {
            var groups = $item.data( FILTER_ATTRIBUTE_KEY );
            var keys = this.delimeter && !$.isArray( groups ) ?
                groups.split( this.delimeter ) :
                groups;
            return $.inArray(category, keys) > -1;
        }
    };


    /**
     * Toggles the filtered and concealed class names.
     * @param {jQuery} $filtered Filtered set.
     * @param {jQuery} $concealed Concealed set.
     * @private
     */
    Shuffle.prototype._toggleFilterClasses = function( $filtered, $concealed ) {
        $filtered
            .removeClass( Shuffle.ClassName.CONCEALED )
            .addClass( Shuffle.ClassName.FILTERED );
        $concealed
            .removeClass( Shuffle.ClassName.FILTERED )
            .addClass( Shuffle.ClassName.CONCEALED );
    };


    /**
     * Set the initial css for each item
     * @param {jQuery} [$items] Optionally specifiy at set to initialize
     */
    Shuffle.prototype._initItems = function( $items ) {
        $items = $items || this.$items;
        $items.addClass([
            Shuffle.ClassName.SHUFFLE_ITEM,
            Shuffle.ClassName.FILTERED
        ].join(' '));
        $items.css( this.itemCss ).data('point', new Point()).data('scale', DEFAULT_SCALE);
    };


    /**
     * Updates the filtered item count.
     * @private
     */
    Shuffle.prototype._updateItemCount = function() {
        this.visibleItems = this._getFilteredItems().length;
    };


    /**
     * Sets css transform transition on a an element.
     * @param {Element} element Element to set transition on.
     * @private
     */
    Shuffle.prototype._setTransition = function( element ) {
        element.style[ TRANSITION ] = CSS_TRANSFORM + ' ' + this.speed + 'ms ' +
            this.easing + ', opacity ' + this.speed + 'ms ' + this.easing;
    };


    /**
     * Sets css transform transition on a group of elements.
     * @param {ArrayLike.<Element>} $items Elements to set transitions on.
     * @private
     */
    Shuffle.prototype._setTransitions = function( $items ) {
        $items = $items || this.$items;
        each($items, function( el ) {
            this._setTransition( el );
        }, this);
    };


    /**
     * Sets a transition delay on a collection of elements, making each delay
     * greater than the last.
     * @param {ArrayLike.<Element>} $collection Array to iterate over.
     */
    Shuffle.prototype._setSequentialDelay = function( $collection ) {
        if ( !this.supported ) {
            return;
        }

        // $collection can be an array of dom elements or jquery object
        each($collection, function( el, i ) {
            // This works because the transition-property: transform, opacity;
            el.style[ TRANSITION_DELAY ] = '0ms,' + ((i + 1) * this.sequentialFadeDelay) + 'ms';
        }, this);
    };


    Shuffle.prototype._getItems = function() {
        return this.$el.children( this.itemSelector );
    };


    Shuffle.prototype._getFilteredItems = function() {
        return this.$items.filter('.' + Shuffle.ClassName.FILTERED);
    };


    Shuffle.prototype._getConcealedItems = function() {
        return this.$items.filter('.' + Shuffle.ClassName.CONCEALED);
    };


    /**
     * Returns the column size, based on column width and sizer options.
     * @param {number} containerWidth Size of the parent container.
     * @param {number} gutterSize Size of the gutters.
     * @return {number}
     * @private
     */
    Shuffle.prototype._getColumnSize = function( containerWidth, gutterSize ) {
        var size;

        // If the columnWidth property is a function, then the grid is fluid
        if ( $.isFunction( this.columnWidth ) ) {
            size = this.columnWidth(containerWidth);

            // columnWidth option isn't a function, are they using a sizing element?
        } else if ( this.useSizer ) {
            size = Shuffle._getOuterWidth(this.sizer);

            // if not, how about the explicitly set option?
        } else if ( this.columnWidth ) {
            size = this.columnWidth;

            // or use the size of the first item
        } else if ( this.$items.length > 0 ) {
            size = Shuffle._getOuterWidth(this.$items[0], true);

            // if there's no items, use size of container
        } else {
            size = containerWidth;
        }

        // Don't let them set a column width of zero.
        if ( size === 0 ) {
            size = containerWidth;
        }

        return size + gutterSize;
    };


    /**
     * Returns the gutter size, based on gutter width and sizer options.
     * @param {number} containerWidth Size of the parent container.
     * @return {number}
     * @private
     */
    Shuffle.prototype._getGutterSize = function( containerWidth ) {
        var size;
        if ( $.isFunction( this.gutterWidth ) ) {
            size = this.gutterWidth(containerWidth);
        } else if ( this.useSizer ) {
            size = Shuffle._getNumberStyle(this.sizer, 'marginLeft');
        } else {
            size = this.gutterWidth;
        }

        return size;
    };


    /**
     * Calculate the number of columns to be used. Gets css if using sizer element.
     * @param {number} [theContainerWidth] Optionally specify a container width if it's already available.
     */
    Shuffle.prototype._setColumns = function( theContainerWidth ) {
        var containerWidth = theContainerWidth || Shuffle._getOuterWidth( this.element );
        var gutter = this._getGutterSize( containerWidth );
        var columnWidth = this._getColumnSize( containerWidth, gutter );
        var calculatedColumns = (containerWidth + gutter) / columnWidth;

        // Widths given from getStyles are not precise enough...
        if ( Math.abs(Math.round(calculatedColumns) - calculatedColumns) < this.columnThreshold ) {
            // e.g. calculatedColumns = 11.998876
            calculatedColumns = Math.round( calculatedColumns );
        }

        this.cols = Math.max( Math.floor(calculatedColumns), 1 );
        this.containerWidth = containerWidth;
        this.colWidth = columnWidth;
    };

    /**
     * Adjust the height of the grid
     */
    Shuffle.prototype._setContainerSize = function() {
        this.$el.css( 'height', this._getContainerSize() );
    };


    /**
     * Based on the column heights, it returns the biggest one.
     * @return {number}
     * @private
     */
    Shuffle.prototype._getContainerSize = function() {
        return arrayMax( this.positions );
    };


    /**
     * Fire events with .shuffle namespace
     */
    Shuffle.prototype._fire = function( name, args ) {
        this.$el.trigger( name + '.' + SHUFFLE, args && args.length ? args : [ this ] );
    };


    /**
     * Zeros out the y columns array, which is used to determine item placement.
     * @private
     */
    Shuffle.prototype._resetCols = function() {
        var i = this.cols;
        this.positions = [];
        while (i--) {
            this.positions.push( 0 );
        }
    };


    /**
     * Loops through each item that should be shown and calculates the x, y position.
     * @param {Array.<Element>} items Array of items that will be shown/layed out in order in their array.
     *     Because jQuery collection are always ordered in DOM order, we can't pass a jq collection.
     * @param {boolean} [isOnlyPosition=false] If true this will position the items with zero opacity.
     */
    Shuffle.prototype._layout = function( items, isOnlyPosition ) {
        each(items, function( item ) {
            this._layoutItem( item, !!isOnlyPosition );
        }, this);

        // `_layout` always happens after `_shrink`, so it's safe to process the style
        // queue here with styles from the shrink method.
        this._processStyleQueue();

        // Adjust the height of the container.
        this._setContainerSize();
    };


    /**
     * Calculates the position of the item and pushes it onto the style queue.
     * @param {Element} item Element which is being positioned.
     * @param {boolean} isOnlyPosition Whether to position the item, but with zero
     *     opacity so that it can fade in later.
     * @private
     */
    Shuffle.prototype._layoutItem = function( item, isOnlyPosition ) {
        var $item = $(item);
        var itemData = $item.data();
        var currPos = itemData.point;
        var currScale = itemData.scale;
        var itemSize = {
            width: Shuffle._getOuterWidth( item, true ),
            height: Shuffle._getOuterHeight( item, true )
        };
        var pos = this._getItemPosition( itemSize );

        // If the item will not change its position, do not add it to the render
        // queue. Transitions don't fire when setting a property to the same value.
        if ( Point.equals(currPos, pos) && currScale === DEFAULT_SCALE ) {
            return;
        }

        // Save data for shrink
        itemData.point = pos;
        itemData.scale = DEFAULT_SCALE;

        this.styleQueue.push({
            $item: $item,
            point: pos,
            scale: DEFAULT_SCALE,
            opacity: isOnlyPosition ? 0 : 1,
            // Set styles immediately if there is no transition speed.
            skipTransition: isOnlyPosition || this.speed === 0,
            callfront: function() {
                if ( !isOnlyPosition ) {
                    $item.css( 'visibility', 'visible' );
                }
            },
            callback: function() {
                if ( isOnlyPosition ) {
                    $item.css( 'visibility', 'hidden' );
                }
            }
        });
    };


    /**
     * Determine the location of the next item, based on its size.
     * @param {{width: number, height: number}} itemSize Object with width and height.
     * @return {Point}
     * @private
     */
    Shuffle.prototype._getItemPosition = function( itemSize ) {
        var columnSpan = this._getColumnSpan( itemSize.width, this.colWidth, this.cols );

        var setY = this._getColumnSet( columnSpan, this.cols );

        // Finds the index of the smallest number in the set.
        var shortColumnIndex = this._getShortColumn( setY, this.buffer );

        // Position the item
        var point = new Point(
            Math.round( this.colWidth * shortColumnIndex ),
            Math.round( setY[shortColumnIndex] ));

        // Update the columns array with the new values for each column.
        // e.g. before the update the columns could be [250, 0, 0, 0] for an item
        // which spans 2 columns. After it would be [250, itemHeight, itemHeight, 0].
        var setHeight = setY[shortColumnIndex] + itemSize.height;
        var setSpan = this.cols + 1 - setY.length;
        for ( var i = 0; i < setSpan; i++ ) {
            this.positions[ shortColumnIndex + i ] = setHeight;
        }

        return point;
    };


    /**
     * Determine the number of columns an items spans.
     * @param {number} itemWidth Width of the item.
     * @param {number} columnWidth Width of the column (includes gutter).
     * @param {number} columns Total number of columns
     * @return {number}
     * @private
     */
    Shuffle.prototype._getColumnSpan = function( itemWidth, columnWidth, columns ) {
        var columnSpan = itemWidth / columnWidth;

        // If the difference between the rounded column span number and the
        // calculated column span number is really small, round the number to
        // make it fit.
        if ( Math.abs(Math.round( columnSpan ) - columnSpan ) < this.columnThreshold ) {
            // e.g. columnSpan = 4.0089945390298745
            columnSpan = Math.round( columnSpan );
        }

        // Ensure the column span is not more than the amount of columns in the whole layout.
        return Math.min( Math.ceil( columnSpan ), columns );
    };


    /**
     * Retrieves the column set to use for placement.
     * @param {number} columnSpan The number of columns this current item spans.
     * @param {number} columns The total columns in the grid.
     * @return {Array.<number>} An array of numbers represeting the column set.
     * @private
     */
    Shuffle.prototype._getColumnSet = function( columnSpan, columns ) {
        // The item spans only one column.
        if ( columnSpan === 1 ) {
            return this.positions;

            // The item spans more than one column, figure out how many different
            // places it could fit horizontally.
            // The group count is the number of places within the positions this block
            // could fit, ignoring the current positions of items.
            // Imagine a 2 column brick as the second item in a 4 column grid with
            // 10px height each. Find the places it would fit:
            // [10, 0, 0, 0]
            //  |   |  |
            //  *   *  *
            //
            // Then take the places which fit and get the bigger of the two:
            // max([10, 0]), max([0, 0]), max([0, 0]) = [10, 0, 0]
            //
            // Next, find the first smallest number (the short column).
            // [10, 0, 0]
            //      |
            //      *
            //
            // And that's where it should be placed!
        } else {
            var groupCount = columns + 1 - columnSpan;
            var groupY = [];

            // For how many possible positions for this item there are.
            for ( var i = 0; i < groupCount; i++ ) {
                // Find the bigger value for each place it could fit.
                groupY[i] = arrayMax( this.positions.slice( i, i + columnSpan ) );
            }

            return groupY;
        }
    };


    /**
     * Find index of short column, the first from the left where this item will go.
     *
     * @param {Array.<number>} positions The array to search for the smallest number.
     * @param {number} buffer Optional buffer which is very useful when the height
     *     is a percentage of the width.
     * @return {number} Index of the short column.
     * @private
     */
    Shuffle.prototype._getShortColumn = function( positions, buffer ) {
        var minPosition = arrayMin( positions );
        for (var i = 0, len = positions.length; i < len; i++) {
            if ( positions[i] >= minPosition - buffer && positions[i] <= minPosition + buffer ) {
                return i;
            }
        }
        return 0;
    };


    /**
     * Hides the elements that don't match our filter.
     * @param {jQuery} $collection jQuery collection to shrink.
     * @private
     */
    Shuffle.prototype._shrink = function( $collection ) {
        var $concealed = $collection || this._getConcealedItems();

        each($concealed, function( item ) {
            var $item = $(item);
            var itemData = $item.data();

            // Continuing would add a transitionend event listener to the element, but
            // that listener would not execute because the transform and opacity would
            // stay the same.
            if ( itemData.scale === CONCEALED_SCALE ) {
                return;
            }

            itemData.scale = CONCEALED_SCALE;

            this.styleQueue.push({
                $item: $item,
                point: itemData.point,
                scale : CONCEALED_SCALE,
                opacity: 0,
                callback: function() {
                    $item.css( 'visibility', 'hidden' );
                }
            });
        }, this);
    };


    /**
     * Resize handler.
     * @private
     */
    Shuffle.prototype._onResize = function() {
        // If shuffle is disabled, destroyed, don't do anything
        if ( !this.enabled || this.destroyed ) {
            return;
        }

        // Will need to check height in the future if it's layed out horizontaly
        var containerWidth = Shuffle._getOuterWidth( this.element );

        // containerWidth hasn't changed, don't do anything
        if ( containerWidth === this.containerWidth ) {
            return;
        }

        this.update();
    };


    /**
     * Returns styles for either jQuery animate or transition.
     * @param {Object} opts Transition options.
     * @return {!Object} Transforms for transitions, left/top for animate.
     * @private
     */
    Shuffle.prototype._getStylesForTransition = function( opts ) {
        var styles = {
            opacity: opts.opacity
        };

        if ( this.supported ) {
            styles[ TRANSFORM ] = Shuffle._getItemTransformString( opts.point, opts.scale );
        } else {
            styles.left = opts.point.x;
            styles.top = opts.point.y;
        }

        return styles;
    };


    /**
     * Transitions an item in the grid
     *
     * @param {Object} opts options.
     * @param {jQuery} opts.$item jQuery object representing the current item.
     * @param {Point} opts.point A point object with the x and y coordinates.
     * @param {number} opts.scale Amount to scale the item.
     * @param {number} opts.opacity Opacity of the item.
     * @param {Function} opts.callback Complete function for the animation.
     * @param {Function} opts.callfront Function to call before transitioning.
     * @private
     */
    Shuffle.prototype._transition = function( opts ) {
        var styles = this._getStylesForTransition( opts );
        this._startItemAnimation( opts.$item, styles, opts.callfront || $.noop, opts.callback || $.noop );
    };


    Shuffle.prototype._startItemAnimation = function( $item, styles, callfront, callback ) {
        var _this = this;
        // Transition end handler removes its listener.
        function handleTransitionEnd( evt ) {
            // Make sure this event handler has not bubbled up from a child.
            if ( evt.target === evt.currentTarget ) {
                $( evt.target ).off( TRANSITIONEND, handleTransitionEnd );
                _this._removeTransitionReference(reference);
                callback();
            }
        }

        var reference = {
            $element: $item,
            handler: handleTransitionEnd
        };

        callfront();

        // Transitions are not set until shuffle has loaded to avoid the initial transition.
        if ( !this.initialized ) {
            $item.css( styles );
            callback();
            return;
        }

        // Use CSS Transforms if we have them
        if ( this.supported ) {
            $item.css( styles );
            $item.on( TRANSITIONEND, handleTransitionEnd );
            this._transitions.push(reference);

            // Use jQuery to animate left/top
        } else {
            // Save the deferred object which jQuery returns.
            var anim = $item.stop( true ).animate( styles, this.speed, 'swing', callback );
            // Push the animation to the list of pending animations.
            this._animations.push( anim.promise() );
        }
    };


    /**
     * Execute the styles gathered in the style queue. This applies styles to elements,
     * triggering transitions.
     * @param {boolean} noLayout Whether to trigger a layout event.
     * @private
     */
    Shuffle.prototype._processStyleQueue = function( noLayout ) {
        if ( this.isTransitioning ) {
            this._cancelMovement();
        }

        var $transitions = $();

        // Iterate over the queue and keep track of ones that use transitions.
        each(this.styleQueue, function( transitionObj ) {
            if ( transitionObj.skipTransition ) {
                this._styleImmediately( transitionObj );
            } else {
                $transitions = $transitions.add( transitionObj.$item );
                this._transition( transitionObj );
            }
        }, this);


        if ( $transitions.length > 0 && this.initialized && this.speed > 0 ) {
            // Set flag that shuffle is currently in motion.
            this.isTransitioning = true;

            if ( this.supported ) {
                this._whenCollectionDone( $transitions, TRANSITIONEND, this._movementFinished );

                // The _transition function appends a promise to the animations array.
                // When they're all complete, do things.
            } else {
                this._whenAnimationsDone( this._movementFinished );
            }

            // A call to layout happened, but none of the newly filtered items will
            // change position. Asynchronously fire the callback here.
        } else if ( !noLayout ) {
            defer( this._layoutEnd, this );
        }

        // Remove everything in the style queue
        this.styleQueue.length = 0;
    };

    Shuffle.prototype._cancelMovement = function() {
        if (this.supported) {
            // Remove the transition end event for each listener.
            each(this._transitions, function( transition ) {
                transition.$element.off( TRANSITIONEND, transition.handler );
            });
        } else {
            // Even when `stop` is called on the jQuery animation, its promise will
            // still be resolved. Since it cannot be determine from within that callback
            // whether the animation was stopped or not, a flag is set here to distinguish
            // between the two states.
            this._isMovementCanceled = true;
            this.$items.stop(true);
            this._isMovementCanceled = false;
        }

        // Reset the array.
        this._transitions.length = 0;

        // Show it's no longer active.
        this.isTransitioning = false;
    };

    Shuffle.prototype._removeTransitionReference = function(ref) {
        var indexInArray = $.inArray(ref, this._transitions);
        if (indexInArray > -1) {
            this._transitions.splice(indexInArray, 1);
        }
    };


    /**
     * Apply styles without a transition.
     * @param {Object} opts Transitions options object.
     * @private
     */
    Shuffle.prototype._styleImmediately = function( opts ) {
        Shuffle._skipTransition(opts.$item[0], function() {
            opts.$item.css( this._getStylesForTransition( opts ) );
        }, this);
    };

    Shuffle.prototype._movementFinished = function() {
        this.isTransitioning = false;
        this._layoutEnd();
    };

    Shuffle.prototype._layoutEnd = function() {
        this._fire( Shuffle.EventType.LAYOUT );
    };

    Shuffle.prototype._addItems = function( $newItems, addToEnd, isSequential ) {
        // Add classes and set initial positions.
        this._initItems( $newItems );

        // Add transition to each item.
        this._setTransitions( $newItems );

        // Update the list of
        this.$items = this._getItems();

        // Shrink all items (without transitions).
        this._shrink( $newItems );
        each(this.styleQueue, function( transitionObj ) {
            transitionObj.skipTransition = true;
        });

        // Apply shrink positions, but do not cause a layout event.
        this._processStyleQueue( true );

        if ( addToEnd ) {
            this._addItemsToEnd( $newItems, isSequential );
        } else {
            this.shuffle( this.lastFilter );
        }
    };


    Shuffle.prototype._addItemsToEnd = function( $newItems, isSequential ) {
        // Get ones that passed the current filter
        var $passed = this._filter( null, $newItems );
        var passed = $passed.get();

        // How many filtered elements?
        this._updateItemCount();

        this._layout( passed, true );

        if ( isSequential && this.supported ) {
            this._setSequentialDelay( passed );
        }

        this._revealAppended( passed );
    };


    /**
     * Triggers appended elements to fade in.
     * @param {ArrayLike.<Element>} $newFilteredItems Collection of elements.
     * @private
     */
    Shuffle.prototype._revealAppended = function( newFilteredItems ) {
        defer(function() {
            each(newFilteredItems, function( el ) {
                var $item = $( el );
                this._transition({
                    $item: $item,
                    opacity: 1,
                    point: $item.data('point'),
                    scale: DEFAULT_SCALE
                });
            }, this);

            this._whenCollectionDone($(newFilteredItems), TRANSITIONEND, function() {
                $(newFilteredItems).css( TRANSITION_DELAY, '0ms' );
                this._movementFinished();
            });
        }, this, this.revealAppendedDelay);
    };


    /**
     * Execute a function when an event has been triggered for every item in a collection.
     * @param {jQuery} $collection Collection of elements.
     * @param {string} eventName Event to listen for.
     * @param {Function} callback Callback to execute when they're done.
     * @private
     */
    Shuffle.prototype._whenCollectionDone = function( $collection, eventName, callback ) {
        var done = 0;
        var items = $collection.length;
        var self = this;

        function handleEventName( evt ) {
            if ( evt.target === evt.currentTarget ) {
                $( evt.target ).off( eventName, handleEventName );
                done++;

                // Execute callback if all items have emitted the correct event.
                if ( done === items ) {
                    self._removeTransitionReference(reference);
                    callback.call( self );
                }
            }
        }

        var reference = {
            $element: $collection,
            handler: handleEventName
        };

        // Bind the event to all items.
        $collection.on( eventName, handleEventName );

        // Keep track of transitionend events so they can be removed.
        this._transitions.push(reference);
    };


    /**
     * Execute a callback after jQuery `animate` for a collection has finished.
     * @param {Function} callback Callback to execute when they're done.
     * @private
     */
    Shuffle.prototype._whenAnimationsDone = function( callback ) {
        $.when.apply( null, this._animations ).always( $.proxy( function() {
            this._animations.length = 0;
            if (!this._isMovementCanceled) {
                callback.call( this );
            }
        }, this ));
    };


    /**
     * Public Methods
     */

    /**
     * The magic. This is what makes the plugin 'shuffle'
     * @param {string|Function} [category] Category to filter by. Can be a function
     * @param {Object} [sortObj] A sort object which can sort the filtered set
     */
    Shuffle.prototype.shuffle = function( category, sortObj ) {
        if ( !this.enabled ) {
            return;
        }

        if ( !category ) {
            category = ALL_ITEMS;
        }

        this._filter( category );

        // How many filtered elements?
        this._updateItemCount();

        // Shrink each concealed item
        this._shrink();

        // Update transforms on .filtered elements so they will animate to their new positions
        this.sort( sortObj );
    };


    /**
     * Gets the .filtered elements, sorts them, and passes them to layout.
     * @param {Object} opts the options object for the sorted plugin
     */
    Shuffle.prototype.sort = function( opts ) {
        if ( this.enabled ) {
            this._resetCols();

            var sortOptions = opts || this.lastSort;
            var items = this._getFilteredItems().sorted( sortOptions );

            this._layout( items );

            this.lastSort = sortOptions;
        }
    };


    /**
     * Reposition everything.
     * @param {boolean} isOnlyLayout If true, column and gutter widths won't be
     *     recalculated.
     */
    Shuffle.prototype.update = function( isOnlyLayout ) {
        if ( this.enabled ) {

            if ( !isOnlyLayout ) {
                // Get updated colCount
                this._setColumns();
            }

            // Layout items
            this.sort();
        }
    };


    /**
     * Use this instead of `update()` if you don't need the columns and gutters updated
     * Maybe an image inside `shuffle` loaded (and now has a height), which means calculations
     * could be off.
     */
    Shuffle.prototype.layout = function() {
        this.update( true );
    };


    /**
     * New items have been appended to shuffle. Fade them in sequentially
     * @param {jQuery} $newItems jQuery collection of new items
     * @param {boolean} [addToEnd=false] If true, new items will be added to the end / bottom
     *     of the items. If not true, items will be mixed in with the current sort order.
     * @param {boolean} [isSequential=true] If false, new items won't sequentially fade in
     */
    Shuffle.prototype.appended = function( $newItems, addToEnd, isSequential ) {
        this._addItems( $newItems, addToEnd === true, isSequential !== false );
    };


    /**
     * Disables shuffle from updating dimensions and layout on resize
     */
    Shuffle.prototype.disable = function() {
        this.enabled = false;
    };


    /**
     * Enables shuffle again
     * @param {boolean} [isUpdateLayout=true] if undefined, shuffle will update columns and gutters
     */
    Shuffle.prototype.enable = function( isUpdateLayout ) {
        this.enabled = true;
        if ( isUpdateLayout !== false ) {
            this.update();
        }
    };


    /**
     * Remove 1 or more shuffle items
     * @param {jQuery} $collection A jQuery object containing one or more element in shuffle
     * @return {Shuffle} The shuffle object
     */
    Shuffle.prototype.remove = function( $collection ) {

        // If this isn't a jquery object, exit
        if ( !$collection.length || !$collection.jquery ) {
            return;
        }

        function handleRemoved() {
            // Remove the collection in the callback
            $collection.remove();

            // Update things now that elements have been removed.
            this.$items = this._getItems();
            this._updateItemCount();

            this._fire( Shuffle.EventType.REMOVED, [ $collection, this ] );

            // Let it get garbage collected
            $collection = null;
        }

        // Hide collection first.
        this._toggleFilterClasses( $(), $collection );
        this._shrink( $collection );

        this.sort();

        this.$el.one( Shuffle.EventType.LAYOUT + '.' + SHUFFLE, $.proxy( handleRemoved, this ) );
    };


    /**
     * Destroys shuffle, removes events, styles, and classes
     */
    Shuffle.prototype.destroy = function() {
        // If there is more than one shuffle instance on the page,
        // removing the resize handler from the window would remove them
        // all. This is why a unique value is needed.
        $window.off('.' + this.unique);

        // Reset container styles
        this.$el
            .removeClass( SHUFFLE )
            .removeAttr('style')
            .removeData( SHUFFLE );

        // Reset individual item styles
        this.$items
            .removeAttr('style')
            .removeData('point')
            .removeData('scale')
            .removeClass([
                Shuffle.ClassName.CONCEALED,
                Shuffle.ClassName.FILTERED,
                Shuffle.ClassName.SHUFFLE_ITEM
            ].join(' '));

        // Null DOM references
        this.$items = null;
        this.$el = null;
        this.sizer = null;
        this.element = null;
        this._transitions = null;

        // Set a flag so if a debounced resize has been triggered,
        // it can first check if it is actually destroyed and not doing anything
        this.destroyed = true;
    };


// Plugin definition
    $.fn.shuffle = function( opts ) {
        var args = Array.prototype.slice.call( arguments, 1 );
        return this.each(function() {
            var $this = $( this );
            var shuffle = $this.data( SHUFFLE );

            // If we don't have a stored shuffle, make a new one and save it
            if ( !shuffle ) {
                shuffle = new Shuffle( this, opts );
                $this.data( SHUFFLE, shuffle );
            } else if ( typeof opts === 'string' && shuffle[ opts ] ) {
                shuffle[ opts ].apply( shuffle, args );
            }
        });
    };


// http://stackoverflow.com/a/962890/373422
    function randomize( array ) {
        var tmp, current;
        var top = array.length;

        if ( !top ) {
            return array;
        }

        while ( --top ) {
            current = Math.floor( Math.random() * (top + 1) );
            tmp = array[ current ];
            array[ current ] = array[ top ];
            array[ top ] = tmp;
        }

        return array;
    }


// You can return `undefined` from the `by` function to revert to DOM order
// This plugin does NOT return a jQuery object. It returns a plain array because
// jQuery sorts everything in DOM order.
    $.fn.sorted = function(options) {
        var opts = $.extend({}, $.fn.sorted.defaults, options);
        var arr = this.get();
        var revert = false;

        if ( !arr.length ) {
            return [];
        }

        if ( opts.randomize ) {
            return randomize( arr );
        }

        // Sort the elements by the opts.by function.
        // If we don't have opts.by, default to DOM order
        if ( $.isFunction( opts.by ) ) {
            arr.sort(function(a, b) {

                // Exit early if we already know we want to revert
                if ( revert ) {
                    return 0;
                }

                var valA = opts.by($(a));
                var valB = opts.by($(b));

                // If both values are undefined, use the DOM order
                if ( valA === undefined && valB === undefined ) {
                    revert = true;
                    return 0;
                }

                if ( valA < valB || valA === 'sortFirst' || valB === 'sortLast' ) {
                    return -1;
                }

                if ( valA > valB || valA === 'sortLast' || valB === 'sortFirst' ) {
                    return 1;
                }

                return 0;
            });
        }

        // Revert to the original array if necessary
        if ( revert ) {
            return this.get();
        }

        if ( opts.reverse ) {
            arr.reverse();
        }

        return arr;
    };


    $.fn.sorted.defaults = {
        reverse: false, // Use array.reverse() to reverse the results
        by: null, // Sorting function
        randomize: false // If true, this will skip the sorting and return a randomized order in the array
    };

    return Shuffle;

});

/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.6.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
/* global window, document, define, jQuery, setInterval, clearInterval */
(function(factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else if (typeof exports !== 'undefined') {
        module.exports = factory(require('jquery'));
    } else {
        factory(jQuery);
    }

}(function($) {
    'use strict';
    var Slick = window.Slick || {};

    Slick = (function() {

        var instanceUid = 0;

        function Slick(element, settings) {

            var _ = this, dataSettings;

            _.defaults = {
                accessibility: true,
                adaptiveHeight: false,
                appendArrows: $(element),
                appendDots: $(element),
                arrows: true,
                asNavFor: null,
                prevArrow: '<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',
                nextArrow: '<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',
                autoplay: false,
                autoplaySpeed: 3000,
                centerMode: false,
                centerPadding: '50px',
                cssEase: 'ease',
                customPaging: function(slider, i) {
                    return $('<button type="button" data-role="none" role="button" tabindex="0" />').text(i + 1);
                },
                dots: false,
                dotsClass: 'slick-dots',
                draggable: true,
                easing: 'linear',
                edgeFriction: 0.35,
                fade: false,
                focusOnSelect: false,
                infinite: true,
                initialSlide: 0,
                lazyLoad: 'ondemand',
                mobileFirst: false,
                pauseOnHover: true,
                pauseOnFocus: true,
                pauseOnDotsHover: false,
                respondTo: 'window',
                responsive: null,
                rows: 1,
                rtl: false,
                slide: '',
                slidesPerRow: 1,
                slidesToShow: 1,
                slidesToScroll: 1,
                speed: 500,
                swipe: true,
                swipeToSlide: false,
                touchMove: true,
                touchThreshold: 5,
                useCSS: true,
                useTransform: true,
                variableWidth: false,
                vertical: false,
                verticalSwiping: false,
                waitForAnimate: true,
                zIndex: 1000
            };

            _.initials = {
                animating: false,
                dragging: false,
                autoPlayTimer: null,
                currentDirection: 0,
                currentLeft: null,
                currentSlide: 0,
                direction: 1,
                $dots: null,
                listWidth: null,
                listHeight: null,
                loadIndex: 0,
                $nextArrow: null,
                $prevArrow: null,
                slideCount: null,
                slideWidth: null,
                $slideTrack: null,
                $slides: null,
                sliding: false,
                slideOffset: 0,
                swipeLeft: null,
                $list: null,
                touchObject: {},
                transformsEnabled: false,
                unslicked: false
            };

            $.extend(_, _.initials);

            _.activeBreakpoint = null;
            _.animType = null;
            _.animProp = null;
            _.breakpoints = [];
            _.breakpointSettings = [];
            _.cssTransitions = false;
            _.focussed = false;
            _.interrupted = false;
            _.hidden = 'hidden';
            _.paused = true;
            _.positionProp = null;
            _.respondTo = null;
            _.rowCount = 1;
            _.shouldClick = true;
            _.$slider = $(element);
            _.$slidesCache = null;
            _.transformType = null;
            _.transitionType = null;
            _.visibilityChange = 'visibilitychange';
            _.windowWidth = 0;
            _.windowTimer = null;

            dataSettings = $(element).data('slick') || {};

            _.options = $.extend({}, _.defaults, settings, dataSettings);

            _.currentSlide = _.options.initialSlide;

            _.originalSettings = _.options;

            if (typeof document.mozHidden !== 'undefined') {
                _.hidden = 'mozHidden';
                _.visibilityChange = 'mozvisibilitychange';
            } else if (typeof document.webkitHidden !== 'undefined') {
                _.hidden = 'webkitHidden';
                _.visibilityChange = 'webkitvisibilitychange';
            }

            _.autoPlay = $.proxy(_.autoPlay, _);
            _.autoPlayClear = $.proxy(_.autoPlayClear, _);
            _.autoPlayIterator = $.proxy(_.autoPlayIterator, _);
            _.changeSlide = $.proxy(_.changeSlide, _);
            _.clickHandler = $.proxy(_.clickHandler, _);
            _.selectHandler = $.proxy(_.selectHandler, _);
            _.setPosition = $.proxy(_.setPosition, _);
            _.swipeHandler = $.proxy(_.swipeHandler, _);
            _.dragHandler = $.proxy(_.dragHandler, _);
            _.keyHandler = $.proxy(_.keyHandler, _);

            _.instanceUid = instanceUid++;

            // A simple way to check for HTML strings
            // Strict HTML recognition (must start with <)
            // Extracted from jQuery v1.11 source
            _.htmlExpr = /^(?:\s*(<[\w\W]+>)[^>]*)$/;


            _.registerBreakpoints();
            _.init(true);

        }

        return Slick;

    }());

    Slick.prototype.activateADA = function() {
        var _ = this;

        _.$slideTrack.find('.slick-active').attr({
            'aria-hidden': 'false'
        }).find('a, input, button, select').attr({
            'tabindex': '0'
        });

    };

    Slick.prototype.addSlide = Slick.prototype.slickAdd = function(markup, index, addBefore) {

        var _ = this;

        if (typeof(index) === 'boolean') {
            addBefore = index;
            index = null;
        } else if (index < 0 || (index >= _.slideCount)) {
            return false;
        }

        _.unload();

        if (typeof(index) === 'number') {
            if (index === 0 && _.$slides.length === 0) {
                $(markup).appendTo(_.$slideTrack);
            } else if (addBefore) {
                $(markup).insertBefore(_.$slides.eq(index));
            } else {
                $(markup).insertAfter(_.$slides.eq(index));
            }
        } else {
            if (addBefore === true) {
                $(markup).prependTo(_.$slideTrack);
            } else {
                $(markup).appendTo(_.$slideTrack);
            }
        }

        _.$slides = _.$slideTrack.children(this.options.slide);

        _.$slideTrack.children(this.options.slide).detach();

        _.$slideTrack.append(_.$slides);

        _.$slides.each(function(index, element) {
            $(element).attr('data-slick-index', index);
        });

        _.$slidesCache = _.$slides;

        _.reinit();

    };

    Slick.prototype.animateHeight = function() {
        var _ = this;
        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.animate({
                height: targetHeight
            }, _.options.speed);
        }
    };

    Slick.prototype.animateSlide = function(targetLeft, callback) {

        var animProps = {},
            _ = this;

        _.animateHeight();

        if (_.options.rtl === true && _.options.vertical === false) {
            targetLeft = -targetLeft;
        }
        if (_.transformsEnabled === false) {
            if (_.options.vertical === false) {
                _.$slideTrack.animate({
                    left: targetLeft
                }, _.options.speed, _.options.easing, callback);
            } else {
                _.$slideTrack.animate({
                    top: targetLeft
                }, _.options.speed, _.options.easing, callback);
            }

        } else {

            if (_.cssTransitions === false) {
                if (_.options.rtl === true) {
                    _.currentLeft = -(_.currentLeft);
                }
                $({
                    animStart: _.currentLeft
                }).animate({
                    animStart: targetLeft
                }, {
                    duration: _.options.speed,
                    easing: _.options.easing,
                    step: function(now) {
                        now = Math.ceil(now);
                        if (_.options.vertical === false) {
                            animProps[_.animType] = 'translate(' +
                                now + 'px, 0px)';
                            _.$slideTrack.css(animProps);
                        } else {
                            animProps[_.animType] = 'translate(0px,' +
                                now + 'px)';
                            _.$slideTrack.css(animProps);
                        }
                    },
                    complete: function() {
                        if (callback) {
                            callback.call();
                        }
                    }
                });

            } else {

                _.applyTransition();
                targetLeft = Math.ceil(targetLeft);

                if (_.options.vertical === false) {
                    animProps[_.animType] = 'translate3d(' + targetLeft + 'px, 0px, 0px)';
                } else {
                    animProps[_.animType] = 'translate3d(0px,' + targetLeft + 'px, 0px)';
                }
                _.$slideTrack.css(animProps);

                if (callback) {
                    setTimeout(function() {

                        _.disableTransition();

                        callback.call();
                    }, _.options.speed);
                }

            }

        }

    };

    Slick.prototype.getNavTarget = function() {

        var _ = this,
            asNavFor = _.options.asNavFor;

        if ( asNavFor && asNavFor !== null ) {
            asNavFor = $(asNavFor).not(_.$slider);
        }

        return asNavFor;

    };

    Slick.prototype.asNavFor = function(index) {

        var _ = this,
            asNavFor = _.getNavTarget();

        if ( asNavFor !== null && typeof asNavFor === 'object' ) {
            asNavFor.each(function() {
                var target = $(this).slick('getSlick');
                if(!target.unslicked) {
                    target.slideHandler(index, true);
                }
            });
        }

    };

    Slick.prototype.applyTransition = function(slide) {

        var _ = this,
            transition = {};

        if (_.options.fade === false) {
            transition[_.transitionType] = _.transformType + ' ' + _.options.speed + 'ms ' + _.options.cssEase;
        } else {
            transition[_.transitionType] = 'opacity ' + _.options.speed + 'ms ' + _.options.cssEase;
        }

        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }

    };

    Slick.prototype.autoPlay = function() {

        var _ = this;

        _.autoPlayClear();

        if ( _.slideCount > _.options.slidesToShow ) {
            _.autoPlayTimer = setInterval( _.autoPlayIterator, _.options.autoplaySpeed );
        }

    };

    Slick.prototype.autoPlayClear = function() {

        var _ = this;

        if (_.autoPlayTimer) {
            clearInterval(_.autoPlayTimer);
        }

    };

    Slick.prototype.autoPlayIterator = function() {

        var _ = this,
            slideTo = _.currentSlide + _.options.slidesToScroll;

        if ( !_.paused && !_.interrupted && !_.focussed ) {

            if ( _.options.infinite === false ) {

                if ( _.direction === 1 && ( _.currentSlide + 1 ) === ( _.slideCount - 1 )) {
                    _.direction = 0;
                }

                else if ( _.direction === 0 ) {

                    slideTo = _.currentSlide - _.options.slidesToScroll;

                    if ( _.currentSlide - 1 === 0 ) {
                        _.direction = 1;
                    }

                }

            }

            _.slideHandler( slideTo );

        }

    };

    Slick.prototype.buildArrows = function() {

        var _ = this;

        if (_.options.arrows === true ) {

            _.$prevArrow = $(_.options.prevArrow).addClass('slick-arrow');
            _.$nextArrow = $(_.options.nextArrow).addClass('slick-arrow');

            if( _.slideCount > _.options.slidesToShow ) {

                _.$prevArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');
                _.$nextArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');

                if (_.htmlExpr.test(_.options.prevArrow)) {
                    _.$prevArrow.prependTo(_.options.appendArrows);
                }

                if (_.htmlExpr.test(_.options.nextArrow)) {
                    _.$nextArrow.appendTo(_.options.appendArrows);
                }

                if (_.options.infinite !== true) {
                    _.$prevArrow
                        .addClass('slick-disabled')
                        .attr('aria-disabled', 'true');
                }

            } else {

                _.$prevArrow.add( _.$nextArrow )

                    .addClass('slick-hidden')
                    .attr({
                        'aria-disabled': 'true',
                        'tabindex': '-1'
                    });

            }

        }

    };

    Slick.prototype.buildDots = function() {

        var _ = this,
            i, dot;

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$slider.addClass('slick-dotted');

            dot = $('<ul />').addClass(_.options.dotsClass);

            for (i = 0; i <= _.getDotCount(); i += 1) {
                dot.append($('<li />').append(_.options.customPaging.call(this, _, i)));
            }

            _.$dots = dot.appendTo(_.options.appendDots);

            _.$dots.find('li').first().addClass('slick-active').attr('aria-hidden', 'false');

        }

    };

    Slick.prototype.buildOut = function() {

        var _ = this;

        _.$slides =
            _.$slider
                .children( _.options.slide + ':not(.slick-cloned)')
                .addClass('slick-slide');

        _.slideCount = _.$slides.length;

        _.$slides.each(function(index, element) {
            $(element)
                .attr('data-slick-index', index)
                .data('originalStyling', $(element).attr('style') || '');
        });

        _.$slider.addClass('slick-slider');

        _.$slideTrack = (_.slideCount === 0) ?
            $('<div class="slick-track"/>').appendTo(_.$slider) :
            _.$slides.wrapAll('<div class="slick-track"/>').parent();

        _.$list = _.$slideTrack.wrap(
            '<div aria-live="polite" class="slick-list"/>').parent();
        _.$slideTrack.css('opacity', 0);

        if (_.options.centerMode === true || _.options.swipeToSlide === true) {
            _.options.slidesToScroll = 1;
        }

        $('img[data-lazy]', _.$slider).not('[src]').addClass('slick-loading');

        _.setupInfinite();

        _.buildArrows();

        _.buildDots();

        _.updateDots();


        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);

        if (_.options.draggable === true) {
            _.$list.addClass('draggable');
        }

    };

    Slick.prototype.buildRows = function() {

        var _ = this, a, b, c, newSlides, numOfSlides, originalSlides,slidesPerSection;

        newSlides = document.createDocumentFragment();
        originalSlides = _.$slider.children();

        if(_.options.rows > 1) {

            slidesPerSection = _.options.slidesPerRow * _.options.rows;
            numOfSlides = Math.ceil(
                originalSlides.length / slidesPerSection
            );

            for(a = 0; a < numOfSlides; a++){
                var slide = document.createElement('div');
                for(b = 0; b < _.options.rows; b++) {
                    var row = document.createElement('div');
                    for(c = 0; c < _.options.slidesPerRow; c++) {
                        var target = (a * slidesPerSection + ((b * _.options.slidesPerRow) + c));
                        if (originalSlides.get(target)) {
                            row.appendChild(originalSlides.get(target));
                        }
                    }
                    slide.appendChild(row);
                }
                newSlides.appendChild(slide);
            }

            _.$slider.empty().append(newSlides);
            _.$slider.children().children().children()
                .css({
                    'width':(100 / _.options.slidesPerRow) + '%',
                    'display': 'inline-block'
                });

        }

    };

    Slick.prototype.checkResponsive = function(initial, forceUpdate) {

        var _ = this,
            breakpoint, targetBreakpoint, respondToWidth, triggerBreakpoint = false;
        var sliderWidth = _.$slider.width();
        var windowWidth = window.innerWidth || $(window).width();

        if (_.respondTo === 'window') {
            respondToWidth = windowWidth;
        } else if (_.respondTo === 'slider') {
            respondToWidth = sliderWidth;
        } else if (_.respondTo === 'min') {
            respondToWidth = Math.min(windowWidth, sliderWidth);
        }

        if ( _.options.responsive &&
            _.options.responsive.length &&
            _.options.responsive !== null) {

            targetBreakpoint = null;

            for (breakpoint in _.breakpoints) {
                if (_.breakpoints.hasOwnProperty(breakpoint)) {
                    if (_.originalSettings.mobileFirst === false) {
                        if (respondToWidth < _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    } else {
                        if (respondToWidth > _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    }
                }
            }

            if (targetBreakpoint !== null) {
                if (_.activeBreakpoint !== null) {
                    if (targetBreakpoint !== _.activeBreakpoint || forceUpdate) {
                        _.activeBreakpoint =
                            targetBreakpoint;
                        if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                            _.unslick(targetBreakpoint);
                        } else {
                            _.options = $.extend({}, _.originalSettings,
                                _.breakpointSettings[
                                    targetBreakpoint]);
                            if (initial === true) {
                                _.currentSlide = _.options.initialSlide;
                            }
                            _.refresh(initial);
                        }
                        triggerBreakpoint = targetBreakpoint;
                    }
                } else {
                    _.activeBreakpoint = targetBreakpoint;
                    if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                        _.unslick(targetBreakpoint);
                    } else {
                        _.options = $.extend({}, _.originalSettings,
                            _.breakpointSettings[
                                targetBreakpoint]);
                        if (initial === true) {
                            _.currentSlide = _.options.initialSlide;
                        }
                        _.refresh(initial);
                    }
                    triggerBreakpoint = targetBreakpoint;
                }
            } else {
                if (_.activeBreakpoint !== null) {
                    _.activeBreakpoint = null;
                    _.options = _.originalSettings;
                    if (initial === true) {
                        _.currentSlide = _.options.initialSlide;
                    }
                    _.refresh(initial);
                    triggerBreakpoint = targetBreakpoint;
                }
            }

            // only trigger breakpoints during an actual break. not on initialize.
            if( !initial && triggerBreakpoint !== false ) {
                _.$slider.trigger('breakpoint', [_, triggerBreakpoint]);
            }
        }

    };

    Slick.prototype.changeSlide = function(event, dontAnimate) {

        var _ = this,
            $target = $(event.currentTarget),
            indexOffset, slideOffset, unevenOffset;

        // If target is a link, prevent default action.
        if($target.is('a')) {
            event.preventDefault();
        }

        // If target is not the <li> element (ie: a child), find the <li>.
        if(!$target.is('li')) {
            $target = $target.closest('li');
        }

        unevenOffset = (_.slideCount % _.options.slidesToScroll !== 0);
        indexOffset = unevenOffset ? 0 : (_.slideCount - _.currentSlide) % _.options.slidesToScroll;

        switch (event.data.message) {

            case 'previous':
                slideOffset = indexOffset === 0 ? _.options.slidesToScroll : _.options.slidesToShow - indexOffset;
                if (_.slideCount > _.options.slidesToShow) {
                    _.slideHandler(_.currentSlide - slideOffset, false, dontAnimate);
                }
                break;

            case 'next':
                slideOffset = indexOffset === 0 ? _.options.slidesToScroll : indexOffset;
                if (_.slideCount > _.options.slidesToShow) {
                    _.slideHandler(_.currentSlide + slideOffset, false, dontAnimate);
                }
                break;

            case 'index':
                var index = event.data.index === 0 ? 0 :
                    event.data.index || $target.index() * _.options.slidesToScroll;

                _.slideHandler(_.checkNavigable(index), false, dontAnimate);
                $target.children().trigger('focus');
                break;

            default:
                return;
        }

    };

    Slick.prototype.checkNavigable = function(index) {

        var _ = this,
            navigables, prevNavigable;

        navigables = _.getNavigableIndexes();
        prevNavigable = 0;
        if (index > navigables[navigables.length - 1]) {
            index = navigables[navigables.length - 1];
        } else {
            for (var n in navigables) {
                if (index < navigables[n]) {
                    index = prevNavigable;
                    break;
                }
                prevNavigable = navigables[n];
            }
        }

        return index;
    };

    Slick.prototype.cleanUpEvents = function() {

        var _ = this;

        if (_.options.dots && _.$dots !== null) {

            $('li', _.$dots)
                .off('click.slick', _.changeSlide)
                .off('mouseenter.slick', $.proxy(_.interrupt, _, true))
                .off('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

        _.$slider.off('focus.slick blur.slick');

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow && _.$prevArrow.off('click.slick', _.changeSlide);
            _.$nextArrow && _.$nextArrow.off('click.slick', _.changeSlide);
        }

        _.$list.off('touchstart.slick mousedown.slick', _.swipeHandler);
        _.$list.off('touchmove.slick mousemove.slick', _.swipeHandler);
        _.$list.off('touchend.slick mouseup.slick', _.swipeHandler);
        _.$list.off('touchcancel.slick mouseleave.slick', _.swipeHandler);

        _.$list.off('click.slick', _.clickHandler);

        $(document).off(_.visibilityChange, _.visibility);

        _.cleanUpSlideEvents();

        if (_.options.accessibility === true) {
            _.$list.off('keydown.slick', _.keyHandler);
        }

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().off('click.slick', _.selectHandler);
        }

        $(window).off('orientationchange.slick.slick-' + _.instanceUid, _.orientationChange);

        $(window).off('resize.slick.slick-' + _.instanceUid, _.resize);

        $('[draggable!=true]', _.$slideTrack).off('dragstart', _.preventDefault);

        $(window).off('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(document).off('ready.slick.slick-' + _.instanceUid, _.setPosition);

    };

    Slick.prototype.cleanUpSlideEvents = function() {

        var _ = this;

        _.$list.off('mouseenter.slick', $.proxy(_.interrupt, _, true));
        _.$list.off('mouseleave.slick', $.proxy(_.interrupt, _, false));

    };

    Slick.prototype.cleanUpRows = function() {

        var _ = this, originalSlides;

        if(_.options.rows > 1) {
            originalSlides = _.$slides.children().children();
            originalSlides.removeAttr('style');
            _.$slider.empty().append(originalSlides);
        }

    };

    Slick.prototype.clickHandler = function(event) {

        var _ = this;

        if (_.shouldClick === false) {
            event.stopImmediatePropagation();
            event.stopPropagation();
            event.preventDefault();
        }

    };

    Slick.prototype.destroy = function(refresh) {

        var _ = this;

        _.autoPlayClear();

        _.touchObject = {};

        _.cleanUpEvents();

        $('.slick-cloned', _.$slider).detach();

        if (_.$dots) {
            _.$dots.remove();
        }


        if ( _.$prevArrow && _.$prevArrow.length ) {

            _.$prevArrow
                .removeClass('slick-disabled slick-arrow slick-hidden')
                .removeAttr('aria-hidden aria-disabled tabindex')
                .css('display','');

            if ( _.htmlExpr.test( _.options.prevArrow )) {
                _.$prevArrow.remove();
            }
        }

        if ( _.$nextArrow && _.$nextArrow.length ) {

            _.$nextArrow
                .removeClass('slick-disabled slick-arrow slick-hidden')
                .removeAttr('aria-hidden aria-disabled tabindex')
                .css('display','');

            if ( _.htmlExpr.test( _.options.nextArrow )) {
                _.$nextArrow.remove();
            }

        }


        if (_.$slides) {

            _.$slides
                .removeClass('slick-slide slick-active slick-center slick-visible slick-current')
                .removeAttr('aria-hidden')
                .removeAttr('data-slick-index')
                .each(function(){
                    $(this).attr('style', $(this).data('originalStyling'));
                });

            _.$slideTrack.children(this.options.slide).detach();

            _.$slideTrack.detach();

            _.$list.detach();

            _.$slider.append(_.$slides);
        }

        _.cleanUpRows();

        _.$slider.removeClass('slick-slider');
        _.$slider.removeClass('slick-initialized');
        _.$slider.removeClass('slick-dotted');

        _.unslicked = true;

        if(!refresh) {
            _.$slider.trigger('destroy', [_]);
        }

    };

    Slick.prototype.disableTransition = function(slide) {

        var _ = this,
            transition = {};

        transition[_.transitionType] = '';

        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }

    };

    Slick.prototype.fadeSlide = function(slideIndex, callback) {

        var _ = this;

        if (_.cssTransitions === false) {

            _.$slides.eq(slideIndex).css({
                zIndex: _.options.zIndex
            });

            _.$slides.eq(slideIndex).animate({
                opacity: 1
            }, _.options.speed, _.options.easing, callback);

        } else {

            _.applyTransition(slideIndex);

            _.$slides.eq(slideIndex).css({
                opacity: 1,
                zIndex: _.options.zIndex
            });

            if (callback) {
                setTimeout(function() {

                    _.disableTransition(slideIndex);

                    callback.call();
                }, _.options.speed);
            }

        }

    };

    Slick.prototype.fadeSlideOut = function(slideIndex) {

        var _ = this;

        if (_.cssTransitions === false) {

            _.$slides.eq(slideIndex).animate({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            }, _.options.speed, _.options.easing);

        } else {

            _.applyTransition(slideIndex);

            _.$slides.eq(slideIndex).css({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            });

        }

    };

    Slick.prototype.filterSlides = Slick.prototype.slickFilter = function(filter) {

        var _ = this;

        if (filter !== null) {

            _.$slidesCache = _.$slides;

            _.unload();

            _.$slideTrack.children(this.options.slide).detach();

            _.$slidesCache.filter(filter).appendTo(_.$slideTrack);

            _.reinit();

        }

    };

    Slick.prototype.focusHandler = function() {

        var _ = this;

        _.$slider
            .off('focus.slick blur.slick')
            .on('focus.slick blur.slick',
                '*:not(.slick-arrow)', function(event) {

            event.stopImmediatePropagation();
            var $sf = $(this);

            setTimeout(function() {

                if( _.options.pauseOnFocus ) {
                    _.focussed = $sf.is(':focus');
                    _.autoPlay();
                }

            }, 0);

        });
    };

    Slick.prototype.getCurrent = Slick.prototype.slickCurrentSlide = function() {

        var _ = this;
        return _.currentSlide;

    };

    Slick.prototype.getDotCount = function() {

        var _ = this;

        var breakPoint = 0;
        var counter = 0;
        var pagerQty = 0;

        if (_.options.infinite === true) {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToScroll;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        } else if (_.options.centerMode === true) {
            pagerQty = _.slideCount;
        } else if(!_.options.asNavFor) {
            pagerQty = 1 + Math.ceil((_.slideCount - _.options.slidesToShow) / _.options.slidesToScroll);
        }else {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToScroll;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        }

        return pagerQty - 1;

    };

    Slick.prototype.getLeft = function(slideIndex) {

        var _ = this,
            targetLeft,
            verticalHeight,
            verticalOffset = 0,
            targetSlide;

        _.slideOffset = 0;
        verticalHeight = _.$slides.first().outerHeight(true);

        if (_.options.infinite === true) {
            if (_.slideCount > _.options.slidesToShow) {
                _.slideOffset = (_.slideWidth * _.options.slidesToShow) * -1;
                verticalOffset = (verticalHeight * _.options.slidesToShow) * -1;
            }
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                if (slideIndex + _.options.slidesToScroll > _.slideCount && _.slideCount > _.options.slidesToShow) {
                    if (slideIndex > _.slideCount) {
                        _.slideOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * _.slideWidth) * -1;
                        verticalOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * verticalHeight) * -1;
                    } else {
                        _.slideOffset = ((_.slideCount % _.options.slidesToScroll) * _.slideWidth) * -1;
                        verticalOffset = ((_.slideCount % _.options.slidesToScroll) * verticalHeight) * -1;
                    }
                }
            }
        } else {
            if (slideIndex + _.options.slidesToShow > _.slideCount) {
                _.slideOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * _.slideWidth;
                verticalOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * verticalHeight;
            }
        }

        if (_.slideCount <= _.options.slidesToShow) {
            _.slideOffset = 0;
            verticalOffset = 0;
        }

        if (_.options.centerMode === true && _.options.infinite === true) {
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2) - _.slideWidth;
        } else if (_.options.centerMode === true) {
            _.slideOffset = 0;
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2);
        }

        if (_.options.vertical === false) {
            targetLeft = ((slideIndex * _.slideWidth) * -1) + _.slideOffset;
        } else {
            targetLeft = ((slideIndex * verticalHeight) * -1) + verticalOffset;
        }

        if (_.options.variableWidth === true) {

            if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
            } else {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow);
            }

            if (_.options.rtl === true) {
                if (targetSlide[0]) {
                    targetLeft = (_.$slideTrack.width() - targetSlide[0].offsetLeft - targetSlide.width()) * -1;
                } else {
                    targetLeft =  0;
                }
            } else {
                targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
            }

            if (_.options.centerMode === true) {
                if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
                } else {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow + 1);
                }

                if (_.options.rtl === true) {
                    if (targetSlide[0]) {
                        targetLeft = (_.$slideTrack.width() - targetSlide[0].offsetLeft - targetSlide.width()) * -1;
                    } else {
                        targetLeft =  0;
                    }
                } else {
                    targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
                }

                targetLeft += (_.$list.width() - targetSlide.outerWidth()) / 2;
            }
        }

        return targetLeft;

    };

    Slick.prototype.getOption = Slick.prototype.slickGetOption = function(option) {

        var _ = this;

        return _.options[option];

    };

    Slick.prototype.getNavigableIndexes = function() {

        var _ = this,
            breakPoint = 0,
            counter = 0,
            indexes = [],
            max;

        if (_.options.infinite === false) {
            max = _.slideCount;
        } else {
            breakPoint = _.options.slidesToScroll * -1;
            counter = _.options.slidesToScroll * -1;
            max = _.slideCount * 2;
        }

        while (breakPoint < max) {
            indexes.push(breakPoint);
            breakPoint = counter + _.options.slidesToScroll;
            counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
        }

        return indexes;

    };

    Slick.prototype.getSlick = function() {

        return this;

    };

    Slick.prototype.getSlideCount = function() {

        var _ = this,
            slidesTraversed, swipedSlide, centerOffset;

        centerOffset = _.options.centerMode === true ? _.slideWidth * Math.floor(_.options.slidesToShow / 2) : 0;

        if (_.options.swipeToSlide === true) {
            _.$slideTrack.find('.slick-slide').each(function(index, slide) {
                if (slide.offsetLeft - centerOffset + ($(slide).outerWidth() / 2) > (_.swipeLeft * -1)) {
                    swipedSlide = slide;
                    return false;
                }
            });

            slidesTraversed = Math.abs($(swipedSlide).attr('data-slick-index') - _.currentSlide) || 1;

            return slidesTraversed;

        } else {
            return _.options.slidesToScroll;
        }

    };

    Slick.prototype.goTo = Slick.prototype.slickGoTo = function(slide, dontAnimate) {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'index',
                index: parseInt(slide)
            }
        }, dontAnimate);

    };

    Slick.prototype.init = function(creation) {

        var _ = this;

        if (!$(_.$slider).hasClass('slick-initialized')) {

            $(_.$slider).addClass('slick-initialized');

            _.buildRows();
            _.buildOut();
            _.setProps();
            _.startLoad();
            _.loadSlider();
            _.initializeEvents();
            _.updateArrows();
            _.updateDots();
            _.checkResponsive(true);
            _.focusHandler();

        }

        if (creation) {
            _.$slider.trigger('init', [_]);
        }

        if (_.options.accessibility === true) {
            _.initADA();
        }

        if ( _.options.autoplay ) {

            _.paused = false;
            _.autoPlay();

        }

    };

    Slick.prototype.initADA = function() {
        var _ = this;
        _.$slides.add(_.$slideTrack.find('.slick-cloned')).attr({
            'aria-hidden': 'true',
            'tabindex': '-1'
        }).find('a, input, button, select').attr({
            'tabindex': '-1'
        });

        _.$slideTrack.attr('role', 'listbox');

        _.$slides.not(_.$slideTrack.find('.slick-cloned')).each(function(i) {
            $(this).attr({
                'role': 'option',
                'aria-describedby': 'slick-slide' + _.instanceUid + i + ''
            });
        });

        if (_.$dots !== null) {
            _.$dots.attr('role', 'tablist').find('li').each(function(i) {
                $(this).attr({
                    'role': 'presentation',
                    'aria-selected': 'false',
                    'aria-controls': 'navigation' + _.instanceUid + i + '',
                    'id': 'slick-slide' + _.instanceUid + i + ''
                });
            })
                .first().attr('aria-selected', 'true').end()
                .find('button').attr('role', 'button').end()
                .closest('div').attr('role', 'toolbar');
        }
        _.activateADA();

    };

    Slick.prototype.initArrowEvents = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow
               .off('click.slick')
               .on('click.slick', {
                    message: 'previous'
               }, _.changeSlide);
            _.$nextArrow
               .off('click.slick')
               .on('click.slick', {
                    message: 'next'
               }, _.changeSlide);
        }

    };

    Slick.prototype.initDotEvents = function() {

        var _ = this;

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
            $('li', _.$dots).on('click.slick', {
                message: 'index'
            }, _.changeSlide);
        }

        if ( _.options.dots === true && _.options.pauseOnDotsHover === true ) {

            $('li', _.$dots)
                .on('mouseenter.slick', $.proxy(_.interrupt, _, true))
                .on('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

    };

    Slick.prototype.initSlideEvents = function() {

        var _ = this;

        if ( _.options.pauseOnHover ) {

            _.$list.on('mouseenter.slick', $.proxy(_.interrupt, _, true));
            _.$list.on('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

    };

    Slick.prototype.initializeEvents = function() {

        var _ = this;

        _.initArrowEvents();

        _.initDotEvents();
        _.initSlideEvents();

        _.$list.on('touchstart.slick mousedown.slick', {
            action: 'start'
        }, _.swipeHandler);
        _.$list.on('touchmove.slick mousemove.slick', {
            action: 'move'
        }, _.swipeHandler);
        _.$list.on('touchend.slick mouseup.slick', {
            action: 'end'
        }, _.swipeHandler);
        _.$list.on('touchcancel.slick mouseleave.slick', {
            action: 'end'
        }, _.swipeHandler);

        _.$list.on('click.slick', _.clickHandler);

        $(document).on(_.visibilityChange, $.proxy(_.visibility, _));

        if (_.options.accessibility === true) {
            _.$list.on('keydown.slick', _.keyHandler);
        }

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }

        $(window).on('orientationchange.slick.slick-' + _.instanceUid, $.proxy(_.orientationChange, _));

        $(window).on('resize.slick.slick-' + _.instanceUid, $.proxy(_.resize, _));

        $('[draggable!=true]', _.$slideTrack).on('dragstart', _.preventDefault);

        $(window).on('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(document).on('ready.slick.slick-' + _.instanceUid, _.setPosition);

    };

    Slick.prototype.initUI = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {

            _.$prevArrow.show();
            _.$nextArrow.show();

        }

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$dots.show();

        }

    };

    Slick.prototype.keyHandler = function(event) {

        var _ = this;
         //Dont slide if the cursor is inside the form fields and arrow keys are pressed
        if(!event.target.tagName.match('TEXTAREA|INPUT|SELECT')) {
            if (event.keyCode === 37 && _.options.accessibility === true) {
                _.changeSlide({
                    data: {
                        message: _.options.rtl === true ? 'next' :  'previous'
                    }
                });
            } else if (event.keyCode === 39 && _.options.accessibility === true) {
                _.changeSlide({
                    data: {
                        message: _.options.rtl === true ? 'previous' : 'next'
                    }
                });
            }
        }

    };

    Slick.prototype.lazyLoad = function() {

        var _ = this,
            loadRange, cloneRange, rangeStart, rangeEnd;

        function loadImages(imagesScope) {

            $('img[data-lazy]', imagesScope).each(function() {

                var image = $(this),
                    imageSource = $(this).attr('data-lazy'),
                    imageToLoad = document.createElement('img');

                imageToLoad.onload = function() {

                    image
                        .animate({ opacity: 0 }, 100, function() {
                            image
                                .attr('src', imageSource)
                                .animate({ opacity: 1 }, 200, function() {
                                    image
                                        .removeAttr('data-lazy')
                                        .removeClass('slick-loading');
                                });
                            _.$slider.trigger('lazyLoaded', [_, image, imageSource]);
                        });

                };

                imageToLoad.onerror = function() {

                    image
                        .removeAttr( 'data-lazy' )
                        .removeClass( 'slick-loading' )
                        .addClass( 'slick-lazyload-error' );

                    _.$slider.trigger('lazyLoadError', [ _, image, imageSource ]);

                };

                imageToLoad.src = imageSource;

            });

        }

        if (_.options.centerMode === true) {
            if (_.options.infinite === true) {
                rangeStart = _.currentSlide + (_.options.slidesToShow / 2 + 1);
                rangeEnd = rangeStart + _.options.slidesToShow + 2;
            } else {
                rangeStart = Math.max(0, _.currentSlide - (_.options.slidesToShow / 2 + 1));
                rangeEnd = 2 + (_.options.slidesToShow / 2 + 1) + _.currentSlide;
            }
        } else {
            rangeStart = _.options.infinite ? _.options.slidesToShow + _.currentSlide : _.currentSlide;
            rangeEnd = Math.ceil(rangeStart + _.options.slidesToShow);
            if (_.options.fade === true) {
                if (rangeStart > 0) rangeStart--;
                if (rangeEnd <= _.slideCount) rangeEnd++;
            }
        }

        loadRange = _.$slider.find('.slick-slide').slice(rangeStart, rangeEnd);
        loadImages(loadRange);

        if (_.slideCount <= _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-slide');
            loadImages(cloneRange);
        } else
        if (_.currentSlide >= _.slideCount - _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-cloned').slice(0, _.options.slidesToShow);
            loadImages(cloneRange);
        } else if (_.currentSlide === 0) {
            cloneRange = _.$slider.find('.slick-cloned').slice(_.options.slidesToShow * -1);
            loadImages(cloneRange);
        }

    };

    Slick.prototype.loadSlider = function() {

        var _ = this;

        _.setPosition();

        _.$slideTrack.css({
            opacity: 1
        });

        _.$slider.removeClass('slick-loading');

        _.initUI();

        if (_.options.lazyLoad === 'progressive') {
            _.progressiveLazyLoad();
        }

    };

    Slick.prototype.next = Slick.prototype.slickNext = function() {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'next'
            }
        });

    };

    Slick.prototype.orientationChange = function() {

        var _ = this;

        _.checkResponsive();
        _.setPosition();

    };

    Slick.prototype.pause = Slick.prototype.slickPause = function() {

        var _ = this;

        _.autoPlayClear();
        _.paused = true;

    };

    Slick.prototype.play = Slick.prototype.slickPlay = function() {

        var _ = this;

        _.autoPlay();
        _.options.autoplay = true;
        _.paused = false;
        _.focussed = false;
        _.interrupted = false;

    };

    Slick.prototype.postSlide = function(index) {

        var _ = this;

        if( !_.unslicked ) {

            _.$slider.trigger('afterChange', [_, index]);

            _.animating = false;

            _.setPosition();

            _.swipeLeft = null;

            if ( _.options.autoplay ) {
                _.autoPlay();
            }

            if (_.options.accessibility === true) {
                _.initADA();
            }

        }

    };

    Slick.prototype.prev = Slick.prototype.slickPrev = function() {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'previous'
            }
        });

    };

    Slick.prototype.preventDefault = function(event) {

        event.preventDefault();

    };

    Slick.prototype.progressiveLazyLoad = function( tryCount ) {

        tryCount = tryCount || 1;

        var _ = this,
            $imgsToLoad = $( 'img[data-lazy]', _.$slider ),
            image,
            imageSource,
            imageToLoad;

        if ( $imgsToLoad.length ) {

            image = $imgsToLoad.first();
            imageSource = image.attr('data-lazy');
            imageToLoad = document.createElement('img');

            imageToLoad.onload = function() {

                image
                    .attr( 'src', imageSource )
                    .removeAttr('data-lazy')
                    .removeClass('slick-loading');

                if ( _.options.adaptiveHeight === true ) {
                    _.setPosition();
                }

                _.$slider.trigger('lazyLoaded', [ _, image, imageSource ]);
                _.progressiveLazyLoad();

            };

            imageToLoad.onerror = function() {

                if ( tryCount < 3 ) {

                    /**
                     * try to load the image 3 times,
                     * leave a slight delay so we don't get
                     * servers blocking the request.
                     */
                    setTimeout( function() {
                        _.progressiveLazyLoad( tryCount + 1 );
                    }, 500 );

                } else {

                    image
                        .removeAttr( 'data-lazy' )
                        .removeClass( 'slick-loading' )
                        .addClass( 'slick-lazyload-error' );

                    _.$slider.trigger('lazyLoadError', [ _, image, imageSource ]);

                    _.progressiveLazyLoad();

                }

            };

            imageToLoad.src = imageSource;

        } else {

            _.$slider.trigger('allImagesLoaded', [ _ ]);

        }

    };

    Slick.prototype.refresh = function( initializing ) {

        var _ = this, currentSlide, lastVisibleIndex;

        lastVisibleIndex = _.slideCount - _.options.slidesToShow;

        // in non-infinite sliders, we don't want to go past the
        // last visible index.
        if( !_.options.infinite && ( _.currentSlide > lastVisibleIndex )) {
            _.currentSlide = lastVisibleIndex;
        }

        // if less slides than to show, go to start.
        if ( _.slideCount <= _.options.slidesToShow ) {
            _.currentSlide = 0;

        }

        currentSlide = _.currentSlide;

        _.destroy(true);

        $.extend(_, _.initials, { currentSlide: currentSlide });

        _.init();

        if( !initializing ) {

            _.changeSlide({
                data: {
                    message: 'index',
                    index: currentSlide
                }
            }, false);

        }

    };

    Slick.prototype.registerBreakpoints = function() {

        var _ = this, breakpoint, currentBreakpoint, l,
            responsiveSettings = _.options.responsive || null;

        if ( $.type(responsiveSettings) === 'array' && responsiveSettings.length ) {

            _.respondTo = _.options.respondTo || 'window';

            for ( breakpoint in responsiveSettings ) {

                l = _.breakpoints.length-1;
                currentBreakpoint = responsiveSettings[breakpoint].breakpoint;

                if (responsiveSettings.hasOwnProperty(breakpoint)) {

                    // loop through the breakpoints and cut out any existing
                    // ones with the same breakpoint number, we don't want dupes.
                    while( l >= 0 ) {
                        if( _.breakpoints[l] && _.breakpoints[l] === currentBreakpoint ) {
                            _.breakpoints.splice(l,1);
                        }
                        l--;
                    }

                    _.breakpoints.push(currentBreakpoint);
                    _.breakpointSettings[currentBreakpoint] = responsiveSettings[breakpoint].settings;

                }

            }

            _.breakpoints.sort(function(a, b) {
                return ( _.options.mobileFirst ) ? a-b : b-a;
            });

        }

    };

    Slick.prototype.reinit = function() {

        var _ = this;

        _.$slides =
            _.$slideTrack
                .children(_.options.slide)
                .addClass('slick-slide');

        _.slideCount = _.$slides.length;

        if (_.currentSlide >= _.slideCount && _.currentSlide !== 0) {
            _.currentSlide = _.currentSlide - _.options.slidesToScroll;
        }

        if (_.slideCount <= _.options.slidesToShow) {
            _.currentSlide = 0;
        }

        _.registerBreakpoints();

        _.setProps();
        _.setupInfinite();
        _.buildArrows();
        _.updateArrows();
        _.initArrowEvents();
        _.buildDots();
        _.updateDots();
        _.initDotEvents();
        _.cleanUpSlideEvents();
        _.initSlideEvents();

        _.checkResponsive(false, true);

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }

        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);

        _.setPosition();
        _.focusHandler();

        _.paused = !_.options.autoplay;
        _.autoPlay();

        _.$slider.trigger('reInit', [_]);

    };

    Slick.prototype.resize = function() {

        var _ = this;

        if ($(window).width() !== _.windowWidth) {
            clearTimeout(_.windowDelay);
            _.windowDelay = window.setTimeout(function() {
                _.windowWidth = $(window).width();
                _.checkResponsive();
                if( !_.unslicked ) { _.setPosition(); }
            }, 50);
        }
    };

    Slick.prototype.removeSlide = Slick.prototype.slickRemove = function(index, removeBefore, removeAll) {

        var _ = this;

        if (typeof(index) === 'boolean') {
            removeBefore = index;
            index = removeBefore === true ? 0 : _.slideCount - 1;
        } else {
            index = removeBefore === true ? --index : index;
        }

        if (_.slideCount < 1 || index < 0 || index > _.slideCount - 1) {
            return false;
        }

        _.unload();

        if (removeAll === true) {
            _.$slideTrack.children().remove();
        } else {
            _.$slideTrack.children(this.options.slide).eq(index).remove();
        }

        _.$slides = _.$slideTrack.children(this.options.slide);

        _.$slideTrack.children(this.options.slide).detach();

        _.$slideTrack.append(_.$slides);

        _.$slidesCache = _.$slides;

        _.reinit();

    };

    Slick.prototype.setCSS = function(position) {

        var _ = this,
            positionProps = {},
            x, y;

        if (_.options.rtl === true) {
            position = -position;
        }
        x = _.positionProp == 'left' ? Math.ceil(position) + 'px' : '0px';
        y = _.positionProp == 'top' ? Math.ceil(position) + 'px' : '0px';

        positionProps[_.positionProp] = position;

        if (_.transformsEnabled === false) {
            _.$slideTrack.css(positionProps);
        } else {
            positionProps = {};
            if (_.cssTransitions === false) {
                positionProps[_.animType] = 'translate(' + x + ', ' + y + ')';
                _.$slideTrack.css(positionProps);
            } else {
                positionProps[_.animType] = 'translate3d(' + x + ', ' + y + ', 0px)';
                _.$slideTrack.css(positionProps);
            }
        }

    };

    Slick.prototype.setDimensions = function() {

        var _ = this;

        if (_.options.vertical === false) {
            if (_.options.centerMode === true) {
                _.$list.css({
                    padding: ('0px ' + _.options.centerPadding)
                });
            }
        } else {
            _.$list.height(_.$slides.first().outerHeight(true) * _.options.slidesToShow);
            if (_.options.centerMode === true) {
                _.$list.css({
                    padding: (_.options.centerPadding + ' 0px')
                });
            }
        }

        _.listWidth = _.$list.width();
        _.listHeight = _.$list.height();


        if (_.options.vertical === false && _.options.variableWidth === false) {
            _.slideWidth = Math.ceil(_.listWidth / _.options.slidesToShow);
            _.$slideTrack.width(Math.ceil((_.slideWidth * _.$slideTrack.children('.slick-slide').length)));

        } else if (_.options.variableWidth === true) {
            _.$slideTrack.width(5000 * _.slideCount);
        } else {
            _.slideWidth = Math.ceil(_.listWidth);
            _.$slideTrack.height(Math.ceil((_.$slides.first().outerHeight(true) * _.$slideTrack.children('.slick-slide').length)));
        }

        var offset = _.$slides.first().outerWidth(true) - _.$slides.first().width();
        if (_.options.variableWidth === false) _.$slideTrack.children('.slick-slide').width(_.slideWidth - offset);

    };

    Slick.prototype.setFade = function() {

        var _ = this,
            targetLeft;

        _.$slides.each(function(index, element) {
            targetLeft = (_.slideWidth * index) * -1;
            if (_.options.rtl === true) {
                $(element).css({
                    position: 'relative',
                    right: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            } else {
                $(element).css({
                    position: 'relative',
                    left: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            }
        });

        _.$slides.eq(_.currentSlide).css({
            zIndex: _.options.zIndex - 1,
            opacity: 1
        });

    };

    Slick.prototype.setHeight = function() {

        var _ = this;

        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.css('height', targetHeight);
        }

    };

    Slick.prototype.setOption =
    Slick.prototype.slickSetOption = function() {

        /**
         * accepts arguments in format of:
         *
         *  - for changing a single option's value:
         *     .slick("setOption", option, value, refresh )
         *
         *  - for changing a set of responsive options:
         *     .slick("setOption", 'responsive', [{}, ...], refresh )
         *
         *  - for updating multiple values at once (not responsive)
         *     .slick("setOption", { 'option': value, ... }, refresh )
         */

        var _ = this, l, item, option, value, refresh = false, type;

        if( $.type( arguments[0] ) === 'object' ) {

            option =  arguments[0];
            refresh = arguments[1];
            type = 'multiple';

        } else if ( $.type( arguments[0] ) === 'string' ) {

            option =  arguments[0];
            value = arguments[1];
            refresh = arguments[2];

            if ( arguments[0] === 'responsive' && $.type( arguments[1] ) === 'array' ) {

                type = 'responsive';

            } else if ( typeof arguments[1] !== 'undefined' ) {

                type = 'single';

            }

        }

        if ( type === 'single' ) {

            _.options[option] = value;


        } else if ( type === 'multiple' ) {

            $.each( option , function( opt, val ) {

                _.options[opt] = val;

            });


        } else if ( type === 'responsive' ) {

            for ( item in value ) {

                if( $.type( _.options.responsive ) !== 'array' ) {

                    _.options.responsive = [ value[item] ];

                } else {

                    l = _.options.responsive.length-1;

                    // loop through the responsive object and splice out duplicates.
                    while( l >= 0 ) {

                        if( _.options.responsive[l].breakpoint === value[item].breakpoint ) {

                            _.options.responsive.splice(l,1);

                        }

                        l--;

                    }

                    _.options.responsive.push( value[item] );

                }

            }

        }

        if ( refresh ) {

            _.unload();
            _.reinit();

        }

    };

    Slick.prototype.setPosition = function() {

        var _ = this;

        _.setDimensions();

        _.setHeight();

        if (_.options.fade === false) {
            _.setCSS(_.getLeft(_.currentSlide));
        } else {
            _.setFade();
        }

        _.$slider.trigger('setPosition', [_]);

    };

    Slick.prototype.setProps = function() {

        var _ = this,
            bodyStyle = document.body.style;

        _.positionProp = _.options.vertical === true ? 'top' : 'left';

        if (_.positionProp === 'top') {
            _.$slider.addClass('slick-vertical');
        } else {
            _.$slider.removeClass('slick-vertical');
        }

        if (bodyStyle.WebkitTransition !== undefined ||
            bodyStyle.MozTransition !== undefined ||
            bodyStyle.msTransition !== undefined) {
            if (_.options.useCSS === true) {
                _.cssTransitions = true;
            }
        }

        if ( _.options.fade ) {
            if ( typeof _.options.zIndex === 'number' ) {
                if( _.options.zIndex < 3 ) {
                    _.options.zIndex = 3;
                }
            } else {
                _.options.zIndex = _.defaults.zIndex;
            }
        }

        if (bodyStyle.OTransform !== undefined) {
            _.animType = 'OTransform';
            _.transformType = '-o-transform';
            _.transitionType = 'OTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.MozTransform !== undefined) {
            _.animType = 'MozTransform';
            _.transformType = '-moz-transform';
            _.transitionType = 'MozTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.MozPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.webkitTransform !== undefined) {
            _.animType = 'webkitTransform';
            _.transformType = '-webkit-transform';
            _.transitionType = 'webkitTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.msTransform !== undefined) {
            _.animType = 'msTransform';
            _.transformType = '-ms-transform';
            _.transitionType = 'msTransition';
            if (bodyStyle.msTransform === undefined) _.animType = false;
        }
        if (bodyStyle.transform !== undefined && _.animType !== false) {
            _.animType = 'transform';
            _.transformType = 'transform';
            _.transitionType = 'transition';
        }
        _.transformsEnabled = _.options.useTransform && (_.animType !== null && _.animType !== false);
    };


    Slick.prototype.setSlideClasses = function(index) {

        var _ = this,
            centerOffset, allSlides, indexOffset, remainder;

        allSlides = _.$slider
            .find('.slick-slide')
            .removeClass('slick-active slick-center slick-current')
            .attr('aria-hidden', 'true');

        _.$slides
            .eq(index)
            .addClass('slick-current');

        if (_.options.centerMode === true) {

            centerOffset = Math.floor(_.options.slidesToShow / 2);

            if (_.options.infinite === true) {

                if (index >= centerOffset && index <= (_.slideCount - 1) - centerOffset) {

                    _.$slides
                        .slice(index - centerOffset, index + centerOffset + 1)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                } else {

                    indexOffset = _.options.slidesToShow + index;
                    allSlides
                        .slice(indexOffset - centerOffset + 1, indexOffset + centerOffset + 2)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                }

                if (index === 0) {

                    allSlides
                        .eq(allSlides.length - 1 - _.options.slidesToShow)
                        .addClass('slick-center');

                } else if (index === _.slideCount - 1) {

                    allSlides
                        .eq(_.options.slidesToShow)
                        .addClass('slick-center');

                }

            }

            _.$slides
                .eq(index)
                .addClass('slick-center');

        } else {

            if (index >= 0 && index <= (_.slideCount - _.options.slidesToShow)) {

                _.$slides
                    .slice(index, index + _.options.slidesToShow)
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false');

            } else if (allSlides.length <= _.options.slidesToShow) {

                allSlides
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false');

            } else {

                remainder = _.slideCount % _.options.slidesToShow;
                indexOffset = _.options.infinite === true ? _.options.slidesToShow + index : index;

                if (_.options.slidesToShow == _.options.slidesToScroll && (_.slideCount - index) < _.options.slidesToShow) {

                    allSlides
                        .slice(indexOffset - (_.options.slidesToShow - remainder), indexOffset + remainder)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                } else {

                    allSlides
                        .slice(indexOffset, indexOffset + _.options.slidesToShow)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                }

            }

        }

        if (_.options.lazyLoad === 'ondemand') {
            _.lazyLoad();
        }

    };

    Slick.prototype.setupInfinite = function() {

        var _ = this,
            i, slideIndex, infiniteCount;

        if (_.options.fade === true) {
            _.options.centerMode = false;
        }

        if (_.options.infinite === true && _.options.fade === false) {

            slideIndex = null;

            if (_.slideCount > _.options.slidesToShow) {

                if (_.options.centerMode === true) {
                    infiniteCount = _.options.slidesToShow + 1;
                } else {
                    infiniteCount = _.options.slidesToShow;
                }

                for (i = _.slideCount; i > (_.slideCount -
                        infiniteCount); i -= 1) {
                    slideIndex = i - 1;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '')
                        .attr('data-slick-index', slideIndex - _.slideCount)
                        .prependTo(_.$slideTrack).addClass('slick-cloned');
                }
                for (i = 0; i < infiniteCount; i += 1) {
                    slideIndex = i;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '')
                        .attr('data-slick-index', slideIndex + _.slideCount)
                        .appendTo(_.$slideTrack).addClass('slick-cloned');
                }
                _.$slideTrack.find('.slick-cloned').find('[id]').each(function() {
                    $(this).attr('id', '');
                });

            }

        }

    };

    Slick.prototype.interrupt = function( toggle ) {

        var _ = this;

        if( !toggle ) {
            _.autoPlay();
        }
        _.interrupted = toggle;

    };

    Slick.prototype.selectHandler = function(event) {

        var _ = this;

        var targetElement =
            $(event.target).is('.slick-slide') ?
                $(event.target) :
                $(event.target).parents('.slick-slide');

        var index = parseInt(targetElement.attr('data-slick-index'));

        if (!index) index = 0;

        if (_.slideCount <= _.options.slidesToShow) {

            _.setSlideClasses(index);
            _.asNavFor(index);
            return;

        }

        _.slideHandler(index);

    };

    Slick.prototype.slideHandler = function(index, sync, dontAnimate) {

        var targetSlide, animSlide, oldSlide, slideLeft, targetLeft = null,
            _ = this, navTarget;

        sync = sync || false;

        if (_.animating === true && _.options.waitForAnimate === true) {
            return;
        }

        if (_.options.fade === true && _.currentSlide === index) {
            return;
        }

        if (_.slideCount <= _.options.slidesToShow) {
            return;
        }

        if (sync === false) {
            _.asNavFor(index);
        }

        targetSlide = index;
        targetLeft = _.getLeft(targetSlide);
        slideLeft = _.getLeft(_.currentSlide);

        _.currentLeft = _.swipeLeft === null ? slideLeft : _.swipeLeft;

        if (_.options.infinite === false && _.options.centerMode === false && (index < 0 || index > _.getDotCount() * _.options.slidesToScroll)) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function() {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        } else if (_.options.infinite === false && _.options.centerMode === true && (index < 0 || index > (_.slideCount - _.options.slidesToScroll))) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function() {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        }

        if ( _.options.autoplay ) {
            clearInterval(_.autoPlayTimer);
        }

        if (targetSlide < 0) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = _.slideCount - (_.slideCount % _.options.slidesToScroll);
            } else {
                animSlide = _.slideCount + targetSlide;
            }
        } else if (targetSlide >= _.slideCount) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = 0;
            } else {
                animSlide = targetSlide - _.slideCount;
            }
        } else {
            animSlide = targetSlide;
        }

        _.animating = true;

        _.$slider.trigger('beforeChange', [_, _.currentSlide, animSlide]);

        oldSlide = _.currentSlide;
        _.currentSlide = animSlide;

        _.setSlideClasses(_.currentSlide);

        if ( _.options.asNavFor ) {

            navTarget = _.getNavTarget();
            navTarget = navTarget.slick('getSlick');

            if ( navTarget.slideCount <= navTarget.options.slidesToShow ) {
                navTarget.setSlideClasses(_.currentSlide);
            }

        }

        _.updateDots();
        _.updateArrows();

        if (_.options.fade === true) {
            if (dontAnimate !== true) {

                _.fadeSlideOut(oldSlide);

                _.fadeSlide(animSlide, function() {
                    _.postSlide(animSlide);
                });

            } else {
                _.postSlide(animSlide);
            }
            _.animateHeight();
            return;
        }

        if (dontAnimate !== true) {
            _.animateSlide(targetLeft, function() {
                _.postSlide(animSlide);
            });
        } else {
            _.postSlide(animSlide);
        }

    };

    Slick.prototype.startLoad = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {

            _.$prevArrow.hide();
            _.$nextArrow.hide();

        }

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$dots.hide();

        }

        _.$slider.addClass('slick-loading');

    };

    Slick.prototype.swipeDirection = function() {

        var xDist, yDist, r, swipeAngle, _ = this;

        xDist = _.touchObject.startX - _.touchObject.curX;
        yDist = _.touchObject.startY - _.touchObject.curY;
        r = Math.atan2(yDist, xDist);

        swipeAngle = Math.round(r * 180 / Math.PI);
        if (swipeAngle < 0) {
            swipeAngle = 360 - Math.abs(swipeAngle);
        }

        if ((swipeAngle <= 45) && (swipeAngle >= 0)) {
            return (_.options.rtl === false ? 'left' : 'right');
        }
        if ((swipeAngle <= 360) && (swipeAngle >= 315)) {
            return (_.options.rtl === false ? 'left' : 'right');
        }
        if ((swipeAngle >= 135) && (swipeAngle <= 225)) {
            return (_.options.rtl === false ? 'right' : 'left');
        }
        if (_.options.verticalSwiping === true) {
            if ((swipeAngle >= 35) && (swipeAngle <= 135)) {
                return 'down';
            } else {
                return 'up';
            }
        }

        return 'vertical';

    };

    Slick.prototype.swipeEnd = function(event) {

        var _ = this,
            slideCount,
            direction;

        _.dragging = false;
        _.interrupted = false;
        _.shouldClick = ( _.touchObject.swipeLength > 10 ) ? false : true;

        if ( _.touchObject.curX === undefined ) {
            return false;
        }

        if ( _.touchObject.edgeHit === true ) {
            _.$slider.trigger('edge', [_, _.swipeDirection() ]);
        }

        if ( _.touchObject.swipeLength >= _.touchObject.minSwipe ) {

            direction = _.swipeDirection();

            switch ( direction ) {

                case 'left':
                case 'down':

                    slideCount =
                        _.options.swipeToSlide ?
                            _.checkNavigable( _.currentSlide + _.getSlideCount() ) :
                            _.currentSlide + _.getSlideCount();

                    _.currentDirection = 0;

                    break;

                case 'right':
                case 'up':

                    slideCount =
                        _.options.swipeToSlide ?
                            _.checkNavigable( _.currentSlide - _.getSlideCount() ) :
                            _.currentSlide - _.getSlideCount();

                    _.currentDirection = 1;

                    break;

                default:


            }

            if( direction != 'vertical' ) {

                _.slideHandler( slideCount );
                _.touchObject = {};
                _.$slider.trigger('swipe', [_, direction ]);

            }

        } else {

            if ( _.touchObject.startX !== _.touchObject.curX ) {

                _.slideHandler( _.currentSlide );
                _.touchObject = {};

            }

        }

    };

    Slick.prototype.swipeHandler = function(event) {

        var _ = this;

        if ((_.options.swipe === false) || ('ontouchend' in document && _.options.swipe === false)) {
            return;
        } else if (_.options.draggable === false && event.type.indexOf('mouse') !== -1) {
            return;
        }

        _.touchObject.fingerCount = event.originalEvent && event.originalEvent.touches !== undefined ?
            event.originalEvent.touches.length : 1;

        _.touchObject.minSwipe = _.listWidth / _.options
            .touchThreshold;

        if (_.options.verticalSwiping === true) {
            _.touchObject.minSwipe = _.listHeight / _.options
                .touchThreshold;
        }

        switch (event.data.action) {

            case 'start':
                _.swipeStart(event);
                break;

            case 'move':
                _.swipeMove(event);
                break;

            case 'end':
                _.swipeEnd(event);
                break;

        }

    };

    Slick.prototype.swipeMove = function(event) {

        var _ = this,
            edgeWasHit = false,
            curLeft, swipeDirection, swipeLength, positionOffset, touches;

        touches = event.originalEvent !== undefined ? event.originalEvent.touches : null;

        if (!_.dragging || touches && touches.length !== 1) {
            return false;
        }

        curLeft = _.getLeft(_.currentSlide);

        _.touchObject.curX = touches !== undefined ? touches[0].pageX : event.clientX;
        _.touchObject.curY = touches !== undefined ? touches[0].pageY : event.clientY;

        _.touchObject.swipeLength = Math.round(Math.sqrt(
            Math.pow(_.touchObject.curX - _.touchObject.startX, 2)));

        if (_.options.verticalSwiping === true) {
            _.touchObject.swipeLength = Math.round(Math.sqrt(
                Math.pow(_.touchObject.curY - _.touchObject.startY, 2)));
        }

        swipeDirection = _.swipeDirection();

        if (swipeDirection === 'vertical') {
            return;
        }

        if (event.originalEvent !== undefined && _.touchObject.swipeLength > 4) {
            event.preventDefault();
        }

        positionOffset = (_.options.rtl === false ? 1 : -1) * (_.touchObject.curX > _.touchObject.startX ? 1 : -1);
        if (_.options.verticalSwiping === true) {
            positionOffset = _.touchObject.curY > _.touchObject.startY ? 1 : -1;
        }


        swipeLength = _.touchObject.swipeLength;

        _.touchObject.edgeHit = false;

        if (_.options.infinite === false) {
            if ((_.currentSlide === 0 && swipeDirection === 'right') || (_.currentSlide >= _.getDotCount() && swipeDirection === 'left')) {
                swipeLength = _.touchObject.swipeLength * _.options.edgeFriction;
                _.touchObject.edgeHit = true;
            }
        }

        if (_.options.vertical === false) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        } else {
            _.swipeLeft = curLeft + (swipeLength * (_.$list.height() / _.listWidth)) * positionOffset;
        }
        if (_.options.verticalSwiping === true) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        }

        if (_.options.fade === true || _.options.touchMove === false) {
            return false;
        }

        if (_.animating === true) {
            _.swipeLeft = null;
            return false;
        }

        _.setCSS(_.swipeLeft);

    };

    Slick.prototype.swipeStart = function(event) {

        var _ = this,
            touches;

        _.interrupted = true;

        if (_.touchObject.fingerCount !== 1 || _.slideCount <= _.options.slidesToShow) {
            _.touchObject = {};
            return false;
        }

        if (event.originalEvent !== undefined && event.originalEvent.touches !== undefined) {
            touches = event.originalEvent.touches[0];
        }

        _.touchObject.startX = _.touchObject.curX = touches !== undefined ? touches.pageX : event.clientX;
        _.touchObject.startY = _.touchObject.curY = touches !== undefined ? touches.pageY : event.clientY;

        _.dragging = true;

    };

    Slick.prototype.unfilterSlides = Slick.prototype.slickUnfilter = function() {

        var _ = this;

        if (_.$slidesCache !== null) {

            _.unload();

            _.$slideTrack.children(this.options.slide).detach();

            _.$slidesCache.appendTo(_.$slideTrack);

            _.reinit();

        }

    };

    Slick.prototype.unload = function() {

        var _ = this;

        $('.slick-cloned', _.$slider).remove();

        if (_.$dots) {
            _.$dots.remove();
        }

        if (_.$prevArrow && _.htmlExpr.test(_.options.prevArrow)) {
            _.$prevArrow.remove();
        }

        if (_.$nextArrow && _.htmlExpr.test(_.options.nextArrow)) {
            _.$nextArrow.remove();
        }

        _.$slides
            .removeClass('slick-slide slick-active slick-visible slick-current')
            .attr('aria-hidden', 'true')
            .css('width', '');

    };

    Slick.prototype.unslick = function(fromBreakpoint) {

        var _ = this;
        _.$slider.trigger('unslick', [_, fromBreakpoint]);
        _.destroy();

    };

    Slick.prototype.updateArrows = function() {

        var _ = this,
            centerOffset;

        centerOffset = Math.floor(_.options.slidesToShow / 2);

        if ( _.options.arrows === true &&
            _.slideCount > _.options.slidesToShow &&
            !_.options.infinite ) {

            _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            if (_.currentSlide === 0) {

                _.$prevArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            } else if (_.currentSlide >= _.slideCount - _.options.slidesToShow && _.options.centerMode === false) {

                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            } else if (_.currentSlide >= _.slideCount - 1 && _.options.centerMode === true) {

                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            }

        }

    };

    Slick.prototype.updateDots = function() {

        var _ = this;

        if (_.$dots !== null) {

            _.$dots
                .find('li')
                .removeClass('slick-active')
                .attr('aria-hidden', 'true');

            _.$dots
                .find('li')
                .eq(Math.floor(_.currentSlide / _.options.slidesToScroll))
                .addClass('slick-active')
                .attr('aria-hidden', 'false');

        }

    };

    Slick.prototype.visibility = function() {

        var _ = this;

        if ( _.options.autoplay ) {

            if ( document[_.hidden] ) {

                _.interrupted = true;

            } else {

                _.interrupted = false;

            }

        }

    };

    $.fn.slick = function() {
        var _ = this,
            opt = arguments[0],
            args = Array.prototype.slice.call(arguments, 1),
            l = _.length,
            i,
            ret;
        for (i = 0; i < l; i++) {
            if (typeof opt == 'object' || typeof opt == 'undefined')
                _[i].slick = new Slick(_[i], opt);
            else
                ret = _[i].slick[opt].apply(_[i].slick, args);
            if (typeof ret != 'undefined') return ret;
        }
        return _;
    };

}));

// Generated by CoffeeScript 1.9.2

/**
 @license Sticky-kit v1.1.2 | WTFPL | Leaf Corcoran 2015 | http://leafo.net
 */

(function() {
    var $, win;

    $ = this.jQuery || window.jQuery;

    win = $(window);

    $.fn.stick_in_parent = function(opts) {
        var doc, elm, enable_bottoming, fn, i, inner_scrolling, len, manual_spacer, offset_top, parent_selector, recalc_every, sticky_class;
        if (opts == null) {
            opts = {};
        }
        sticky_class = opts.sticky_class, inner_scrolling = opts.inner_scrolling, recalc_every = opts.recalc_every, parent_selector = opts.parent, offset_top = opts.offset_top, manual_spacer = opts.spacer, enable_bottoming = opts.bottoming;
        if (offset_top == null) {
            offset_top = 0;
        }
        if (parent_selector == null) {
            parent_selector = void 0;
        }
        if (inner_scrolling == null) {
            inner_scrolling = true;
        }
        if (sticky_class == null) {
            sticky_class = "is_stuck";
        }
        doc = $(document);
        if (enable_bottoming == null) {
            enable_bottoming = true;
        }
        fn = function(elm, padding_bottom, parent_top, parent_height, top, height, el_float, detached) {
            var bottomed, detach, fixed, last_pos, last_scroll_height, offset, parent, recalc, recalc_and_tick, recalc_counter, spacer, tick;
            if (elm.data("sticky_kit")) {
                return;
            }
            elm.data("sticky_kit", true);
            last_scroll_height = doc.height();
            parent = elm.parent();
            if (parent_selector != null) {
                parent = parent.closest(parent_selector);
            }
            if (!parent.length) {
                throw "failed to find stick parent";
            }
            fixed = false;
            bottomed = false;
            spacer = manual_spacer != null ? manual_spacer && elm.closest(manual_spacer) : $("<div />");
            if (spacer) {
                spacer.css('position', elm.css('position'));
            }
            recalc = function() {
                var border_top, padding_top, restore;
                if (detached) {
                    return;
                }
                last_scroll_height = doc.height();
                border_top = parseInt(parent.css("border-top-width"), 10);
                padding_top = parseInt(parent.css("padding-top"), 10);
                padding_bottom = parseInt(parent.css("padding-bottom"), 10);
                parent_top = parent.offset().top + border_top + padding_top;
                parent_height = parent.height();
                if (fixed) {
                    fixed = false;
                    bottomed = false;
                    if (manual_spacer == null) {
                        elm.insertAfter(spacer);
                        spacer.detach();
                    }
                    elm.css({
                        position: "",
                        top: "",
                        width: "",
                        bottom: ""
                    }).removeClass(sticky_class);
                    restore = true;
                }
                top = elm.offset().top - (parseInt(elm.css("margin-top"), 10) || 0) - offset_top;
                height = elm.outerHeight(true);
                el_float = elm.css("float");
                if (spacer) {
                    spacer.css({
                        width: elm.outerWidth(true),
                        height: height,
                        display: elm.css("display"),
                        "vertical-align": elm.css("vertical-align"),
                        "float": el_float
                    });
                }
                if (restore) {
                    return tick();
                }
            };
            recalc();
            if (height === parent_height) {
                return;
            }
            last_pos = void 0;
            offset = offset_top;
            recalc_counter = recalc_every;
            tick = function() {
                var css, delta, recalced, scroll, will_bottom, win_height;
                if (detached) {
                    return;
                }
                recalced = false;
                if (recalc_counter != null) {
                    recalc_counter -= 1;
                    if (recalc_counter <= 0) {
                        recalc_counter = recalc_every;
                        recalc();
                        recalced = true;
                    }
                }
                if (!recalced && doc.height() !== last_scroll_height) {
                    recalc();
                    recalced = true;
                }
                scroll = win.scrollTop();
                if (last_pos != null) {
                    delta = scroll - last_pos;
                }
                last_pos = scroll;
                if (fixed) {
                    if (enable_bottoming) {
                        will_bottom = scroll + height + offset > parent_height + parent_top;
                        if (bottomed && !will_bottom) {
                            bottomed = false;
                            elm.css({
                                position: "fixed",
                                bottom: "",
                                top: offset
                            }).trigger("sticky_kit:unbottom");
                        }
                    }
                    if (scroll < top) {
                        fixed = false;
                        offset = offset_top;
                        if (manual_spacer == null) {
                            if (el_float === "left" || el_float === "right") {
                                elm.insertAfter(spacer);
                            }
                            spacer.detach();
                        }
                        css = {
                            position: "",
                            width: "",
                            top: ""
                        };
                        elm.css(css).removeClass(sticky_class).trigger("sticky_kit:unstick");
                    }
                    if (inner_scrolling) {
                        win_height = win.height();
                        if (height + offset_top > win_height) {
                            if (!bottomed) {
                                offset -= delta;
                                offset = Math.max(win_height - height, offset);
                                offset = Math.min(offset_top, offset);
                                if (fixed) {
                                    elm.css({
                                        top: offset + "px"
                                    });
                                }
                            }
                        }
                    }
                } else {
                    if (scroll > top) {
                        fixed = true;
                        css = {
                            position: "fixed",
                            top: offset
                        };
                        css.width = elm.css("box-sizing") === "border-box" ? elm.outerWidth() + "px" : elm.width() + "px";
                        elm.css(css).addClass(sticky_class);
                        if (manual_spacer == null) {
                            elm.after(spacer);
                            if (el_float === "left" || el_float === "right") {
                                spacer.append(elm);
                            }
                        }
                        elm.trigger("sticky_kit:stick");
                    }
                }
                if (fixed && enable_bottoming) {
                    if (will_bottom == null) {
                        will_bottom = scroll + height + offset > parent_height + parent_top;
                    }
                    if (!bottomed && will_bottom) {
                        bottomed = true;
                        if (parent.css("position") === "static") {
                            parent.css({
                                position: "relative"
                            });
                        }
                        return elm.css({
                            position: "absolute",
                            bottom: padding_bottom,
                            top: "auto"
                        }).trigger("sticky_kit:bottom");
                    }
                }
            };
            recalc_and_tick = function() {
                recalc();
                return tick();
            };
            detach = function() {
                detached = true;
                win.off("touchmove", tick);
                win.off("scroll", tick);
                win.off("resize", recalc_and_tick);
                $(document.body).off("sticky_kit:recalc", recalc_and_tick);
                elm.off("sticky_kit:detach", detach);
                elm.removeData("sticky_kit");
                elm.css({
                    position: "",
                    bottom: "",
                    top: "",
                    width: ""
                });
                parent.position("position", "");
                if (fixed) {
                    if (manual_spacer == null) {
                        if (el_float === "left" || el_float === "right") {
                            elm.insertAfter(spacer);
                        }
                        spacer.remove();
                    }
                    return elm.removeClass(sticky_class);
                }
            };
            win.on("touchmove", tick);
            win.on("scroll", tick);
            win.on("resize", recalc_and_tick);
            $(document.body).on("sticky_kit:recalc", recalc_and_tick);
            elm.on("sticky_kit:detach", detach);
            return setTimeout(tick, 0);
        };
        for (i = 0, len = this.length; i < len; i++) {
            elm = this[i];
            fn($(elm));
        }
        return this;
    };

}).call(this);
/* ===========================================================
 * jquery-simple-text-rotator.js v1
 * ===========================================================
 * Copyright 2013 Pete Rojwongsuriya.
 * http://www.thepetedesign.com
 *
 * A very simple and light weight jQuery plugin that
 * allows you to rotate multiple text without changing
 * the layout
 * https://github.com/peachananr/simple-text-rotator
 *
 * ========================================================== */

!function($){

    var defaults = {
        animation: "dissolve",
        separator: ",",
        speed: 2000
    };

    $.fx.step.textShadowBlur = function(fx) {
        $(fx.elem).prop('textShadowBlur', fx.now).css({textShadow: '0 0 ' + Math.floor(fx.now) + 'px black'});
    };

    $.fn.textrotator = function(options){
        var settings = $.extend({}, defaults, options);

        return this.each(function(){
            var el = $(this);
            var array = [];
            $.each(el.text().split(settings.separator), function(key, value) {
                array.push(value);
            });
            el.text(array[0]);

            // animation option
            var rotate = function() {
                switch (settings.animation) {
                    case 'dissolve':
                        el.animate({
                            textShadowBlur:20,
                            opacity: 0
                        }, 500 , function() {
                            index = $.inArray(el.text(), array);
                            if((index + 1) == array.length) index = -1;
                            el.text(array[index + 1]).animate({
                                textShadowBlur:0,
                                opacity: 1
                            }, 500 );
                        });
                        break;

                    case 'flip':
                        if(el.find(".back").length > 0) {
                            el.html(el.find(".back").html());
                        }

                        var initial = el.text();
                        var index = $.inArray(initial, array);
                        if((index + 1) == array.length) index = -1;

                        el.html("");
                        $("<span class='front'>" + initial + "</span>").appendTo(el);
                        $("<span class='back'>" + array[index + 1] + "</span>").appendTo(el);

                        var mwidth = Math.max(el.find('.back').outerWidth(), el.find('.front').outerWidth());
                        el.find('.back, .front').css('min-width', mwidth);

                        el.wrapInner("<span class='rotating' />").find(".rotating").hide().addClass("flip").show().css({
                            "-webkit-transform": " rotateY(-180deg)",
                            "-moz-transform": " rotateY(-180deg)",
                            "-o-transform": " rotateY(-180deg)",
                            "transform": " rotateY(-180deg)"
                        });

                        break;

                    case 'flipUp':
                        if(el.find(".back").length > 0) {
                            el.html(el.find(".back").html());
                        }

                        var initial = el.text();
                        var index = $.inArray(initial, array);
                        if((index + 1) == array.length) index = -1;

                        el.html("");
                        $("<span class='front'>" + initial + "</span>").appendTo(el);
                        $("<span class='back'>" + array[index + 1] + "</span>").appendTo(el);

                        var mwidth = Math.max(el.find('.back').outerWidth(), el.find('.front').outerWidth());
                        el.find('.back, .front').css('min-width', mwidth);

                        el.wrapInner("<span class='rotating' />").find(".rotating").hide().addClass("flip up").show().css({
                            "-webkit-transform": " rotateX(-180deg)",
                            "-moz-transform": " rotateX(-180deg)",
                            "-o-transform": " rotateX(-180deg)",
                            "transform": " rotateX(-180deg)"
                        });

                        break;

                    case 'flipCube':
                        if(el.find(".back").length > 0) {
                            el.html(el.find(".back").html());
                        }

                        var initial = el.text();
                        var index = $.inArray(initial, array);
                        if((index + 1) == array.length) index = -1;

                        el.html("");
                        $("<span class='front'>" + initial + "</span>").appendTo(el);
                        $("<span class='back'>" + array[index + 1] + "</span>").appendTo(el);

                        var mwidth = Math.max(el.find('.back').outerWidth(), el.find('.front').outerWidth());
                        el.find('.back, .front').css('min-width', mwidth);

                        el.wrapInner("<span class='rotating' />").find(".rotating").hide().addClass("flip cube").show().css({
                            "-webkit-transform": " rotateY(180deg)",
                            "-moz-transform": " rotateY(180deg)",
                            "-o-transform": " rotateY(180deg)",
                            "transform": " rotateY(180deg)"
                        });

                        break;

                    case 'flipCubeUp':
                        if(el.find(".back").length > 0) {
                            el.html(el.find(".back").html());
                        }

                        var initial = el.text();
                        var index = $.inArray(initial, array);
                        if((index + 1) == array.length) index = -1;

                        el.html("");
                        $("<span class='front'>" + initial + "</span>").appendTo(el);
                        $("<span class='back'>" + array[index + 1] + "</span>").appendTo(el);

                        var mwidth = Math.max(el.find('.back').outerWidth(), el.find('.front').outerWidth());
                        el.find('.back, .front').css('min-width', mwidth);

                        el.wrapInner("<span class='rotating' />").find(".rotating").hide().addClass("flip cube up").show().css({
                            "-webkit-transform": " rotateX(180deg)",
                            "-moz-transform": " rotateX(180deg)",
                            "-o-transform": " rotateX(180deg)",
                            "transform": " rotateX(180deg)"
                        });

                        break;

                    case 'spin':
                        if(el.find(".rotating").length > 0) {
                            el.html(el.find(".rotating").html());
                        }
                        index = $.inArray(el.text(), array);
                        if((index + 1) == array.length) index = -1;

                        el.wrapInner("<span class='rotating spin' />").find(".rotating").hide().text(array[index + 1]).show().css({
                            "-webkit-transform": " rotate(0) scale(1)",
                            "-moz-transform": "rotate(0) scale(1)",
                            "-o-transform": "rotate(0) scale(1)",
                            "transform": "rotate(0) scale(1)"
                        });
                        break;

                    case 'fade':
                        el.fadeOut(settings.speed, function() {
                            index = $.inArray(el.text(), array);
                            if((index + 1) == array.length) index = -1;
                            el.text(array[index + 1]).fadeIn(settings.speed);
                        });
                        break;
                }

                // if (el.find('.back, .front').length) {
                //     var mwidth = Math.max(el.find('.back').outerWidth(), el.find('.front').outerWidth());
                //     el.find('.back, .front').css('min-width', mwidth);
                // }
            };
            setInterval(rotate, settings.speed);
        });
    };

}(window.jQuery);


/* Web Font Loader v1.6.28 - (c) Adobe Systems, Google. License: Apache 2.0 */(function(){function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function p(a,b,c){p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return p.apply(null,arguments)}var q=Date.now||function(){return+new Date};function ca(a,b){this.a=a;this.o=b||a;this.c=this.o.document}var da=!!window.FontFace;function t(a,b,c,d){b=a.c.createElement(b);if(c)for(var e in c)c.hasOwnProperty(e)&&("style"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));d&&b.appendChild(a.c.createTextNode(d));return b}function u(a,b,c){a=a.c.getElementsByTagName(b)[0];a||(a=document.documentElement);a.insertBefore(c,a.lastChild)}function v(a){a.parentNode&&a.parentNode.removeChild(a)}
    function w(a,b,c){b=b||[];c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}b=[];for(e=0;e<d.length;e+=1){f=!1;for(g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function y(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}
    function ea(a){return a.o.location.hostname||a.a.location.hostname}function z(a,b,c){function d(){m&&e&&f&&(m(g),m=null)}b=t(a,"link",{rel:"stylesheet",href:b,media:"all"});var e=!1,f=!0,g=null,m=c||null;da?(b.onload=function(){e=!0;d()},b.onerror=function(){e=!0;g=Error("Stylesheet failed to load");d()}):setTimeout(function(){e=!0;d()},0);u(a,"head",b)}
    function A(a,b,c,d){var e=a.c.getElementsByTagName("head")[0];if(e){var f=t(a,"script",{src:b}),g=!1;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))};e.appendChild(f);setTimeout(function(){g||(g=!0,c&&c(Error("Script load timeout")))},d||5E3);return f}return null};function B(){this.a=0;this.c=null}function C(a){a.a++;return function(){a.a--;D(a)}}function E(a,b){a.c=b;D(a)}function D(a){0==a.a&&a.c&&(a.c(),a.c=null)};function F(a){this.a=a||"-"}F.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.a)};function G(a,b){this.c=a;this.f=4;this.a="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.a=c[1],this.f=parseInt(c[2],10))}function fa(a){return H(a)+" "+(a.f+"00")+" 300px "+I(a.c)}function I(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");-1!=d.indexOf(" ")||/^\d/.test(d)?b.push("'"+d+"'"):b.push(d)}return b.join(",")}function J(a){return a.a+a.f}function H(a){var b="normal";"o"===a.a?b="oblique":"i"===a.a&&(b="italic");return b}
    function ga(a){var b=4,c="n",d=null;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b};function ha(a,b){this.c=a;this.f=a.o.document.documentElement;this.h=b;this.a=new F("-");this.j=!1!==b.events;this.g=!1!==b.classes}function ia(a){a.g&&w(a.f,[a.a.c("wf","loading")]);K(a,"loading")}function L(a){if(a.g){var b=y(a.f,a.a.c("wf","active")),c=[],d=[a.a.c("wf","loading")];b||c.push(a.a.c("wf","inactive"));w(a.f,c,d)}K(a,"inactive")}function K(a,b,c){if(a.j&&a.h[b])if(c)a.h[b](c.c,J(c));else a.h[b]()};function ja(){this.c={}}function ka(a,b,c){var d=[],e;for(e in b)if(b.hasOwnProperty(e)){var f=a.c[e];f&&d.push(f(b[e],c))}return d};function M(a,b){this.c=a;this.f=b;this.a=t(this.c,"span",{"aria-hidden":"true"},this.f)}function N(a){u(a.c,"body",a.a)}function O(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+I(a.c)+";"+("font-style:"+H(a)+";font-weight:"+(a.f+"00")+";")};function P(a,b,c,d,e,f){this.g=a;this.j=b;this.a=d;this.c=c;this.f=e||3E3;this.h=f||void 0}P.prototype.start=function(){var a=this.c.o.document,b=this,c=q(),d=new Promise(function(d,e){function f(){q()-c>=b.f?e():a.fonts.load(fa(b.a),b.h).then(function(a){1<=a.length?d():setTimeout(f,25)},function(){e()})}f()}),e=null,f=new Promise(function(a,d){e=setTimeout(d,b.f)});Promise.race([f,d]).then(function(){e&&(clearTimeout(e),e=null);b.g(b.a)},function(){b.j(b.a)})};function Q(a,b,c,d,e,f,g){this.v=a;this.B=b;this.c=c;this.a=d;this.s=g||"BESbswy";this.f={};this.w=e||3E3;this.u=f||null;this.m=this.j=this.h=this.g=null;this.g=new M(this.c,this.s);this.h=new M(this.c,this.s);this.j=new M(this.c,this.s);this.m=new M(this.c,this.s);a=new G(this.a.c+",serif",J(this.a));a=O(a);this.g.a.style.cssText=a;a=new G(this.a.c+",sans-serif",J(this.a));a=O(a);this.h.a.style.cssText=a;a=new G("serif",J(this.a));a=O(a);this.j.a.style.cssText=a;a=new G("sans-serif",J(this.a));a=
        O(a);this.m.a.style.cssText=a;N(this.g);N(this.h);N(this.j);N(this.m)}var R={D:"serif",C:"sans-serif"},S=null;function T(){if(null===S){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);S=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return S}Q.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.m.a.offsetWidth;this.A=q();U(this)};
    function la(a,b,c){for(var d in R)if(R.hasOwnProperty(d)&&b===a.f[R[d]]&&c===a.f[R[d]])return!0;return!1}function U(a){var b=a.g.a.offsetWidth,c=a.h.a.offsetWidth,d;(d=b===a.f.serif&&c===a.f["sans-serif"])||(d=T()&&la(a,b,c));d?q()-a.A>=a.w?T()&&la(a,b,c)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?V(a,a.v):V(a,a.B):ma(a):V(a,a.v)}function ma(a){setTimeout(p(function(){U(this)},a),50)}function V(a,b){setTimeout(p(function(){v(this.g.a);v(this.h.a);v(this.j.a);v(this.m.a);b(this.a)},a),0)};function W(a,b,c){this.c=a;this.a=b;this.f=0;this.m=this.j=!1;this.s=c}var X=null;W.prototype.g=function(a){var b=this.a;b.g&&w(b.f,[b.a.c("wf",a.c,J(a).toString(),"active")],[b.a.c("wf",a.c,J(a).toString(),"loading"),b.a.c("wf",a.c,J(a).toString(),"inactive")]);K(b,"fontactive",a);this.m=!0;na(this)};
    W.prototype.h=function(a){var b=this.a;if(b.g){var c=y(b.f,b.a.c("wf",a.c,J(a).toString(),"active")),d=[],e=[b.a.c("wf",a.c,J(a).toString(),"loading")];c||d.push(b.a.c("wf",a.c,J(a).toString(),"inactive"));w(b.f,d,e)}K(b,"fontinactive",a);na(this)};function na(a){0==--a.f&&a.j&&(a.m?(a=a.a,a.g&&w(a.f,[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),K(a,"active")):L(a.a))};function oa(a){this.j=a;this.a=new ja;this.h=0;this.f=this.g=!0}oa.prototype.load=function(a){this.c=new ca(this.j,a.context||this.j);this.g=!1!==a.events;this.f=!1!==a.classes;pa(this,new ha(this.c,a),a)};
    function qa(a,b,c,d,e){var f=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=e||null,m=d||null||{};if(0===c.length&&f)L(b.a);else{b.f+=c.length;f&&(b.j=f);var h,l=[];for(h=0;h<c.length;h++){var k=c[h],n=m[k.c],r=b.a,x=k;r.g&&w(r.f,[r.a.c("wf",x.c,J(x).toString(),"loading")]);K(r,"fontloading",x);r=null;if(null===X)if(window.FontFace){var x=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),xa=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);
        X=x?42<parseInt(x[1],10):xa?!1:!0}else X=!1;X?r=new P(p(b.g,b),p(b.h,b),b.c,k,b.s,n):r=new Q(p(b.g,b),p(b.h,b),b.c,k,b.s,a,n);l.push(r)}for(h=0;h<l.length;h++)l[h].start()}},0)}function pa(a,b,c){var d=[],e=c.timeout;ia(b);var d=ka(a.a,c,a.c),f=new W(a.c,b,e);a.h=d.length;b=0;for(c=d.length;b<c;b++)d[b].load(function(b,d,c){qa(a,f,b,d,c)})};function ra(a,b){this.c=a;this.a=b}
    ra.prototype.load=function(a){function b(){if(f["__mti_fntLst"+d]){var c=f["__mti_fntLst"+d](),e=[],h;if(c)for(var l=0;l<c.length;l++){var k=c[l].fontfamily;void 0!=c[l].fontStyle&&void 0!=c[l].fontWeight?(h=c[l].fontStyle+c[l].fontWeight,e.push(new G(k,h))):e.push(new G(k))}a(e)}else setTimeout(function(){b()},50)}var c=this,d=c.a.projectId,e=c.a.version;if(d){var f=c.c.o;A(this.c,(c.a.api||"https://fast.fonts.net/jsapi")+"/"+d+".js"+(e?"?v="+e:""),function(e){e?a([]):(f["__MonotypeConfiguration__"+
    d]=function(){return c.a},b())}).id="__MonotypeAPIScript__"+d}else a([])};function sa(a,b){this.c=a;this.a=b}sa.prototype.load=function(a){var b,c,d=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new B;b=0;for(c=d.length;b<c;b++)z(this.c,d[b],C(g));var m=[];b=0;for(c=e.length;b<c;b++)if(d=e[b].split(":"),d[1])for(var h=d[1].split(","),l=0;l<h.length;l+=1)m.push(new G(d[0],h[l]));else m.push(new G(d[0]));E(g,function(){a(m,f)})};function ta(a,b){a?this.c=a:this.c=ua;this.a=[];this.f=[];this.g=b||""}var ua="https://fonts.googleapis.com/css";function va(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":");a.a.push(e.join(f))}}
    function wa(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++)c.push(a.a[d].replace(/ /g,"+"));b=a.c+"?family="+c.join("%7C");0<a.f.length&&(b+="&subset="+a.f.join(","));0<a.g.length&&(b+="&text="+encodeURIComponent(a.g));return b};function ya(a){this.f=a;this.a=[];this.c={}}
    var za={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Aa={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ba={i:"i",italic:"i",n:"n",normal:"n"},
        Ca=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
    function Da(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(":"),e=d[0].replace(/\+/g," "),f=["n4"];if(2<=d.length){var g;var m=d[1];g=[];if(m)for(var m=m.split(","),h=m.length,l=0;l<h;l++){var k;k=m[l];if(k.match(/^[\w-]+$/)){var n=Ca.exec(k.toLowerCase());if(null==n)k="";else{k=n[2];k=null==k||""==k?"n":Ba[k];n=n[1];if(null==n||""==n)n="4";else var r=Aa[n],n=r?r:isNaN(n)?"4":n.substr(0,1);k=[k,n].join("")}}else k="";k&&g.push(k)}0<g.length&&(f=g);3==d.length&&(d=d[2],g=[],d=d?d.split(","):
        g,0<d.length&&(d=za[d[0]])&&(a.c[e]=d))}a.c[e]||(d=za[e])&&(a.c[e]=d);for(d=0;d<f.length;d+=1)a.a.push(new G(e,f[d]))}};function Ea(a,b){this.c=a;this.a=b}var Fa={Arimo:!0,Cousine:!0,Tinos:!0};Ea.prototype.load=function(a){var b=new B,c=this.c,d=new ta(this.a.api,this.a.text),e=this.a.families;va(d,e);var f=new ya(e);Da(f);z(c,wa(d),C(b));E(b,function(){a(f.a,f.c,Fa)})};function Ga(a,b){this.c=a;this.a=b}Ga.prototype.load=function(a){var b=this.a.id,c=this.c.o;b?A(this.c,(this.a.api||"https://use.typekit.net")+"/"+b+".js",function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var e=[],f=0;f<b.length;f+=2)for(var g=b[f],m=b[f+1],h=0;h<m.length;h++)e.push(new G(g,m[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(l){}a(e)}},2E3):a([])};function Ha(a,b){this.c=a;this.f=b;this.a=[]}Ha.prototype.load=function(a){var b=this.f.id,c=this.c.o,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var g=0,m=c.fonts.length;g<m;++g){var h=c.fonts[g];d.a.push(new G(h.name,ga("font-weight:"+h.weight+";font-style:"+h.style)))}a(d.a)},A(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+ea(this.c)+"/"+b+".js",function(b){b&&a([])})):a([])};var Y=new oa(window);Y.a.c.custom=function(a,b){return new sa(b,a)};Y.a.c.fontdeck=function(a,b){return new Ha(b,a)};Y.a.c.monotype=function(a,b){return new ra(b,a)};Y.a.c.typekit=function(a,b){return new Ga(b,a)};Y.a.c.google=function(a,b){return new Ea(b,a)};var Z={load:p(Y.load,Y)};"function"===typeof define&&define.amd?define(function(){return Z}):"undefined"!==typeof module&&module.exports?module.exports=Z:(window.WebFont=Z,window.WebFontConfig&&Y.load(window.WebFontConfig));}());
(function() {
    var MutationObserver, Util, WeakMap, getComputedStyle, getComputedStyleRX,
        __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
        __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

    Util = (function() {
        function Util() {}

        Util.prototype.extend = function(custom, defaults) {
            var key, value;
            for (key in defaults) {
                value = defaults[key];
                if (custom[key] == null) {
                    custom[key] = value;
                }
            }
            return custom;
        };

        Util.prototype.isMobile = function(agent) {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(agent);
        };

        Util.prototype.addEvent = function(elem, event, fn) {
            if (elem.addEventListener != null) {
                return elem.addEventListener(event, fn, false);
            } else if (elem.attachEvent != null) {
                return elem.attachEvent("on" + event, fn);
            } else {
                return elem[event] = fn;
            }
        };

        Util.prototype.removeEvent = function(elem, event, fn) {
            if (elem.removeEventListener != null) {
                return elem.removeEventListener(event, fn, false);
            } else if (elem.detachEvent != null) {
                return elem.detachEvent("on" + event, fn);
            } else {
                return delete elem[event];
            }
        };

        Util.prototype.innerHeight = function() {
            if ('innerHeight' in window) {
                return window.innerHeight;
            } else {
                return document.documentElement.clientHeight;
            }
        };

        return Util;

    })();

    WeakMap = this.WeakMap || this.MozWeakMap || (WeakMap = (function() {
            function WeakMap() {
                this.keys = [];
                this.values = [];
            }

            WeakMap.prototype.get = function(key) {
                var i, item, _i, _len, _ref;
                _ref = this.keys;
                for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
                    item = _ref[i];
                    if (item === key) {
                        return this.values[i];
                    }
                }
            };

            WeakMap.prototype.set = function(key, value) {
                var i, item, _i, _len, _ref;
                _ref = this.keys;
                for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
                    item = _ref[i];
                    if (item === key) {
                        this.values[i] = value;
                        return;
                    }
                }
                this.keys.push(key);
                return this.values.push(value);
            };

            return WeakMap;

        })());

    MutationObserver = this.MutationObserver || this.WebkitMutationObserver || this.MozMutationObserver || (MutationObserver = (function() {
            function MutationObserver() {
                if (typeof console !== "undefined" && console !== null) {
                    console.warn('MutationObserver is not supported by your browser.');
                }
                if (typeof console !== "undefined" && console !== null) {
                    console.warn('WOW.js cannot detect dom mutations, please call .sync() after loading new content.');
                }
            }

            MutationObserver.notSupported = true;

            MutationObserver.prototype.observe = function() {};

            return MutationObserver;

        })());

    getComputedStyle = this.getComputedStyle || function(el, pseudo) {
            this.getPropertyValue = function(prop) {
                var _ref;
                if (prop === 'float') {
                    prop = 'styleFloat';
                }
                if (getComputedStyleRX.test(prop)) {
                    prop.replace(getComputedStyleRX, function(_, _char) {
                        return _char.toUpperCase();
                    });
                }
                return ((_ref = el.currentStyle) != null ? _ref[prop] : void 0) || null;
            };
            return this;
        };

    getComputedStyleRX = /(\-([a-z]){1})/g;

    this.WOW = (function() {
        WOW.prototype.defaults = {
            boxClass: 'wow',
            animateClass: 'animated',
            offset: 0,
            mobile: true,
            live: true,
            callback: null
        };

        function WOW(options) {
            if (options == null) {
                options = {};
            }
            this.scrollCallback = __bind(this.scrollCallback, this);
            this.scrollHandler = __bind(this.scrollHandler, this);
            this.start = __bind(this.start, this);
            this.scrolled = true;
            this.config = this.util().extend(options, this.defaults);
            this.animationNameCache = new WeakMap();
        }

        WOW.prototype.init = function() {
            var _ref;
            this.element = window.document.documentElement;
            if ((_ref = document.readyState) === "interactive" || _ref === "complete") {
                this.start();
            } else {
                this.util().addEvent(document, 'DOMContentLoaded', this.start);
            }
            return this.finished = [];
        };

        WOW.prototype.start = function() {
            var box, _i, _len, _ref;
            this.stopped = false;
            this.boxes = (function() {
                var _i, _len, _ref, _results;
                _ref = this.element.querySelectorAll("." + this.config.boxClass);
                _results = [];
                for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                    box = _ref[_i];
                    _results.push(box);
                }
                return _results;
            }).call(this);
            this.all = (function() {
                var _i, _len, _ref, _results;
                _ref = this.boxes;
                _results = [];
                for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                    box = _ref[_i];
                    _results.push(box);
                }
                return _results;
            }).call(this);
            if (this.boxes.length) {
                if (this.disabled()) {
                    this.resetStyle();
                } else {
                    _ref = this.boxes;
                    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                        box = _ref[_i];
                        this.applyStyle(box, true);
                    }
                }
            }
            if (!this.disabled()) {
                this.util().addEvent(window, 'scroll', this.scrollHandler);
                this.util().addEvent(window, 'resize', this.scrollHandler);
                this.interval = setInterval(this.scrollCallback, 50);
            }
            if (this.config.live) {
                return new MutationObserver((function(_this) {
                    return function(records) {
                        var node, record, _j, _len1, _results;
                        _results = [];
                        for (_j = 0, _len1 = records.length; _j < _len1; _j++) {
                            record = records[_j];
                            _results.push((function() {
                                var _k, _len2, _ref1, _results1;
                                _ref1 = record.addedNodes || [];
                                _results1 = [];
                                for (_k = 0, _len2 = _ref1.length; _k < _len2; _k++) {
                                    node = _ref1[_k];
                                    _results1.push(this.doSync(node));
                                }
                                return _results1;
                            }).call(_this));
                        }
                        return _results;
                    };
                })(this)).observe(document.body, {
                    childList: true,
                    subtree: true
                });
            }
        };

        WOW.prototype.stop = function() {
            this.stopped = true;
            this.util().removeEvent(window, 'scroll', this.scrollHandler);
            this.util().removeEvent(window, 'resize', this.scrollHandler);
            if (this.interval != null) {
                return clearInterval(this.interval);
            }
        };

        WOW.prototype.sync = function(element) {
            if (MutationObserver.notSupported) {
                return this.doSync(this.element);
            }
        };

        WOW.prototype.doSync = function(element) {
            var box, _i, _len, _ref, _results;
            if (element == null) {
                element = this.element;
            }
            if (element.nodeType !== 1) {
                return;
            }
            element = element.parentNode || element;
            _ref = element.querySelectorAll("." + this.config.boxClass);
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                box = _ref[_i];
                if (__indexOf.call(this.all, box) < 0) {
                    this.boxes.push(box);
                    this.all.push(box);
                    if (this.stopped || this.disabled()) {
                        this.resetStyle();
                    } else {
                        this.applyStyle(box, true);
                    }
                    _results.push(this.scrolled = true);
                } else {
                    _results.push(void 0);
                }
            }
            return _results;
        };

        WOW.prototype.show = function(box) {
            this.applyStyle(box);
            box.className = "" + box.className + " " + this.config.animateClass;
            if (this.config.callback != null) {
                return this.config.callback(box);
            }
        };

        WOW.prototype.applyStyle = function(box, hidden) {
            var delay, duration, iteration;
            duration = box.getAttribute('data-wow-duration');
            delay = box.getAttribute('data-wow-delay');
            iteration = box.getAttribute('data-wow-iteration');
            return this.animate((function(_this) {
                return function() {
                    return _this.customStyle(box, hidden, duration, delay, iteration);
                };
            })(this));
        };

        WOW.prototype.animate = (function() {
            if ('requestAnimationFrame' in window) {
                return function(callback) {
                    return window.requestAnimationFrame(callback);
                };
            } else {
                return function(callback) {
                    return callback();
                };
            }
        })();

        WOW.prototype.resetStyle = function() {
            var box, _i, _len, _ref, _results;
            _ref = this.boxes;
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                box = _ref[_i];
                _results.push(box.style.visibility = 'visible');
            }
            return _results;
        };

        WOW.prototype.customStyle = function(box, hidden, duration, delay, iteration) {
            if (hidden) {
                this.cacheAnimationName(box);
            }
            box.style.visibility = hidden ? 'hidden' : 'visible';
            if (duration) {
                this.vendorSet(box.style, {
                    animationDuration: duration
                });
            }
            if (delay) {
                this.vendorSet(box.style, {
                    animationDelay: delay
                });
            }
            if (iteration) {
                this.vendorSet(box.style, {
                    animationIterationCount: iteration
                });
            }
            this.vendorSet(box.style, {
                animationName: hidden ? 'none' : this.cachedAnimationName(box)
            });
            return box;
        };

        WOW.prototype.vendors = ["moz", "webkit"];

        WOW.prototype.vendorSet = function(elem, properties) {
            var name, value, vendor, _results;
            _results = [];
            for (name in properties) {
                value = properties[name];
                elem["" + name] = value;
                _results.push((function() {
                    var _i, _len, _ref, _results1;
                    _ref = this.vendors;
                    _results1 = [];
                    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                        vendor = _ref[_i];
                        _results1.push(elem["" + vendor + (name.charAt(0).toUpperCase()) + (name.substr(1))] = value);
                    }
                    return _results1;
                }).call(this));
            }
            return _results;
        };

        WOW.prototype.vendorCSS = function(elem, property) {
            var result, style, vendor, _i, _len, _ref;
            style = getComputedStyle(elem);
            result = style.getPropertyCSSValue(property);
            _ref = this.vendors;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                vendor = _ref[_i];
                result = result || style.getPropertyCSSValue("-" + vendor + "-" + property);
            }
            return result;
        };

        WOW.prototype.animationName = function(box) {
            var animationName;
            try {
                animationName = this.vendorCSS(box, 'animation-name').cssText;
            } catch (_error) {
                animationName = getComputedStyle(box).getPropertyValue('animation-name');
            }
            if (animationName === 'none') {
                return '';
            } else {
                return animationName;
            }
        };

        WOW.prototype.cacheAnimationName = function(box) {
            return this.animationNameCache.set(box, this.animationName(box));
        };

        WOW.prototype.cachedAnimationName = function(box) {
            return this.animationNameCache.get(box);
        };

        WOW.prototype.scrollHandler = function() {
            return this.scrolled = true;
        };

        WOW.prototype.scrollCallback = function() {
            var box;
            if (this.scrolled) {
                this.scrolled = false;
                this.boxes = (function() {
                    var _i, _len, _ref, _results;
                    _ref = this.boxes;
                    _results = [];
                    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                        box = _ref[_i];
                        if (!(box)) {
                            continue;
                        }
                        if (this.isVisible(box)) {
                            this.show(box);
                            continue;
                        }
                        _results.push(box);
                    }
                    return _results;
                }).call(this);
                if (!(this.boxes.length || this.config.live)) {
                    return this.stop();
                }
            }
        };

        WOW.prototype.offsetTop = function(element) {
            var top;
            while (element.offsetTop === void 0) {
                element = element.parentNode;
            }
            top = element.offsetTop;
            while (element = element.offsetParent) {
                top += element.offsetTop;
            }
            return top;
        };

        WOW.prototype.isVisible = function(box) {
            var bottom, offset, top, viewBottom, viewTop;
            offset = box.getAttribute('data-wow-offset') || this.config.offset;
            viewTop = window.pageYOffset;
            viewBottom = viewTop + Math.min(this.element.clientHeight, this.util().innerHeight()) - offset;
            top = this.offsetTop(box);
            bottom = top + box.clientHeight;
            return top <= viewBottom && bottom >= viewTop;
        };

        WOW.prototype.util = function() {
            return this._util != null ? this._util : this._util = new Util();
        };

        WOW.prototype.disabled = function() {
            return !this.config.mobile && this.util().isMobile(navigator.userAgent);
        };

        return WOW;

    })();

}).call(this);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZjbGljay1saWIuanMiLCJqYXJhbGxheC5qcyIsImpxdWVyeS5hamF4Q2hpbXAuanMiLCJqcXVlcnkuYXBwZWFyLmpzIiwianF1ZXJ5LmNpcmNsZS1wcm9ncmVzcy5qcyIsImpxdWVyeS5jb3VudGRvd24uanMiLCJqcXVlcnkuZWFzaW5ncy5qcyIsImpxdWVyeS5tYi5ZVFBsYXllci5qcyIsImpxdWVyeS5zd2lwZWJveC5qcyIsImpxdWVyeS50aHJvdHRsZS1kZWJvdW5jZS5qcyIsImpxdWVyeS50eXBlZC5qcyIsInB6dF9oZWxwZXJzLmpzIiwicmV0aW5hLmpzIiwic2h1ZmZsZS5qcyIsInNsaWNrLmpzIiwic3RpY2t5LWtpdC5qcyIsInRleHRyb3RhdG9yLmpzIiwid2ZfbG9hZGVyLmpzIiwid293LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeDBCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdHJCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hpQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDclBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaHBFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOTdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2piQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdnBEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzUwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFzc2V0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIjsoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8qKlxuICAgICAqIEBwcmVzZXJ2ZSBGYXN0Q2xpY2s6IHBvbHlmaWxsIHRvIHJlbW92ZSBjbGljayBkZWxheXMgb24gYnJvd3NlcnMgd2l0aCB0b3VjaCBVSXMuXG4gICAgICpcbiAgICAgKiBAY29kaW5nc3RhbmRhcmQgZnRsYWJzLWpzdjJcbiAgICAgKiBAY29weXJpZ2h0IFRoZSBGaW5hbmNpYWwgVGltZXMgTGltaXRlZCBbQWxsIFJpZ2h0cyBSZXNlcnZlZF1cbiAgICAgKiBAbGljZW5zZSBNSVQgTGljZW5zZSAoc2VlIExJQ0VOU0UudHh0KVxuICAgICAqL1xuXG4gICAgLypqc2xpbnQgYnJvd3Nlcjp0cnVlLCBub2RlOnRydWUqL1xuICAgIC8qZ2xvYmFsIGRlZmluZSwgRXZlbnQsIE5vZGUqL1xuXG5cbiAgICAvKipcbiAgICAgKiBJbnN0YW50aWF0ZSBmYXN0LWNsaWNraW5nIGxpc3RlbmVycyBvbiB0aGUgc3BlY2lmaWVkIGxheWVyLlxuICAgICAqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtFbGVtZW50fSBsYXllciBUaGUgbGF5ZXIgdG8gbGlzdGVuIG9uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBUaGUgb3B0aW9ucyB0byBvdmVycmlkZSB0aGUgZGVmYXVsdHNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBGYXN0Q2xpY2sobGF5ZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG9sZE9uQ2xpY2s7XG5cbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgYSBjbGljayBpcyBjdXJyZW50bHkgYmVpbmcgdHJhY2tlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUgYm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50cmFja2luZ0NsaWNrID0gZmFsc2U7XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGltZXN0YW1wIGZvciB3aGVuIGNsaWNrIHRyYWNraW5nIHN0YXJ0ZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIG51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50cmFja2luZ0NsaWNrU3RhcnQgPSAwO1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBlbGVtZW50IGJlaW5nIHRyYWNrZWQgZm9yIGEgY2xpY2suXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIEV2ZW50VGFyZ2V0XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRhcmdldEVsZW1lbnQgPSBudWxsO1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFgtY29vcmRpbmF0ZSBvZiB0b3VjaCBzdGFydCBldmVudC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUgbnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRvdWNoU3RhcnRYID0gMDtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBZLWNvb3JkaW5hdGUgb2YgdG91Y2ggc3RhcnQgZXZlbnQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIG51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b3VjaFN0YXJ0WSA9IDA7XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogSUQgb2YgdGhlIGxhc3QgdG91Y2gsIHJldHJpZXZlZCBmcm9tIFRvdWNoLmlkZW50aWZpZXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIG51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sYXN0VG91Y2hJZGVudGlmaWVyID0gMDtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUb3VjaG1vdmUgYm91bmRhcnksIGJleW9uZCB3aGljaCBhIGNsaWNrIHdpbGwgYmUgY2FuY2VsbGVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSBudW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG91Y2hCb3VuZGFyeSA9IG9wdGlvbnMudG91Y2hCb3VuZGFyeSB8fCAxMDtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgRmFzdENsaWNrIGxheWVyLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSBFbGVtZW50XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxheWVyID0gbGF5ZXI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtaW5pbXVtIHRpbWUgYmV0d2VlbiB0YXAodG91Y2hzdGFydCBhbmQgdG91Y2hlbmQpIGV2ZW50c1xuICAgICAgICAgKlxuICAgICAgICAgKiBAdHlwZSBudW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudGFwRGVsYXkgPSBvcHRpb25zLnRhcERlbGF5IHx8IDIwMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG1heGltdW0gdGltZSBmb3IgYSB0YXBcbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUgbnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRhcFRpbWVvdXQgPSBvcHRpb25zLnRhcFRpbWVvdXQgfHwgNzAwO1xuXG4gICAgICAgIGlmIChGYXN0Q2xpY2subm90TmVlZGVkKGxheWVyKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU29tZSBvbGQgdmVyc2lvbnMgb2YgQW5kcm9pZCBkb24ndCBoYXZlIEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kXG4gICAgICAgIGZ1bmN0aW9uIGJpbmQobWV0aG9kLCBjb250ZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiBtZXRob2QuYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTsgfTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgdmFyIG1ldGhvZHMgPSBbJ29uTW91c2UnLCAnb25DbGljaycsICdvblRvdWNoU3RhcnQnLCAnb25Ub3VjaE1vdmUnLCAnb25Ub3VjaEVuZCcsICdvblRvdWNoQ2FuY2VsJ107XG4gICAgICAgIHZhciBjb250ZXh0ID0gdGhpcztcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBtZXRob2RzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgY29udGV4dFttZXRob2RzW2ldXSA9IGJpbmQoY29udGV4dFttZXRob2RzW2ldXSwgY29udGV4dCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTZXQgdXAgZXZlbnQgaGFuZGxlcnMgYXMgcmVxdWlyZWRcbiAgICAgICAgaWYgKGRldmljZUlzQW5kcm9pZCkge1xuICAgICAgICAgICAgbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgdGhpcy5vbk1vdXNlLCB0cnVlKTtcbiAgICAgICAgICAgIGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMub25Nb3VzZSwgdHJ1ZSk7XG4gICAgICAgICAgICBsYXllci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5vbk1vdXNlLCB0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsaWNrLCB0cnVlKTtcbiAgICAgICAgbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25Ub3VjaFN0YXJ0LCBmYWxzZSk7XG4gICAgICAgIGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMub25Ub3VjaE1vdmUsIGZhbHNlKTtcbiAgICAgICAgbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm9uVG91Y2hFbmQsIGZhbHNlKTtcbiAgICAgICAgbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCB0aGlzLm9uVG91Y2hDYW5jZWwsIGZhbHNlKTtcblxuICAgICAgICAvLyBIYWNrIGlzIHJlcXVpcmVkIGZvciBicm93c2VycyB0aGF0IGRvbid0IHN1cHBvcnQgRXZlbnQjc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIChlLmcuIEFuZHJvaWQgMilcbiAgICAgICAgLy8gd2hpY2ggaXMgaG93IEZhc3RDbGljayBub3JtYWxseSBzdG9wcyBjbGljayBldmVudHMgYnViYmxpbmcgdG8gY2FsbGJhY2tzIHJlZ2lzdGVyZWQgb24gdGhlIEZhc3RDbGlja1xuICAgICAgICAvLyBsYXllciB3aGVuIHRoZXkgYXJlIGNhbmNlbGxlZC5cbiAgICAgICAgaWYgKCFFdmVudC5wcm90b3R5cGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKSB7XG4gICAgICAgICAgICBsYXllci5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgY2FsbGJhY2ssIGNhcHR1cmUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcm12ID0gTm9kZS5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lcjtcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2NsaWNrJykge1xuICAgICAgICAgICAgICAgICAgICBybXYuY2FsbChsYXllciwgdHlwZSwgY2FsbGJhY2suaGlqYWNrZWQgfHwgY2FsbGJhY2ssIGNhcHR1cmUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJtdi5jYWxsKGxheWVyLCB0eXBlLCBjYWxsYmFjaywgY2FwdHVyZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKHR5cGUsIGNhbGxiYWNrLCBjYXB0dXJlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFkdiA9IE5vZGUucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXI7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdjbGljaycpIHtcbiAgICAgICAgICAgICAgICAgICAgYWR2LmNhbGwobGF5ZXIsIHR5cGUsIGNhbGxiYWNrLmhpamFja2VkIHx8IChjYWxsYmFjay5oaWphY2tlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFldmVudC5wcm9wYWdhdGlvblN0b3BwZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBjYXB0dXJlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhZHYuY2FsbChsYXllciwgdHlwZSwgY2FsbGJhY2ssIGNhcHR1cmUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBhIGhhbmRsZXIgaXMgYWxyZWFkeSBkZWNsYXJlZCBpbiB0aGUgZWxlbWVudCdzIG9uY2xpY2sgYXR0cmlidXRlLCBpdCB3aWxsIGJlIGZpcmVkIGJlZm9yZVxuICAgICAgICAvLyBGYXN0Q2xpY2sncyBvbkNsaWNrIGhhbmRsZXIuIEZpeCB0aGlzIGJ5IHB1bGxpbmcgb3V0IHRoZSB1c2VyLWRlZmluZWQgaGFuZGxlciBmdW5jdGlvbiBhbmRcbiAgICAgICAgLy8gYWRkaW5nIGl0IGFzIGxpc3RlbmVyLlxuICAgICAgICBpZiAodHlwZW9mIGxheWVyLm9uY2xpY2sgPT09ICdmdW5jdGlvbicpIHtcblxuICAgICAgICAgICAgLy8gQW5kcm9pZCBicm93c2VyIG9uIGF0IGxlYXN0IDMuMiByZXF1aXJlcyBhIG5ldyByZWZlcmVuY2UgdG8gdGhlIGZ1bmN0aW9uIGluIGxheWVyLm9uY2xpY2tcbiAgICAgICAgICAgIC8vIC0gdGhlIG9sZCBvbmUgd29uJ3Qgd29yayBpZiBwYXNzZWQgdG8gYWRkRXZlbnRMaXN0ZW5lciBkaXJlY3RseS5cbiAgICAgICAgICAgIG9sZE9uQ2xpY2sgPSBsYXllci5vbmNsaWNrO1xuICAgICAgICAgICAgbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIG9sZE9uQ2xpY2soZXZlbnQpO1xuICAgICAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICAgICAgbGF5ZXIub25jbGljayA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXaW5kb3dzIFBob25lIDguMSBmYWtlcyB1c2VyIGFnZW50IHN0cmluZyB0byBsb29rIGxpa2UgQW5kcm9pZCBhbmQgaVBob25lLlxuICAgICAqXG4gICAgICogQHR5cGUgYm9vbGVhblxuICAgICAqL1xuICAgIHZhciBkZXZpY2VJc1dpbmRvd3NQaG9uZSA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIldpbmRvd3MgUGhvbmVcIikgPj0gMDtcblxuICAgIC8qKlxuICAgICAqIEFuZHJvaWQgcmVxdWlyZXMgZXhjZXB0aW9ucy5cbiAgICAgKlxuICAgICAqIEB0eXBlIGJvb2xlYW5cbiAgICAgKi9cbiAgICB2YXIgZGV2aWNlSXNBbmRyb2lkID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdBbmRyb2lkJykgPiAwICYmICFkZXZpY2VJc1dpbmRvd3NQaG9uZTtcblxuXG4gICAgLyoqXG4gICAgICogaU9TIHJlcXVpcmVzIGV4Y2VwdGlvbnMuXG4gICAgICpcbiAgICAgKiBAdHlwZSBib29sZWFuXG4gICAgICovXG4gICAgdmFyIGRldmljZUlzSU9TID0gL2lQKGFkfGhvbmV8b2QpLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpICYmICFkZXZpY2VJc1dpbmRvd3NQaG9uZTtcblxuXG4gICAgLyoqXG4gICAgICogaU9TIDQgcmVxdWlyZXMgYW4gZXhjZXB0aW9uIGZvciBzZWxlY3QgZWxlbWVudHMuXG4gICAgICpcbiAgICAgKiBAdHlwZSBib29sZWFuXG4gICAgICovXG4gICAgdmFyIGRldmljZUlzSU9TNCA9IGRldmljZUlzSU9TICYmICgvT1MgNF9cXGQoX1xcZCk/LykudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcblxuXG4gICAgLyoqXG4gICAgICogaU9TIDYuMC03LiogcmVxdWlyZXMgdGhlIHRhcmdldCBlbGVtZW50IHRvIGJlIG1hbnVhbGx5IGRlcml2ZWRcbiAgICAgKlxuICAgICAqIEB0eXBlIGJvb2xlYW5cbiAgICAgKi9cbiAgICB2YXIgZGV2aWNlSXNJT1NXaXRoQmFkVGFyZ2V0ID0gZGV2aWNlSXNJT1MgJiYgKC9PUyBbNi03XV9cXGQvKS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xuXG4gICAgLyoqXG4gICAgICogQmxhY2tCZXJyeSByZXF1aXJlcyBleGNlcHRpb25zLlxuICAgICAqXG4gICAgICogQHR5cGUgYm9vbGVhblxuICAgICAqL1xuICAgIHZhciBkZXZpY2VJc0JsYWNrQmVycnkxMCA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQkIxMCcpID4gMDtcblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSB3aGV0aGVyIGEgZ2l2ZW4gZWxlbWVudCByZXF1aXJlcyBhIG5hdGl2ZSBjbGljay5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8RWxlbWVudH0gdGFyZ2V0IFRhcmdldCBET00gZWxlbWVudFxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIHRydWUgaWYgdGhlIGVsZW1lbnQgbmVlZHMgYSBuYXRpdmUgY2xpY2tcbiAgICAgKi9cbiAgICBGYXN0Q2xpY2sucHJvdG90eXBlLm5lZWRzQ2xpY2sgPSBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgICAgc3dpdGNoICh0YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkge1xuXG4gICAgICAgICAgICAvLyBEb24ndCBzZW5kIGEgc3ludGhldGljIGNsaWNrIHRvIGRpc2FibGVkIGlucHV0cyAoaXNzdWUgIzYyKVxuICAgICAgICAgICAgY2FzZSAnYnV0dG9uJzpcbiAgICAgICAgICAgIGNhc2UgJ3NlbGVjdCc6XG4gICAgICAgICAgICBjYXNlICd0ZXh0YXJlYSc6XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2lucHV0JzpcblxuICAgICAgICAgICAgICAgIC8vIEZpbGUgaW5wdXRzIG5lZWQgcmVhbCBjbGlja3Mgb24gaU9TIDYgZHVlIHRvIGEgYnJvd3NlciBidWcgKGlzc3VlICM2OClcbiAgICAgICAgICAgICAgICBpZiAoKGRldmljZUlzSU9TICYmIHRhcmdldC50eXBlID09PSAnZmlsZScpIHx8IHRhcmdldC5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2xhYmVsJzpcbiAgICAgICAgICAgIGNhc2UgJ2lmcmFtZSc6IC8vIGlPUzggaG9tZXNjcmVlbiBhcHBzIGNhbiBwcmV2ZW50IGV2ZW50cyBidWJibGluZyBpbnRvIGZyYW1lc1xuICAgICAgICAgICAgY2FzZSAndmlkZW8nOlxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICgvXFxibmVlZHNjbGlja1xcYi8pLnRlc3QodGFyZ2V0LmNsYXNzTmFtZSk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIHdoZXRoZXIgYSBnaXZlbiBlbGVtZW50IHJlcXVpcmVzIGEgY2FsbCB0byBmb2N1cyB0byBzaW11bGF0ZSBjbGljayBpbnRvIGVsZW1lbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0V2ZW50VGFyZ2V0fEVsZW1lbnR9IHRhcmdldCBUYXJnZXQgRE9NIGVsZW1lbnRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBlbGVtZW50IHJlcXVpcmVzIGEgY2FsbCB0byBmb2N1cyB0byBzaW11bGF0ZSBuYXRpdmUgY2xpY2suXG4gICAgICovXG4gICAgRmFzdENsaWNrLnByb3RvdHlwZS5uZWVkc0ZvY3VzID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICAgIHN3aXRjaCAodGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgIGNhc2UgJ3RleHRhcmVhJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIGNhc2UgJ3NlbGVjdCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICFkZXZpY2VJc0FuZHJvaWQ7XG4gICAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0YXJnZXQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdidXR0b24nOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICdjaGVja2JveCc6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbGUnOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICdpbWFnZSc6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3VibWl0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBObyBwb2ludCBpbiBhdHRlbXB0aW5nIHRvIGZvY3VzIGRpc2FibGVkIGlucHV0c1xuICAgICAgICAgICAgICAgIHJldHVybiAhdGFyZ2V0LmRpc2FibGVkICYmICF0YXJnZXQucmVhZE9ubHk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiAoL1xcYm5lZWRzZm9jdXNcXGIvKS50ZXN0KHRhcmdldC5jbGFzc05hbWUpO1xuICAgICAgICB9XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogU2VuZCBhIGNsaWNrIGV2ZW50IHRvIHRoZSBzcGVjaWZpZWQgZWxlbWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8RWxlbWVudH0gdGFyZ2V0RWxlbWVudFxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50XG4gICAgICovXG4gICAgRmFzdENsaWNrLnByb3RvdHlwZS5zZW5kQ2xpY2sgPSBmdW5jdGlvbih0YXJnZXRFbGVtZW50LCBldmVudCkge1xuICAgICAgICB2YXIgY2xpY2tFdmVudCwgdG91Y2g7XG5cbiAgICAgICAgLy8gT24gc29tZSBBbmRyb2lkIGRldmljZXMgYWN0aXZlRWxlbWVudCBuZWVkcyB0byBiZSBibHVycmVkIG90aGVyd2lzZSB0aGUgc3ludGhldGljIGNsaWNrIHdpbGwgaGF2ZSBubyBlZmZlY3QgKCMyNClcbiAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAhPT0gdGFyZ2V0RWxlbWVudCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuXG4gICAgICAgIC8vIFN5bnRoZXNpc2UgYSBjbGljayBldmVudCwgd2l0aCBhbiBleHRyYSBhdHRyaWJ1dGUgc28gaXQgY2FuIGJlIHRyYWNrZWRcbiAgICAgICAgY2xpY2tFdmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpO1xuICAgICAgICBjbGlja0V2ZW50LmluaXRNb3VzZUV2ZW50KHRoaXMuZGV0ZXJtaW5lRXZlbnRUeXBlKHRhcmdldEVsZW1lbnQpLCB0cnVlLCB0cnVlLCB3aW5kb3csIDEsIHRvdWNoLnNjcmVlblgsIHRvdWNoLnNjcmVlblksIHRvdWNoLmNsaWVudFgsIHRvdWNoLmNsaWVudFksIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCBudWxsKTtcbiAgICAgICAgY2xpY2tFdmVudC5mb3J3YXJkZWRUb3VjaEV2ZW50ID0gdHJ1ZTtcbiAgICAgICAgdGFyZ2V0RWxlbWVudC5kaXNwYXRjaEV2ZW50KGNsaWNrRXZlbnQpO1xuICAgIH07XG5cbiAgICBGYXN0Q2xpY2sucHJvdG90eXBlLmRldGVybWluZUV2ZW50VHlwZSA9IGZ1bmN0aW9uKHRhcmdldEVsZW1lbnQpIHtcblxuICAgICAgICAvL0lzc3VlICMxNTk6IEFuZHJvaWQgQ2hyb21lIFNlbGVjdCBCb3ggZG9lcyBub3Qgb3BlbiB3aXRoIGEgc3ludGhldGljIGNsaWNrIGV2ZW50XG4gICAgICAgIGlmIChkZXZpY2VJc0FuZHJvaWQgJiYgdGFyZ2V0RWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZWxlY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gJ21vdXNlZG93bic7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJ2NsaWNrJztcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0V2ZW50VGFyZ2V0fEVsZW1lbnR9IHRhcmdldEVsZW1lbnRcbiAgICAgKi9cbiAgICBGYXN0Q2xpY2sucHJvdG90eXBlLmZvY3VzID0gZnVuY3Rpb24odGFyZ2V0RWxlbWVudCkge1xuICAgICAgICB2YXIgbGVuZ3RoO1xuXG4gICAgICAgIC8vIElzc3VlICMxNjA6IG9uIGlPUyA3LCBzb21lIGlucHV0IGVsZW1lbnRzIChlLmcuIGRhdGUgZGF0ZXRpbWUgbW9udGgpIHRocm93IGEgdmFndWUgVHlwZUVycm9yIG9uIHNldFNlbGVjdGlvblJhbmdlLiBUaGVzZSBlbGVtZW50cyBkb24ndCBoYXZlIGFuIGludGVnZXIgdmFsdWUgZm9yIHRoZSBzZWxlY3Rpb25TdGFydCBhbmQgc2VsZWN0aW9uRW5kIHByb3BlcnRpZXMsIGJ1dCB1bmZvcnR1bmF0ZWx5IHRoYXQgY2FuJ3QgYmUgdXNlZCBmb3IgZGV0ZWN0aW9uIGJlY2F1c2UgYWNjZXNzaW5nIHRoZSBwcm9wZXJ0aWVzIGFsc28gdGhyb3dzIGEgVHlwZUVycm9yLiBKdXN0IGNoZWNrIHRoZSB0eXBlIGluc3RlYWQuIEZpbGVkIGFzIEFwcGxlIGJ1ZyAjMTUxMjI3MjQuXG4gICAgICAgIGlmIChkZXZpY2VJc0lPUyAmJiB0YXJnZXRFbGVtZW50LnNldFNlbGVjdGlvblJhbmdlICYmIHRhcmdldEVsZW1lbnQudHlwZS5pbmRleE9mKCdkYXRlJykgIT09IDAgJiYgdGFyZ2V0RWxlbWVudC50eXBlICE9PSAndGltZScgJiYgdGFyZ2V0RWxlbWVudC50eXBlICE9PSAnbW9udGgnKSB7XG4gICAgICAgICAgICBsZW5ndGggPSB0YXJnZXRFbGVtZW50LnZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIHRhcmdldEVsZW1lbnQuc2V0U2VsZWN0aW9uUmFuZ2UobGVuZ3RoLCBsZW5ndGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgd2hldGhlciB0aGUgZ2l2ZW4gdGFyZ2V0IGVsZW1lbnQgaXMgYSBjaGlsZCBvZiBhIHNjcm9sbGFibGUgbGF5ZXIgYW5kIGlmIHNvLCBzZXQgYSBmbGFnIG9uIGl0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFdmVudFRhcmdldHxFbGVtZW50fSB0YXJnZXRFbGVtZW50XG4gICAgICovXG4gICAgRmFzdENsaWNrLnByb3RvdHlwZS51cGRhdGVTY3JvbGxQYXJlbnQgPSBmdW5jdGlvbih0YXJnZXRFbGVtZW50KSB7XG4gICAgICAgIHZhciBzY3JvbGxQYXJlbnQsIHBhcmVudEVsZW1lbnQ7XG5cbiAgICAgICAgc2Nyb2xsUGFyZW50ID0gdGFyZ2V0RWxlbWVudC5mYXN0Q2xpY2tTY3JvbGxQYXJlbnQ7XG5cbiAgICAgICAgLy8gQXR0ZW1wdCB0byBkaXNjb3ZlciB3aGV0aGVyIHRoZSB0YXJnZXQgZWxlbWVudCBpcyBjb250YWluZWQgd2l0aGluIGEgc2Nyb2xsYWJsZSBsYXllci4gUmUtY2hlY2sgaWYgdGhlXG4gICAgICAgIC8vIHRhcmdldCBlbGVtZW50IHdhcyBtb3ZlZCB0byBhbm90aGVyIHBhcmVudC5cbiAgICAgICAgaWYgKCFzY3JvbGxQYXJlbnQgfHwgIXNjcm9sbFBhcmVudC5jb250YWlucyh0YXJnZXRFbGVtZW50KSkge1xuICAgICAgICAgICAgcGFyZW50RWxlbWVudCA9IHRhcmdldEVsZW1lbnQ7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0ID4gcGFyZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsUGFyZW50ID0gcGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5mYXN0Q2xpY2tTY3JvbGxQYXJlbnQgPSBwYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwYXJlbnRFbGVtZW50ID0gcGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgfSB3aGlsZSAocGFyZW50RWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBbHdheXMgdXBkYXRlIHRoZSBzY3JvbGwgdG9wIHRyYWNrZXIgaWYgcG9zc2libGUuXG4gICAgICAgIGlmIChzY3JvbGxQYXJlbnQpIHtcbiAgICAgICAgICAgIHNjcm9sbFBhcmVudC5mYXN0Q2xpY2tMYXN0U2Nyb2xsVG9wID0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcDtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RXZlbnRUYXJnZXR9IHRhcmdldEVsZW1lbnRcbiAgICAgKiBAcmV0dXJucyB7RWxlbWVudHxFdmVudFRhcmdldH1cbiAgICAgKi9cbiAgICBGYXN0Q2xpY2sucHJvdG90eXBlLmdldFRhcmdldEVsZW1lbnRGcm9tRXZlbnRUYXJnZXQgPSBmdW5jdGlvbihldmVudFRhcmdldCkge1xuXG4gICAgICAgIC8vIE9uIHNvbWUgb2xkZXIgYnJvd3NlcnMgKG5vdGFibHkgU2FmYXJpIG9uIGlPUyA0LjEgLSBzZWUgaXNzdWUgIzU2KSB0aGUgZXZlbnQgdGFyZ2V0IG1heSBiZSBhIHRleHQgbm9kZS5cbiAgICAgICAgaWYgKGV2ZW50VGFyZ2V0Lm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkge1xuICAgICAgICAgICAgcmV0dXJuIGV2ZW50VGFyZ2V0LnBhcmVudE5vZGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZXZlbnRUYXJnZXQ7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogT24gdG91Y2ggc3RhcnQsIHJlY29yZCB0aGUgcG9zaXRpb24gYW5kIHNjcm9sbCBvZmZzZXQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudFxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIEZhc3RDbGljay5wcm90b3R5cGUub25Ub3VjaFN0YXJ0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldEVsZW1lbnQsIHRvdWNoLCBzZWxlY3Rpb247XG5cbiAgICAgICAgLy8gSWdub3JlIG11bHRpcGxlIHRvdWNoZXMsIG90aGVyd2lzZSBwaW5jaC10by16b29tIGlzIHByZXZlbnRlZCBpZiBib3RoIGZpbmdlcnMgYXJlIG9uIHRoZSBGYXN0Q2xpY2sgZWxlbWVudCAoaXNzdWUgIzExMSkuXG4gICAgICAgIGlmIChldmVudC50YXJnZXRUb3VjaGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGFyZ2V0RWxlbWVudCA9IHRoaXMuZ2V0VGFyZ2V0RWxlbWVudEZyb21FdmVudFRhcmdldChldmVudC50YXJnZXQpO1xuICAgICAgICB0b3VjaCA9IGV2ZW50LnRhcmdldFRvdWNoZXNbMF07XG5cbiAgICAgICAgaWYgKGRldmljZUlzSU9TKSB7XG5cbiAgICAgICAgICAgIC8vIE9ubHkgdHJ1c3RlZCBldmVudHMgd2lsbCBkZXNlbGVjdCB0ZXh0IG9uIGlPUyAoaXNzdWUgIzQ5KVxuICAgICAgICAgICAgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5yYW5nZUNvdW50ICYmICFzZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFkZXZpY2VJc0lPUzQpIHtcblxuICAgICAgICAgICAgICAgIC8vIFdlaXJkIHRoaW5ncyBoYXBwZW4gb24gaU9TIHdoZW4gYW4gYWxlcnQgb3IgY29uZmlybSBkaWFsb2cgaXMgb3BlbmVkIGZyb20gYSBjbGljayBldmVudCBjYWxsYmFjayAoaXNzdWUgIzIzKTpcbiAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSB1c2VyIG5leHQgdGFwcyBhbnl3aGVyZSBlbHNlIG9uIHRoZSBwYWdlLCBuZXcgdG91Y2hzdGFydCBhbmQgdG91Y2hlbmQgZXZlbnRzIGFyZSBkaXNwYXRjaGVkXG4gICAgICAgICAgICAgICAgLy8gd2l0aCB0aGUgc2FtZSBpZGVudGlmaWVyIGFzIHRoZSB0b3VjaCBldmVudCB0aGF0IHByZXZpb3VzbHkgdHJpZ2dlcmVkIHRoZSBjbGljayB0aGF0IHRyaWdnZXJlZCB0aGUgYWxlcnQuXG4gICAgICAgICAgICAgICAgLy8gU2FkbHksIHRoZXJlIGlzIGFuIGlzc3VlIG9uIGlPUyA0IHRoYXQgY2F1c2VzIHNvbWUgbm9ybWFsIHRvdWNoIGV2ZW50cyB0byBoYXZlIHRoZSBzYW1lIGlkZW50aWZpZXIgYXMgYW5cbiAgICAgICAgICAgICAgICAvLyBpbW1lZGlhdGVseSBwcmVjZWVkaW5nIHRvdWNoIGV2ZW50IChpc3N1ZSAjNTIpLCBzbyB0aGlzIGZpeCBpcyB1bmF2YWlsYWJsZSBvbiB0aGF0IHBsYXRmb3JtLlxuICAgICAgICAgICAgICAgIC8vIElzc3VlIDEyMDogdG91Y2guaWRlbnRpZmllciBpcyAwIHdoZW4gQ2hyb21lIGRldiB0b29scyAnRW11bGF0ZSB0b3VjaCBldmVudHMnIGlzIHNldCB3aXRoIGFuIGlPUyBkZXZpY2UgVUEgc3RyaW5nLFxuICAgICAgICAgICAgICAgIC8vIHdoaWNoIGNhdXNlcyBhbGwgdG91Y2ggZXZlbnRzIHRvIGJlIGlnbm9yZWQuIEFzIHRoaXMgYmxvY2sgb25seSBhcHBsaWVzIHRvIGlPUywgYW5kIGlPUyBpZGVudGlmaWVycyBhcmUgYWx3YXlzIGxvbmcsXG4gICAgICAgICAgICAgICAgLy8gcmFuZG9tIGludGVnZXJzLCBpdCdzIHNhZmUgdG8gdG8gY29udGludWUgaWYgdGhlIGlkZW50aWZpZXIgaXMgMCBoZXJlLlxuICAgICAgICAgICAgICAgIGlmICh0b3VjaC5pZGVudGlmaWVyICYmIHRvdWNoLmlkZW50aWZpZXIgPT09IHRoaXMubGFzdFRvdWNoSWRlbnRpZmllcikge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0VG91Y2hJZGVudGlmaWVyID0gdG91Y2guaWRlbnRpZmllcjtcblxuICAgICAgICAgICAgICAgIC8vIElmIHRoZSB0YXJnZXQgZWxlbWVudCBpcyBhIGNoaWxkIG9mIGEgc2Nyb2xsYWJsZSBsYXllciAodXNpbmcgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoKSBhbmQ6XG4gICAgICAgICAgICAgICAgLy8gMSkgdGhlIHVzZXIgZG9lcyBhIGZsaW5nIHNjcm9sbCBvbiB0aGUgc2Nyb2xsYWJsZSBsYXllclxuICAgICAgICAgICAgICAgIC8vIDIpIHRoZSB1c2VyIHN0b3BzIHRoZSBmbGluZyBzY3JvbGwgd2l0aCBhbm90aGVyIHRhcFxuICAgICAgICAgICAgICAgIC8vIHRoZW4gdGhlIGV2ZW50LnRhcmdldCBvZiB0aGUgbGFzdCAndG91Y2hlbmQnIGV2ZW50IHdpbGwgYmUgdGhlIGVsZW1lbnQgdGhhdCB3YXMgdW5kZXIgdGhlIHVzZXIncyBmaW5nZXJcbiAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBmbGluZyBzY3JvbGwgd2FzIHN0YXJ0ZWQsIGNhdXNpbmcgRmFzdENsaWNrIHRvIHNlbmQgYSBjbGljayBldmVudCB0byB0aGF0IGxheWVyIC0gdW5sZXNzIGEgY2hlY2tcbiAgICAgICAgICAgICAgICAvLyBpcyBtYWRlIHRvIGVuc3VyZSB0aGF0IGEgcGFyZW50IGxheWVyIHdhcyBub3Qgc2Nyb2xsZWQgYmVmb3JlIHNlbmRpbmcgYSBzeW50aGV0aWMgY2xpY2sgKGlzc3VlICM0MikuXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTY3JvbGxQYXJlbnQodGFyZ2V0RWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRyYWNraW5nQ2xpY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLnRyYWNraW5nQ2xpY2tTdGFydCA9IGV2ZW50LnRpbWVTdGFtcDtcbiAgICAgICAgdGhpcy50YXJnZXRFbGVtZW50ID0gdGFyZ2V0RWxlbWVudDtcblxuICAgICAgICB0aGlzLnRvdWNoU3RhcnRYID0gdG91Y2gucGFnZVg7XG4gICAgICAgIHRoaXMudG91Y2hTdGFydFkgPSB0b3VjaC5wYWdlWTtcblxuICAgICAgICAvLyBQcmV2ZW50IHBoYW50b20gY2xpY2tzIG9uIGZhc3QgZG91YmxlLXRhcCAoaXNzdWUgIzM2KVxuICAgICAgICBpZiAoKGV2ZW50LnRpbWVTdGFtcCAtIHRoaXMubGFzdENsaWNrVGltZSkgPCB0aGlzLnRhcERlbGF5KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQmFzZWQgb24gYSB0b3VjaG1vdmUgZXZlbnQgb2JqZWN0LCBjaGVjayB3aGV0aGVyIHRoZSB0b3VjaCBoYXMgbW92ZWQgcGFzdCBhIGJvdW5kYXJ5IHNpbmNlIGl0IHN0YXJ0ZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudFxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIEZhc3RDbGljay5wcm90b3R5cGUudG91Y2hIYXNNb3ZlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciB0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLCBib3VuZGFyeSA9IHRoaXMudG91Y2hCb3VuZGFyeTtcblxuICAgICAgICBpZiAoTWF0aC5hYnModG91Y2gucGFnZVggLSB0aGlzLnRvdWNoU3RhcnRYKSA+IGJvdW5kYXJ5IHx8IE1hdGguYWJzKHRvdWNoLnBhZ2VZIC0gdGhpcy50b3VjaFN0YXJ0WSkgPiBib3VuZGFyeSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBsYXN0IHBvc2l0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBGYXN0Q2xpY2sucHJvdG90eXBlLm9uVG91Y2hNb3ZlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLnRyYWNraW5nQ2xpY2spIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdGhlIHRvdWNoIGhhcyBtb3ZlZCwgY2FuY2VsIHRoZSBjbGljayB0cmFja2luZ1xuICAgICAgICBpZiAodGhpcy50YXJnZXRFbGVtZW50ICE9PSB0aGlzLmdldFRhcmdldEVsZW1lbnRGcm9tRXZlbnRUYXJnZXQoZXZlbnQudGFyZ2V0KSB8fCB0aGlzLnRvdWNoSGFzTW92ZWQoZXZlbnQpKSB7XG4gICAgICAgICAgICB0aGlzLnRyYWNraW5nQ2xpY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBBdHRlbXB0IHRvIGZpbmQgdGhlIGxhYmVsbGVkIGNvbnRyb2wgZm9yIHRoZSBnaXZlbiBsYWJlbCBlbGVtZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFdmVudFRhcmdldHxIVE1MTGFiZWxFbGVtZW50fSBsYWJlbEVsZW1lbnRcbiAgICAgKiBAcmV0dXJucyB7RWxlbWVudHxudWxsfVxuICAgICAqL1xuICAgIEZhc3RDbGljay5wcm90b3R5cGUuZmluZENvbnRyb2wgPSBmdW5jdGlvbihsYWJlbEVsZW1lbnQpIHtcblxuICAgICAgICAvLyBGYXN0IHBhdGggZm9yIG5ld2VyIGJyb3dzZXJzIHN1cHBvcnRpbmcgdGhlIEhUTUw1IGNvbnRyb2wgYXR0cmlidXRlXG4gICAgICAgIGlmIChsYWJlbEVsZW1lbnQuY29udHJvbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFiZWxFbGVtZW50LmNvbnRyb2w7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBbGwgYnJvd3NlcnMgdW5kZXIgdGVzdCB0aGF0IHN1cHBvcnQgdG91Y2ggZXZlbnRzIGFsc28gc3VwcG9ydCB0aGUgSFRNTDUgaHRtbEZvciBhdHRyaWJ1dGVcbiAgICAgICAgaWYgKGxhYmVsRWxlbWVudC5odG1sRm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGFiZWxFbGVtZW50Lmh0bWxGb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgbm8gZm9yIGF0dHJpYnV0ZSBleGlzdHMsIGF0dGVtcHQgdG8gcmV0cmlldmUgdGhlIGZpcnN0IGxhYmVsbGFibGUgZGVzY2VuZGFudCBlbGVtZW50XG4gICAgICAgIC8vIHRoZSBsaXN0IG9mIHdoaWNoIGlzIGRlZmluZWQgaGVyZTogaHR0cDovL3d3dy53My5vcmcvVFIvaHRtbDUvZm9ybXMuaHRtbCNjYXRlZ29yeS1sYWJlbFxuICAgICAgICByZXR1cm4gbGFiZWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvbiwgaW5wdXQ6bm90KFt0eXBlPWhpZGRlbl0pLCBrZXlnZW4sIG1ldGVyLCBvdXRwdXQsIHByb2dyZXNzLCBzZWxlY3QsIHRleHRhcmVhJyk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogT24gdG91Y2ggZW5kLCBkZXRlcm1pbmUgd2hldGhlciB0byBzZW5kIGEgY2xpY2sgZXZlbnQgYXQgb25jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50XG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgRmFzdENsaWNrLnByb3RvdHlwZS5vblRvdWNoRW5kID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIGZvckVsZW1lbnQsIHRyYWNraW5nQ2xpY2tTdGFydCwgdGFyZ2V0VGFnTmFtZSwgc2Nyb2xsUGFyZW50LCB0b3VjaCwgdGFyZ2V0RWxlbWVudCA9IHRoaXMudGFyZ2V0RWxlbWVudDtcblxuICAgICAgICBpZiAoIXRoaXMudHJhY2tpbmdDbGljaykge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQcmV2ZW50IHBoYW50b20gY2xpY2tzIG9uIGZhc3QgZG91YmxlLXRhcCAoaXNzdWUgIzM2KVxuICAgICAgICBpZiAoKGV2ZW50LnRpbWVTdGFtcCAtIHRoaXMubGFzdENsaWNrVGltZSkgPCB0aGlzLnRhcERlbGF5KSB7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbE5leHRDbGljayA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgoZXZlbnQudGltZVN0YW1wIC0gdGhpcy50cmFja2luZ0NsaWNrU3RhcnQpID4gdGhpcy50YXBUaW1lb3V0KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlc2V0IHRvIHByZXZlbnQgd3JvbmcgY2xpY2sgY2FuY2VsIG9uIGlucHV0IChpc3N1ZSAjMTU2KS5cbiAgICAgICAgdGhpcy5jYW5jZWxOZXh0Q2xpY2sgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmxhc3RDbGlja1RpbWUgPSBldmVudC50aW1lU3RhbXA7XG5cbiAgICAgICAgdHJhY2tpbmdDbGlja1N0YXJ0ID0gdGhpcy50cmFja2luZ0NsaWNrU3RhcnQ7XG4gICAgICAgIHRoaXMudHJhY2tpbmdDbGljayA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRyYWNraW5nQ2xpY2tTdGFydCA9IDA7XG5cbiAgICAgICAgLy8gT24gc29tZSBpT1MgZGV2aWNlcywgdGhlIHRhcmdldEVsZW1lbnQgc3VwcGxpZWQgd2l0aCB0aGUgZXZlbnQgaXMgaW52YWxpZCBpZiB0aGUgbGF5ZXJcbiAgICAgICAgLy8gaXMgcGVyZm9ybWluZyBhIHRyYW5zaXRpb24gb3Igc2Nyb2xsLCBhbmQgaGFzIHRvIGJlIHJlLWRldGVjdGVkIG1hbnVhbGx5LiBOb3RlIHRoYXRcbiAgICAgICAgLy8gZm9yIHRoaXMgdG8gZnVuY3Rpb24gY29ycmVjdGx5LCBpdCBtdXN0IGJlIGNhbGxlZCAqYWZ0ZXIqIHRoZSBldmVudCB0YXJnZXQgaXMgY2hlY2tlZCFcbiAgICAgICAgLy8gU2VlIGlzc3VlICM1NzsgYWxzbyBmaWxlZCBhcyByZGFyOi8vMTMwNDg1ODkgLlxuICAgICAgICBpZiAoZGV2aWNlSXNJT1NXaXRoQmFkVGFyZ2V0KSB7XG4gICAgICAgICAgICB0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuXG4gICAgICAgICAgICAvLyBJbiBjZXJ0YWluIGNhc2VzIGFyZ3VtZW50cyBvZiBlbGVtZW50RnJvbVBvaW50IGNhbiBiZSBuZWdhdGl2ZSwgc28gcHJldmVudCBzZXR0aW5nIHRhcmdldEVsZW1lbnQgdG8gbnVsbFxuICAgICAgICAgICAgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQodG91Y2gucGFnZVggLSB3aW5kb3cucGFnZVhPZmZzZXQsIHRvdWNoLnBhZ2VZIC0gd2luZG93LnBhZ2VZT2Zmc2V0KSB8fCB0YXJnZXRFbGVtZW50O1xuICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5mYXN0Q2xpY2tTY3JvbGxQYXJlbnQgPSB0aGlzLnRhcmdldEVsZW1lbnQuZmFzdENsaWNrU2Nyb2xsUGFyZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgdGFyZ2V0VGFnTmFtZSA9IHRhcmdldEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAodGFyZ2V0VGFnTmFtZSA9PT0gJ2xhYmVsJykge1xuICAgICAgICAgICAgZm9yRWxlbWVudCA9IHRoaXMuZmluZENvbnRyb2wodGFyZ2V0RWxlbWVudCk7XG4gICAgICAgICAgICBpZiAoZm9yRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXModGFyZ2V0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgaWYgKGRldmljZUlzQW5kcm9pZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudCA9IGZvckVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5uZWVkc0ZvY3VzKHRhcmdldEVsZW1lbnQpKSB7XG5cbiAgICAgICAgICAgIC8vIENhc2UgMTogSWYgdGhlIHRvdWNoIHN0YXJ0ZWQgYSB3aGlsZSBhZ28gKGJlc3QgZ3Vlc3MgaXMgMTAwbXMgYmFzZWQgb24gdGVzdHMgZm9yIGlzc3VlICMzNikgdGhlbiBmb2N1cyB3aWxsIGJlIHRyaWdnZXJlZCBhbnl3YXkuIFJldHVybiBlYXJseSBhbmQgdW5zZXQgdGhlIHRhcmdldCBlbGVtZW50IHJlZmVyZW5jZSBzbyB0aGF0IHRoZSBzdWJzZXF1ZW50IGNsaWNrIHdpbGwgYmUgYWxsb3dlZCB0aHJvdWdoLlxuICAgICAgICAgICAgLy8gQ2FzZSAyOiBXaXRob3V0IHRoaXMgZXhjZXB0aW9uIGZvciBpbnB1dCBlbGVtZW50cyB0YXBwZWQgd2hlbiB0aGUgZG9jdW1lbnQgaXMgY29udGFpbmVkIGluIGFuIGlmcmFtZSwgdGhlbiBhbnkgaW5wdXR0ZWQgdGV4dCB3b24ndCBiZSB2aXNpYmxlIGV2ZW4gdGhvdWdoIHRoZSB2YWx1ZSBhdHRyaWJ1dGUgaXMgdXBkYXRlZCBhcyB0aGUgdXNlciB0eXBlcyAoaXNzdWUgIzM3KS5cbiAgICAgICAgICAgIGlmICgoZXZlbnQudGltZVN0YW1wIC0gdHJhY2tpbmdDbGlja1N0YXJ0KSA+IDEwMCB8fCAoZGV2aWNlSXNJT1MgJiYgd2luZG93LnRvcCAhPT0gd2luZG93ICYmIHRhcmdldFRhZ05hbWUgPT09ICdpbnB1dCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50YXJnZXRFbGVtZW50ID0gbnVsbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZm9jdXModGFyZ2V0RWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLnNlbmRDbGljayh0YXJnZXRFbGVtZW50LCBldmVudCk7XG5cbiAgICAgICAgICAgIC8vIFNlbGVjdCBlbGVtZW50cyBuZWVkIHRoZSBldmVudCB0byBnbyB0aHJvdWdoIG9uIGlPUyA0LCBvdGhlcndpc2UgdGhlIHNlbGVjdG9yIG1lbnUgd29uJ3Qgb3Blbi5cbiAgICAgICAgICAgIC8vIEFsc28gdGhpcyBicmVha3Mgb3BlbmluZyBzZWxlY3RzIHdoZW4gVm9pY2VPdmVyIGlzIGFjdGl2ZSBvbiBpT1M2LCBpT1M3IChhbmQgcG9zc2libHkgb3RoZXJzKVxuICAgICAgICAgICAgaWYgKCFkZXZpY2VJc0lPUyB8fCB0YXJnZXRUYWdOYW1lICE9PSAnc2VsZWN0Jykge1xuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRldmljZUlzSU9TICYmICFkZXZpY2VJc0lPUzQpIHtcblxuICAgICAgICAgICAgLy8gRG9uJ3Qgc2VuZCBhIHN5bnRoZXRpYyBjbGljayBldmVudCBpZiB0aGUgdGFyZ2V0IGVsZW1lbnQgaXMgY29udGFpbmVkIHdpdGhpbiBhIHBhcmVudCBsYXllciB0aGF0IHdhcyBzY3JvbGxlZFxuICAgICAgICAgICAgLy8gYW5kIHRoaXMgdGFwIGlzIGJlaW5nIHVzZWQgdG8gc3RvcCB0aGUgc2Nyb2xsaW5nICh1c3VhbGx5IGluaXRpYXRlZCBieSBhIGZsaW5nIC0gaXNzdWUgIzQyKS5cbiAgICAgICAgICAgIHNjcm9sbFBhcmVudCA9IHRhcmdldEVsZW1lbnQuZmFzdENsaWNrU2Nyb2xsUGFyZW50O1xuICAgICAgICAgICAgaWYgKHNjcm9sbFBhcmVudCAmJiBzY3JvbGxQYXJlbnQuZmFzdENsaWNrTGFzdFNjcm9sbFRvcCAhPT0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJldmVudCB0aGUgYWN0dWFsIGNsaWNrIGZyb20gZ29pbmcgdGhvdWdoIC0gdW5sZXNzIHRoZSB0YXJnZXQgbm9kZSBpcyBtYXJrZWQgYXMgcmVxdWlyaW5nXG4gICAgICAgIC8vIHJlYWwgY2xpY2tzIG9yIGlmIGl0IGlzIGluIHRoZSB3aGl0ZWxpc3QgaW4gd2hpY2ggY2FzZSBvbmx5IG5vbi1wcm9ncmFtbWF0aWMgY2xpY2tzIGFyZSBwZXJtaXR0ZWQuXG4gICAgICAgIGlmICghdGhpcy5uZWVkc0NsaWNrKHRhcmdldEVsZW1lbnQpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5zZW5kQ2xpY2sodGFyZ2V0RWxlbWVudCwgZXZlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIE9uIHRvdWNoIGNhbmNlbCwgc3RvcCB0cmFja2luZyB0aGUgY2xpY2suXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7dm9pZH1cbiAgICAgKi9cbiAgICBGYXN0Q2xpY2sucHJvdG90eXBlLm9uVG91Y2hDYW5jZWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy50cmFja2luZ0NsaWNrID0gZmFsc2U7XG4gICAgICAgIHRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIG1vdXNlIGV2ZW50cyB3aGljaCBzaG91bGQgYmUgcGVybWl0dGVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBGYXN0Q2xpY2sucHJvdG90eXBlLm9uTW91c2UgPSBmdW5jdGlvbihldmVudCkge1xuXG4gICAgICAgIC8vIElmIGEgdGFyZ2V0IGVsZW1lbnQgd2FzIG5ldmVyIHNldCAoYmVjYXVzZSBhIHRvdWNoIGV2ZW50IHdhcyBuZXZlciBmaXJlZCkgYWxsb3cgdGhlIGV2ZW50XG4gICAgICAgIGlmICghdGhpcy50YXJnZXRFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChldmVudC5mb3J3YXJkZWRUb3VjaEV2ZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFByb2dyYW1tYXRpY2FsbHkgZ2VuZXJhdGVkIGV2ZW50cyB0YXJnZXRpbmcgYSBzcGVjaWZpYyBlbGVtZW50IHNob3VsZCBiZSBwZXJtaXR0ZWRcbiAgICAgICAgaWYgKCFldmVudC5jYW5jZWxhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERlcml2ZSBhbmQgY2hlY2sgdGhlIHRhcmdldCBlbGVtZW50IHRvIHNlZSB3aGV0aGVyIHRoZSBtb3VzZSBldmVudCBuZWVkcyB0byBiZSBwZXJtaXR0ZWQ7XG4gICAgICAgIC8vIHVubGVzcyBleHBsaWNpdGx5IGVuYWJsZWQsIHByZXZlbnQgbm9uLXRvdWNoIGNsaWNrIGV2ZW50cyBmcm9tIHRyaWdnZXJpbmcgYWN0aW9ucyxcbiAgICAgICAgLy8gdG8gcHJldmVudCBnaG9zdC9kb3VibGVjbGlja3MuXG4gICAgICAgIGlmICghdGhpcy5uZWVkc0NsaWNrKHRoaXMudGFyZ2V0RWxlbWVudCkgfHwgdGhpcy5jYW5jZWxOZXh0Q2xpY2spIHtcblxuICAgICAgICAgICAgLy8gUHJldmVudCBhbnkgdXNlci1hZGRlZCBsaXN0ZW5lcnMgZGVjbGFyZWQgb24gRmFzdENsaWNrIGVsZW1lbnQgZnJvbSBiZWluZyBmaXJlZC5cbiAgICAgICAgICAgIGlmIChldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24pIHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAvLyBQYXJ0IG9mIHRoZSBoYWNrIGZvciBicm93c2VycyB0aGF0IGRvbid0IHN1cHBvcnQgRXZlbnQjc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIChlLmcuIEFuZHJvaWQgMilcbiAgICAgICAgICAgICAgICBldmVudC5wcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDYW5jZWwgdGhlIGV2ZW50XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIHRoZSBtb3VzZSBldmVudCBpcyBwZXJtaXR0ZWQsIHJldHVybiB0cnVlIGZvciB0aGUgYWN0aW9uIHRvIGdvIHRocm91Z2guXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIE9uIGFjdHVhbCBjbGlja3MsIGRldGVybWluZSB3aGV0aGVyIHRoaXMgaXMgYSB0b3VjaC1nZW5lcmF0ZWQgY2xpY2ssIGEgY2xpY2sgYWN0aW9uIG9jY3VycmluZ1xuICAgICAqIG5hdHVyYWxseSBhZnRlciBhIGRlbGF5IGFmdGVyIGEgdG91Y2ggKHdoaWNoIG5lZWRzIHRvIGJlIGNhbmNlbGxlZCB0byBhdm9pZCBkdXBsaWNhdGlvbiksIG9yXG4gICAgICogYW4gYWN0dWFsIGNsaWNrIHdoaWNoIHNob3VsZCBiZSBwZXJtaXR0ZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudFxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIEZhc3RDbGljay5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBwZXJtaXR0ZWQ7XG5cbiAgICAgICAgLy8gSXQncyBwb3NzaWJsZSBmb3IgYW5vdGhlciBGYXN0Q2xpY2stbGlrZSBsaWJyYXJ5IGRlbGl2ZXJlZCB3aXRoIHRoaXJkLXBhcnR5IGNvZGUgdG8gZmlyZSBhIGNsaWNrIGV2ZW50IGJlZm9yZSBGYXN0Q2xpY2sgZG9lcyAoaXNzdWUgIzQ0KS4gSW4gdGhhdCBjYXNlLCBzZXQgdGhlIGNsaWNrLXRyYWNraW5nIGZsYWcgYmFjayB0byBmYWxzZSBhbmQgcmV0dXJuIGVhcmx5LiBUaGlzIHdpbGwgY2F1c2Ugb25Ub3VjaEVuZCB0byByZXR1cm4gZWFybHkuXG4gICAgICAgIGlmICh0aGlzLnRyYWNraW5nQ2xpY2spIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnRyYWNraW5nQ2xpY2sgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmVyeSBvZGQgYmVoYXZpb3VyIG9uIGlPUyAoaXNzdWUgIzE4KTogaWYgYSBzdWJtaXQgZWxlbWVudCBpcyBwcmVzZW50IGluc2lkZSBhIGZvcm0gYW5kIHRoZSB1c2VyIGhpdHMgZW50ZXIgaW4gdGhlIGlPUyBzaW11bGF0b3Igb3IgY2xpY2tzIHRoZSBHbyBidXR0b24gb24gdGhlIHBvcC11cCBPUyBrZXlib2FyZCB0aGUgYSBraW5kIG9mICdmYWtlJyBjbGljayBldmVudCB3aWxsIGJlIHRyaWdnZXJlZCB3aXRoIHRoZSBzdWJtaXQtdHlwZSBpbnB1dCBlbGVtZW50IGFzIHRoZSB0YXJnZXQuXG4gICAgICAgIGlmIChldmVudC50YXJnZXQudHlwZSA9PT0gJ3N1Ym1pdCcgJiYgZXZlbnQuZGV0YWlsID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBlcm1pdHRlZCA9IHRoaXMub25Nb3VzZShldmVudCk7XG5cbiAgICAgICAgLy8gT25seSB1bnNldCB0YXJnZXRFbGVtZW50IGlmIHRoZSBjbGljayBpcyBub3QgcGVybWl0dGVkLiBUaGlzIHdpbGwgZW5zdXJlIHRoYXQgdGhlIGNoZWNrIGZvciAhdGFyZ2V0RWxlbWVudCBpbiBvbk1vdXNlIGZhaWxzIGFuZCB0aGUgYnJvd3NlcidzIGNsaWNrIGRvZXNuJ3QgZ28gdGhyb3VnaC5cbiAgICAgICAgaWYgKCFwZXJtaXR0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBjbGlja3MgYXJlIHBlcm1pdHRlZCwgcmV0dXJuIHRydWUgZm9yIHRoZSBhY3Rpb24gdG8gZ28gdGhyb3VnaC5cbiAgICAgICAgcmV0dXJuIHBlcm1pdHRlZDtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYWxsIEZhc3RDbGljaydzIGV2ZW50IGxpc3RlbmVycy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHt2b2lkfVxuICAgICAqL1xuICAgIEZhc3RDbGljay5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGF5ZXIgPSB0aGlzLmxheWVyO1xuXG4gICAgICAgIGlmIChkZXZpY2VJc0FuZHJvaWQpIHtcbiAgICAgICAgICAgIGxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIHRoaXMub25Nb3VzZSwgdHJ1ZSk7XG4gICAgICAgICAgICBsYXllci5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm9uTW91c2UsIHRydWUpO1xuICAgICAgICAgICAgbGF5ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZSwgdHJ1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBsYXllci5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbGljaywgdHJ1ZSk7XG4gICAgICAgIGxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLm9uVG91Y2hTdGFydCwgZmFsc2UpO1xuICAgICAgICBsYXllci5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLm9uVG91Y2hNb3ZlLCBmYWxzZSk7XG4gICAgICAgIGxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vblRvdWNoRW5kLCBmYWxzZSk7XG4gICAgICAgIGxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgdGhpcy5vblRvdWNoQ2FuY2VsLCBmYWxzZSk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgd2hldGhlciBGYXN0Q2xpY2sgaXMgbmVlZGVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50fSBsYXllciBUaGUgbGF5ZXIgdG8gbGlzdGVuIG9uXG4gICAgICovXG4gICAgRmFzdENsaWNrLm5vdE5lZWRlZCA9IGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgICAgIHZhciBtZXRhVmlld3BvcnQ7XG4gICAgICAgIHZhciBjaHJvbWVWZXJzaW9uO1xuICAgICAgICB2YXIgYmxhY2tiZXJyeVZlcnNpb247XG4gICAgICAgIHZhciBmaXJlZm94VmVyc2lvbjtcblxuICAgICAgICAvLyBEZXZpY2VzIHRoYXQgZG9uJ3Qgc3VwcG9ydCB0b3VjaCBkb24ndCBuZWVkIEZhc3RDbGlja1xuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5vbnRvdWNoc3RhcnQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENocm9tZSB2ZXJzaW9uIC0gemVybyBmb3Igb3RoZXIgYnJvd3NlcnNcbiAgICAgICAgY2hyb21lVmVyc2lvbiA9ICsoL0Nocm9tZVxcLyhbMC05XSspLy5leGVjKG5hdmlnYXRvci51c2VyQWdlbnQpIHx8IFssMF0pWzFdO1xuXG4gICAgICAgIGlmIChjaHJvbWVWZXJzaW9uKSB7XG5cbiAgICAgICAgICAgIGlmIChkZXZpY2VJc0FuZHJvaWQpIHtcbiAgICAgICAgICAgICAgICBtZXRhVmlld3BvcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9dmlld3BvcnRdJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAobWV0YVZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENocm9tZSBvbiBBbmRyb2lkIHdpdGggdXNlci1zY2FsYWJsZT1cIm5vXCIgZG9lc24ndCBuZWVkIEZhc3RDbGljayAoaXNzdWUgIzg5KVxuICAgICAgICAgICAgICAgICAgICBpZiAobWV0YVZpZXdwb3J0LmNvbnRlbnQuaW5kZXhPZigndXNlci1zY2FsYWJsZT1ubycpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hyb21lIDMyIGFuZCBhYm92ZSB3aXRoIHdpZHRoPWRldmljZS13aWR0aCBvciBsZXNzIGRvbid0IG5lZWQgRmFzdENsaWNrXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaHJvbWVWZXJzaW9uID4gMzEgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoIDw9IHdpbmRvdy5vdXRlcldpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIENocm9tZSBkZXNrdG9wIGRvZXNuJ3QgbmVlZCBGYXN0Q2xpY2sgKGlzc3VlICMxNSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGV2aWNlSXNCbGFja0JlcnJ5MTApIHtcbiAgICAgICAgICAgIGJsYWNrYmVycnlWZXJzaW9uID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvVmVyc2lvblxcLyhbMC05XSopXFwuKFswLTldKikvKTtcblxuICAgICAgICAgICAgLy8gQmxhY2tCZXJyeSAxMC4zKyBkb2VzIG5vdCByZXF1aXJlIEZhc3RjbGljayBsaWJyYXJ5LlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Z0bGFicy9mYXN0Y2xpY2svaXNzdWVzLzI1MVxuICAgICAgICAgICAgaWYgKGJsYWNrYmVycnlWZXJzaW9uWzFdID49IDEwICYmIGJsYWNrYmVycnlWZXJzaW9uWzJdID49IDMpIHtcbiAgICAgICAgICAgICAgICBtZXRhVmlld3BvcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9dmlld3BvcnRdJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAobWV0YVZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVzZXItc2NhbGFibGU9bm8gZWxpbWluYXRlcyBjbGljayBkZWxheS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGFWaWV3cG9ydC5jb250ZW50LmluZGV4T2YoJ3VzZXItc2NhbGFibGU9bm8nKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHdpZHRoPWRldmljZS13aWR0aCAob3IgbGVzcyB0aGFuIGRldmljZS13aWR0aCkgZWxpbWluYXRlcyBjbGljayBkZWxheS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxXaWR0aCA8PSB3aW5kb3cub3V0ZXJXaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJRTEwIHdpdGggLW1zLXRvdWNoLWFjdGlvbjogbm9uZSBvciBtYW5pcHVsYXRpb24sIHdoaWNoIGRpc2FibGVzIGRvdWJsZS10YXAtdG8tem9vbSAoaXNzdWUgIzk3KVxuICAgICAgICBpZiAobGF5ZXIuc3R5bGUubXNUb3VjaEFjdGlvbiA9PT0gJ25vbmUnIHx8IGxheWVyLnN0eWxlLnRvdWNoQWN0aW9uID09PSAnbWFuaXB1bGF0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaXJlZm94IHZlcnNpb24gLSB6ZXJvIGZvciBvdGhlciBicm93c2Vyc1xuICAgICAgICBmaXJlZm94VmVyc2lvbiA9ICsoL0ZpcmVmb3hcXC8oWzAtOV0rKS8uZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KSB8fCBbLDBdKVsxXTtcblxuICAgICAgICBpZiAoZmlyZWZveFZlcnNpb24gPj0gMjcpIHtcbiAgICAgICAgICAgIC8vIEZpcmVmb3ggMjcrIGRvZXMgbm90IGhhdmUgdGFwIGRlbGF5IGlmIHRoZSBjb250ZW50IGlzIG5vdCB6b29tYWJsZSAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTkyMjg5NlxuXG4gICAgICAgICAgICBtZXRhVmlld3BvcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9dmlld3BvcnRdJyk7XG4gICAgICAgICAgICBpZiAobWV0YVZpZXdwb3J0ICYmIChtZXRhVmlld3BvcnQuY29udGVudC5pbmRleE9mKCd1c2VyLXNjYWxhYmxlPW5vJykgIT09IC0xIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxXaWR0aCA8PSB3aW5kb3cub3V0ZXJXaWR0aCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElFMTE6IHByZWZpeGVkIC1tcy10b3VjaC1hY3Rpb24gaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCBhbmQgaXQncyByZWNvbWVuZGVkIHRvIHVzZSBub24tcHJlZml4ZWQgdmVyc2lvblxuICAgICAgICAvLyBodHRwOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvd2luZG93cy9hcHBzL0hoNzY3MzEzLmFzcHhcbiAgICAgICAgaWYgKGxheWVyLnN0eWxlLnRvdWNoQWN0aW9uID09PSAnbm9uZScgfHwgbGF5ZXIuc3R5bGUudG91Y2hBY3Rpb24gPT09ICdtYW5pcHVsYXRpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBGYWN0b3J5IG1ldGhvZCBmb3IgY3JlYXRpbmcgYSBGYXN0Q2xpY2sgb2JqZWN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGxheWVyIFRoZSBsYXllciB0byBsaXN0ZW4gb25cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIFRoZSBvcHRpb25zIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0c1xuICAgICAqL1xuICAgIEZhc3RDbGljay5hdHRhY2ggPSBmdW5jdGlvbihsYXllciwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IEZhc3RDbGljayhsYXllciwgb3B0aW9ucyk7XG4gICAgfTtcblxuXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZS5hbWQgPT09ICdvYmplY3QnICYmIGRlZmluZS5hbWQpIHtcblxuICAgICAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuXG4gICAgICAgIGRlZmluZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBGYXN0Q2xpY2s7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBGYXN0Q2xpY2suYXR0YWNoO1xuICAgICAgICBtb2R1bGUuZXhwb3J0cy5GYXN0Q2xpY2sgPSBGYXN0Q2xpY2s7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LkZhc3RDbGljayA9IEZhc3RDbGljaztcbiAgICB9XG59KCkpOyIsIi8qIVxuICogTmFtZSAgICA6IEp1c3QgQW5vdGhlciBQYXJhbGxheCBbSmFyYWxsYXhdXG4gKiBWZXJzaW9uIDogMS44LjBcbiAqIEF1dGhvciAgOiBfbksgaHR0cHM6Ly9ua2Rldi5pbmZvXG4gKiBHaXRIdWIgIDogaHR0cHM6Ly9naXRodWIuY29tL25rLW8vamFyYWxsYXhcbiAqL1xuKGZ1bmN0aW9uICh3aW5kb3cpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvLyBBZGFwdGVkIGZyb20gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vcGF1bGlyaXNoLzE1Nzk2NzFcbiAgICBpZighRGF0ZS5ub3cpIHtcbiAgICAgICAgRGF0ZS5ub3cgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfTtcbiAgICB9XG4gICAgaWYoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIHZlbmRvcnMgPSBbJ3dlYmtpdCcsICdtb3onXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVuZG9ycy5sZW5ndGggJiYgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7ICsraSkge1xuICAgICAgICAgICAgICAgIHZhciB2cCA9IHZlbmRvcnNbaV07XG4gICAgICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2cCsnUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XG4gICAgICAgICAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gd2luZG93W3ZwKydDYW5jZWxBbmltYXRpb25GcmFtZSddXG4gICAgICAgICAgICAgICAgICAgIHx8IHdpbmRvd1t2cCsnQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoL2lQKGFkfGhvbmV8b2QpLipPUyA2Ly50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSAvLyBpT1M2IGlzIGJ1Z2d5XG4gICAgICAgICAgICAgICAgfHwgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgIXdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBsYXN0VGltZSA9IDA7XG4gICAgICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRUaW1lID0gTWF0aC5tYXgobGFzdFRpbWUgKyAxNiwgbm93KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjYWxsYmFjayhsYXN0VGltZSA9IG5leHRUaW1lKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRUaW1lIC0gbm93KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSgpKTtcbiAgICB9XG5cbiAgICAvLyB0ZXN0IGlmIGNzcyBwcm9wZXJ0eSBzdXBwb3J0ZWQgYnkgYnJvd3NlclxuICAgIC8vIGxpa2UgXCJ0cmFuc2Zvcm1cIlxuICAgIHZhciB0ZW1wRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZnVuY3Rpb24gaXNQcm9wZXJ0eVN1cHBvcnRlZCAocHJvcGVydHkpIHtcbiAgICAgICAgdmFyIHByZWZpeGVzID0gWydPJywnTW96JywnbXMnLCdNcycsJ1dlYmtpdCddO1xuICAgICAgICB2YXIgaSA9IHByZWZpeGVzLmxlbmd0aDtcbiAgICAgICAgaWYgKHRlbXBEaXYuc3R5bGVbcHJvcGVydHldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHByb3BlcnR5ID0gcHJvcGVydHkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm9wZXJ0eS5zdWJzdHIoMSk7XG4gICAgICAgIHdoaWxlICgtLWkgPiAtMSAmJiB0ZW1wRGl2LnN0eWxlW3ByZWZpeGVzW2ldICsgcHJvcGVydHldID09PSB1bmRlZmluZWQpIHsgfVxuICAgICAgICByZXR1cm4gaSA+PSAwO1xuICAgIH1cblxuICAgIHZhciBzdXBwb3J0VHJhbnNmb3JtID0gaXNQcm9wZXJ0eVN1cHBvcnRlZCgndHJhbnNmb3JtJyk7XG4gICAgdmFyIHN1cHBvcnRUcmFuc2Zvcm0zRCA9IGlzUHJvcGVydHlTdXBwb3J0ZWQoJ3BlcnNwZWN0aXZlJyk7XG5cbiAgICB2YXIgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuICAgIHZhciBpc0FuZHJvaWQgPSB1YS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2FuZHJvaWQnKSA+IC0xO1xuICAgIHZhciBpc0lPcyA9IC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KHVhKSAmJiAhd2luZG93Lk1TU3RyZWFtO1xuICAgIHZhciBpc0ZpcmVmb3ggPSB1YS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2ZpcmVmb3gnKSA+IC0xO1xuICAgIHZhciBpc0lFID0gdWEuaW5kZXhPZignTVNJRSAnKSA+IC0xICAgIC8vIElFIDEwIG9yIG9sZGVyXG4gICAgICAgIHx8IHVhLmluZGV4T2YoJ1RyaWRlbnQvJykgPiAtMSAvLyBJRSAxMVxuICAgICAgICB8fCB1YS5pbmRleE9mKCdFZGdlLycpID4gLTE7ICAgLy8gRWRnZVxuICAgIHZhciBpc0lFbHQxMCA9IGRvY3VtZW50LmFsbCAmJiAhd2luZG93LmF0b2I7IC8vIElFIDkgb3Igb2xkZXJcblxuICAgIHZhciB3bmRXO1xuICAgIHZhciB3bmRIO1xuICAgIGZ1bmN0aW9uIHVwZGF0ZVduZFZhcnMgKCkge1xuICAgICAgICB3bmRXID0gd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoO1xuICAgICAgICB3bmRIID0gd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gICAgfVxuICAgIHVwZGF0ZVduZFZhcnMoKTtcblxuICAgIC8vIGxpc3Qgd2l0aCBhbGwgamFyYWxsYXggaW5zdGFuY2VzXG4gICAgLy8gbmVlZCB0byByZW5kZXIgYWxsIGluIG9uZSBzY3JvbGwvcmVzaXplIGV2ZW50XG4gICAgdmFyIGphcmFsbGF4TGlzdCA9IFtdO1xuXG4gICAgLy8gSmFyYWxsYXggaW5zdGFuY2VcbiAgICB2YXIgSmFyYWxsYXggPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaW5zdGFuY2VJRCA9IDA7XG5cbiAgICAgICAgZnVuY3Rpb24gSmFyYWxsYXhfaW5uZXIgKGl0ZW0sIHVzZXJPcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGRhdGFPcHRpb25zO1xuXG4gICAgICAgICAgICBfdGhpcy4kaXRlbSAgICAgID0gaXRlbTtcblxuICAgICAgICAgICAgX3RoaXMuZGVmYXVsdHMgICA9IHtcbiAgICAgICAgICAgICAgICB0eXBlICAgICAgICAgICAgICA6ICdzY3JvbGwnLCAvLyB0eXBlIG9mIHBhcmFsbGF4OiBzY3JvbGwsIHNjYWxlLCBvcGFjaXR5LCBzY2FsZS1vcGFjaXR5LCBzY3JvbGwtb3BhY2l0eVxuICAgICAgICAgICAgICAgIHNwZWVkICAgICAgICAgICAgIDogMC41LCAvLyBzdXBwb3J0ZWQgdmFsdWUgZnJvbSAtMSB0byAyXG4gICAgICAgICAgICAgICAgaW1nU3JjICAgICAgICAgICAgOiBudWxsLFxuICAgICAgICAgICAgICAgIGltZ1dpZHRoICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgICAgICAgICBpbWdIZWlnaHQgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgZWxlbWVudEluVmlld3BvcnQgOiBudWxsLFxuICAgICAgICAgICAgICAgIHpJbmRleCAgICAgICAgICAgIDogLTEwMCxcbiAgICAgICAgICAgICAgICBub0FuZHJvaWQgICAgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG5vSW9zICAgICAgICAgICAgIDogdHJ1ZSxcblxuICAgICAgICAgICAgICAgIC8vIGV2ZW50c1xuICAgICAgICAgICAgICAgIG9uU2Nyb2xsICAgICAgICAgIDogbnVsbCwgLy8gZnVuY3Rpb24oY2FsY3VsYXRpb25zKSB7fVxuICAgICAgICAgICAgICAgIG9uSW5pdCAgICAgICAgICAgIDogbnVsbCwgLy8gZnVuY3Rpb24oKSB7fVxuICAgICAgICAgICAgICAgIG9uRGVzdHJveSAgICAgICAgIDogbnVsbCwgLy8gZnVuY3Rpb24oKSB7fVxuICAgICAgICAgICAgICAgIG9uQ292ZXJJbWFnZSAgICAgIDogbnVsbCAgLy8gZnVuY3Rpb24oKSB7fVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGRhdGFPcHRpb25zICAgICAgPSBKU09OLnBhcnNlKF90aGlzLiRpdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1qYXJhbGxheCcpIHx8ICd7fScpO1xuICAgICAgICAgICAgX3RoaXMub3B0aW9ucyAgICA9IF90aGlzLmV4dGVuZCh7fSwgX3RoaXMuZGVmYXVsdHMsIGRhdGFPcHRpb25zLCB1c2VyT3B0aW9ucyk7XG5cbiAgICAgICAgICAgIC8vIHN0b3AgaW5pdCBpZiBhbmRyb2lkIG9yIGlvc1xuICAgICAgICAgICAgaWYoIXN1cHBvcnRUcmFuc2Zvcm0gfHwgaXNBbmRyb2lkICYmIF90aGlzLm9wdGlvbnMubm9BbmRyb2lkIHx8IGlzSU9zICYmIF90aGlzLm9wdGlvbnMubm9Jb3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGZpeCBzcGVlZCBvcHRpb24gWy0xLjAsIDIuMF1cbiAgICAgICAgICAgIF90aGlzLm9wdGlvbnMuc3BlZWQgPSBNYXRoLm1pbigyLCBNYXRoLm1heCgtMSwgcGFyc2VGbG9hdChfdGhpcy5vcHRpb25zLnNwZWVkKSkpO1xuXG4gICAgICAgICAgICAvLyBjdXN0b20gZWxlbWVudCB0byBjaGVjayBpZiBwYXJhbGxheCBpbiB2aWV3cG9ydFxuICAgICAgICAgICAgdmFyIGVsZW1lbnRJblZQID0gX3RoaXMub3B0aW9ucy5lbGVtZW50SW5WaWV3cG9ydDtcbiAgICAgICAgICAgIC8vIGdldCBmaXJzdCBpdGVtIGZyb20gYXJyYXlcbiAgICAgICAgICAgIGlmKGVsZW1lbnRJblZQICYmIHR5cGVvZiBlbGVtZW50SW5WUCA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGVsZW1lbnRJblZQLmxlbmd0aCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50SW5WUCA9IGVsZW1lbnRJblZQWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgZG9tIGVsZW1lbnRcbiAgICAgICAgICAgIGlmKCFlbGVtZW50SW5WUCBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50SW5WUCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5vcHRpb25zLmVsZW1lbnRJblZpZXdwb3J0ID0gZWxlbWVudEluVlA7XG5cbiAgICAgICAgICAgIF90aGlzLmluc3RhbmNlSUQgPSBpbnN0YW5jZUlEKys7XG5cbiAgICAgICAgICAgIF90aGlzLmltYWdlICAgICAgPSB7XG4gICAgICAgICAgICAgICAgc3JjICAgICAgICA6IF90aGlzLm9wdGlvbnMuaW1nU3JjIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgJGNvbnRhaW5lciA6IG51bGwsXG4gICAgICAgICAgICAgICAgJGl0ZW0gICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgd2lkdGggICAgICA6IF90aGlzLm9wdGlvbnMuaW1nV2lkdGggfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBoZWlnaHQgICAgIDogX3RoaXMub3B0aW9ucy5pbWdIZWlnaHQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAvLyBmaXggZm9yIHNvbWUgZGV2aWNlc1xuICAgICAgICAgICAgICAgIC8vIHVzZSA8aW1nPiBpbnN0ZWFkIG9mIGJhY2tncm91bmQgaW1hZ2UgLSBtb3JlIHNtb290aGx5XG4gICAgICAgICAgICAgICAgdXNlSW1nVGFnICA6IGlzSU9zIHx8IGlzQW5kcm9pZCB8fCBpc0lFLFxuXG4gICAgICAgICAgICAgICAgLy8gcG9zaXRpb24gYWJzb2x1dGUgaXMgbmVlZGVkIG9uIElFOSBhbmQgRmlyZUZveCBiZWNhdXNlIGZpeGVkIHBvc2l0aW9uIGhhdmUgZ2xpdGNoZXNcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiAgIDogIXN1cHBvcnRUcmFuc2Zvcm0zRCB8fCBpc0ZpcmVmb3ggPyAnYWJzb2x1dGUnIDogJ2ZpeGVkJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoX3RoaXMuaW5pdEltZygpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuaW5pdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIEphcmFsbGF4X2lubmVyO1xuICAgIH0oKSk7XG5cbiAgICAvLyBhZGQgc3R5bGVzIHRvIGVsZW1lbnRcbiAgICBKYXJhbGxheC5wcm90b3R5cGUuY3NzID0gZnVuY3Rpb24gKGVsLCBzdHlsZXMpIHtcbiAgICAgICAgaWYodHlwZW9mIHN0eWxlcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGlmKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKS5nZXRQcm9wZXJ0eVZhbHVlKHN0eWxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZWwuc3R5bGVbc3R5bGVzXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCB0cmFuc2Zvcm0gcHJvcGVydHkgd2l0aCB2ZW5kb3IgcHJlZml4ZXNcbiAgICAgICAgaWYoc3R5bGVzLnRyYW5zZm9ybSkge1xuICAgICAgICAgICAgaWYgKHN1cHBvcnRUcmFuc2Zvcm0zRCkge1xuICAgICAgICAgICAgICAgIHN0eWxlcy50cmFuc2Zvcm0gKz0gJyB0cmFuc2xhdGVaKDApJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0eWxlcy5XZWJraXRUcmFuc2Zvcm0gPSBzdHlsZXMuTW96VHJhbnNmb3JtID0gc3R5bGVzLm1zVHJhbnNmb3JtID0gc3R5bGVzLk9UcmFuc2Zvcm0gPSBzdHlsZXMudHJhbnNmb3JtO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yKHZhciBrIGluIHN0eWxlcykge1xuICAgICAgICAgICAgZWwuc3R5bGVba10gPSBzdHlsZXNba107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVsO1xuICAgIH07XG4gICAgLy8gRXh0ZW5kIGxpa2UgalF1ZXJ5LmV4dGVuZFxuICAgIEphcmFsbGF4LnByb3RvdHlwZS5leHRlbmQgPSBmdW5jdGlvbiAob3V0KSB7XG4gICAgICAgIG91dCA9IG91dCB8fCB7fTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICghYXJndW1lbnRzW2ldKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYXJndW1lbnRzW2ldKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50c1tpXS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIG91dFtrZXldID0gYXJndW1lbnRzW2ldW2tleV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfTtcblxuICAgIC8vIEphcmFsbGF4IGZ1bmN0aW9uc1xuICAgIEphcmFsbGF4LnByb3RvdHlwZS5pbml0SW1nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIC8vIGdldCBpbWFnZSBzcmNcbiAgICAgICAgaWYoX3RoaXMuaW1hZ2Uuc3JjID09PSBudWxsKSB7XG4gICAgICAgICAgICBfdGhpcy5pbWFnZS5zcmMgPSBfdGhpcy5jc3MoX3RoaXMuJGl0ZW0sICdiYWNrZ3JvdW5kLWltYWdlJykucmVwbGFjZSgvXnVybFxcKFsnXCJdPy9nLCcnKS5yZXBsYWNlKC9bJ1wiXT9cXCkkL2csJycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhKCFfdGhpcy5pbWFnZS5zcmMgfHwgX3RoaXMuaW1hZ2Uuc3JjID09PSAnbm9uZScpO1xuICAgIH07XG5cbiAgICBKYXJhbGxheC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcyxcbiAgICAgICAgICAgIGNvbnRhaW5lclN0eWxlcyA9IHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiAgICAgICAgIDogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgICB0b3AgICAgICAgICAgICAgIDogMCxcbiAgICAgICAgICAgICAgICBsZWZ0ICAgICAgICAgICAgIDogMCxcbiAgICAgICAgICAgICAgICB3aWR0aCAgICAgICAgICAgIDogJzEwMCUnLFxuICAgICAgICAgICAgICAgIGhlaWdodCAgICAgICAgICAgOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgb3ZlcmZsb3cgICAgICAgICA6ICdoaWRkZW4nLFxuICAgICAgICAgICAgICAgIHBvaW50ZXJFdmVudHMgICAgOiAnbm9uZSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbWFnZVN0eWxlcyA9IHt9O1xuXG4gICAgICAgIC8vIHNhdmUgZGVmYXVsdCB1c2VyIHN0eWxlc1xuICAgICAgICBfdGhpcy4kaXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtamFyYWxsYXgtb3JpZ2luYWwtc3R5bGVzJywgX3RoaXMuJGl0ZW0uZ2V0QXR0cmlidXRlKCdzdHlsZScpKTtcblxuICAgICAgICAvLyBzZXQgcmVsYXRpdmUgcG9zaXRpb24gYW5kIHotaW5kZXggdG8gdGhlIHBhcmVudFxuICAgICAgICBpZiAoX3RoaXMuY3NzKF90aGlzLiRpdGVtLCAncG9zaXRpb24nKSA9PT0gJ3N0YXRpYycpIHtcbiAgICAgICAgICAgIF90aGlzLmNzcyhfdGhpcy4kaXRlbSwge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX3RoaXMuY3NzKF90aGlzLiRpdGVtLCAnei1pbmRleCcpID09PSAnYXV0bycpIHtcbiAgICAgICAgICAgIF90aGlzLmNzcyhfdGhpcy4kaXRlbSwge1xuICAgICAgICAgICAgICAgIHpJbmRleDogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjb250YWluZXIgZm9yIHBhcmFsbGF4IGltYWdlXG4gICAgICAgIF90aGlzLmltYWdlLiRjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgX3RoaXMuY3NzKF90aGlzLmltYWdlLiRjb250YWluZXIsIGNvbnRhaW5lclN0eWxlcyk7XG4gICAgICAgIF90aGlzLmNzcyhfdGhpcy5pbWFnZS4kY29udGFpbmVyLCB7XG4gICAgICAgICAgICB2aXNpYmlsaXR5IDogJ2hpZGRlbicsXG4gICAgICAgICAgICAnei1pbmRleCcgIDogX3RoaXMub3B0aW9ucy56SW5kZXhcbiAgICAgICAgfSk7XG4gICAgICAgIF90aGlzLmltYWdlLiRjb250YWluZXIuc2V0QXR0cmlidXRlKCdpZCcsICdqYXJhbGxheC1jb250YWluZXItJyArIF90aGlzLmluc3RhbmNlSUQpO1xuICAgICAgICBfdGhpcy4kaXRlbS5hcHBlbmRDaGlsZChfdGhpcy5pbWFnZS4kY29udGFpbmVyKTtcblxuICAgICAgICAvLyB1c2UgaW1nIHRhZ1xuICAgICAgICBpZihfdGhpcy5pbWFnZS51c2VJbWdUYWcpIHtcbiAgICAgICAgICAgIF90aGlzLmltYWdlLiRpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgICAgICBfdGhpcy5pbWFnZS4kaXRlbS5zZXRBdHRyaWJ1dGUoJ3NyYycsIF90aGlzLmltYWdlLnNyYyk7XG4gICAgICAgICAgICBpbWFnZVN0eWxlcyA9IF90aGlzLmV4dGVuZCh7XG4gICAgICAgICAgICAgICAgJ21heC13aWR0aCcgOiAnbm9uZSdcbiAgICAgICAgICAgIH0sIGNvbnRhaW5lclN0eWxlcywgaW1hZ2VTdHlsZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXNlIGRpdiB3aXRoIGJhY2tncm91bmQgaW1hZ2VcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBfdGhpcy5pbWFnZS4kaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgaW1hZ2VTdHlsZXMgPSBfdGhpcy5leHRlbmQoe1xuICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLXBvc2l0aW9uJyA6ICc1MCUgNTAlJyxcbiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1zaXplJyAgICAgOiAnMTAwJSBhdXRvJyxcbiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1yZXBlYXQnICAgOiAnbm8tcmVwZWF0IG5vLXJlcGVhdCcsXG4gICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtaW1hZ2UnICAgIDogJ3VybChcIicgKyBfdGhpcy5pbWFnZS5zcmMgKyAnXCIpJ1xuICAgICAgICAgICAgfSwgY29udGFpbmVyU3R5bGVzLCBpbWFnZVN0eWxlcyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjaGVjayBpZiBvbmUgb2YgcGFyZW50cyBoYXZlIHRyYW5zZm9ybSBzdHlsZSAod2l0aG91dCB0aGlzIGNoZWNrLCBzY3JvbGwgdHJhbnNmb3JtIHdpbGwgYmUgaW52ZXJ0ZWQpXG4gICAgICAgIC8vIGRpc2N1c3Npb24gLSBodHRwczovL2dpdGh1Yi5jb20vbmstby9qYXJhbGxheC9pc3N1ZXMvOVxuICAgICAgICB2YXIgcGFyZW50V2l0aFRyYW5zZm9ybSA9IDA7XG4gICAgICAgIHZhciAkaXRlbVBhcmVudHMgPSBfdGhpcy4kaXRlbTtcbiAgICAgICAgd2hpbGUgKCRpdGVtUGFyZW50cyAhPT0gbnVsbCAmJiAkaXRlbVBhcmVudHMgIT09IGRvY3VtZW50ICYmIHBhcmVudFdpdGhUcmFuc2Zvcm0gPT09IDApIHtcbiAgICAgICAgICAgIHZhciBwYXJlbnRfdHJhbnNmb3JtID0gX3RoaXMuY3NzKCRpdGVtUGFyZW50cywgJy13ZWJraXQtdHJhbnNmb3JtJykgfHwgX3RoaXMuY3NzKCRpdGVtUGFyZW50cywgJy1tb3otdHJhbnNmb3JtJykgfHwgX3RoaXMuY3NzKCRpdGVtUGFyZW50cywgJ3RyYW5zZm9ybScpO1xuICAgICAgICAgICAgaWYocGFyZW50X3RyYW5zZm9ybSAmJiBwYXJlbnRfdHJhbnNmb3JtICE9PSAnbm9uZScpIHtcbiAgICAgICAgICAgICAgICBwYXJlbnRXaXRoVHJhbnNmb3JtID0gMTtcblxuICAgICAgICAgICAgICAgIC8vIGFkZCB0cmFuc2Zvcm0gb24gcGFyYWxsYXggY29udGFpbmVyIGlmIHRoZXJlIGlzIHBhcmVudCB3aXRoIHRyYW5zZm9ybVxuICAgICAgICAgICAgICAgIF90aGlzLmNzcyhfdGhpcy5pbWFnZS4kY29udGFpbmVyLCB7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoMCkgdHJhbnNsYXRlWSgwKSdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRpdGVtUGFyZW50cyA9ICRpdGVtUGFyZW50cy5wYXJlbnROb2RlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWJzb2x1dGUgcG9zaXRpb24gaWYgb25lIG9mIHBhcmVudHMgaGF2ZSB0cmFuc2Zvcm1hdGlvbnMgb3IgcGFyYWxsYXggd2l0aG91dCBzY3JvbGxcbiAgICAgICAgaWYgKHBhcmVudFdpdGhUcmFuc2Zvcm0gfHwgX3RoaXMub3B0aW9ucy50eXBlID09PSAnb3BhY2l0eSd8fCBfdGhpcy5vcHRpb25zLnR5cGUgPT09ICdzY2FsZScgfHwgX3RoaXMub3B0aW9ucy50eXBlID09PSAnc2NhbGUtb3BhY2l0eScpIHtcbiAgICAgICAgICAgIF90aGlzLmltYWdlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCBwb3NpdGlvbiB0byBwYXJhbGxheCBibG9ja1xuICAgICAgICBpbWFnZVN0eWxlcy5wb3NpdGlvbiA9IF90aGlzLmltYWdlLnBvc2l0aW9uO1xuXG4gICAgICAgIC8vIHBhcmFsbGF4IGltYWdlXG4gICAgICAgIF90aGlzLmNzcyhfdGhpcy5pbWFnZS4kaXRlbSwgaW1hZ2VTdHlsZXMpO1xuICAgICAgICBfdGhpcy5pbWFnZS4kY29udGFpbmVyLmFwcGVuZENoaWxkKF90aGlzLmltYWdlLiRpdGVtKTtcblxuICAgICAgICAvLyBjb3ZlciBpbWFnZSBpZiB3aWR0aCBhbmQgaGVpZ2h0IGlzIHJlYWR5XG4gICAgICAgIGZ1bmN0aW9uIGluaXRBZnRlclJlYWR5ICgpIHtcbiAgICAgICAgICAgIF90aGlzLmNvdmVySW1hZ2UoKTtcbiAgICAgICAgICAgIF90aGlzLmNsaXBDb250YWluZXIoKTtcbiAgICAgICAgICAgIF90aGlzLm9uU2Nyb2xsKHRydWUpO1xuXG4gICAgICAgICAgICAvLyBjYWxsIG9uSW5pdCBldmVudFxuICAgICAgICAgICAgaWYoX3RoaXMub3B0aW9ucy5vbkluaXQpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5vcHRpb25zLm9uSW5pdC5jYWxsKF90aGlzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdGltZW91dCB0byBmaXggSUUgYmxpbmtpbmdcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmKF90aGlzLiRpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBkZWZhdWx0IHVzZXIgYmFja2dyb3VuZFxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jc3MoX3RoaXMuJGl0ZW0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLWltYWdlJyAgICAgIDogJ25vbmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtYXR0YWNobWVudCcgOiAnc2Nyb2xsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLXNpemUnICAgICAgIDogJ2F1dG8nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoX3RoaXMuaW1hZ2Uud2lkdGggJiYgX3RoaXMuaW1hZ2UuaGVpZ2h0KSB7XG4gICAgICAgICAgICAvLyBpbml0IGlmIHdpZHRoIGFuZCBoZWlnaHQgYWxyZWFkeSBleGlzdHNcbiAgICAgICAgICAgIGluaXRBZnRlclJlYWR5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBsb2FkIGltYWdlIGFuZCBnZXQgd2lkdGggYW5kIGhlaWdodFxuICAgICAgICAgICAgX3RoaXMuZ2V0SW1hZ2VTaXplKF90aGlzLmltYWdlLnNyYywgZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5pbWFnZS53aWR0aCAgPSB3aWR0aDtcbiAgICAgICAgICAgICAgICBfdGhpcy5pbWFnZS5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgICAgICAgICAgaW5pdEFmdGVyUmVhZHkoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgamFyYWxsYXhMaXN0LnB1c2goX3RoaXMpO1xuICAgIH07XG5cbiAgICBKYXJhbGxheC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICAvLyByZW1vdmUgZnJvbSBpbnN0YW5jZXMgbGlzdFxuICAgICAgICBmb3IodmFyIGsgPSAwLCBsZW4gPSBqYXJhbGxheExpc3QubGVuZ3RoOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgICAgICAgIGlmKGphcmFsbGF4TGlzdFtrXS5pbnN0YW5jZUlEID09PSBfdGhpcy5pbnN0YW5jZUlEKSB7XG4gICAgICAgICAgICAgICAgamFyYWxsYXhMaXN0LnNwbGljZShrLCAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJldHVybiBzdHlsZXMgb24gY29udGFpbmVyIGFzIGJlZm9yZSBqYXJhbGxheCBpbml0XG4gICAgICAgIHZhciBvcmlnaW5hbFN0eWxlc1RhZyA9IF90aGlzLiRpdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1qYXJhbGxheC1vcmlnaW5hbC1zdHlsZXMnKTtcbiAgICAgICAgX3RoaXMuJGl0ZW0ucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWphcmFsbGF4LW9yaWdpbmFsLXN0eWxlcycpO1xuICAgICAgICAvLyBudWxsIG9jY3VycyBpZiB0aGVyZSBpcyBubyBzdHlsZSB0YWcgYmVmb3JlIGphcmFsbGF4IGluaXRcbiAgICAgICAgaWYob3JpZ2luYWxTdHlsZXNUYWcgPT09ICdudWxsJykge1xuICAgICAgICAgICAgX3RoaXMuJGl0ZW0ucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX3RoaXMuJGl0ZW0uc2V0QXR0cmlidXRlKCdzdHlsZScsIG9yaWdpbmFsU3R5bGVzVGFnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJlbW92ZSBhZGRpdGlvbmFsIGRvbSBlbGVtZW50c1xuICAgICAgICBpZihfdGhpcy4kY2xpcFN0eWxlcykge1xuICAgICAgICAgICAgX3RoaXMuJGNsaXBTdHlsZXMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChfdGhpcy4kY2xpcFN0eWxlcyk7XG4gICAgICAgIH1cbiAgICAgICAgX3RoaXMuaW1hZ2UuJGNvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKF90aGlzLmltYWdlLiRjb250YWluZXIpO1xuXG4gICAgICAgIC8vIGNhbGwgb25EZXN0cm95IGV2ZW50XG4gICAgICAgIGlmKF90aGlzLm9wdGlvbnMub25EZXN0cm95KSB7XG4gICAgICAgICAgICBfdGhpcy5vcHRpb25zLm9uRGVzdHJveS5jYWxsKF90aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGRlbGV0ZSBqYXJhbGxheCBmcm9tIGl0ZW1cbiAgICAgICAgZGVsZXRlIF90aGlzLiRpdGVtLmphcmFsbGF4O1xuXG4gICAgICAgIC8vIGRlbGV0ZSBhbGwgdmFyaWFibGVzXG4gICAgICAgIGZvcih2YXIgbiBpbiBfdGhpcykge1xuICAgICAgICAgICAgZGVsZXRlIF90aGlzW25dO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIEphcmFsbGF4LnByb3RvdHlwZS5nZXRJbWFnZVNpemUgPSBmdW5jdGlvbiAoc3JjLCBjYWxsYmFjaykge1xuICAgICAgICBpZighc3JjIHx8ICFjYWxsYmFjaykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHRlbXBJbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgdGVtcEltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjYWxsYmFjayh0ZW1wSW1nLndpZHRoLCB0ZW1wSW1nLmhlaWdodCk7XG4gICAgICAgIH07XG4gICAgICAgIHRlbXBJbWcuc3JjID0gc3JjO1xuICAgIH07XG5cbiAgICAvLyBpdCB3aWxsIHJlbW92ZSBzb21lIGltYWdlIG92ZXJsYXBwaW5nXG4gICAgLy8gb3ZlcmxhcHBpbmcgb2NjdXIgZHVlIHRvIGFuIGltYWdlIHBvc2l0aW9uIGZpeGVkIGluc2lkZSBhYnNvbHV0ZSBwb3NpdGlvbiBlbGVtZW50ICh3ZWJraXQgYmFzZWQgYnJvd3NlcnMgd29ya3Mgd2l0aG91dCBhbnkgZml4KVxuICAgIEphcmFsbGF4LnByb3RvdHlwZS5jbGlwQ29udGFpbmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBjbGlwIGlzIG5vdCB3b3JraW5nIHByb3Blcmx5IG9uIHJlYWwgSUU5IGFuZCBsZXNzXG4gICAgICAgIGlmKGlzSUVsdDEwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgX3RoaXMgID0gdGhpcyxcbiAgICAgICAgICAgIHJlY3QgICA9IF90aGlzLmltYWdlLiRjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICB3aWR0aCAgPSByZWN0LndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XG5cbiAgICAgICAgaWYoIV90aGlzLiRjbGlwU3R5bGVzKSB7XG4gICAgICAgICAgICBfdGhpcy4kY2xpcFN0eWxlcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XG4gICAgICAgICAgICBfdGhpcy4kY2xpcFN0eWxlcy5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dC9jc3MnKTtcbiAgICAgICAgICAgIF90aGlzLiRjbGlwU3R5bGVzLnNldEF0dHJpYnV0ZSgnaWQnLCAnI2phcmFsbGF4LWNsaXAtJyArIF90aGlzLmluc3RhbmNlSUQpO1xuICAgICAgICAgICAgdmFyIGhlYWQgPSBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gICAgICAgICAgICBoZWFkLmFwcGVuZENoaWxkKF90aGlzLiRjbGlwU3R5bGVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzdHlsZXMgPSBbXG4gICAgICAgICAgICAnI2phcmFsbGF4LWNvbnRhaW5lci0nICsgX3RoaXMuaW5zdGFuY2VJRCArICcgeycsXG4gICAgICAgICAgICAnICAgY2xpcDogcmVjdCgwICcgKyB3aWR0aCArICdweCAnICsgaGVpZ2h0ICsgJ3B4IDApOycsXG4gICAgICAgICAgICAnICAgY2xpcDogcmVjdCgwLCAnICsgd2lkdGggKyAncHgsICcgKyBoZWlnaHQgKyAncHgsIDApOycsXG4gICAgICAgICAgICAnfSdcbiAgICAgICAgXS5qb2luKCdcXG4nKTtcblxuICAgICAgICAvLyBhZGQgY2xpcCBzdHlsZXMgaW5saW5lICh0aGlzIG1ldGhvZCBuZWVkIGZvciBzdXBwb3J0IElFOCBhbmQgbGVzcyBicm93c2VycylcbiAgICAgICAgaWYgKF90aGlzLiRjbGlwU3R5bGVzLnN0eWxlU2hlZXQpe1xuICAgICAgICAgICAgX3RoaXMuJGNsaXBTdHlsZXMuc3R5bGVTaGVldC5jc3NUZXh0ID0gc3R5bGVzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX3RoaXMuJGNsaXBTdHlsZXMuaW5uZXJIVE1MID0gc3R5bGVzO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIEphcmFsbGF4LnByb3RvdHlwZS5jb3ZlckltYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIGlmKCFfdGhpcy5pbWFnZS53aWR0aCB8fCAhX3RoaXMuaW1hZ2UuaGVpZ2h0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmVjdCAgICAgICA9IF90aGlzLmltYWdlLiRjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICBjb250VyAgICAgID0gcmVjdC53aWR0aCxcbiAgICAgICAgICAgIGNvbnRIICAgICAgPSByZWN0LmhlaWdodCxcbiAgICAgICAgICAgIGNvbnRMICAgICAgPSByZWN0LmxlZnQsXG4gICAgICAgICAgICBpbWdXICAgICAgID0gX3RoaXMuaW1hZ2Uud2lkdGgsXG4gICAgICAgICAgICBpbWdIICAgICAgID0gX3RoaXMuaW1hZ2UuaGVpZ2h0LFxuICAgICAgICAgICAgc3BlZWQgICAgICA9IF90aGlzLm9wdGlvbnMuc3BlZWQsXG4gICAgICAgICAgICBpc1Njcm9sbCAgID0gX3RoaXMub3B0aW9ucy50eXBlID09PSAnc2Nyb2xsJyB8fCBfdGhpcy5vcHRpb25zLnR5cGUgPT09ICdzY3JvbGwtb3BhY2l0eScsXG4gICAgICAgICAgICBzY3JvbGxEaXN0ID0gMCxcbiAgICAgICAgICAgIHJlc3VsdFcgICAgPSAwLFxuICAgICAgICAgICAgcmVzdWx0SCAgICA9IGNvbnRILFxuICAgICAgICAgICAgcmVzdWx0TUwgICA9IDAsXG4gICAgICAgICAgICByZXN1bHRNVCAgID0gMDtcblxuICAgICAgICAvLyBzY3JvbGwgcGFyYWxsYXhcbiAgICAgICAgaWYoaXNTY3JvbGwpIHtcbiAgICAgICAgICAgIC8vIHNjcm9sbCBkaXN0YW5jZSBhbmQgaGVpZ2h0IGZvciBpbWFnZVxuICAgICAgICAgICAgaWYgKHNwZWVkIDwgMCkge1xuICAgICAgICAgICAgICAgIHNjcm9sbERpc3QgPSBzcGVlZCAqIE1hdGgubWF4KGNvbnRILCB3bmRIKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2Nyb2xsRGlzdCA9IHNwZWVkICogKGNvbnRIICsgd25kSCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNpemUgZm9yIHNjcm9sbCBwYXJhbGxheFxuICAgICAgICAgICAgaWYgKHNwZWVkID4gMSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdEggPSBNYXRoLmFicyhzY3JvbGxEaXN0IC0gd25kSCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNwZWVkIDwgMCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdEggPSBzY3JvbGxEaXN0IC8gc3BlZWQgKyBNYXRoLmFicyhzY3JvbGxEaXN0KTtcbiAgICAgICAgICAgIH0gIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdEggKz0gTWF0aC5hYnMod25kSCAtIGNvbnRIKSAqICgxIC0gc3BlZWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY3JvbGxEaXN0IC89IDI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjYWxjdWxhdGUgd2lkdGggcmVsYXRpdmUgdG8gaGVpZ2h0IGFuZCBpbWFnZSBzaXplXG4gICAgICAgIHJlc3VsdFcgPSByZXN1bHRIICogaW1nVyAvIGltZ0g7XG4gICAgICAgIGlmKHJlc3VsdFcgPCBjb250Vykge1xuICAgICAgICAgICAgcmVzdWx0VyA9IGNvbnRXO1xuICAgICAgICAgICAgcmVzdWx0SCA9IHJlc3VsdFcgKiBpbWdIIC8gaW1nVztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNlbnRlciBwYXJhbGxheCBpbWFnZVxuICAgICAgICBpZihpc1Njcm9sbCkge1xuICAgICAgICAgICAgcmVzdWx0TUwgPSBjb250TCArIChjb250VyAtIHJlc3VsdFcpIC8gMjtcbiAgICAgICAgICAgIHJlc3VsdE1UID0gKHduZEggLSByZXN1bHRIKSAvIDI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHRNTCA9IChjb250VyAtIHJlc3VsdFcpIC8gMjtcbiAgICAgICAgICAgIHJlc3VsdE1UID0gKGNvbnRIIC0gcmVzdWx0SCkgLyAyO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZml4IGlmIHBhcmFsbGF4IGJsb2NrIGluIGFic29sdXRlIHBvc2l0aW9uXG4gICAgICAgIGlmKF90aGlzLmltYWdlLnBvc2l0aW9uID09PSAnYWJzb2x1dGUnKSB7XG4gICAgICAgICAgICByZXN1bHRNTCAtPSBjb250TDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHN0b3JlIHNjcm9sbCBkaXN0YW5jZVxuICAgICAgICBfdGhpcy5wYXJhbGxheFNjcm9sbERpc3RhbmNlID0gc2Nyb2xsRGlzdDtcblxuICAgICAgICAvLyBhcHBseSByZXN1bHQgdG8gaXRlbVxuICAgICAgICBfdGhpcy5jc3MoX3RoaXMuaW1hZ2UuJGl0ZW0sIHtcbiAgICAgICAgICAgIHdpZHRoOiByZXN1bHRXICsgJ3B4JyxcbiAgICAgICAgICAgIGhlaWdodDogcmVzdWx0SCArICdweCcsXG4gICAgICAgICAgICBtYXJnaW5MZWZ0OiByZXN1bHRNTCArICdweCcsXG4gICAgICAgICAgICBtYXJnaW5Ub3A6IHJlc3VsdE1UICsgJ3B4J1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBjYWxsIG9uQ292ZXJJbWFnZSBldmVudFxuICAgICAgICBpZihfdGhpcy5vcHRpb25zLm9uQ292ZXJJbWFnZSkge1xuICAgICAgICAgICAgX3RoaXMub3B0aW9ucy5vbkNvdmVySW1hZ2UuY2FsbChfdGhpcyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgSmFyYWxsYXgucHJvdG90eXBlLmlzVmlzaWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNFbGVtZW50SW5WaWV3cG9ydCB8fCBmYWxzZTtcbiAgICB9O1xuXG4gICAgSmFyYWxsYXgucHJvdG90eXBlLm9uU2Nyb2xsID0gZnVuY3Rpb24gKGZvcmNlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgaWYoIV90aGlzLmltYWdlLndpZHRoIHx8ICFfdGhpcy5pbWFnZS5oZWlnaHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZWN0ICAgPSBfdGhpcy4kaXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgICAgICAgIGNvbnRUICA9IHJlY3QudG9wLFxuICAgICAgICAgICAgY29udEggID0gcmVjdC5oZWlnaHQsXG4gICAgICAgICAgICBzdHlsZXMgPSB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eSAgICAgICAgIDogJ3Zpc2libGUnLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbiA6ICc1MCUgNTAlJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvLyBjaGVjayBpZiBpbiB2aWV3cG9ydFxuICAgICAgICB2YXIgdmlld3BvcnRSZWN0ID0gcmVjdDtcbiAgICAgICAgaWYoX3RoaXMub3B0aW9ucy5lbGVtZW50SW5WaWV3cG9ydCkge1xuICAgICAgICAgICAgdmlld3BvcnRSZWN0ID0gX3RoaXMub3B0aW9ucy5lbGVtZW50SW5WaWV3cG9ydC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgfVxuICAgICAgICBfdGhpcy5pc0VsZW1lbnRJblZpZXdwb3J0ID1cbiAgICAgICAgICAgIHZpZXdwb3J0UmVjdC5ib3R0b20gPj0gMCAmJlxuICAgICAgICAgICAgdmlld3BvcnRSZWN0LnJpZ2h0ID49IDAgJiZcbiAgICAgICAgICAgIHZpZXdwb3J0UmVjdC50b3AgPD0gd25kSCAmJlxuICAgICAgICAgICAgdmlld3BvcnRSZWN0LmxlZnQgPD0gd25kVztcblxuICAgICAgICAvLyBzdG9wIGNhbGN1bGF0aW9ucyBpZiBpdGVtIGlzIG5vdCBpbiB2aWV3cG9ydFxuICAgICAgICBpZiAoZm9yY2UgPyBmYWxzZSA6ICFfdGhpcy5pc0VsZW1lbnRJblZpZXdwb3J0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjYWxjdWxhdGUgcGFyYWxsYXggaGVscGluZyB2YXJpYWJsZXNcbiAgICAgICAgdmFyIGJlZm9yZVRvcCA9IE1hdGgubWF4KDAsIGNvbnRUKSxcbiAgICAgICAgICAgIGJlZm9yZVRvcEVuZCA9IE1hdGgubWF4KDAsIGNvbnRIICsgY29udFQpLFxuICAgICAgICAgICAgYWZ0ZXJUb3AgPSBNYXRoLm1heCgwLCAtY29udFQpLFxuICAgICAgICAgICAgYmVmb3JlQm90dG9tID0gTWF0aC5tYXgoMCwgY29udFQgKyBjb250SCAtIHduZEgpLFxuICAgICAgICAgICAgYmVmb3JlQm90dG9tRW5kID0gTWF0aC5tYXgoMCwgY29udEggLSAoY29udFQgKyBjb250SCAtIHduZEgpKSxcbiAgICAgICAgICAgIGFmdGVyQm90dG9tID0gTWF0aC5tYXgoMCwgLWNvbnRUICsgd25kSCAtIGNvbnRIKSxcbiAgICAgICAgICAgIGZyb21WaWV3cG9ydENlbnRlciA9IDEgLSAyICogKHduZEggLSBjb250VCkgLyAod25kSCArIGNvbnRIKTtcblxuICAgICAgICAvLyBjYWxjdWxhdGUgb24gaG93IHBlcmNlbnQgb2Ygc2VjdGlvbiBpcyB2aXNpYmxlXG4gICAgICAgIHZhciB2aXNpYmxlUGVyY2VudCA9IDE7XG4gICAgICAgIGlmKGNvbnRIIDwgd25kSCkge1xuICAgICAgICAgICAgdmlzaWJsZVBlcmNlbnQgPSAxIC0gKGFmdGVyVG9wIHx8IGJlZm9yZUJvdHRvbSkgLyBjb250SDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmKGJlZm9yZVRvcEVuZCA8PSB3bmRIKSB7XG4gICAgICAgICAgICAgICAgdmlzaWJsZVBlcmNlbnQgPSBiZWZvcmVUb3BFbmQgLyB3bmRIO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChiZWZvcmVCb3R0b21FbmQgPD0gd25kSCkge1xuICAgICAgICAgICAgICAgIHZpc2libGVQZXJjZW50ID0gYmVmb3JlQm90dG9tRW5kIC8gd25kSDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG9wYWNpdHlcbiAgICAgICAgaWYoX3RoaXMub3B0aW9ucy50eXBlID09PSAnb3BhY2l0eScgfHwgX3RoaXMub3B0aW9ucy50eXBlID09PSAnc2NhbGUtb3BhY2l0eScgfHwgX3RoaXMub3B0aW9ucy50eXBlID09PSAnc2Nyb2xsLW9wYWNpdHknKSB7XG4gICAgICAgICAgICBzdHlsZXMudHJhbnNmb3JtID0gJyc7IC8vIGVtcHR5IHRvIGFkZCB0cmFuc2xhdGVaKDApIHdoZXJlIGl0IGlzIHBvc3NpYmxlXG4gICAgICAgICAgICBzdHlsZXMub3BhY2l0eSA9IHZpc2libGVQZXJjZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2NhbGVcbiAgICAgICAgaWYoX3RoaXMub3B0aW9ucy50eXBlID09PSAnc2NhbGUnIHx8IF90aGlzLm9wdGlvbnMudHlwZSA9PT0gJ3NjYWxlLW9wYWNpdHknKSB7XG4gICAgICAgICAgICB2YXIgc2NhbGUgPSAxO1xuICAgICAgICAgICAgaWYoX3RoaXMub3B0aW9ucy5zcGVlZCA8IDApIHtcbiAgICAgICAgICAgICAgICBzY2FsZSAtPSBfdGhpcy5vcHRpb25zLnNwZWVkICogdmlzaWJsZVBlcmNlbnQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNjYWxlICs9IF90aGlzLm9wdGlvbnMuc3BlZWQgKiAoMSAtIHZpc2libGVQZXJjZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0eWxlcy50cmFuc2Zvcm0gPSAnc2NhbGUoJyArIHNjYWxlICsgJyknO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2Nyb2xsXG4gICAgICAgIGlmKF90aGlzLm9wdGlvbnMudHlwZSA9PT0gJ3Njcm9sbCcgfHwgX3RoaXMub3B0aW9ucy50eXBlID09PSAnc2Nyb2xsLW9wYWNpdHknKSB7XG4gICAgICAgICAgICB2YXIgcG9zaXRpb25ZID0gX3RoaXMucGFyYWxsYXhTY3JvbGxEaXN0YW5jZSAqIGZyb21WaWV3cG9ydENlbnRlcjtcblxuICAgICAgICAgICAgLy8gZml4IGlmIHBhcmFsbGF4IGJsb2NrIGluIGFic29sdXRlIHBvc2l0aW9uXG4gICAgICAgICAgICBpZihfdGhpcy5pbWFnZS5wb3NpdGlvbiA9PT0gJ2Fic29sdXRlJykge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uWSAtPSBjb250VDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3R5bGVzLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKCcgKyBwb3NpdGlvblkgKyAncHgpJztcbiAgICAgICAgfVxuXG4gICAgICAgIF90aGlzLmNzcyhfdGhpcy5pbWFnZS4kaXRlbSwgc3R5bGVzKTtcblxuICAgICAgICAvLyBjYWxsIG9uU2Nyb2xsIGV2ZW50XG4gICAgICAgIGlmKF90aGlzLm9wdGlvbnMub25TY3JvbGwpIHtcbiAgICAgICAgICAgIF90aGlzLm9wdGlvbnMub25TY3JvbGwuY2FsbChfdGhpcywge1xuICAgICAgICAgICAgICAgIHNlY3Rpb246IHJlY3QsXG5cbiAgICAgICAgICAgICAgICBiZWZvcmVUb3A6IGJlZm9yZVRvcCxcbiAgICAgICAgICAgICAgICBiZWZvcmVUb3BFbmQ6IGJlZm9yZVRvcEVuZCxcbiAgICAgICAgICAgICAgICBhZnRlclRvcDogYWZ0ZXJUb3AsXG4gICAgICAgICAgICAgICAgYmVmb3JlQm90dG9tOiBiZWZvcmVCb3R0b20sXG4gICAgICAgICAgICAgICAgYmVmb3JlQm90dG9tRW5kOiBiZWZvcmVCb3R0b21FbmQsXG4gICAgICAgICAgICAgICAgYWZ0ZXJCb3R0b206IGFmdGVyQm90dG9tLFxuXG4gICAgICAgICAgICAgICAgdmlzaWJsZVBlcmNlbnQ6IHZpc2libGVQZXJjZW50LFxuICAgICAgICAgICAgICAgIGZyb21WaWV3cG9ydENlbnRlcjogZnJvbVZpZXdwb3J0Q2VudGVyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8vIGluaXQgZXZlbnRzXG4gICAgZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lciAoZWwsIGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgICAgICBpZiAoZWwuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhhbmRsZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWwuYXR0YWNoRXZlbnQoJ29uJyArIGV2ZW50TmFtZSwgZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgaGFuZGxlci5jYWxsKGVsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXBkYXRlIChlKSB7XG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYoZS50eXBlICE9PSAnc2Nyb2xsJykge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVduZFZhcnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvcih2YXIgayA9IDAsIGxlbiA9IGphcmFsbGF4TGlzdC5sZW5ndGg7IGsgPCBsZW47IGsrKykge1xuICAgICAgICAgICAgICAgIC8vIGNvdmVyIGltYWdlIGFuZCBjbGlwIG5lZWRlZCBvbmx5IHdoZW4gcGFyYWxsYXggY29udGFpbmVyIHdhcyBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgaWYoZS50eXBlICE9PSAnc2Nyb2xsJykge1xuICAgICAgICAgICAgICAgICAgICBqYXJhbGxheExpc3Rba10uY292ZXJJbWFnZSgpO1xuICAgICAgICAgICAgICAgICAgICBqYXJhbGxheExpc3Rba10uY2xpcENvbnRhaW5lcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBqYXJhbGxheExpc3Rba10ub25TY3JvbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFkZEV2ZW50TGlzdGVuZXIod2luZG93LCAnc2Nyb2xsJywgdXBkYXRlKTtcbiAgICBhZGRFdmVudExpc3RlbmVyKHdpbmRvdywgJ3Jlc2l6ZScsIHVwZGF0ZSk7XG4gICAgYWRkRXZlbnRMaXN0ZW5lcih3aW5kb3csICdvcmllbnRhdGlvbmNoYW5nZScsIHVwZGF0ZSk7XG4gICAgYWRkRXZlbnRMaXN0ZW5lcih3aW5kb3csICdsb2FkJywgdXBkYXRlKTtcblxuXG4gICAgLy8gZ2xvYmFsIGRlZmluaXRpb25cbiAgICB2YXIgcGx1Z2luID0gZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICAgIC8vIGNoZWNrIGZvciBkb20gZWxlbWVudFxuICAgICAgICAvLyB0aGFua3M6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzg0Mjg2L2phdmFzY3JpcHQtaXNkb20taG93LWRvLXlvdS1jaGVjay1pZi1hLWphdmFzY3JpcHQtb2JqZWN0LWlzLWEtZG9tLW9iamVjdFxuICAgICAgICBpZih0eXBlb2YgSFRNTEVsZW1lbnQgPT09IFwib2JqZWN0XCIgPyBpdGVtcyBpbnN0YW5jZW9mIEhUTUxFbGVtZW50IDogaXRlbXMgJiYgdHlwZW9mIGl0ZW1zID09PSBcIm9iamVjdFwiICYmIGl0ZW1zICE9PSBudWxsICYmIGl0ZW1zLm5vZGVUeXBlID09PSAxICYmIHR5cGVvZiBpdGVtcy5ub2RlTmFtZT09PVwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIGl0ZW1zID0gW2l0ZW1zXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzWzFdLFxuICAgICAgICAgICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMiksXG4gICAgICAgICAgICBsZW4gPSBpdGVtcy5sZW5ndGgsXG4gICAgICAgICAgICBrID0gMCxcbiAgICAgICAgICAgIHJldDtcblxuICAgICAgICBmb3IgKGs7IGsgPCBsZW47IGsrKykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0JyB8fCB0eXBlb2Ygb3B0aW9ucyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBpZighaXRlbXNba10uamFyYWxsYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNba10uamFyYWxsYXggPSBuZXcgSmFyYWxsYXgoaXRlbXNba10sIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoaXRlbXNba10uamFyYWxsYXgpIHtcbiAgICAgICAgICAgICAgICByZXQgPSBpdGVtc1trXS5qYXJhbGxheFtvcHRpb25zXS5hcHBseShpdGVtc1trXS5qYXJhbGxheCwgYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHJldCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgIH07XG4gICAgcGx1Z2luLmNvbnN0cnVjdG9yID0gSmFyYWxsYXg7XG5cbiAgICAvLyBubyBjb25mbGljdFxuICAgIHZhciBvbGRQbHVnaW4gPSB3aW5kb3cuamFyYWxsYXg7XG4gICAgd2luZG93LmphcmFsbGF4ID0gcGx1Z2luO1xuICAgIHdpbmRvdy5qYXJhbGxheC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB3aW5kb3cuamFyYWxsYXggPSBvbGRQbHVnaW47XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICAvLyBqUXVlcnkgc3VwcG9ydFxuICAgIGlmKHR5cGVvZiBqUXVlcnkgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHZhciBqUXVlcnlQbHVnaW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cyB8fCBbXTtcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS51bnNoaWZ0LmNhbGwoYXJncywgdGhpcyk7XG4gICAgICAgICAgICB2YXIgcmVzID0gcGx1Z2luLmFwcGx5KHdpbmRvdywgYXJncyk7XG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIHJlcyAhPT0gJ29iamVjdCcgPyByZXMgOiB0aGlzO1xuICAgICAgICB9O1xuICAgICAgICBqUXVlcnlQbHVnaW4uY29uc3RydWN0b3IgPSBKYXJhbGxheDtcblxuICAgICAgICAvLyBubyBjb25mbGljdFxuICAgICAgICB2YXIgb2xkSnFQbHVnaW4gPSBqUXVlcnkuZm4uamFyYWxsYXg7XG4gICAgICAgIGpRdWVyeS5mbi5qYXJhbGxheCA9IGpRdWVyeVBsdWdpbjtcbiAgICAgICAgalF1ZXJ5LmZuLmphcmFsbGF4Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqUXVlcnkuZm4uamFyYWxsYXggPSBvbGRKcVBsdWdpbjtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vIGRhdGEtamFyYWxsYXggaW5pdGlhbGl6YXRpb25cbiAgICBhZGRFdmVudExpc3RlbmVyKHdpbmRvdywgJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHBsdWdpbihkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1qYXJhbGxheF0sIFtkYXRhLWphcmFsbGF4LXZpZGVvXScpKTtcbiAgICB9KTtcbn0od2luZG93KSk7IiwiLyohXG4gTWFpbGNoaW1wIEFqYXggU3VibWl0XG4galF1ZXJ5IFBsdWdpblxuIEF1dGhvcjogU2lkZGhhcnRoIERvc2hpXG5cbiBVc2U6XG4gPT09XG4gJCgnI2Zvcm1faWQnKS5hamF4Y2hpbXAob3B0aW9ucyk7XG5cbiAtIEZvcm0gc2hvdWxkIGhhdmUgb25lIDxpbnB1dD4gZWxlbWVudCB3aXRoIGF0dHJpYnV0ZSAndHlwZT1lbWFpbCdcbiAtIEZvcm0gc2hvdWxkIGhhdmUgb25lIGxhYmVsIGVsZW1lbnQgd2l0aCBhdHRyaWJ1dGUgJ2Zvcj1lbWFpbF9pbnB1dF9pZCcgKHVzZWQgdG8gZGlzcGxheSBlcnJvci9zdWNjZXNzIG1lc3NhZ2UpXG4gLSBBbGwgb3B0aW9ucyBhcmUgb3B0aW9uYWwuXG5cbiBPcHRpb25zOlxuID09PT09PT1cbiBvcHRpb25zID0ge1xuIGxhbmd1YWdlOiAnZW4nLFxuIGNhbGxiYWNrOiBjYWxsYmFja0Z1bmN0aW9uLFxuIHVybDogJ2h0dHA6Ly9ibGFoYmxhaC51czEubGlzdC1tYW5hZ2UuY29tL3N1YnNjcmliZS9wb3N0P3U9NWFmc2RoZnVoZHNpdWZkYmE2Zjg4MDImaWQ9NGRqaGZkc2g5OWYnXG4gfVxuXG4gTm90ZXM6XG4gPT09PT1cbiBUbyBnZXQgdGhlIG1haWxjaGltcCBKU09OUCB1cmwgKHVuZG9jdW1lbnRlZCksIGNoYW5nZSAncG9zdD8nIHRvICdwb3N0LWpzb24/JyBhbmQgYWRkICcmYz0/JyB0byB0aGUgZW5kLlxuIEZvciBlLmcuICdodHRwOi8vYmxhaGJsYWgudXMxLmxpc3QtbWFuYWdlLmNvbS9zdWJzY3JpYmUvcG9zdC1qc29uP3U9NWFmc2RoZnVoZHNpdWZkYmE2Zjg4MDImaWQ9NGRqaGZkc2g5OWYmYz0/JyxcbiAqL1xuXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAkLmFqYXhDaGltcCA9IHtcbiAgICAgICAgcmVzcG9uc2VzOiB7XG4gICAgICAgICAgICAwOiAnV2UgaGF2ZSBzZW50IHlvdSBhIGNvbmZpcm1hdGlvbiBlbWFpbCcsXG4gICAgICAgICAgICAxOiAnUGxlYXNlIGVudGVyIGEgdmFsdWUnLFxuICAgICAgICAgICAgMjogJ0FuIGVtYWlsIGFkZHJlc3MgbXVzdCBjb250YWluIGEgc2luZ2xlIEAnLFxuICAgICAgICAgICAgMzogJ1RoZSBkb21haW4gcG9ydGlvbiBvZiB0aGUgZW1haWwgYWRkcmVzcyBpcyBpbnZhbGlkJyxcbiAgICAgICAgICAgIDQ6ICdUaGUgdXNlcm5hbWUgcG9ydGlvbiBvZiB0aGUgZW1haWwgYWRkcmVzcyBpcyBpbnZhbGlkJyxcbiAgICAgICAgICAgIDU6ICdUaGlzIGVtYWlsIGFkZHJlc3MgbG9va3MgZmFrZSBvciBpbnZhbGlkLiBQbGVhc2UgZW50ZXIgYSByZWFsIGVtYWlsIGFkZHJlc3MnLFxuICAgICAgICAgICAgNjogJ2lzIGFscmVhZHkgc3Vic2NyaWJlZCB0byBsaXN0J1xuICAgICAgICB9LFxuICAgICAgICB0cmFuc2xhdGlvbnM6IHtcbiAgICAgICAgICAgICdlbic6IG51bGxcbiAgICAgICAgfSxcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHNlbGVjdG9yLCBvcHRpb25zKSB7XG4gICAgICAgICAgICAkKHNlbGVjdG9yKS5hamF4Q2hpbXAob3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJC5mbi5hamF4Q2hpbXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAkKHRoaXMpLmVhY2goZnVuY3Rpb24oaSwgZWxlbSkge1xuICAgICAgICAgICAgdmFyIGZvcm0gPSAkKGVsZW0pO1xuICAgICAgICAgICAgdmFyIGVtYWlsID0gZm9ybS5maW5kKCdpbnB1dFt0eXBlPWVtYWlsXScpO1xuXG4gICAgICAgICAgICB2YXIgbGFiZWw7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5sYWJlbCkge1xuICAgICAgICAgICAgICAgIGxhYmVsID0gb3B0aW9ucy5sYWJlbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGFiZWwgPSBmb3JtLmZpbmQoJ2xhYmVsW2Zvcj0nICsgZW1haWwuYXR0cignaWQnKSArICddJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcbiAgICAgICAgICAgICAgICAndXJsJzogZm9ybS5hdHRyKCdhY3Rpb24nKSxcbiAgICAgICAgICAgICAgICAnbGFuZ3VhZ2UnOiAnZW4nXG4gICAgICAgICAgICB9LCBvcHRpb25zKTtcblxuICAgICAgICAgICAgdmFyIHVybCA9IHNldHRpbmdzLnVybC5yZXBsYWNlKCcvcG9zdD8nLCAnL3Bvc3QtanNvbj8nKS5jb25jYXQoJyZjPT8nKTtcblxuICAgICAgICAgICAgZm9ybS5hdHRyKCdub3ZhbGlkYXRlJywgJ3RydWUnKTtcbiAgICAgICAgICAgIGVtYWlsLmF0dHIoJ25hbWUnLCAnRU1BSUwnKTtcblxuICAgICAgICAgICAgZm9ybS5zdWJtaXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBtc2c7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3ApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3AucmVzdWx0ID09PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1zZyA9ICdXZSBoYXZlIHNlbnQgeW91IGEgY29uZmlybWF0aW9uIGVtYWlsJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLnJlbW92ZUNsYXNzKCdlcnJvcicpLmFkZENsYXNzKCd2YWxpZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWwucmVtb3ZlQ2xhc3MoJ2Vycm9yJykuYWRkQ2xhc3MoJ3ZhbGlkJyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbC5yZW1vdmVDbGFzcygndmFsaWQnKS5hZGRDbGFzcygnZXJyb3InKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLnJlbW92ZUNsYXNzKCd2YWxpZCcpLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0cyA9IHJlc3AubXNnLnNwbGl0KCcgLSAnLCAyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydHNbMV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cgPSByZXNwLm1zZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHBhcnNlSW50KHBhcnRzWzBdLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpLnRvU3RyaW5nKCkgPT09IHBhcnRzWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IHBhcnRzWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gcGFydHNbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gcmVzcC5tc2c7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gcmVzcC5tc2c7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRyYW5zbGF0ZSBhbmQgZGlzcGxheSBtZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZW5ndGggPSAwLCBtc2ducjtcblxuICAgICAgICAgICAgICAgICAgICBpZihPYmplY3Qua2V5cyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBPYmplY3Qua2V5cygkLmFqYXhDaGltcC5yZXNwb25zZXMpLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluICQuYWpheENoaW1wLnJlc3BvbnNlcyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQuYWpheENoaW1wLnJlc3BvbnNlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlKGxlbmd0aC0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobXNnLmluZGV4T2YoJC5hamF4Q2hpbXAucmVzcG9uc2VzW2xlbmd0aF0pIT09LTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2duciA9IGxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmxhbmd1YWdlICE9PSAnZW4nICYmIG1zZ25yID4gLTEgJiYgJC5hamF4Q2hpbXAudHJhbnNsYXRpb25zICYmICQuYWpheENoaW1wLnRyYW5zbGF0aW9uc1tzZXR0aW5ncy5sYW5ndWFnZV0gJiYgJC5hamF4Q2hpbXAudHJhbnNsYXRpb25zW3NldHRpbmdzLmxhbmd1YWdlXVttc2ducl1cbiAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtc2cgPSAkLmFqYXhDaGltcC50cmFuc2xhdGlvbnNbc2V0dGluZ3MubGFuZ3VhZ2VdW21zZ25yXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsYWJlbC5odG1sKG1zZyk7XG5cbiAgICAgICAgICAgICAgICAgICAgbGFiZWwuc2hvdygyMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhyZXNwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgICAgICAgICAgdmFyIGRhdGFBcnJheSA9IGZvcm0uc2VyaWFsaXplQXJyYXkoKTtcbiAgICAgICAgICAgICAgICAkLmVhY2goZGF0YUFycmF5LCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVtpdGVtLm5hbWVdID0gaXRlbS52YWx1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbnAnLFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHJlc3AsIHRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZygnbWFpbGNoaW1wIGFqYXggc3VibWl0IGVycm9yOiAnICsgdGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFRyYW5zbGF0ZSBhbmQgZGlzcGxheSBzdWJtaXQgbWVzc2FnZVxuICAgICAgICAgICAgICAgIHZhciBzdWJtaXRNc2cgPSAnU3VibWl0dGluZy4uLic7XG4gICAgICAgICAgICAgICAgaWYoXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmxhbmd1YWdlICE9PSAnZW4nICYmICQuYWpheENoaW1wLnRyYW5zbGF0aW9ucyAmJiAkLmFqYXhDaGltcC50cmFuc2xhdGlvbnNbc2V0dGluZ3MubGFuZ3VhZ2VdICYmICQuYWpheENoaW1wLnRyYW5zbGF0aW9uc1tzZXR0aW5ncy5sYW5ndWFnZV0uc3VibWl0XG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Ym1pdE1zZyA9ICQuYWpheENoaW1wLnRyYW5zbGF0aW9uc1tzZXR0aW5ncy5sYW5ndWFnZV0uc3VibWl0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsYWJlbC5odG1sKHN1Ym1pdE1zZykuc2hvdygyMDAwKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbn0pKGpRdWVyeSk7IiwiLypcbiAqIGpRdWVyeSBhcHBlYXIgcGx1Z2luXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEyIEFuZHJleSBTaWRvcm92XG4gKiBsaWNlbnNlZCB1bmRlciBNSVQgbGljZW5zZS5cbiAqXG4gKiBodHRwczovL2dpdGh1Yi5jb20vbW9yci9qcXVlcnkuYXBwZWFyL1xuICpcbiAqIFZlcnNpb246IDAuMy42XG4gKi9cbihmdW5jdGlvbigkKSB7XG4gICAgdmFyIHNlbGVjdG9ycyA9IFtdO1xuXG4gICAgdmFyIGNoZWNrX2JpbmRlZCA9IGZhbHNlO1xuICAgIHZhciBjaGVja19sb2NrID0gZmFsc2U7XG4gICAgdmFyIGRlZmF1bHRzID0ge1xuICAgICAgICBpbnRlcnZhbDogMjUwLFxuICAgICAgICBmb3JjZV9wcm9jZXNzOiBmYWxzZVxuICAgIH07XG4gICAgdmFyICR3aW5kb3cgPSAkKHdpbmRvdyk7XG5cbiAgICB2YXIgJHByaW9yX2FwcGVhcmVkID0gW107XG5cbiAgICBmdW5jdGlvbiBhcHBlYXJlZChzZWxlY3Rvcikge1xuICAgICAgICByZXR1cm4gJChzZWxlY3RvcikuZmlsdGVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICQodGhpcykuaXMoJzphcHBlYXJlZCcpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwcm9jZXNzKCkge1xuICAgICAgICBjaGVja19sb2NrID0gZmFsc2U7XG4gICAgICAgIGZvciAodmFyIGluZGV4ID0gMCwgc2VsZWN0b3JzTGVuZ3RoID0gc2VsZWN0b3JzLmxlbmd0aDsgaW5kZXggPCBzZWxlY3RvcnNMZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIHZhciAkYXBwZWFyZWQgPSBhcHBlYXJlZChzZWxlY3RvcnNbaW5kZXhdKTtcblxuICAgICAgICAgICAgJGFwcGVhcmVkLnRyaWdnZXIoJ2FwcGVhcicsIFskYXBwZWFyZWRdKTtcblxuICAgICAgICAgICAgaWYgKCRwcmlvcl9hcHBlYXJlZFtpbmRleF0pIHtcbiAgICAgICAgICAgICAgICB2YXIgJGRpc2FwcGVhcmVkID0gJHByaW9yX2FwcGVhcmVkW2luZGV4XS5ub3QoJGFwcGVhcmVkKTtcbiAgICAgICAgICAgICAgICAkZGlzYXBwZWFyZWQudHJpZ2dlcignZGlzYXBwZWFyJywgWyRkaXNhcHBlYXJlZF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHByaW9yX2FwcGVhcmVkW2luZGV4XSA9ICRhcHBlYXJlZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZF9zZWxlY3RvcihzZWxlY3Rvcikge1xuICAgICAgICBzZWxlY3RvcnMucHVzaChzZWxlY3Rvcik7XG4gICAgICAgICRwcmlvcl9hcHBlYXJlZC5wdXNoKCk7XG4gICAgfVxuXG4gICAgLy8gXCJhcHBlYXJlZFwiIGN1c3RvbSBmaWx0ZXJcbiAgICAkLmV4cHJbJzonXS5hcHBlYXJlZCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgaWYgKCEkZWxlbWVudC5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHdpbmRvd19sZWZ0ID0gJHdpbmRvdy5zY3JvbGxMZWZ0KCk7XG4gICAgICAgIHZhciB3aW5kb3dfdG9wID0gJHdpbmRvdy5zY3JvbGxUb3AoKTtcbiAgICAgICAgdmFyIG9mZnNldCA9ICRlbGVtZW50Lm9mZnNldCgpO1xuICAgICAgICB2YXIgbGVmdCA9IG9mZnNldC5sZWZ0O1xuICAgICAgICB2YXIgdG9wID0gb2Zmc2V0LnRvcDtcblxuICAgICAgICBpZiAodG9wICsgJGVsZW1lbnQuaGVpZ2h0KCkgPj0gd2luZG93X3RvcCAmJlxuICAgICAgICAgICAgdG9wIC0gKCRlbGVtZW50LmRhdGEoJ2FwcGVhci10b3Atb2Zmc2V0JykgfHwgMCkgPD0gd2luZG93X3RvcCArICR3aW5kb3cuaGVpZ2h0KCkgJiZcbiAgICAgICAgICAgIGxlZnQgKyAkZWxlbWVudC53aWR0aCgpID49IHdpbmRvd19sZWZ0ICYmXG4gICAgICAgICAgICBsZWZ0IC0gKCRlbGVtZW50LmRhdGEoJ2FwcGVhci1sZWZ0LW9mZnNldCcpIHx8IDApIDw9IHdpbmRvd19sZWZ0ICsgJHdpbmRvdy53aWR0aCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkLmZuLmV4dGVuZCh7XG4gICAgICAgIC8vIHdhdGNoaW5nIGZvciBlbGVtZW50J3MgYXBwZWFyYW5jZSBpbiBicm93c2VyIHZpZXdwb3J0XG4gICAgICAgIGFwcGVhcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIG9wdHMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMgfHwge30pO1xuICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciB8fCB0aGlzO1xuICAgICAgICAgICAgaWYgKCFjaGVja19iaW5kZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgb25fY2hlY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrX2xvY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjaGVja19sb2NrID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHByb2Nlc3MsIG9wdHMuaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAkKHdpbmRvdykuc2Nyb2xsKG9uX2NoZWNrKS5yZXNpemUob25fY2hlY2spO1xuICAgICAgICAgICAgICAgIGNoZWNrX2JpbmRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvcHRzLmZvcmNlX3Byb2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHByb2Nlc3MsIG9wdHMuaW50ZXJ2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWRkX3NlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICAgICAgICAgIHJldHVybiAkKHNlbGVjdG9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgJC5leHRlbmQoe1xuICAgICAgICAvLyBmb3JjZSBlbGVtZW50cydzIGFwcGVhcmFuY2UgY2hlY2tcbiAgICAgICAgZm9yY2VfYXBwZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChjaGVja19iaW5kZWQpIHtcbiAgICAgICAgICAgICAgICBwcm9jZXNzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGZ1bmN0aW9uKCkge1xuICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAvLyBOb2RlXG4gICAgICAgIHJldHVybiByZXF1aXJlKCdqcXVlcnknKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4galF1ZXJ5O1xuICAgIH1cbn0oKSk7IiwiLyoqXG4gKiBqcXVlcnktY2lyY2xlLXByb2dyZXNzIC0galF1ZXJ5IFBsdWdpbiB0byBkcmF3IGFuaW1hdGVkIGNpcmN1bGFyIHByb2dyZXNzIGJhcnM6XG4gKiB7QGxpbmsgaHR0cDovL2tvdHRlbmF0b3IuZ2l0aHViLmlvL2pxdWVyeS1jaXJjbGUtcHJvZ3Jlc3MvfVxuICpcbiAqIEBhdXRob3IgUm9zdHlzbGF2IEJyeXpndW5vdiA8a290dGVuYXRvckBnbWFpbC5jb20+XG4gKiBAdmVyc2lvbiAxLjIuMlxuICogQGxpY2VuY2UgTUlUXG4gKiBAcHJlc2VydmVcbiAqL1xuLy8gVU1EIGZhY3RvcnkgLSBodHRwczovL2dpdGh1Yi5jb20vdW1kanMvdW1kL2Jsb2IvZDMxYmI2ZWU3MDk4NzE1ZTAxOWY1MmJkZmUyN2IzZTRiZmQyYjk3ZS90ZW1wbGF0ZXMvanF1ZXJ5UGx1Z2luLmpzXG4vLyBVc2VzIEFNRCwgQ29tbW9uSlMgb3IgYnJvd3NlciBnbG9iYWxzIHRvIGNyZWF0ZSBhIGpRdWVyeSBwbHVnaW4uXG4oZnVuY3Rpb24oZmFjdG9yeSkge1xuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgLy8gQU1EIC0gcmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZVxuICAgICAgICBkZWZpbmUoWydqcXVlcnknXSwgZmFjdG9yeSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgICAgICAvLyBOb2RlL0NvbW1vbkpTXG4gICAgICAgIHZhciAkID0gcmVxdWlyZSgnanF1ZXJ5Jyk7XG4gICAgICAgIGZhY3RvcnkoJCk7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0gJDtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHNcbiAgICAgICAgZmFjdG9yeShqUXVlcnkpO1xuICAgIH1cbn0pKGZ1bmN0aW9uKCQpIHtcbiAgICAvKipcbiAgICAgKiBJbm5lciBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgY2lyY2xlIHByb2dyZXNzIGJhci5cbiAgICAgKiBUaGUgY2xhc3MgaXMgbm90IGV4cG9zZWQgX3lldF8gYnV0IHlvdSBjYW4gY3JlYXRlIGFuIGluc3RhbmNlIHRocm91Z2ggalF1ZXJ5IG1ldGhvZCBjYWxsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGNvbmZpZyAtIFlvdSBjYW4gY3VzdG9taXplIGFueSBjbGFzcyBtZW1iZXIgKHByb3BlcnR5IG9yIG1ldGhvZCkuXG4gICAgICogQGNsYXNzXG4gICAgICogQGFsaWFzIENpcmNsZVByb2dyZXNzXG4gICAgICovXG4gICAgZnVuY3Rpb24gQ2lyY2xlUHJvZ3Jlc3MoY29uZmlnKSB7XG4gICAgICAgIHRoaXMuaW5pdChjb25maWcpO1xuICAgIH1cblxuICAgIENpcmNsZVByb2dyZXNzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gcHVibGljIG9wdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIGlzIHRoZSBvbmx5IHJlcXVpcmVkIG9wdGlvbi4gSXQgc2hvdWxkIGJlIGZyb20gYDAuMGAgdG8gYDEuMGAuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqIEBkZWZhdWx0IDAuMFxuICAgICAgICAgKi9cbiAgICAgICAgdmFsdWU6IDAuMCxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2l6ZSBvZiB0aGUgY2FudmFzIGluIHBpeGVscy5cbiAgICAgICAgICogSXQncyBhIHNxdWFyZSBzbyB3ZSBuZWVkIG9ubHkgb25lIGRpbWVuc2lvbi5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICogQGRlZmF1bHQgMTAwLjBcbiAgICAgICAgICovXG4gICAgICAgIHNpemU6IDEwMC4wLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsIGFuZ2xlIGZvciBgMC4wYCB2YWx1ZSBpbiByYWRpYW5zLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKiBAZGVmYXVsdCAtTWF0aC5QSVxuICAgICAgICAgKi9cbiAgICAgICAgc3RhcnRBbmdsZTogLU1hdGguUEksXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdpZHRoIG9mIHRoZSBhcmMgaW4gcGl4ZWxzLlxuICAgICAgICAgKiBJZiBpdCdzIGAnYXV0bydgIC0gdGhlIHZhbHVlIGlzIGNhbGN1bGF0ZWQgYXMgYFt0aGlzLnNpemVde0BsaW5rIENpcmNsZVByb2dyZXNzI3NpemV9IC8gMTRgLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfHN0cmluZ31cbiAgICAgICAgICogQGRlZmF1bHQgJ2F1dG8nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlja25lc3M6ICdhdXRvJyxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmlsbCBvZiB0aGUgYXJjLiBZb3UgbWF5IHNldCBpdCB0bzpcbiAgICAgICAgICpcbiAgICAgICAgICogICAtIHNvbGlkIGNvbG9yOlxuICAgICAgICAgKiAgICAgLSBgJyMzYWVhYmInYFxuICAgICAgICAgKiAgICAgLSBgeyBjb2xvcjogJyMzYWVhYmInIH1gXG4gICAgICAgICAqICAgICAtIGB7IGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAuMyknIH1gXG4gICAgICAgICAqICAgLSBsaW5lYXIgZ3JhZGllbnQgXyhsZWZ0IHRvIHJpZ2h0KV86XG4gICAgICAgICAqICAgICAtIGB7IGdyYWRpZW50OiBbJyMzYWVhYmInLCAnI2ZkZDI1MCddLCBncmFkaWVudEFuZ2xlOiBNYXRoLlBJIC8gNCB9YFxuICAgICAgICAgKiAgICAgLSBgeyBncmFkaWVudDogWydyZWQnLCAnZ3JlZW4nLCAnYmx1ZSddLCBncmFkaWVudERpcmVjdGlvbjogW3gwLCB5MCwgeDEsIHkxXSB9YFxuICAgICAgICAgKiAgICAgLSBgeyBncmFkaWVudDogW1tcInJlZFwiLCAuMl0sIFtcImdyZWVuXCIsIC4zXSwgW1wiYmx1ZVwiLCAuOF1dIH1gXG4gICAgICAgICAqICAgLSBpbWFnZTpcbiAgICAgICAgICogICAgIC0gYHsgaW1hZ2U6ICdodHRwOi8vaS5pbWd1ci5jb20vcFQwaTg5di5wbmcnIH1gXG4gICAgICAgICAqICAgICAtIGB7IGltYWdlOiBpbWFnZU9iamVjdCB9YFxuICAgICAgICAgKiAgICAgLSBgeyBjb2xvcjogJ2xpbWUnLCBpbWFnZTogJ2h0dHA6Ly9pLmltZ3VyLmNvbS9wVDBpODl2LnBuZycgfWAgLVxuICAgICAgICAgKiAgICAgICBjb2xvciBkaXNwbGF5ZWQgdW50aWwgdGhlIGltYWdlIGlzIGxvYWRlZFxuICAgICAgICAgKlxuICAgICAgICAgKiBAZGVmYXVsdCB7Z3JhZGllbnQ6IFsnIzNhZWFiYicsICcjZmRkMjUwJ119XG4gICAgICAgICAqL1xuICAgICAgICBmaWxsOiB7XG4gICAgICAgICAgICBncmFkaWVudDogWycjM2FlYWJiJywgJyNmZGQyNTAnXVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb2xvciBvZiB0aGUgXCJlbXB0eVwiIGFyYy4gT25seSBhIGNvbG9yIGZpbGwgc3VwcG9ydGVkIGJ5IG5vdy5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICogQGRlZmF1bHQgJ3JnYmEoMCwgMCwgMCwgLjEpJ1xuICAgICAgICAgKi9cbiAgICAgICAgZW1wdHlGaWxsOiAncmdiYSgwLCAwLCAwLCAuMSknLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBqUXVlcnkgQW5pbWF0aW9uIGNvbmZpZy5cbiAgICAgICAgICogWW91IGNhbiBwYXNzIGBmYWxzZWAgdG8gZGlzYWJsZSB0aGUgYW5pbWF0aW9uLlxuICAgICAgICAgKiBAc2VlIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9hbmltYXRlL1xuICAgICAgICAgKiBAdHlwZSB7b2JqZWN0fGJvb2xlYW59XG4gICAgICAgICAqIEBkZWZhdWx0IHtkdXJhdGlvbjogMTIwMCwgZWFzaW5nOiAnY2lyY2xlUHJvZ3Jlc3NFYXNpbmcnfVxuICAgICAgICAgKi9cbiAgICAgICAgYW5pbWF0aW9uOiB7XG4gICAgICAgICAgICBkdXJhdGlvbjogMTIwMCxcbiAgICAgICAgICAgIGVhc2luZzogJ2NpcmNsZVByb2dyZXNzRWFzaW5nJ1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWZhdWx0IGFuaW1hdGlvbiBzdGFydHMgYXQgYDAuMGAgYW5kIGVuZHMgYXQgc3BlY2lmaWVkIGB2YWx1ZWAuIExldCdzIGNhbGwgdGhpcyBfZGlyZWN0IGFuaW1hdGlvbl8uXG4gICAgICAgICAqIElmIHlvdSB3YW50IHRvIG1ha2UgX3JldmVyc2VkIGFuaW1hdGlvbl8gLSBzZXQgYGFuaW1hdGlvblN0YXJ0VmFsdWU6IDEuMGAuXG4gICAgICAgICAqIEFsc28geW91IG1heSBzcGVjaWZ5IGFueSBvdGhlciB2YWx1ZSBmcm9tIGAwLjBgIHRvIGAxLjBgLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKiBAZGVmYXVsdCAwLjBcbiAgICAgICAgICovXG4gICAgICAgIGFuaW1hdGlvblN0YXJ0VmFsdWU6IDAuMCxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV2ZXJzZSBhbmltYXRpb24gYW5kIGFyYyBkcmF3LlxuICAgICAgICAgKiBCeSBkZWZhdWx0LCB0aGUgYXJjIGlzIGZpbGxlZCBmcm9tIGAwLjBgIHRvIGB2YWx1ZWAsIF9jbG9ja3dpc2VfLlxuICAgICAgICAgKiBXaXRoIGByZXZlcnNlOiB0cnVlYCB0aGUgYXJjIGlzIGZpbGxlZCBmcm9tIGAxLjBgIHRvIGB2YWx1ZWAsIF9jb3VudGVyLWNsb2Nrd2lzZV8uXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAgICAgKi9cbiAgICAgICAgcmV2ZXJzZTogZmFsc2UsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFyYyBsaW5lIGNhcDogYCdidXR0J2AsIGAncm91bmQnYCBvciBgJ3NxdWFyZSdgIC1cbiAgICAgICAgICogW3JlYWQgbW9yZV17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5saW5lQ2FwfS5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICogQGRlZmF1bHQgJ2J1dHQnXG4gICAgICAgICAqL1xuICAgICAgICBsaW5lQ2FwOiAnYnV0dCcsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbnZhcyBpbnNlcnRpb24gbW9kZTogYXBwZW5kIG9yIHByZXBlbmQgaXQgaW50byB0aGUgcGFyZW50IGVsZW1lbnQ/XG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqIEBkZWZhdWx0ICdwcmVwZW5kJ1xuICAgICAgICAgKi9cbiAgICAgICAgaW5zZXJ0TW9kZTogJ3ByZXBlbmQnLFxuXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHByb3RlY3RlZCBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAvKipcbiAgICAgICAgICogTGluayB0byB7QGxpbmsgQ2lyY2xlUHJvZ3Jlc3N9IGNvbnN0cnVjdG9yLlxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdHJ1Y3RvcjogQ2lyY2xlUHJvZ3Jlc3MsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbnRhaW5lciBlbGVtZW50LiBTaG91bGQgYmUgcGFzc2VkIGludG8gY29uc3RydWN0b3IgY29uZmlnLlxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICAgICAqL1xuICAgICAgICBlbDogbnVsbCxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FudmFzIGVsZW1lbnQuIEF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGFuZCBwcmVwZW5kZWQgdG8gW3RoaXMuZWxde0BsaW5rIENpcmNsZVByb2dyZXNzI2VsfS5cbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKiBAdHlwZSB7SFRNTENhbnZhc0VsZW1lbnR9XG4gICAgICAgICAqL1xuICAgICAgICBjYW52YXM6IG51bGwsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIDJELWNvbnRleHQgb2YgW3RoaXMuY2FudmFzXXtAbGluayBDaXJjbGVQcm9ncmVzcyNjYW52YXN9LlxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqIEB0eXBlIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9XG4gICAgICAgICAqL1xuICAgICAgICBjdHg6IG51bGwsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJhZGl1cyBvZiB0aGUgb3V0ZXIgY2lyY2xlLiBBdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQgYXMgYFt0aGlzLnNpemVde0BsaW5rIENpcmNsZVByb2dyZXNzI3NpemV9IC8gMmAuXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHJhZGl1czogMC4wLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaWxsIG9mIHRoZSBtYWluIGFyYy4gQXV0b21hdGljYWxseSBjYWxjdWxhdGVkLCBkZXBlbmRpbmcgb24gW3RoaXMuZmlsbF17QGxpbmsgQ2lyY2xlUHJvZ3Jlc3MjZmlsbH0gb3B0aW9uLlxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd8Q2FudmFzR3JhZGllbnR8Q2FudmFzUGF0dGVybn1cbiAgICAgICAgICovXG4gICAgICAgIGFyY0ZpbGw6IG51bGwsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExhc3QgcmVuZGVyZWQgZnJhbWUgdmFsdWUuXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIGxhc3RGcmFtZVZhbHVlOiAwLjAsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQvcmUtaW5pdCB0aGUgd2lkZ2V0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaHJvd3MgYSBqUXVlcnkgZXZlbnQ6XG4gICAgICAgICAqXG4gICAgICAgICAqIC0gYGNpcmNsZS1pbml0ZWQoanFFdmVudClgXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjb25maWcgLSBZb3UgY2FuIGN1c3RvbWl6ZSBhbnkgY2xhc3MgbWVtYmVyIChwcm9wZXJ0eSBvciBtZXRob2QpLlxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0aGlzLCBjb25maWcpO1xuICAgICAgICAgICAgdGhpcy5yYWRpdXMgPSB0aGlzLnNpemUgLyAyO1xuICAgICAgICAgICAgdGhpcy5pbml0V2lkZ2V0KCk7XG4gICAgICAgICAgICB0aGlzLmluaXRGaWxsKCk7XG4gICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgICAgIHRoaXMuZWwudHJpZ2dlcignY2lyY2xlLWluaXRlZCcpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplIGA8Y2FudmFzPmAuXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGluaXRXaWRnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmNhbnZhcylcbiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhcyA9ICQoJzxjYW52YXM+JylbdGhpcy5pbnNlcnRNb2RlID09ICdwcmVwZW5kJyA/ICdwcmVwZW5kVG8nIDogJ2FwcGVuZFRvJ10odGhpcy5lbClbMF07XG5cbiAgICAgICAgICAgIHZhciBjYW52YXMgPSB0aGlzLmNhbnZhcztcbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHRoaXMuc2l6ZTtcbiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLnNpemU7XG4gICAgICAgICAgICB0aGlzLmN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgICAgICAgICBpZiAod2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNjYWxlQnkgPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcbiAgICAgICAgICAgICAgICBjYW52YXMuc3R5bGUud2lkdGggPSBjYW52YXMuc3R5bGUuaGVpZ2h0ID0gdGhpcy5zaXplICsgJ3B4JztcbiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBjYW52YXMuaGVpZ2h0ID0gdGhpcy5zaXplICogc2NhbGVCeTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zY2FsZShzY2FsZUJ5LCBzY2FsZUJ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBtZXRob2Qgc2V0cyBbdGhpcy5hcmNGaWxsXXtAbGluayBDaXJjbGVQcm9ncmVzcyNhcmNGaWxsfS5cbiAgICAgICAgICogSXQgY291bGQgZG8gdGhpcyBhc3luYyAob24gaW1hZ2UgbG9hZCkuXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGluaXRGaWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgICAgICAgICBmaWxsID0gdGhpcy5maWxsLFxuICAgICAgICAgICAgICAgIGN0eCA9IHRoaXMuY3R4LFxuICAgICAgICAgICAgICAgIHNpemUgPSB0aGlzLnNpemU7XG5cbiAgICAgICAgICAgIGlmICghZmlsbClcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihcIlRoZSBmaWxsIGlzIG5vdCBzcGVjaWZpZWQhXCIpO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGZpbGwgPT0gJ3N0cmluZycpXG4gICAgICAgICAgICAgICAgZmlsbCA9IHtjb2xvcjogZmlsbH07XG5cbiAgICAgICAgICAgIGlmIChmaWxsLmNvbG9yKVxuICAgICAgICAgICAgICAgIHRoaXMuYXJjRmlsbCA9IGZpbGwuY29sb3I7XG5cbiAgICAgICAgICAgIGlmIChmaWxsLmdyYWRpZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGdyID0gZmlsbC5ncmFkaWVudDtcblxuICAgICAgICAgICAgICAgIGlmIChnci5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyY0ZpbGwgPSBnclswXTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdyLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGdhID0gZmlsbC5ncmFkaWVudEFuZ2xlIHx8IDAsIC8vIGdyYWRpZW50IGRpcmVjdGlvbiBhbmdsZTsgMCBieSBkZWZhdWx0XG4gICAgICAgICAgICAgICAgICAgICAgICBnZCA9IGZpbGwuZ3JhZGllbnREaXJlY3Rpb24gfHwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplIC8gMiAqICgxIC0gTWF0aC5jb3MoZ2EpKSwgLy8geDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSAvIDIgKiAoMSArIE1hdGguc2luKGdhKSksIC8vIHkwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgLyAyICogKDEgKyBNYXRoLmNvcyhnYSkpLCAvLyB4MVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplIC8gMiAqICgxIC0gTWF0aC5zaW4oZ2EpKSAgLy8geTFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZyA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudC5hcHBseShjdHgsIGdkKTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSBncltpXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBpIC8gKGdyLmxlbmd0aCAtIDEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJC5pc0FycmF5KGNvbG9yKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IGNvbG9yWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gY29sb3JbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxnLmFkZENvbG9yU3RvcChwb3MsIGNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJjRmlsbCA9IGxnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpbGwuaW1hZ2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW1nO1xuXG4gICAgICAgICAgICAgICAgaWYgKGZpbGwuaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZSkge1xuICAgICAgICAgICAgICAgICAgICBpbWcgPSBmaWxsLmltYWdlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgICAgICAgICBpbWcuc3JjID0gZmlsbC5pbWFnZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaW1nLmNvbXBsZXRlKVxuICAgICAgICAgICAgICAgICAgICBzZXRJbWFnZUZpbGwoKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBzZXRJbWFnZUZpbGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEltYWdlRmlsbCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgYmcgPSAkKCc8Y2FudmFzPicpWzBdO1xuICAgICAgICAgICAgICAgIGJnLndpZHRoID0gc2VsZi5zaXplO1xuICAgICAgICAgICAgICAgIGJnLmhlaWdodCA9IHNlbGYuc2l6ZTtcbiAgICAgICAgICAgICAgICBiZy5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShpbWcsIDAsIDAsIHNpemUsIHNpemUpO1xuICAgICAgICAgICAgICAgIHNlbGYuYXJjRmlsbCA9IHNlbGYuY3R4LmNyZWF0ZVBhdHRlcm4oYmcsICduby1yZXBlYXQnKTtcbiAgICAgICAgICAgICAgICBzZWxmLmRyYXdGcmFtZShzZWxmLmxhc3RGcmFtZVZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRHJhdyB0aGUgY2lyY2xlLlxuICAgICAgICAgKiBAcHJvdGVjdGVkXG4gICAgICAgICAqL1xuICAgICAgICBkcmF3OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbilcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdBbmltYXRlZCh0aGlzLnZhbHVlKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdGcmFtZSh0aGlzLnZhbHVlKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRHJhdyBhIHNpbmdsZSBhbmltYXRpb24gZnJhbWUuXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHYgLSBGcmFtZSB2YWx1ZS5cbiAgICAgICAgICovXG4gICAgICAgIGRyYXdGcmFtZTogZnVuY3Rpb24odikge1xuICAgICAgICAgICAgdGhpcy5sYXN0RnJhbWVWYWx1ZSA9IHY7XG4gICAgICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5zaXplLCB0aGlzLnNpemUpO1xuICAgICAgICAgICAgdGhpcy5kcmF3RW1wdHlBcmModik7XG4gICAgICAgICAgICB0aGlzLmRyYXdBcmModik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERyYXcgdGhlIGFyYyAocGFydCBvZiB0aGUgY2lyY2xlKS5cbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gdiAtIEZyYW1lIHZhbHVlLlxuICAgICAgICAgKi9cbiAgICAgICAgZHJhd0FyYzogZnVuY3Rpb24odikge1xuICAgICAgICAgICAgaWYgKHYgPT09IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jdHgsXG4gICAgICAgICAgICAgICAgciA9IHRoaXMucmFkaXVzLFxuICAgICAgICAgICAgICAgIHQgPSB0aGlzLmdldFRoaWNrbmVzcygpLFxuICAgICAgICAgICAgICAgIGEgPSB0aGlzLnN0YXJ0QW5nbGU7XG5cbiAgICAgICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5yZXZlcnNlKSB7XG4gICAgICAgICAgICAgICAgY3R4LmFyYyhyLCByLCByIC0gdCAvIDIsIGEsIGEgKyBNYXRoLlBJICogMiAqIHYpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdHguYXJjKHIsIHIsIHIgLSB0IC8gMiwgYSAtIE1hdGguUEkgKiAyICogdiwgYSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSB0O1xuICAgICAgICAgICAgY3R4LmxpbmVDYXAgPSB0aGlzLmxpbmVDYXA7XG4gICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmFyY0ZpbGw7XG4gICAgICAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEcmF3IHRoZSBfZW1wdHkgKGJhY2tncm91bmQpXyBhcmMgKHBhcnQgb2YgdGhlIGNpcmNsZSkuXG4gICAgICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHYgLSBGcmFtZSB2YWx1ZS5cbiAgICAgICAgICovXG4gICAgICAgIGRyYXdFbXB0eUFyYzogZnVuY3Rpb24odikge1xuICAgICAgICAgICAgdmFyIGN0eCA9IHRoaXMuY3R4LFxuICAgICAgICAgICAgICAgIHIgPSB0aGlzLnJhZGl1cyxcbiAgICAgICAgICAgICAgICB0ID0gdGhpcy5nZXRUaGlja25lc3MoKSxcbiAgICAgICAgICAgICAgICBhID0gdGhpcy5zdGFydEFuZ2xlO1xuXG4gICAgICAgICAgICBpZiAodiA8IDEpIHtcbiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcblxuICAgICAgICAgICAgICAgIGlmICh2IDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhyLCByLCByIC0gdCAvIDIsIDAsIE1hdGguUEkgKiAyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmV2ZXJzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhyLCByLCByIC0gdCAvIDIsIGEgKyBNYXRoLlBJICogMiAqIHYsIGEpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhyLCByLCByIC0gdCAvIDIsIGEsIGEgLSBNYXRoLlBJICogMiAqIHYpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IHQ7XG4gICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5lbXB0eUZpbGw7XG4gICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuaW1hdGUgdGhlIHByb2dyZXNzIGJhci5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhyb3dzIDMgalF1ZXJ5IGV2ZW50czpcbiAgICAgICAgICpcbiAgICAgICAgICogLSBgY2lyY2xlLWFuaW1hdGlvbi1zdGFydChqcUV2ZW50KWBcbiAgICAgICAgICogLSBgY2lyY2xlLWFuaW1hdGlvbi1wcm9ncmVzcyhqcUV2ZW50LCBhbmltYXRpb25Qcm9ncmVzcywgc3RlcFZhbHVlKWAgLSBtdWx0aXBsZSBldmVudFxuICAgICAgICAgKiAgIGFuaW1hdGlvblByb2dyZXNzOiBmcm9tIGAwLjBgIHRvIGAxLjBgOyBzdGVwVmFsdWU6IGZyb20gYDAuMGAgdG8gYHZhbHVlYFxuICAgICAgICAgKiAtIGBjaXJjbGUtYW5pbWF0aW9uLWVuZChqcUV2ZW50KWBcbiAgICAgICAgICpcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gdiAtIEZpbmFsIHZhbHVlLlxuICAgICAgICAgKi9cbiAgICAgICAgZHJhd0FuaW1hdGVkOiBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZWwgPSB0aGlzLmVsLFxuICAgICAgICAgICAgICAgIGNhbnZhcyA9ICQodGhpcy5jYW52YXMpO1xuXG4gICAgICAgICAgICAvLyBzdG9wIHByZXZpb3VzIGFuaW1hdGlvbiBiZWZvcmUgbmV3IFwic3RhcnRcIiBldmVudCBpcyB0cmlnZ2VyZWRcbiAgICAgICAgICAgIGNhbnZhcy5zdG9wKHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgIGVsLnRyaWdnZXIoJ2NpcmNsZS1hbmltYXRpb24tc3RhcnQnKTtcblxuICAgICAgICAgICAgY2FudmFzXG4gICAgICAgICAgICAgICAgLmNzcyh7YW5pbWF0aW9uUHJvZ3Jlc3M6IDB9KVxuICAgICAgICAgICAgICAgIC5hbmltYXRlKHthbmltYXRpb25Qcm9ncmVzczogMX0sICQuZXh0ZW5kKHt9LCB0aGlzLmFuaW1hdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICBzdGVwOiBmdW5jdGlvbihhbmltYXRpb25Qcm9ncmVzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ZXBWYWx1ZSA9IHNlbGYuYW5pbWF0aW9uU3RhcnRWYWx1ZSAqICgxIC0gYW5pbWF0aW9uUHJvZ3Jlc3MpICsgdiAqIGFuaW1hdGlvblByb2dyZXNzO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kcmF3RnJhbWUoc3RlcFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnRyaWdnZXIoJ2NpcmNsZS1hbmltYXRpb24tcHJvZ3Jlc3MnLCBbYW5pbWF0aW9uUHJvZ3Jlc3MsIHN0ZXBWYWx1ZV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgLnByb21pc2UoKVxuICAgICAgICAgICAgICAgIC5hbHdheXMoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRyaWdnZXIgb24gYm90aCBzdWNjZXNzZnVsICYgZmFpbHVyZSBhbmltYXRpb24gZW5kXG4gICAgICAgICAgICAgICAgICAgIGVsLnRyaWdnZXIoJ2NpcmNsZS1hbmltYXRpb24tZW5kJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCB0aGUgY2lyY2xlIHRoaWNrbmVzcy5cbiAgICAgICAgICogQHNlZSBDaXJjbGVQcm9ncmVzcyN0aGlja25lc3NcbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0VGhpY2tuZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkLmlzTnVtZXJpYyh0aGlzLnRoaWNrbmVzcykgPyB0aGlzLnRoaWNrbmVzcyA6IHRoaXMuc2l6ZSAvIDE0O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgY3VycmVudCB2YWx1ZS5cbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKiBAcmV0dXJuIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IGN1cnJlbnQgdmFsdWUgKHdpdGggc21vb3RoIGFuaW1hdGlvbiB0cmFuc2l0aW9uKS5cbiAgICAgICAgICogQHByb3RlY3RlZFxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gbmV3VmFsdWVcbiAgICAgICAgICovXG4gICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbihuZXdWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uKVxuICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uU3RhcnRWYWx1ZSA9IHRoaXMubGFzdEZyYW1lVmFsdWU7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB0aGlzLmRyYXcoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIEluaXRpYXRpbmcgalF1ZXJ5IHBsdWdpbiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICQuY2lyY2xlUHJvZ3Jlc3MgPSB7XG4gICAgICAgIC8vIERlZmF1bHQgb3B0aW9ucyAoeW91IG1heSBvdmVycmlkZSB0aGVtKVxuICAgICAgICBkZWZhdWx0czogQ2lyY2xlUHJvZ3Jlc3MucHJvdG90eXBlXG4gICAgfTtcblxuICAgIC8vIGVhc2UtaW4tb3V0LWN1YmljXG4gICAgJC5lYXNpbmcuY2lyY2xlUHJvZ3Jlc3NFYXNpbmcgPSBmdW5jdGlvbih4KSB7XG4gICAgICAgIGlmICh4IDwgMC41KSB7XG4gICAgICAgICAgICB4ID0gMiAqIHg7XG4gICAgICAgICAgICByZXR1cm4gMC41ICogeCAqIHggKiB4O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeCA9IDIgLSAyICogeDtcbiAgICAgICAgICAgIHJldHVybiAxIC0gMC41ICogeCAqIHggKiB4O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIENpcmNsZVByb2dyZXNzfS5cbiAgICAgKiBQcm9kdWNlcyBbaW5pdCBldmVudF17QGxpbmsgQ2lyY2xlUHJvZ3Jlc3MjaW5pdH0gYW5kIFthbmltYXRpb24gZXZlbnRzXXtAbGluayBDaXJjbGVQcm9ncmVzcyNkcmF3QW5pbWF0ZWR9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtjb25maWdPckNvbW1hbmRdIC0gQ29uZmlnIG9iamVjdCBvciBjb21tYW5kIG5hbWUuXG4gICAgICpcbiAgICAgKiBDb25maWcgZXhhbXBsZSAoeW91IGNhbiBzcGVjaWZ5IGFueSB7QGxpbmsgQ2lyY2xlUHJvZ3Jlc3N9IHByb3BlcnR5KTpcbiAgICAgKlxuICAgICAqIGBgYGpzXG4gICAgICogeyB2YWx1ZTogMC43NSwgc2l6ZTogNTAsIGFuaW1hdGlvbjogZmFsc2UgfVxuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQ29tbWFuZHM6XG4gICAgICpcbiAgICAgKiBgYGBqc1xuICAgICAqIGVsLmNpcmNsZVByb2dyZXNzKCd3aWRnZXQnKTsgLy8gZ2V0IHRoZSA8Y2FudmFzPlxuICAgICAqIGVsLmNpcmNsZVByb2dyZXNzKCd2YWx1ZScpOyAvLyBnZXQgdGhlIHZhbHVlXG4gICAgICogZWwuY2lyY2xlUHJvZ3Jlc3MoJ3ZhbHVlJywgbmV3VmFsdWUpOyAvLyB1cGRhdGUgdGhlIHZhbHVlXG4gICAgICogZWwuY2lyY2xlUHJvZ3Jlc3MoJ3JlZHJhdycpOyAvLyByZWRyYXcgdGhlIGNpcmNsZVxuICAgICAqIGVsLmNpcmNsZVByb2dyZXNzKCk7IC8vIHRoZSBzYW1lIGFzICdyZWRyYXcnXG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2NvbW1hbmRBcmd1bWVudF0gLSBTb21lIGNvbW1hbmRzIChsaWtlIGAndmFsdWUnYCkgbWF5IHJlcXVpcmUgYW4gYXJndW1lbnQuXG4gICAgICogQHNlZSBDaXJjbGVQcm9ncmVzc1xuICAgICAqIEBhbGlhcyBcIiQoLi4uKS5jaXJjbGVQcm9ncmVzc1wiXG4gICAgICovXG4gICAgJC5mbi5jaXJjbGVQcm9ncmVzcyA9IGZ1bmN0aW9uKGNvbmZpZ09yQ29tbWFuZCwgY29tbWFuZEFyZ3VtZW50KSB7XG4gICAgICAgIHZhciBkYXRhTmFtZSA9ICdjaXJjbGUtcHJvZ3Jlc3MnLFxuICAgICAgICAgICAgZmlyc3RJbnN0YW5jZSA9IHRoaXMuZGF0YShkYXRhTmFtZSk7XG5cbiAgICAgICAgaWYgKGNvbmZpZ09yQ29tbWFuZCA9PSAnd2lkZ2V0Jykge1xuICAgICAgICAgICAgaWYgKCFmaXJzdEluc3RhbmNlKVxuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdDYWxsaW5nIFwid2lkZ2V0XCIgbWV0aG9kIG9uIG5vdCBpbml0aWFsaXplZCBpbnN0YW5jZSBpcyBmb3JiaWRkZW4nKTtcbiAgICAgICAgICAgIHJldHVybiBmaXJzdEluc3RhbmNlLmNhbnZhcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb25maWdPckNvbW1hbmQgPT0gJ3ZhbHVlJykge1xuICAgICAgICAgICAgaWYgKCFmaXJzdEluc3RhbmNlKVxuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdDYWxsaW5nIFwidmFsdWVcIiBtZXRob2Qgb24gbm90IGluaXRpYWxpemVkIGluc3RhbmNlIGlzIGZvcmJpZGRlbicpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb21tYW5kQXJndW1lbnQgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyc3RJbnN0YW5jZS5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBhcmd1bWVudHNbMV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5kYXRhKGRhdGFOYW1lKS5zZXRWYWx1ZShuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGVsID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICBpbnN0YW5jZSA9IGVsLmRhdGEoZGF0YU5hbWUpLFxuICAgICAgICAgICAgICAgIGNvbmZpZyA9ICQuaXNQbGFpbk9iamVjdChjb25maWdPckNvbW1hbmQpID8gY29uZmlnT3JDb21tYW5kIDoge307XG5cbiAgICAgICAgICAgIGlmIChpbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmluaXQoY29uZmlnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGluaXRpYWxDb25maWcgPSAkLmV4dGVuZCh7fSwgZWwuZGF0YSgpKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGluaXRpYWxDb25maWcuZmlsbCA9PSAnc3RyaW5nJylcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbENvbmZpZy5maWxsID0gSlNPTi5wYXJzZShpbml0aWFsQ29uZmlnLmZpbGwpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaW5pdGlhbENvbmZpZy5hbmltYXRpb24gPT0gJ3N0cmluZycpXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxDb25maWcuYW5pbWF0aW9uID0gSlNPTi5wYXJzZShpbml0aWFsQ29uZmlnLmFuaW1hdGlvbik7XG4gICAgICAgICAgICAgICAgY29uZmlnID0gJC5leHRlbmQoaW5pdGlhbENvbmZpZywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICBjb25maWcuZWwgPSBlbDtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZSA9IG5ldyBDaXJjbGVQcm9ncmVzcyhjb25maWcpO1xuICAgICAgICAgICAgICAgIGVsLmRhdGEoZGF0YU5hbWUsIGluc3RhbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbn0pO1xuIiwiLyohXG4gKiBUaGUgRmluYWwgQ291bnRkb3duIGZvciBqUXVlcnkgdjIuMi4wIChodHRwOi8vaGlsaW9zLmdpdGh1Yi5pby9qUXVlcnkuY291bnRkb3duLylcbiAqIENvcHlyaWdodCAoYykgMjAxNiBFZHNvbiBIaWxpb3NcbiAqIFxuICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZlxuICogdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbCBpblxuICogdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0b1xuICogdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2ZcbiAqIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbyxcbiAqIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuICogXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKiBcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTXG4gKiBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1JcbiAqIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUlxuICogSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU5cbiAqIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG4gKi9cbihmdW5jdGlvbihmYWN0b3J5KSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIGRlZmluZShbIFwianF1ZXJ5XCIgXSwgZmFjdG9yeSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZmFjdG9yeShqUXVlcnkpO1xuICAgIH1cbn0pKGZ1bmN0aW9uKCQpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgaW5zdGFuY2VzID0gW10sIG1hdGNoZXJzID0gW10sIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBwcmVjaXNpb246IDEwMCxcbiAgICAgICAgZWxhcHNlOiBmYWxzZSxcbiAgICAgICAgZGVmZXI6IGZhbHNlXG4gICAgfTtcbiAgICBtYXRjaGVycy5wdXNoKC9eWzAtOV0qJC8uc291cmNlKTtcbiAgICBtYXRjaGVycy5wdXNoKC8oWzAtOV17MSwyfVxcLyl7Mn1bMC05XXs0fSggWzAtOV17MSwyfSg6WzAtOV17Mn0pezJ9KT8vLnNvdXJjZSk7XG4gICAgbWF0Y2hlcnMucHVzaCgvWzAtOV17NH0oW1xcL1xcLV1bMC05XXsxLDJ9KXsyfSggWzAtOV17MSwyfSg6WzAtOV17Mn0pezJ9KT8vLnNvdXJjZSk7XG4gICAgbWF0Y2hlcnMgPSBuZXcgUmVnRXhwKG1hdGNoZXJzLmpvaW4oXCJ8XCIpKTtcbiAgICBmdW5jdGlvbiBwYXJzZURhdGVTdHJpbmcoZGF0ZVN0cmluZykge1xuICAgICAgICBpZiAoZGF0ZVN0cmluZyBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRlU3RyaW5nO1xuICAgICAgICB9XG4gICAgICAgIGlmIChTdHJpbmcoZGF0ZVN0cmluZykubWF0Y2gobWF0Y2hlcnMpKSB7XG4gICAgICAgICAgICBpZiAoU3RyaW5nKGRhdGVTdHJpbmcpLm1hdGNoKC9eWzAtOV0qJC8pKSB7XG4gICAgICAgICAgICAgICAgZGF0ZVN0cmluZyA9IE51bWJlcihkYXRlU3RyaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChTdHJpbmcoZGF0ZVN0cmluZykubWF0Y2goL1xcLS8pKSB7XG4gICAgICAgICAgICAgICAgZGF0ZVN0cmluZyA9IFN0cmluZyhkYXRlU3RyaW5nKS5yZXBsYWNlKC9cXC0vZywgXCIvXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGVTdHJpbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGRuJ3QgY2FzdCBgXCIgKyBkYXRlU3RyaW5nICsgXCJgIHRvIGEgZGF0ZSBvYmplY3QuXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZhciBESVJFQ1RJVkVfS0VZX01BUCA9IHtcbiAgICAgICAgWTogXCJ5ZWFyc1wiLFxuICAgICAgICBtOiBcIm1vbnRoc1wiLFxuICAgICAgICBuOiBcImRheXNUb01vbnRoXCIsXG4gICAgICAgIGQ6IFwiZGF5c1RvV2Vla1wiLFxuICAgICAgICB3OiBcIndlZWtzXCIsXG4gICAgICAgIFc6IFwid2Vla3NUb01vbnRoXCIsXG4gICAgICAgIEg6IFwiaG91cnNcIixcbiAgICAgICAgTTogXCJtaW51dGVzXCIsXG4gICAgICAgIFM6IFwic2Vjb25kc1wiLFxuICAgICAgICBEOiBcInRvdGFsRGF5c1wiLFxuICAgICAgICBJOiBcInRvdGFsSG91cnNcIixcbiAgICAgICAgTjogXCJ0b3RhbE1pbnV0ZXNcIixcbiAgICAgICAgVDogXCJ0b3RhbFNlY29uZHNcIlxuICAgIH07XG4gICAgZnVuY3Rpb24gZXNjYXBlZFJlZ0V4cChzdHIpIHtcbiAgICAgICAgdmFyIHNhbml0aXplID0gc3RyLnRvU3RyaW5nKCkucmVwbGFjZSgvKFsuPyorXiRbXFxdXFxcXCgpe318LV0pL2csIFwiXFxcXCQxXCIpO1xuICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChzYW5pdGl6ZSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHN0cmZ0aW1lKG9mZnNldE9iamVjdCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZm9ybWF0KSB7XG4gICAgICAgICAgICB2YXIgZGlyZWN0aXZlcyA9IGZvcm1hdC5tYXRjaCgvJSgtfCEpP1tBLVpdezF9KDpbXjtdKzspPy9naSk7XG4gICAgICAgICAgICBpZiAoZGlyZWN0aXZlcykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBkaXJlY3RpdmVzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkaXJlY3RpdmUgPSBkaXJlY3RpdmVzW2ldLm1hdGNoKC8lKC18ISk/KFthLXpBLVpdezF9KSg6W147XSs7KT8vKSwgcmVnZXhwID0gZXNjYXBlZFJlZ0V4cChkaXJlY3RpdmVbMF0pLCBtb2RpZmllciA9IGRpcmVjdGl2ZVsxXSB8fCBcIlwiLCBwbHVyYWwgPSBkaXJlY3RpdmVbM10gfHwgXCJcIiwgdmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3RpdmUgPSBkaXJlY3RpdmVbMl07XG4gICAgICAgICAgICAgICAgICAgIGlmIChESVJFQ1RJVkVfS0VZX01BUC5oYXNPd25Qcm9wZXJ0eShkaXJlY3RpdmUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IERJUkVDVElWRV9LRVlfTUFQW2RpcmVjdGl2ZV07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE51bWJlcihvZmZzZXRPYmplY3RbdmFsdWVdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RpZmllciA9PT0gXCIhXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBsdXJhbGl6ZShwbHVyYWwsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RpZmllciA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gXCIwXCIgKyB2YWx1ZS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdC5yZXBsYWNlKHJlZ2V4cCwgdmFsdWUudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3JtYXQgPSBmb3JtYXQucmVwbGFjZSgvJSUvLCBcIiVcIik7XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0O1xuICAgICAgICB9O1xuICAgIH1cbiAgICBmdW5jdGlvbiBwbHVyYWxpemUoZm9ybWF0LCBjb3VudCkge1xuICAgICAgICB2YXIgcGx1cmFsID0gXCJzXCIsIHNpbmd1bGFyID0gXCJcIjtcbiAgICAgICAgaWYgKGZvcm1hdCkge1xuICAgICAgICAgICAgZm9ybWF0ID0gZm9ybWF0LnJlcGxhY2UoLyg6fDt8XFxzKS9naSwgXCJcIikuc3BsaXQoL1xcLC8pO1xuICAgICAgICAgICAgaWYgKGZvcm1hdC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBwbHVyYWwgPSBmb3JtYXRbMF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNpbmd1bGFyID0gZm9ybWF0WzBdO1xuICAgICAgICAgICAgICAgIHBsdXJhbCA9IGZvcm1hdFsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoTWF0aC5hYnMoY291bnQpID4gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHBsdXJhbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzaW5ndWxhcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2YXIgQ291bnRkb3duID0gZnVuY3Rpb24oZWwsIGZpbmFsRGF0ZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLmVsID0gZWw7XG4gICAgICAgIHRoaXMuJGVsID0gJChlbCk7XG4gICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBudWxsO1xuICAgICAgICB0aGlzLm9mZnNldCA9IHt9O1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdE9wdGlvbnMpO1xuICAgICAgICB0aGlzLmluc3RhbmNlTnVtYmVyID0gaW5zdGFuY2VzLmxlbmd0aDtcbiAgICAgICAgaW5zdGFuY2VzLnB1c2godGhpcyk7XG4gICAgICAgIHRoaXMuJGVsLmRhdGEoXCJjb3VudGRvd24taW5zdGFuY2VcIiwgdGhpcy5pbnN0YW5jZU51bWJlcik7XG4gICAgICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIHRoaXMuJGVsLm9uKFwidXBkYXRlLmNvdW50ZG93blwiLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRlbC5vbihcInN0b3BlZC5jb3VudGRvd25cIiwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgdGhpcy4kZWwub24oXCJmaW5pc2guY291bnRkb3duXCIsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0RmluYWxEYXRlKGZpbmFsRGF0ZSk7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGVmZXIgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgICQuZXh0ZW5kKENvdW50ZG93bi5wcm90b3R5cGUsIHtcbiAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaW50ZXJ2YWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZS5jYWxsKHNlbGYpO1xuICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLnByZWNpc2lvbik7XG4gICAgICAgIH0sXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwic3RvcGVkXCIpO1xuICAgICAgICB9LFxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwYXVzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzdW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcC5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgaW5zdGFuY2VzW3RoaXMuaW5zdGFuY2VOdW1iZXJdID0gbnVsbDtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLiRlbC5kYXRhKCkuY291bnRkb3duSW5zdGFuY2U7XG4gICAgICAgIH0sXG4gICAgICAgIHNldEZpbmFsRGF0ZTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZmluYWxEYXRlID0gcGFyc2VEYXRlU3RyaW5nKHZhbHVlKTtcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRlbC5jbG9zZXN0KFwiaHRtbFwiKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBoYXNFdmVudHNBdHRhY2hlZCA9ICQuX2RhdGEodGhpcy5lbCwgXCJldmVudHNcIikgIT09IHVuZGVmaW5lZCwgbm93ID0gbmV3IERhdGUoKSwgbmV3VG90YWxTZWNzTGVmdDtcbiAgICAgICAgICAgIG5ld1RvdGFsU2Vjc0xlZnQgPSB0aGlzLmZpbmFsRGF0ZS5nZXRUaW1lKCkgLSBub3cuZ2V0VGltZSgpO1xuICAgICAgICAgICAgbmV3VG90YWxTZWNzTGVmdCA9IE1hdGguY2VpbChuZXdUb3RhbFNlY3NMZWZ0IC8gMWUzKTtcbiAgICAgICAgICAgIG5ld1RvdGFsU2Vjc0xlZnQgPSAhdGhpcy5vcHRpb25zLmVsYXBzZSAmJiBuZXdUb3RhbFNlY3NMZWZ0IDwgMCA/IDAgOiBNYXRoLmFicyhuZXdUb3RhbFNlY3NMZWZ0KTtcbiAgICAgICAgICAgIGlmICh0aGlzLnRvdGFsU2Vjc0xlZnQgPT09IG5ld1RvdGFsU2Vjc0xlZnQgfHwgIWhhc0V2ZW50c0F0dGFjaGVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsU2Vjc0xlZnQgPSBuZXdUb3RhbFNlY3NMZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbGFwc2VkID0gbm93ID49IHRoaXMuZmluYWxEYXRlO1xuICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSB7XG4gICAgICAgICAgICAgICAgc2Vjb25kczogdGhpcy50b3RhbFNlY3NMZWZ0ICUgNjAsXG4gICAgICAgICAgICAgICAgbWludXRlczogTWF0aC5mbG9vcih0aGlzLnRvdGFsU2Vjc0xlZnQgLyA2MCkgJSA2MCxcbiAgICAgICAgICAgICAgICBob3VyczogTWF0aC5mbG9vcih0aGlzLnRvdGFsU2Vjc0xlZnQgLyA2MCAvIDYwKSAlIDI0LFxuICAgICAgICAgICAgICAgIGRheXM6IE1hdGguZmxvb3IodGhpcy50b3RhbFNlY3NMZWZ0IC8gNjAgLyA2MCAvIDI0KSAlIDcsXG4gICAgICAgICAgICAgICAgZGF5c1RvV2VlazogTWF0aC5mbG9vcih0aGlzLnRvdGFsU2Vjc0xlZnQgLyA2MCAvIDYwIC8gMjQpICUgNyxcbiAgICAgICAgICAgICAgICBkYXlzVG9Nb250aDogTWF0aC5mbG9vcih0aGlzLnRvdGFsU2Vjc0xlZnQgLyA2MCAvIDYwIC8gMjQgJSAzMC40MzY4KSxcbiAgICAgICAgICAgICAgICB3ZWVrczogTWF0aC5mbG9vcih0aGlzLnRvdGFsU2Vjc0xlZnQgLyA2MCAvIDYwIC8gMjQgLyA3KSxcbiAgICAgICAgICAgICAgICB3ZWVrc1RvTW9udGg6IE1hdGguZmxvb3IodGhpcy50b3RhbFNlY3NMZWZ0IC8gNjAgLyA2MCAvIDI0IC8gNykgJSA0LFxuICAgICAgICAgICAgICAgIG1vbnRoczogTWF0aC5mbG9vcih0aGlzLnRvdGFsU2Vjc0xlZnQgLyA2MCAvIDYwIC8gMjQgLyAzMC40MzY4KSxcbiAgICAgICAgICAgICAgICB5ZWFyczogTWF0aC5hYnModGhpcy5maW5hbERhdGUuZ2V0RnVsbFllYXIoKSAtIG5vdy5nZXRGdWxsWWVhcigpKSxcbiAgICAgICAgICAgICAgICB0b3RhbERheXM6IE1hdGguZmxvb3IodGhpcy50b3RhbFNlY3NMZWZ0IC8gNjAgLyA2MCAvIDI0KSxcbiAgICAgICAgICAgICAgICB0b3RhbEhvdXJzOiBNYXRoLmZsb29yKHRoaXMudG90YWxTZWNzTGVmdCAvIDYwIC8gNjApLFxuICAgICAgICAgICAgICAgIHRvdGFsTWludXRlczogTWF0aC5mbG9vcih0aGlzLnRvdGFsU2Vjc0xlZnQgLyA2MCksXG4gICAgICAgICAgICAgICAgdG90YWxTZWNvbmRzOiB0aGlzLnRvdGFsU2Vjc0xlZnRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5lbGFwc2UgJiYgdGhpcy50b3RhbFNlY3NMZWZ0ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwiZmluaXNoXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoXCJ1cGRhdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRpc3BhdGNoRXZlbnQ6IGZ1bmN0aW9uKGV2ZW50TmFtZSkge1xuICAgICAgICAgICAgdmFyIGV2ZW50ID0gJC5FdmVudChldmVudE5hbWUgKyBcIi5jb3VudGRvd25cIik7XG4gICAgICAgICAgICBldmVudC5maW5hbERhdGUgPSB0aGlzLmZpbmFsRGF0ZTtcbiAgICAgICAgICAgIGV2ZW50LmVsYXBzZWQgPSB0aGlzLmVsYXBzZWQ7XG4gICAgICAgICAgICBldmVudC5vZmZzZXQgPSAkLmV4dGVuZCh7fSwgdGhpcy5vZmZzZXQpO1xuICAgICAgICAgICAgZXZlbnQuc3RyZnRpbWUgPSBzdHJmdGltZSh0aGlzLm9mZnNldCk7XG4gICAgICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgICQuZm4uY291bnRkb3duID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmd1bWVudHNBcnJheSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2VOdW1iZXIgPSAkKHRoaXMpLmRhdGEoXCJjb3VudGRvd24taW5zdGFuY2VcIik7XG4gICAgICAgICAgICBpZiAoaW5zdGFuY2VOdW1iZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IGluc3RhbmNlc1tpbnN0YW5jZU51bWJlcl0sIG1ldGhvZCA9IGFyZ3VtZW50c0FycmF5WzBdO1xuICAgICAgICAgICAgICAgIGlmIChDb3VudGRvd24ucHJvdG90eXBlLmhhc093blByb3BlcnR5KG1ldGhvZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VbbWV0aG9kXS5hcHBseShpbnN0YW5jZSwgYXJndW1lbnRzQXJyYXkuc2xpY2UoMSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoU3RyaW5nKG1ldGhvZCkubWF0Y2goL15bJEEtWl9dWzAtOUEtWl8kXSokL2kpID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnNldEZpbmFsRGF0ZS5jYWxsKGluc3RhbmNlLCBtZXRob2QpO1xuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5zdGFydCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQuZXJyb3IoXCJNZXRob2QgJXMgZG9lcyBub3QgZXhpc3Qgb24galF1ZXJ5LmNvdW50ZG93blwiLnJlcGxhY2UoL1xcJXMvZ2ksIG1ldGhvZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3IENvdW50ZG93bih0aGlzLCBhcmd1bWVudHNBcnJheVswXSwgYXJndW1lbnRzQXJyYXlbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufSk7IiwiLypcbiAqICQgRWFzaW5nIHYxLjMgLSBodHRwOi8vZ3NnZC5jby51ay9zYW5kYm94LyQvZWFzaW5nL1xuICpcbiAqIFVzZXMgdGhlIGJ1aWx0IGluIGVhc2luZyBjYXBhYmlsaXRpZXMgYWRkZWQgSW4gJCAxLjFcbiAqIHRvIG9mZmVyIG11bHRpcGxlIGVhc2luZyBvcHRpb25zXG4gKlxuICogVEVSTVMgT0YgVVNFIC0gJCBFYXNpbmdcbiAqXG4gKiBPcGVuIHNvdXJjZSB1bmRlciB0aGUgQlNEIExpY2Vuc2UuXG4gKlxuICogQ29weXJpZ2h0INCSwqkgMjAwOCBHZW9yZ2UgTWNHaW5sZXkgU21pdGhcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbixcbiAqIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZlxuICogY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxuICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3RcbiAqIG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzXG4gKiBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKlxuICogTmVpdGhlciB0aGUgbmFtZSBvZiB0aGUgYXV0aG9yIG5vciB0aGUgbmFtZXMgb2YgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2VcbiAqIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXG4gKlxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCIgQU5EIEFOWVxuICogRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GXG4gKiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqICBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsXG4gKiAgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFXG4gKiAgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEXG4gKiBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElOR1xuICogIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEXG4gKiBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKlxuICovXG5cbihmdW5jdGlvbigkLCB1bmRlZmluZWQpIHtcbiAgICAvLyB0OiBjdXJyZW50IHRpbWUsIGI6IGJlZ0lubkluZyB2YWx1ZSwgYzogY2hhbmdlIEluIHZhbHVlLCBkOiBkdXJhdGlvblxuICAgICQuZWFzaW5nWydqc3dpbmcnXSA9ICQuZWFzaW5nWydzd2luZyddO1xuXG4gICAgJC5leHRlbmQoXG4gICAgICAgICQuZWFzaW5nLFxuICAgICAgICB7XG4gICAgICAgICAgICBkZWY6ICdlYXNlT3V0UXVhZCcsXG4gICAgICAgICAgICBzd2luZzogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICAvL2FsZXJ0KCQuZWFzaW5nLmRlZmF1bHQpO1xuICAgICAgICAgICAgICAgIHJldHVybiAkLmVhc2luZ1skLmVhc2luZy5kZWZdKHgsIHQsIGIsIGMsIGQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVhc2VJblF1YWQ6IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMqKHQvPWQpKnQgKyBiO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVhc2VPdXRRdWFkOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtYyAqKHQvPWQpKih0LTIpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5PdXRRdWFkOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIGlmICgodC89ZC8yKSA8IDEpIHJldHVybiBjLzIqdCp0ICsgYjtcbiAgICAgICAgICAgICAgICByZXR1cm4gLWMvMiAqICgoLS10KSoodC0yKSAtIDEpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5DdWJpYzogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYyoodC89ZCkqdCp0ICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlT3V0Q3ViaWM6IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMqKCh0PXQvZC0xKSp0KnQgKyAxKSArIGI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWFzZUluT3V0Q3ViaWM6IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMip0KnQqdCArIGI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMvMiooKHQtPTIpKnQqdCArIDIpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5RdWFydDogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYyoodC89ZCkqdCp0KnQgKyBiO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVhc2VPdXRRdWFydDogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLWMgKiAoKHQ9dC9kLTEpKnQqdCp0IC0gMSkgKyBiO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVhc2VJbk91dFF1YXJ0OiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIGlmICgodC89ZC8yKSA8IDEpIHJldHVybiBjLzIqdCp0KnQqdCArIGI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1jLzIgKiAoKHQtPTIpKnQqdCp0IC0gMikgKyBiO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVhc2VJblF1aW50OiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjKih0Lz1kKSp0KnQqdCp0ICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlT3V0UXVpbnQ6IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMqKCh0PXQvZC0xKSp0KnQqdCp0ICsgMSkgKyBiO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVhc2VJbk91dFF1aW50OiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIGlmICgodC89ZC8yKSA8IDEpIHJldHVybiBjLzIqdCp0KnQqdCp0ICsgYjtcbiAgICAgICAgICAgICAgICByZXR1cm4gYy8yKigodC09MikqdCp0KnQqdCArIDIpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5TaW5lOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtYyAqIE1hdGguY29zKHQvZCAqIChNYXRoLlBJLzIpKSArIGMgKyBiO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVhc2VPdXRTaW5lOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjICogTWF0aC5zaW4odC9kICogKE1hdGguUEkvMikpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5PdXRTaW5lOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtYy8yICogKE1hdGguY29zKE1hdGguUEkqdC9kKSAtIDEpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5FeHBvOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAodD09MCkgPyBiIDogYyAqIE1hdGgucG93KDIsIDEwICogKHQvZCAtIDEpKSArIGI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWFzZU91dEV4cG86IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh0PT1kKSA/IGIrYyA6IGMgKiAoLU1hdGgucG93KDIsIC0xMCAqIHQvZCkgKyAxKSArIGI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWFzZUluT3V0RXhwbzogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICBpZiAodD09MCkgcmV0dXJuIGI7XG4gICAgICAgICAgICAgICAgaWYgKHQ9PWQpIHJldHVybiBiK2M7XG4gICAgICAgICAgICAgICAgaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMiAqIE1hdGgucG93KDIsIDEwICogKHQgLSAxKSkgKyBiO1xuICAgICAgICAgICAgICAgIHJldHVybiBjLzIgKiAoLU1hdGgucG93KDIsIC0xMCAqIC0tdCkgKyAyKSArIGI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWFzZUluQ2lyYzogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLWMgKiAoTWF0aC5zcXJ0KDEgLSAodC89ZCkqdCkgLSAxKSArIGI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWFzZU91dENpcmM6IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMgKiBNYXRoLnNxcnQoMSAtICh0PXQvZC0xKSp0KSArIGI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWFzZUluT3V0Q2lyYzogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICBpZiAoKHQvPWQvMikgPCAxKSByZXR1cm4gLWMvMiAqIChNYXRoLnNxcnQoMSAtIHQqdCkgLSAxKSArIGI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMvMiAqIChNYXRoLnNxcnQoMSAtICh0LT0yKSp0KSArIDEpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5FbGFzdGljOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIHZhciBzPTEuNzAxNTg7dmFyIHA9MDt2YXIgYT1jO1xuICAgICAgICAgICAgICAgIGlmICh0PT0wKSByZXR1cm4gYjsgIGlmICgodC89ZCk9PTEpIHJldHVybiBiK2M7ICBpZiAoIXApIHA9ZCouMztcbiAgICAgICAgICAgICAgICBpZiAoYSA8IE1hdGguYWJzKGMpKSB7IGE9YzsgdmFyIHM9cC80OyB9XG4gICAgICAgICAgICAgICAgZWxzZSB2YXIgcyA9IHAvKDIqTWF0aC5QSSkgKiBNYXRoLmFzaW4gKGMvYSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0oYSpNYXRoLnBvdygyLDEwKih0LT0xKSkgKiBNYXRoLnNpbiggKHQqZC1zKSooMipNYXRoLlBJKS9wICkpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlT3V0RWxhc3RpYzogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcz0xLjcwMTU4O3ZhciBwPTA7dmFyIGE9YztcbiAgICAgICAgICAgICAgICBpZiAodD09MCkgcmV0dXJuIGI7ICBpZiAoKHQvPWQpPT0xKSByZXR1cm4gYitjOyAgaWYgKCFwKSBwPWQqLjM7XG4gICAgICAgICAgICAgICAgaWYgKGEgPCBNYXRoLmFicyhjKSkgeyBhPWM7IHZhciBzPXAvNDsgfVxuICAgICAgICAgICAgICAgIGVsc2UgdmFyIHMgPSBwLygyKk1hdGguUEkpICogTWF0aC5hc2luIChjL2EpO1xuICAgICAgICAgICAgICAgIHJldHVybiBhKk1hdGgucG93KDIsLTEwKnQpICogTWF0aC5zaW4oICh0KmQtcykqKDIqTWF0aC5QSSkvcCApICsgYyArIGI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWFzZUluT3V0RWxhc3RpYzogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcz0xLjcwMTU4O3ZhciBwPTA7dmFyIGE9YztcbiAgICAgICAgICAgICAgICBpZiAodD09MCkgcmV0dXJuIGI7ICBpZiAoKHQvPWQvMik9PTIpIHJldHVybiBiK2M7ICBpZiAoIXApIHA9ZCooLjMqMS41KTtcbiAgICAgICAgICAgICAgICBpZiAoYSA8IE1hdGguYWJzKGMpKSB7IGE9YzsgdmFyIHM9cC80OyB9XG4gICAgICAgICAgICAgICAgZWxzZSB2YXIgcyA9IHAvKDIqTWF0aC5QSSkgKiBNYXRoLmFzaW4gKGMvYSk7XG4gICAgICAgICAgICAgICAgaWYgKHQgPCAxKSByZXR1cm4gLS41KihhKk1hdGgucG93KDIsMTAqKHQtPTEpKSAqIE1hdGguc2luKCAodCpkLXMpKigyKk1hdGguUEkpL3AgKSkgKyBiO1xuICAgICAgICAgICAgICAgIHJldHVybiBhKk1hdGgucG93KDIsLTEwKih0LT0xKSkgKiBNYXRoLnNpbiggKHQqZC1zKSooMipNYXRoLlBJKS9wICkqLjUgKyBjICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5CYWNrOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCwgcykge1xuICAgICAgICAgICAgICAgIGlmIChzID09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMqKHQvPWQpKnQqKChzKzEpKnQgLSBzKSArIGI7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWFzZU91dEJhY2s6IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkLCBzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHMgPT0gdW5kZWZpbmVkKSBzID0gMS43MDE1ODtcbiAgICAgICAgICAgICAgICByZXR1cm4gYyooKHQ9dC9kLTEpKnQqKChzKzEpKnQgKyBzKSArIDEpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5PdXRCYWNrOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCwgcykge1xuICAgICAgICAgICAgICAgIGlmIChzID09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7XG4gICAgICAgICAgICAgICAgaWYgKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMioodCp0KigoKHMqPSgxLjUyNSkpKzEpKnQgLSBzKSkgKyBiO1xuICAgICAgICAgICAgICAgIHJldHVybiBjLzIqKCh0LT0yKSp0KigoKHMqPSgxLjUyNSkpKzEpKnQgKyBzKSArIDIpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlSW5Cb3VuY2U6IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMgLSAkLmVhc2luZy5lYXNlT3V0Qm91bmNlICh4LCBkLXQsIDAsIGMsIGQpICsgYjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlYXNlT3V0Qm91bmNlOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgICAgICAgICAgICAgIGlmICgodC89ZCkgPCAoMS8yLjc1KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyooNy41NjI1KnQqdCkgKyBiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodCA8ICgyLzIuNzUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjKig3LjU2MjUqKHQtPSgxLjUvMi43NSkpKnQgKyAuNzUpICsgYjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHQgPCAoMi41LzIuNzUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjKig3LjU2MjUqKHQtPSgyLjI1LzIuNzUpKSp0ICsgLjkzNzUpICsgYjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyooNy41NjI1Kih0LT0oMi42MjUvMi43NSkpKnQgKyAuOTg0Mzc1KSArIGI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVhc2VJbk91dEJvdW5jZTogZnVuY3Rpb24gKHgsIHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICAgICAgICBpZiAodCA8IGQvMikgcmV0dXJuICQuZWFzaW5nLmVhc2VJbkJvdW5jZSAoeCwgdCoyLCAwLCBjLCBkKSAqIC41ICsgYjtcbiAgICAgICAgICAgICAgICByZXR1cm4gJC5lYXNpbmcuZWFzZU91dEJvdW5jZSAoeCwgdCoyLWQsIDAsIGMsIGQpICogLjUgKyBjKi41ICsgYjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG59KShqUXVlcnkpO1xuXG4vKlxuICpcbiAqIFRFUk1TIE9GIFVTRSAtIEVBU0lORyBFUVVBVElPTlNcbiAqXG4gKiBPcGVuIHNvdXJjZSB1bmRlciB0aGUgQlNEIExpY2Vuc2UuXG4gKlxuICogQ29weXJpZ2h0INCSwqkgMjAwMSBSb2JlcnQgUGVubmVyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sXG4gKiBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKlxuICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2ZcbiAqIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0XG4gKiBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFsc1xuICogcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICpcbiAqIE5laXRoZXIgdGhlIG5hbWUgb2YgdGhlIGF1dGhvciBub3IgdGhlIG5hbWVzIG9mIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlXG4gKiBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLlxuICpcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORCBBTllcbiAqIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRlxuICogTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gKiAgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLFxuICogIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURVxuICogIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRFxuICogQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkdcbiAqICBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRFxuICogT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxuICpcbiAqLyIsIi8qX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXG4gXyBqcXVlcnkubWIuY29tcG9uZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIGZpbGU6IGpxdWVyeS5tYi5ZVFBsYXllci5zcmMuanMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyBsYXN0IG1vZGlmaWVkOiAxMS8wNS8xNyAxOS41NCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIE9wZW4gTGFiIHMuci5sLiwgRmxvcmVuY2UgLSBJdGFseSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gZW1haWw6IG1hdHRlb0BvcGVuLWxhYi5jb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIHNpdGU6IGh0dHA6Ly9wdXB1bnppLmNvbSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICBodHRwOi8vb3Blbi1sYWIuY29tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gYmxvZzogaHR0cDovL3B1cHVuemkub3Blbi1sYWIuY29tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIFEmQTogIGh0dHA6Ly9qcXVlcnkucHVwdW56aS5jb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gTGljZW5jZXM6IE1JVCwgR1BMICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLmh0bWwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIENvcHlyaWdodCAoYykgMjAwMS0yMDE3LiBNYXR0ZW8gQmljb2NjaGkgKFB1cHVuemkpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fKi9cbnZhciB5dHAgPSB5dHAgfHwge307XG5cbmZ1bmN0aW9uIG9uWW91VHViZUlmcmFtZUFQSVJlYWR5KCkge1xuXHRpZiggeXRwLllUQVBJUmVhZHkgKSByZXR1cm47XG5cdHl0cC5ZVEFQSVJlYWR5ID0gdHJ1ZTtcblx0alF1ZXJ5KCBkb2N1bWVudCApLnRyaWdnZXIoIFwiWVRBUElSZWFkeVwiICk7XG59XG5cbi8vd2luZG93Lm9uWW91VHViZUlmcmFtZUFQSVJlYWR5ID0gb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHk7XG5cbnZhciBnZXRZVFBWaWRlb0lEID0gZnVuY3Rpb24oIHVybCApIHtcblx0dmFyIHZpZGVvSUQsIHBsYXlsaXN0SUQ7XG5cdGlmKCB1cmwuaW5kZXhPZiggXCJ5b3V0dS5iZVwiICkgPiAwICkge1xuXHRcdHZpZGVvSUQgPSB1cmwuc3Vic3RyKCB1cmwubGFzdEluZGV4T2YoIFwiL1wiICkgKyAxLCB1cmwubGVuZ3RoICk7XG5cdFx0cGxheWxpc3RJRCA9IHZpZGVvSUQuaW5kZXhPZiggXCI/bGlzdD1cIiApID4gMCA/IHZpZGVvSUQuc3Vic3RyKCB2aWRlb0lELmxhc3RJbmRleE9mKCBcIj1cIiApLCB2aWRlb0lELmxlbmd0aCApIDogbnVsbDtcblx0XHR2aWRlb0lEID0gcGxheWxpc3RJRCA/IHZpZGVvSUQuc3Vic3RyKCAwLCB2aWRlb0lELmxhc3RJbmRleE9mKCBcIj9cIiApICkgOiB2aWRlb0lEO1xuXHR9IGVsc2UgaWYoIHVybC5pbmRleE9mKCBcImh0dHBcIiApID4gLTEgKSB7XG5cdFx0Ly92aWRlb0lEID0gdXJsLm1hdGNoKCAvKFtcXC8mXXZcXC8oW14mI10qKSl8KFtcXFxcPyZddj0oW14mI10qKSkvIClbIDEgXTtcblx0XHR2aWRlb0lEID0gdXJsLm1hdGNoKCAvW1xcXFw/Jl12PShbXiYjXSopLyApWyAxIF07XG5cdFx0cGxheWxpc3RJRCA9IHVybC5pbmRleE9mKCBcImxpc3Q9XCIgKSA+IDAgPyB1cmwubWF0Y2goIC9bXFxcXD8mXWxpc3Q9KFteJiNdKikvIClbIDEgXSA6IG51bGw7XG5cdH0gZWxzZSB7XG5cdFx0dmlkZW9JRCA9IHVybC5sZW5ndGggPiAxNSA/IG51bGwgOiB1cmw7XG5cdFx0cGxheWxpc3RJRCA9IHZpZGVvSUQgPyBudWxsIDogdXJsO1xuXHR9XG5cdHJldHVybiB7XG5cdFx0dmlkZW9JRDogdmlkZW9JRCxcblx0XHRwbGF5bGlzdElEOiBwbGF5bGlzdElEXG5cdH07XG59O1xuXG4oIGZ1bmN0aW9uKCBqUXVlcnksIHl0cCApIHtcblxuXHRqUXVlcnkubWJZVFBsYXllciA9IHtcblx0XHRuYW1lOiBcImpxdWVyeS5tYi5ZVFBsYXllclwiLFxuXHRcdHZlcnNpb246IFwiMy4wLjIwXCIsXG5cdFx0YnVpbGQ6IFwiNjMwOFwiLFxuXHRcdGF1dGhvcjogXCJNYXR0ZW8gQmljb2NjaGkgKHB1cHVuemkpXCIsXG5cdFx0YXBpS2V5OiBcIlwiLFxuXHRcdGRlZmF1bHRzOiB7XG5cdFx0XHRjb250YWlubWVudDogXCJib2R5XCIsXG5cdFx0XHRyYXRpbzogXCJhdXRvXCIsIC8vIFwiYXV0b1wiLCBcIjE2LzlcIiwgXCI0LzNcIiBvciBudW1iZXI6IDQvMywgMTYvOVxuXHRcdFx0dmlkZW9VUkw6IG51bGwsXG5cdFx0XHRwbGF5bGlzdFVSTDogbnVsbCxcblx0XHRcdHN0YXJ0QXQ6IDAsXG5cdFx0XHRzdG9wQXQ6IDAsXG5cdFx0XHRhdXRvUGxheTogdHJ1ZSxcblx0XHRcdHZvbDogNTAsIC8vIDEgdG8gMTAwXG5cdFx0XHRhZGRSYXN0ZXI6IGZhbHNlLFxuXHRcdFx0bWFzazogZmFsc2UsXG5cdFx0XHRvcGFjaXR5OiAxLFxuXHRcdFx0cXVhbGl0eTogXCJkZWZhdWx0XCIsIC8vb3Ig4oCcc21hbGzigJ0sIOKAnG1lZGl1beKAnSwg4oCcbGFyZ2XigJ0sIOKAnGhkNzIw4oCdLCDigJxoZDEwODDigJ0sIOKAnGhpZ2hyZXPigJ1cblx0XHRcdG11dGU6IGZhbHNlLFxuXHRcdFx0bG9vcDogdHJ1ZSxcblx0XHRcdGZhZGVPblN0YXJ0VGltZTogNTAwLCAvL2ZhZGUgaW4gdGltaW5nIGF0IHZpZGVvIHN0YXJ0XG5cdFx0XHRzaG93Q29udHJvbHM6IHRydWUsXG5cdFx0XHRzaG93QW5ub3RhdGlvbnM6IGZhbHNlLFxuXHRcdFx0c2hvd1lUTG9nbzogdHJ1ZSxcblx0XHRcdHN0b3BNb3ZpZU9uQmx1cjogdHJ1ZSxcblx0XHRcdHJlYWxmdWxsc2NyZWVuOiB0cnVlLFxuXHRcdFx0bW9iaWxlRmFsbGJhY2tJbWFnZTogbnVsbCxcblx0XHRcdGdhVHJhY2s6IHRydWUsXG5cdFx0XHRvcHRpbWl6ZURpc3BsYXk6IHRydWUsXG5cdFx0XHRyZW1lbWJlcl9sYXN0X3RpbWU6IGZhbHNlLFxuXHRcdFx0cGxheU9ubHlJZlZpc2libGU6IGZhbHNlLFxuXHRcdFx0YW5jaG9yOiBcImNlbnRlcixjZW50ZXJcIiwgLy8gdG9wLGJvdHRvbSxsZWZ0LHJpZ2h0IGNvbWJpbmVkIGluIHBhaXJcblx0XHRcdG9uUmVhZHk6IGZ1bmN0aW9uKCBwbGF5ZXIgKSB7fSxcblx0XHRcdG9uRXJyb3I6IGZ1bmN0aW9uKCBwbGF5ZXIsIGVyciApIHt9XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKiAgQGZvbnRmYWNlIGljb25zXG5cdFx0ICogICovXG5cdFx0Y29udHJvbHM6IHtcblx0XHRcdHBsYXk6IFwiUFwiLFxuXHRcdFx0cGF1c2U6IFwicFwiLFxuXHRcdFx0bXV0ZTogXCJNXCIsXG5cdFx0XHR1bm11dGU6IFwiQVwiLFxuXHRcdFx0b25seVlUOiBcIk9cIixcblx0XHRcdHNob3dTaXRlOiBcIlJcIixcblx0XHRcdHl0TG9nbzogXCJZXCJcblx0XHR9LFxuXHRcdGNvbnRyb2xCYXI6IG51bGwsXG5cdFx0bG9hZGluZzogbnVsbCxcblx0XHRsb2NhdGlvblByb3RvY29sOiBcImh0dHBzOlwiLFxuXG5cdFx0ZmlsdGVyczoge1xuXHRcdFx0Z3JheXNjYWxlOiB7XG5cdFx0XHRcdHZhbHVlOiAwLFxuXHRcdFx0XHR1bml0OiBcIiVcIlxuXHRcdFx0fSxcblx0XHRcdGh1ZV9yb3RhdGU6IHtcblx0XHRcdFx0dmFsdWU6IDAsXG5cdFx0XHRcdHVuaXQ6IFwiZGVnXCJcblx0XHRcdH0sXG5cdFx0XHRpbnZlcnQ6IHtcblx0XHRcdFx0dmFsdWU6IDAsXG5cdFx0XHRcdHVuaXQ6IFwiJVwiXG5cdFx0XHR9LFxuXHRcdFx0b3BhY2l0eToge1xuXHRcdFx0XHR2YWx1ZTogMCxcblx0XHRcdFx0dW5pdDogXCIlXCJcblx0XHRcdH0sXG5cdFx0XHRzYXR1cmF0ZToge1xuXHRcdFx0XHR2YWx1ZTogMCxcblx0XHRcdFx0dW5pdDogXCIlXCJcblx0XHRcdH0sXG5cdFx0XHRzZXBpYToge1xuXHRcdFx0XHR2YWx1ZTogMCxcblx0XHRcdFx0dW5pdDogXCIlXCJcblx0XHRcdH0sXG5cdFx0XHRicmlnaHRuZXNzOiB7XG5cdFx0XHRcdHZhbHVlOiAwLFxuXHRcdFx0XHR1bml0OiBcIiVcIlxuXHRcdFx0fSxcblx0XHRcdGNvbnRyYXN0OiB7XG5cdFx0XHRcdHZhbHVlOiAwLFxuXHRcdFx0XHR1bml0OiBcIiVcIlxuXHRcdFx0fSxcblx0XHRcdGJsdXI6IHtcblx0XHRcdFx0dmFsdWU6IDAsXG5cdFx0XHRcdHVuaXQ6IFwicHhcIlxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gb3B0aW9uc1xuXHRcdCAqIEByZXR1cm5zIFtwbGF5ZXJzXVxuXHRcdCAqL1xuXHRcdGJ1aWxkUGxheWVyOiBmdW5jdGlvbiggb3B0aW9ucyApIHtcblx0XHRcdHJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzO1xuXHRcdFx0XHR2YXIgJFlUUGxheWVyID0galF1ZXJ5KCBZVFBsYXllciApO1xuXHRcdFx0XHRZVFBsYXllci5sb29wID0gMDtcblx0XHRcdFx0WVRQbGF5ZXIub3B0ID0ge307XG5cdFx0XHRcdFlUUGxheWVyLnN0YXRlID0gMDtcblx0XHRcdFx0WVRQbGF5ZXIuZmlsdGVycyA9IGpRdWVyeS5tYllUUGxheWVyLmZpbHRlcnM7XG5cdFx0XHRcdFlUUGxheWVyLmZpbHRlcnNFbmFibGVkID0gdHJ1ZTtcblx0XHRcdFx0WVRQbGF5ZXIuaWQgPSBZVFBsYXllci5pZCB8fCBcIllUUF9cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXHRcdFx0XHQkWVRQbGF5ZXIuYWRkQ2xhc3MoIFwibWJfWVRQbGF5ZXJcIiApO1xuXG5cdFx0XHRcdHZhciBwcm9wZXJ0eSA9ICRZVFBsYXllci5kYXRhKCBcInByb3BlcnR5XCIgKSAmJiB0eXBlb2YgJFlUUGxheWVyLmRhdGEoIFwicHJvcGVydHlcIiApID09IFwic3RyaW5nXCIgPyBldmFsKCAnKCcgKyAkWVRQbGF5ZXIuZGF0YSggXCJwcm9wZXJ0eVwiICkgKyAnKScgKSA6ICRZVFBsYXllci5kYXRhKCBcInByb3BlcnR5XCIgKTtcblxuXHRcdFx0XHRpZiggdHlwZW9mIHByb3BlcnR5ICE9IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIHByb3BlcnR5LnZvbCAhPSBcInVuZGVmaW5lZFwiICkge1xuXHRcdFx0XHRcdGlmKCBwcm9wZXJ0eS52b2wgPT09IDAgKSB7XG5cdFx0XHRcdFx0XHRwcm9wZXJ0eS52b2wgPSAxO1xuXHRcdFx0XHRcdFx0cHJvcGVydHkubXV0ZSA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0alF1ZXJ5LmV4dGVuZCggWVRQbGF5ZXIub3B0LCBqUXVlcnkubWJZVFBsYXllci5kZWZhdWx0cywgb3B0aW9ucywgcHJvcGVydHkgKTtcblxuXHRcdFx0XHRpZiggIVlUUGxheWVyLmhhc0NoYW5nZWQgKSB7XG5cdFx0XHRcdFx0WVRQbGF5ZXIuZGVmYXVsdE9wdCA9IHt9O1xuXHRcdFx0XHRcdGpRdWVyeS5leHRlbmQoIFlUUGxheWVyLmRlZmF1bHRPcHQsIGpRdWVyeS5tYllUUGxheWVyLmRlZmF1bHRzLCBvcHRpb25zICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiggWVRQbGF5ZXIub3B0Lmxvb3AgPT0gXCJ0cnVlXCIgKVxuXHRcdFx0XHRcdFlUUGxheWVyLm9wdC5sb29wID0gOTk5OTtcblxuXHRcdFx0XHRZVFBsYXllci5pc1JldGluYSA9ICggd2luZG93LnJldGluYSB8fCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+IDEgKTtcblx0XHRcdFx0dmFyIGlzSWZyYW1lID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIGlzSWZyID0gZmFsc2U7XG5cdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdGlmKCBzZWxmLmxvY2F0aW9uLmhyZWYgIT0gdG9wLmxvY2F0aW9uLmhyZWYgKSBpc0lmciA9IHRydWU7XG5cdFx0XHRcdFx0fSBjYXRjaCggZSApIHtcblx0XHRcdFx0XHRcdGlzSWZyID0gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIGlzSWZyO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdFlUUGxheWVyLmNhbkdvRnVsbFNjcmVlbiA9ICEoIGpRdWVyeS5tYkJyb3dzZXIubXNpZSB8fCBqUXVlcnkubWJCcm93c2VyLm9wZXJhIHx8IGlzSWZyYW1lKCkgKTtcblx0XHRcdFx0aWYoICFZVFBsYXllci5jYW5Hb0Z1bGxTY3JlZW4gKSBZVFBsYXllci5vcHQucmVhbGZ1bGxzY3JlZW4gPSBmYWxzZTtcblx0XHRcdFx0aWYoICEkWVRQbGF5ZXIuYXR0ciggXCJpZFwiICkgKSAkWVRQbGF5ZXIuYXR0ciggXCJpZFwiLCBcInl0cF9cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICk7XG5cdFx0XHRcdHZhciBwbGF5ZXJJRCA9IFwiaWZyYW1lX1wiICsgWVRQbGF5ZXIuaWQ7XG5cdFx0XHRcdFlUUGxheWVyLmlzQWxvbmUgPSBmYWxzZTtcblx0XHRcdFx0WVRQbGF5ZXIuaGFzRm9jdXMgPSB0cnVlO1xuXHRcdFx0XHRZVFBsYXllci52aWRlb0lEID0gdGhpcy5vcHQudmlkZW9VUkwgPyBnZXRZVFBWaWRlb0lEKCB0aGlzLm9wdC52aWRlb1VSTCApLnZpZGVvSUQgOiAkWVRQbGF5ZXIuYXR0ciggXCJocmVmXCIgKSA/IGdldFlUUFZpZGVvSUQoICRZVFBsYXllci5hdHRyKCBcImhyZWZcIiApICkudmlkZW9JRCA6IGZhbHNlO1xuXHRcdFx0XHRZVFBsYXllci5wbGF5bGlzdElEID0gdGhpcy5vcHQudmlkZW9VUkwgPyBnZXRZVFBWaWRlb0lEKCB0aGlzLm9wdC52aWRlb1VSTCApLnBsYXlsaXN0SUQgOiAkWVRQbGF5ZXIuYXR0ciggXCJocmVmXCIgKSA/IGdldFlUUFZpZGVvSUQoICRZVFBsYXllci5hdHRyKCBcImhyZWZcIiApICkucGxheWxpc3RJRCA6IGZhbHNlO1xuXG5cdFx0XHRcdFlUUGxheWVyLm9wdC5zaG93QW5ub3RhdGlvbnMgPSBZVFBsYXllci5vcHQuc2hvd0Fubm90YXRpb25zID8gJzEnIDogJzMnO1xuXG5cdFx0XHRcdHZhciBzdGFydF9mcm9tX2xhc3QgPSAwO1xuXG5cdFx0XHRcdGlmKCBqUXVlcnkubWJDb29raWUuZ2V0KCBcIllUUGxheWVyX3N0YXJ0X2Zyb21cIiArIFlUUGxheWVyLnZpZGVvSUQgKSApXG5cdFx0XHRcdFx0c3RhcnRfZnJvbV9sYXN0ID0gcGFyc2VGbG9hdCggalF1ZXJ5Lm1iQ29va2llLmdldCggXCJZVFBsYXllcl9zdGFydF9mcm9tXCIgKyBZVFBsYXllci52aWRlb0lEICkgKTtcblxuXHRcdFx0XHRpZiggWVRQbGF5ZXIub3B0LnJlbWVtYmVyX2xhc3RfdGltZSAmJiBzdGFydF9mcm9tX2xhc3QgKSB7XG5cdFx0XHRcdFx0WVRQbGF5ZXIuc3RhcnRfZnJvbV9sYXN0ID0gc3RhcnRfZnJvbV9sYXN0O1xuXHRcdFx0XHRcdGpRdWVyeS5tYkNvb2tpZS5yZW1vdmUoIFwiWVRQbGF5ZXJfc3RhcnRfZnJvbVwiICsgWVRQbGF5ZXIudmlkZW9JRCApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYoIGpRdWVyeS5pc1RhYmxldCApXG5cdFx0XHRcdFx0WVRQbGF5ZXIub3B0LmF1dG9QbGF5ID0gZmFsc2U7XG5cblx0XHRcdFx0dmFyIHBsYXllclZhcnMgPSB7XG5cdFx0XHRcdFx0J21vZGVzdGJyYW5kaW5nJzogMSxcblx0XHRcdFx0XHQnYXV0b3BsYXknOiBqUXVlcnkuaXNUYWJsZXQgPyAwIDogMCxcblx0XHRcdFx0XHQnY29udHJvbHMnOiAwLFxuXHRcdFx0XHRcdCdzaG93aW5mbyc6IDAsXG5cdFx0XHRcdFx0J3JlbCc6IDAsXG5cdFx0XHRcdFx0J2VuYWJsZWpzYXBpJzogMSxcblx0XHRcdFx0XHQndmVyc2lvbic6IDMsXG5cdFx0XHRcdFx0J3BsYXllcmFwaWlkJzogcGxheWVySUQsXG5cdFx0XHRcdFx0J29yaWdpbic6ICcqJyxcblx0XHRcdFx0XHQnYWxsb3dmdWxsc2NyZWVuJzogdHJ1ZSxcblx0XHRcdFx0XHQnd21vZGUnOiAndHJhbnNwYXJlbnQnLFxuXHRcdFx0XHRcdCdpdl9sb2FkX3BvbGljeSc6IFlUUGxheWVyLm9wdC5zaG93QW5ub3RhdGlvbnMsXG5cdFx0XHRcdFx0J3BsYXlzaW5saW5lJzogMVxuXHRcdFx0XHR9O1xuXG5cblx0XHRcdFx0aWYoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd2aWRlbycgKS5jYW5QbGF5VHlwZSApIGpRdWVyeS5leHRlbmQoIHBsYXllclZhcnMsIHtcblx0XHRcdFx0XHQnaHRtbDUnOiAxXG5cdFx0XHRcdH0gKTtcblx0XHRcdFx0aWYoIGpRdWVyeS5tYkJyb3dzZXIubXNpZSAmJiBqUXVlcnkubWJCcm93c2VyLnZlcnNpb24gPCA5ICkgdGhpcy5vcHQub3BhY2l0eSA9IDE7XG5cblx0XHRcdFx0WVRQbGF5ZXIuaXNTZWxmID0gWVRQbGF5ZXIub3B0LmNvbnRhaW5tZW50ID09IFwic2VsZlwiO1xuXHRcdFx0XHRZVFBsYXllci5kZWZhdWx0T3B0LmNvbnRhaW5tZW50ID0gWVRQbGF5ZXIub3B0LmNvbnRhaW5tZW50ID0gWVRQbGF5ZXIub3B0LmNvbnRhaW5tZW50ID09IFwic2VsZlwiID8galF1ZXJ5KCB0aGlzICkgOiBqUXVlcnkoIFlUUGxheWVyLm9wdC5jb250YWlubWVudCApO1xuXHRcdFx0XHRZVFBsYXllci5pc0JhY2tncm91bmQgPSBZVFBsYXllci5vcHQuY29udGFpbm1lbnQuaXMoIFwiYm9keVwiICk7XG5cblx0XHRcdFx0aWYoIFlUUGxheWVyLmlzQmFja2dyb3VuZCAmJiB5dHAuYmFja2dyb3VuZElzSW5pdGVkIClcblx0XHRcdFx0XHRyZXR1cm47XG5cblx0XHRcdFx0dmFyIGlzUGxheWVyID0gWVRQbGF5ZXIub3B0LmNvbnRhaW5tZW50LmlzKCBqUXVlcnkoIHRoaXMgKSApO1xuXG5cdFx0XHRcdFlUUGxheWVyLmNhblBsYXlPbk1vYmlsZSA9IGlzUGxheWVyICYmIGpRdWVyeSggdGhpcyApLmNoaWxkcmVuKCkubGVuZ3RoID09PSAwO1xuXHRcdFx0XHRZVFBsYXllci5pc1BsYXllciA9IGZhbHNlO1xuXG5cdFx0XHRcdC8qKlxuXHRcdFx0XHQgKiBIaWRlIHRoZSBwbGFjZWhvbGRlciBpZiBpdCdzIG5vdCB0aGUgdGFyZ2V0IG9mIHRoZSBwbGF5ZXJcblx0XHRcdFx0ICovXG5cdFx0XHRcdGlmKCAhaXNQbGF5ZXIgKSB7XG5cdFx0XHRcdFx0JFlUUGxheWVyLmhpZGUoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRZVFBsYXllci5pc1BsYXllciA9IHRydWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgb3ZlcmxheSA9IGpRdWVyeSggXCI8ZGl2Lz5cIiApLmNzcygge1xuXHRcdFx0XHRcdHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG5cdFx0XHRcdFx0dG9wOiAwLFxuXHRcdFx0XHRcdGxlZnQ6IDAsXG5cdFx0XHRcdFx0d2lkdGg6IFwiMTAwJVwiLFxuXHRcdFx0XHRcdGhlaWdodDogXCIxMDAlXCJcblx0XHRcdFx0fSApLmFkZENsYXNzKCBcIllUUE92ZXJsYXlcIiApO1xuXG5cdFx0XHRcdGlmKCBZVFBsYXllci5pc1BsYXllciApIHtcblx0XHRcdFx0XHRvdmVybGF5Lm9uKCBcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0JFlUUGxheWVyLllUUFRvZ2dsZVBsYXkoKTtcblx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgd3JhcHBlciA9IGpRdWVyeSggXCI8ZGl2Lz5cIiApLmFkZENsYXNzKCBcIm1iWVRQX3dyYXBwZXJcIiApLmF0dHIoIFwiaWRcIiwgXCJ3cmFwcGVyX1wiICsgWVRQbGF5ZXIuaWQgKTtcblx0XHRcdFx0d3JhcHBlci5jc3MoIHtcblx0XHRcdFx0XHRwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuXHRcdFx0XHRcdHpJbmRleDogMCxcblx0XHRcdFx0XHRtaW5XaWR0aDogXCIxMDAlXCIsXG5cdFx0XHRcdFx0bWluSGVpZ2h0OiBcIjEwMCVcIixcblx0XHRcdFx0XHRsZWZ0OiAwLFxuXHRcdFx0XHRcdHRvcDogMCxcblx0XHRcdFx0XHRvdmVyZmxvdzogXCJoaWRkZW5cIixcblx0XHRcdFx0XHRvcGFjaXR5OiAwXG5cdFx0XHRcdH0gKTtcblxuXHRcdFx0XHR2YXIgcGxheWVyQm94ID0galF1ZXJ5KCBcIjxkaXYvPlwiICkuYXR0ciggXCJpZFwiLCBwbGF5ZXJJRCApLmFkZENsYXNzKCBcInBsYXllckJveFwiICk7XG5cdFx0XHRcdHBsYXllckJveC5jc3MoIHtcblx0XHRcdFx0XHRwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuXHRcdFx0XHRcdHpJbmRleDogMCxcblx0XHRcdFx0XHR3aWR0aDogXCIxMDAlXCIsXG5cdFx0XHRcdFx0aGVpZ2h0OiBcIjEwMCVcIixcblx0XHRcdFx0XHR0b3A6IDAsXG5cdFx0XHRcdFx0bGVmdDogMCxcblx0XHRcdFx0XHRvdmVyZmxvdzogXCJoaWRkZW5cIlxuXHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0d3JhcHBlci5hcHBlbmQoIHBsYXllckJveCApO1xuXG5cdFx0XHRcdFlUUGxheWVyLm9wdC5jb250YWlubWVudC5jaGlsZHJlbigpLm5vdCggXCJzY3JpcHQsIHN0eWxlXCIgKS5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRpZiggalF1ZXJ5KCB0aGlzICkuY3NzKCBcInBvc2l0aW9uXCIgKSA9PSBcInN0YXRpY1wiICkgalF1ZXJ5KCB0aGlzICkuY3NzKCBcInBvc2l0aW9uXCIsIFwicmVsYXRpdmVcIiApO1xuXHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0aWYoIFlUUGxheWVyLmlzQmFja2dyb3VuZCApIHtcblx0XHRcdFx0XHRqUXVlcnkoIFwiYm9keVwiICkuY3NzKCB7XG5cdFx0XHRcdFx0XHRib3hTaXppbmc6IFwiYm9yZGVyLWJveFwiXG5cdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0d3JhcHBlci5jc3MoIHtcblx0XHRcdFx0XHRcdHBvc2l0aW9uOiBcImZpeGVkXCIsXG5cdFx0XHRcdFx0XHR0b3A6IDAsXG5cdFx0XHRcdFx0XHRsZWZ0OiAwLFxuXHRcdFx0XHRcdFx0ekluZGV4OiAwXG5cdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0JFlUUGxheWVyLmhpZGUoKTtcblxuXHRcdFx0XHR9IGVsc2UgaWYoIFlUUGxheWVyLm9wdC5jb250YWlubWVudC5jc3MoIFwicG9zaXRpb25cIiApID09IFwic3RhdGljXCIgKVxuXHRcdFx0XHRcdFlUUGxheWVyLm9wdC5jb250YWlubWVudC5jc3MoIHtcblx0XHRcdFx0XHRcdHBvc2l0aW9uOiBcInJlbGF0aXZlXCJcblx0XHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0WVRQbGF5ZXIub3B0LmNvbnRhaW5tZW50LnByZXBlbmQoIHdyYXBwZXIgKTtcblx0XHRcdFx0WVRQbGF5ZXIud3JhcHBlciA9IHdyYXBwZXI7XG5cblx0XHRcdFx0cGxheWVyQm94LmNzcygge1xuXHRcdFx0XHRcdG9wYWNpdHk6IDFcblx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdC8vaWYoICFqUXVlcnkubWJCcm93c2VyLm1vYmlsZSApIHtcblx0XHRcdFx0cGxheWVyQm94LmFmdGVyKCBvdmVybGF5ICk7XG5cdFx0XHRcdFlUUGxheWVyLm92ZXJsYXkgPSBvdmVybGF5O1xuXHRcdFx0XHQvL1x0fVxuXG5cdFx0XHRcdGlmKCBqUXVlcnkuaXNUYWJsZXQgKVxuXHRcdFx0XHRcdGpRdWVyeSggXCJib2R5XCIgKS5vbmUoIFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFlUUGxheWVyLnBsYXllci5wbGF5VmlkZW8oKTtcblx0XHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0aWYoICFZVFBsYXllci5pc0JhY2tncm91bmQgKSB7XG5cdFx0XHRcdFx0b3ZlcmxheS5vbiggXCJtb3VzZWVudGVyXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aWYoIFlUUGxheWVyLmNvbnRyb2xCYXIgJiYgWVRQbGF5ZXIuY29udHJvbEJhci5sZW5ndGggKVxuXHRcdFx0XHRcdFx0XHRZVFBsYXllci5jb250cm9sQmFyLmFkZENsYXNzKCBcInZpc2libGVcIiApO1xuXHRcdFx0XHRcdH0gKS5vbiggXCJtb3VzZWxlYXZlXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aWYoIFlUUGxheWVyLmNvbnRyb2xCYXIgJiYgWVRQbGF5ZXIuY29udHJvbEJhci5sZW5ndGggKVxuXHRcdFx0XHRcdFx0XHRZVFBsYXllci5jb250cm9sQmFyLnJlbW92ZUNsYXNzKCBcInZpc2libGVcIiApO1xuXHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmKCAheXRwLllUQVBJUmVhZHkgKSB7XG5cdFx0XHRcdFx0alF1ZXJ5KCBcIiNZVEFQSVwiICkucmVtb3ZlKCk7XG5cdFx0XHRcdFx0dmFyIHRhZyA9IGpRdWVyeSggXCI8c2NyaXB0Lz5cIiApLmF0dHIoIHtcblx0XHRcdFx0XHRcdFwiYXN5bmNcIjogXCJhc3luY1wiLFxuXHRcdFx0XHRcdFx0XCJzcmNcIjogalF1ZXJ5Lm1iWVRQbGF5ZXIubG9jYXRpb25Qcm90b2NvbCArIFwiLy93d3cueW91dHViZS5jb20vaWZyYW1lX2FwaT92PVwiICsgalF1ZXJ5Lm1iWVRQbGF5ZXIudmVyc2lvbixcblx0XHRcdFx0XHRcdFwiaWRcIjogXCJZVEFQSVwiXG5cdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdGpRdWVyeSggXCJoZWFkXCIgKS5wcmVwZW5kKCB0YWcgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGpRdWVyeSggZG9jdW1lbnQgKS50cmlnZ2VyKCBcIllUQVBJUmVhZHlcIiApO1xuXHRcdFx0XHRcdH0sIDEwMCApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29uc29sZS5kZWJ1ZyggalF1ZXJ5Lm1iQnJvd3Nlci5tb2JpbGUsIGpRdWVyeS5pc1RhYmxldCwgWVRQbGF5ZXIuY2FuUGxheU9uTW9iaWxlICk7XG5cdFx0XHRcdGlmKCBqUXVlcnkubWJCcm93c2VyLm1vYmlsZSAmJiAhalF1ZXJ5LmlzVGFibGV0ICYmICFZVFBsYXllci5jYW5QbGF5T25Nb2JpbGUgKSB7XG5cblx0XHRcdFx0XHRpZiggWVRQbGF5ZXIub3B0Lm1vYmlsZUZhbGxiYWNrSW1hZ2UgKSB7XG5cdFx0XHRcdFx0XHR3cmFwcGVyLmNzcygge1xuXHRcdFx0XHRcdFx0XHRiYWNrZ3JvdW5kSW1hZ2U6IFwidXJsKFwiICsgWVRQbGF5ZXIub3B0Lm1vYmlsZUZhbGxiYWNrSW1hZ2UgKyBcIilcIixcblx0XHRcdFx0XHRcdFx0YmFja2dyb3VuZFBvc2l0aW9uOiBcImNlbnRlciBjZW50ZXJcIixcblx0XHRcdFx0XHRcdFx0YmFja2dyb3VuZFNpemU6IFwiY292ZXJcIixcblx0XHRcdFx0XHRcdFx0YmFja2dyb3VuZFJlcGVhdDogXCJuby1yZXBlYXRcIixcblx0XHRcdFx0XHRcdFx0b3BhY2l0eTogMVxuXHRcdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmKCAhWVRQbGF5ZXIuaXNQbGF5ZXIgKVxuXHRcdFx0XHRcdFx0JFlUUGxheWVyLnJlbW92ZSgpO1xuXHRcdFx0XHRcdGpRdWVyeSggZG9jdW1lbnQgKS50cmlnZ2VyKCBcIllUUFVuYXZhaWxhYmxlXCIgKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRqUXVlcnkoIGRvY3VtZW50ICkub24oIFwiWVRBUElSZWFkeVwiLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRpZiggKCBZVFBsYXllci5pc0JhY2tncm91bmQgJiYgeXRwLmJhY2tncm91bmRJc0luaXRlZCApIHx8IFlUUGxheWVyLmlzSW5pdCApIHJldHVybjtcblx0XHRcdFx0XHRpZiggWVRQbGF5ZXIuaXNCYWNrZ3JvdW5kICkge1xuXHRcdFx0XHRcdFx0eXRwLmJhY2tncm91bmRJc0luaXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0WVRQbGF5ZXIub3B0LmF1dG9QbGF5ID0gdHlwZW9mIFlUUGxheWVyLm9wdC5hdXRvUGxheSA9PSBcInVuZGVmaW5lZFwiID8gKCBZVFBsYXllci5pc0JhY2tncm91bmQgPyB0cnVlIDogZmFsc2UgKSA6IFlUUGxheWVyLm9wdC5hdXRvUGxheTtcblx0XHRcdFx0XHRZVFBsYXllci5vcHQudm9sID0gWVRQbGF5ZXIub3B0LnZvbCA/IFlUUGxheWVyLm9wdC52b2wgOiAxMDA7XG5cdFx0XHRcdFx0alF1ZXJ5Lm1iWVRQbGF5ZXIuZ2V0RGF0YUZyb21BUEkoIFlUUGxheWVyICk7XG5cdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLm9uKCBcIllUUENoYW5nZWRcIiwgZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0XHRcdGlmKCBZVFBsYXllci5pc0luaXQgKVxuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cblx0XHRcdFx0XHRcdFlUUGxheWVyLmlzSW5pdCA9IHRydWU7XG5cblx0XHRcdFx0XHRcdC8vaWYgaXMgbW9iaWxlICYmIGlzUGxheWVyIGZhbGxiYWNrIHRvIHRoZSBkZWZhdWx0IFlUIHBsYXllclxuXHRcdFx0XHRcdFx0aWYoIGpRdWVyeS5tYkJyb3dzZXIubW9iaWxlICYmIFlUUGxheWVyLmNhblBsYXlPbk1vYmlsZSAmJiAhalF1ZXJ5LmlzVGFibGV0ICkge1xuXHRcdFx0XHRcdFx0XHQvLyBUcnkgdG8gYWRqdXN0IHRoZSBwbGF5ZXIgZGltZW50aW9uXG5cdFx0XHRcdFx0XHRcdGlmKCBZVFBsYXllci5vcHQuY29udGFpbm1lbnQub3V0ZXJXaWR0aCgpID4galF1ZXJ5KCB3aW5kb3cgKS53aWR0aCgpICkge1xuXHRcdFx0XHRcdFx0XHRcdFlUUGxheWVyLm9wdC5jb250YWlubWVudC5jc3MoIHtcblx0XHRcdFx0XHRcdFx0XHRcdG1heFdpZHRoOiBcIjEwMCVcIlxuXHRcdFx0XHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgaCA9IFlUUGxheWVyLm9wdC5jb250YWlubWVudC5vdXRlcldpZHRoKCkgKiAuNTYzO1xuXHRcdFx0XHRcdFx0XHRcdFlUUGxheWVyLm9wdC5jb250YWlubWVudC5jc3MoIHtcblx0XHRcdFx0XHRcdFx0XHRcdG1heEhlaWdodDogaFxuXHRcdFx0XHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRuZXcgWVQuUGxheWVyKCBwbGF5ZXJJRCwge1xuXHRcdFx0XHRcdFx0XHRcdHZpZGVvSWQ6IFlUUGxheWVyLnZpZGVvSUQudG9TdHJpbmcoKSxcblx0XHRcdFx0XHRcdFx0XHR3aWR0aDogJzEwMCUnLFxuXHRcdFx0XHRcdFx0XHRcdGhlaWdodDogaCxcblx0XHRcdFx0XHRcdFx0XHRwbGF5ZXJWYXJzOiBwbGF5ZXJWYXJzLFxuXHRcdFx0XHRcdFx0XHRcdGV2ZW50czoge1xuXHRcdFx0XHRcdFx0XHRcdFx0J29uUmVhZHknOiBmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFlUUGxheWVyLnBsYXllciA9IGV2ZW50LnRhcmdldDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0cGxheWVyQm94LmNzcygge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG9wYWNpdHk6IDFcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRZVFBsYXllci53cmFwcGVyLmNzcygge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdG9wYWNpdHk6IDFcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdG5ldyBZVC5QbGF5ZXIoIHBsYXllcklELCB7XG5cdFx0XHRcdFx0XHRcdHZpZGVvSWQ6IFlUUGxheWVyLnZpZGVvSUQudG9TdHJpbmcoKSxcblx0XHRcdFx0XHRcdFx0cGxheWVyVmFyczogcGxheWVyVmFycyxcblx0XHRcdFx0XHRcdFx0ZXZlbnRzOiB7XG5cdFx0XHRcdFx0XHRcdFx0J29uUmVhZHknOiBmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRZVFBsYXllci5wbGF5ZXIgPSBldmVudC50YXJnZXQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiggWVRQbGF5ZXIuaXNSZWFkeSApIHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHRcdFlUUGxheWVyLmlzUmVhZHkgPSBZVFBsYXllci5pc1BsYXllciAmJiAhWVRQbGF5ZXIub3B0LmF1dG9QbGF5ID8gZmFsc2UgOiB0cnVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0WVRQbGF5ZXIucGxheWVyRWwgPSBZVFBsYXllci5wbGF5ZXIuZ2V0SWZyYW1lKCk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIucGxheWVyRWwgKS51bnNlbGVjdGFibGUoKTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0JFlUUGxheWVyLm9wdGltaXplRGlzcGxheSgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0alF1ZXJ5KCB3aW5kb3cgKS5vZmYoIFwicmVzaXplLllUUF9cIiArIFlUUGxheWVyLmlkICkub24oIFwicmVzaXplLllUUF9cIiArIFlUUGxheWVyLmlkLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0JFlUUGxheWVyLm9wdGltaXplRGlzcGxheSgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiggWVRQbGF5ZXIub3B0LnJlbWVtYmVyX2xhc3RfdGltZSApIHtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRqUXVlcnkoIHdpbmRvdyApLm9uKCBcInVubG9hZC5ZVFBfXCIgKyBZVFBsYXllci5pZCwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGN1cnJlbnRfdGltZSA9IFlUUGxheWVyLnBsYXllci5nZXRDdXJyZW50VGltZSgpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0alF1ZXJ5Lm1iQ29va2llLnNldCggXCJZVFBsYXllcl9zdGFydF9mcm9tXCIgKyBZVFBsYXllci52aWRlb0lELCBjdXJyZW50X3RpbWUsIDAgKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdGpRdWVyeS5tYllUUGxheWVyLmNoZWNrRm9yU3RhdGUoIFlUUGxheWVyICk7XG5cdFx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0XHQvKipcblx0XHRcdFx0XHRcdFx0XHQgKlxuXHRcdFx0XHRcdFx0XHRcdCAqIEBwYXJhbSBldmVudFxuXHRcdFx0XHRcdFx0XHRcdCAqXG5cdFx0XHRcdFx0XHRcdFx0ICogLTEgKHVuc3RhcnRlZClcblx0XHRcdFx0XHRcdFx0XHQgKiAwIChlbmRlZClcblx0XHRcdFx0XHRcdFx0XHQgKiAxIChwbGF5aW5nKVxuXHRcdFx0XHRcdFx0XHRcdCAqIDIgKHBhdXNlZClcblx0XHRcdFx0XHRcdFx0XHQgKiAzIChidWZmZXJpbmcpXG5cdFx0XHRcdFx0XHRcdFx0ICogNSAodmlkZW8gY3VlZCkuXG5cdFx0XHRcdFx0XHRcdFx0ICpcblx0XHRcdFx0XHRcdFx0XHQgKlxuXHRcdFx0XHRcdFx0XHRcdCAqL1xuXHRcdFx0XHRcdFx0XHRcdCdvblN0YXRlQ2hhbmdlJzogZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYoIHR5cGVvZiBldmVudC50YXJnZXQuZ2V0UGxheWVyU3RhdGUgIT0gXCJmdW5jdGlvblwiICkgcmV0dXJuO1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIHN0YXRlID0gZXZlbnQudGFyZ2V0LmdldFBsYXllclN0YXRlKCk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmKCBZVFBsYXllci5wcmV2ZW50VHJpZ2dlciApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0WVRQbGF5ZXIucHJldmVudFRyaWdnZXIgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRZVFBsYXllci5zdGF0ZSA9IHN0YXRlO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgZXZlbnRUeXBlO1xuXHRcdFx0XHRcdFx0XHRcdFx0c3dpdGNoKCBzdGF0ZSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAtMTogLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSB1bnN0YXJ0ZWRcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRldmVudFR5cGUgPSBcIllUUFVuc3RhcnRlZFwiO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjYXNlIDA6IC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGVuZGVkXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZXZlbnRUeXBlID0gXCJZVFBSZWFsRW5kXCI7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgMTogLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gcGxheVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGV2ZW50VHlwZSA9IFwiWVRQUGxheVwiO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmKCBZVFBsYXllci5jb250cm9sQmFyLmxlbmd0aCApXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRZVFBsYXllci5jb250cm9sQmFyLmZpbmQoIFwiLm1iX1lUUFBsYXlwYXVzZVwiICkuaHRtbCggalF1ZXJ5Lm1iWVRQbGF5ZXIuY29udHJvbHMucGF1c2UgKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiggdHlwZW9mIF9nYXEgIT0gXCJ1bmRlZmluZWRcIiAmJiBldmFsKCBZVFBsYXllci5vcHQuZ2FUcmFjayApICkgX2dhcS5wdXNoKCBbICdfdHJhY2tFdmVudCcsICdZVFBsYXllcicsICdQbGF5JywgKCBZVFBsYXllci5oYXNEYXRhID8gWVRQbGF5ZXIudmlkZW9EYXRhLnRpdGxlIDogWVRQbGF5ZXIudmlkZW9JRC50b1N0cmluZygpICkgXSApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmKCB0eXBlb2YgZ2EgIT0gXCJ1bmRlZmluZWRcIiAmJiBldmFsKCBZVFBsYXllci5vcHQuZ2FUcmFjayApICkgZ2EoICdzZW5kJywgJ2V2ZW50JywgJ1lUUGxheWVyJywgJ3BsYXknLCAoIFlUUGxheWVyLmhhc0RhdGEgPyBZVFBsYXllci52aWRlb0RhdGEudGl0bGUgOiBZVFBsYXllci52aWRlb0lELnRvU3RyaW5nKCkgKSApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjYXNlIDI6IC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHBhdXNlXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZXZlbnRUeXBlID0gXCJZVFBQYXVzZVwiO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmKCBZVFBsYXllci5jb250cm9sQmFyLmxlbmd0aCApXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRZVFBsYXllci5jb250cm9sQmFyLmZpbmQoIFwiLm1iX1lUUFBsYXlwYXVzZVwiICkuaHRtbCggalF1ZXJ5Lm1iWVRQbGF5ZXIuY29udHJvbHMucGxheSApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjYXNlIDM6IC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGJ1ZmZlclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFlUUGxheWVyLnBsYXllci5zZXRQbGF5YmFja1F1YWxpdHkoIFlUUGxheWVyLm9wdC5xdWFsaXR5ICk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZXZlbnRUeXBlID0gXCJZVFBCdWZmZXJpbmdcIjtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiggWVRQbGF5ZXIuY29udHJvbEJhci5sZW5ndGggKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0WVRQbGF5ZXIuY29udHJvbEJhci5maW5kKCBcIi5tYl9ZVFBQbGF5cGF1c2VcIiApLmh0bWwoIGpRdWVyeS5tYllUUGxheWVyLmNvbnRyb2xzLnBsYXkgKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSA1OiAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBjdWVkXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZXZlbnRUeXBlID0gXCJZVFBDdWVkXCI7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdC8vIFRyaWdnZXIgc3RhdGUgZXZlbnRzXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgWVRQRXZlbnQgPSBqUXVlcnkuRXZlbnQoIGV2ZW50VHlwZSApO1xuXHRcdFx0XHRcdFx0XHRcdFx0WVRQRXZlbnQudGltZSA9IFlUUGxheWVyLmN1cnJlbnRUaW1lO1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYoIFlUUGxheWVyLmNhblRyaWdnZXIgKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkudHJpZ2dlciggWVRQRXZlbnQgKTtcblx0XHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRcdC8qKlxuXHRcdFx0XHRcdFx0XHRcdCAqXG5cdFx0XHRcdFx0XHRcdFx0ICogQHBhcmFtIGVcblx0XHRcdFx0XHRcdFx0XHQgKi9cblx0XHRcdFx0XHRcdFx0XHQnb25QbGF5YmFja1F1YWxpdHlDaGFuZ2UnOiBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBxdWFsaXR5ID0gZS50YXJnZXQuZ2V0UGxheWJhY2tRdWFsaXR5KCk7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgWVRQUXVhbGl0eUNoYW5nZSA9IGpRdWVyeS5FdmVudCggXCJZVFBRdWFsaXR5Q2hhbmdlXCIgKTtcblx0XHRcdFx0XHRcdFx0XHRcdFlUUFF1YWxpdHlDaGFuZ2UucXVhbGl0eSA9IHF1YWxpdHk7XG5cdFx0XHRcdFx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkudHJpZ2dlciggWVRQUXVhbGl0eUNoYW5nZSApO1xuXHRcdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdFx0LyoqXG5cdFx0XHRcdFx0XHRcdFx0ICpcblx0XHRcdFx0XHRcdFx0XHQgKiBAcGFyYW0gZXJyXG5cdFx0XHRcdFx0XHRcdFx0ICovXG5cdFx0XHRcdFx0XHRcdFx0J29uRXJyb3InOiBmdW5jdGlvbiggZXJyICkge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiggZXJyLmRhdGEgPT0gMTUwICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyggXCJFbWJlZGRpbmcgdGhpcyB2aWRlbyBpcyByZXN0cmljdGVkIGJ5IFlvdXR1YmUuXCIgKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYoIFlUUGxheWVyLmlzUGxheUxpc3QgKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5wbGF5TmV4dCgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiggZXJyLmRhdGEgPT0gMiAmJiBZVFBsYXllci5pc1BsYXlMaXN0ICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkucGxheU5leHQoKTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0aWYoIHR5cGVvZiBZVFBsYXllci5vcHQub25FcnJvciA9PSBcImZ1bmN0aW9uXCIgKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRZVFBsYXllci5vcHQub25FcnJvciggJFlUUGxheWVyLCBlcnIgKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdH0gKTtcblxuXHRcdFx0XHQkWVRQbGF5ZXIub2ZmKCBcIllUUFRpbWUubWFza1wiICk7XG5cblx0XHRcdFx0alF1ZXJ5Lm1iWVRQbGF5ZXIuYXBwbHlNYXNrKCBZVFBsYXllciApO1xuXG5cdFx0XHR9ICk7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIENoZWNrIGlmIHRoZSBZVFBsYXllciBpcyBvbiBzY3JlZW5cblx0XHQgKi9cblx0XHRpc09uU2NyZWVuOiBmdW5jdGlvbiggWVRQbGF5ZXIgKSB7XG5cblx0XHRcdHZhciBwbGF5ZXJCb3ggPSBZVFBsYXllci53cmFwcGVyO1xuXG5cdFx0XHR2YXIgd2luVG9wID0gJCggd2luZG93ICkuc2Nyb2xsVG9wKCk7XG5cdFx0XHR2YXIgd2luQm90dG9tID0gd2luVG9wICsgJCggd2luZG93ICkuaGVpZ2h0KCk7XG5cdFx0XHR2YXIgZWxUb3AgPSBwbGF5ZXJCb3gub2Zmc2V0KCkudG9wO1xuXHRcdFx0dmFyIGVsQm90dG9tID0gZWxUb3AgKyBwbGF5ZXJCb3guaGVpZ2h0KCk7XG5cdFx0XHRyZXR1cm4oICggZWxCb3R0b20gPD0gd2luQm90dG9tICkgJiYgKCBlbFRvcCA+PSB3aW5Ub3AgKSApO1xuXG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIFlUUGxheWVyXG5cdFx0ICovXG5cdFx0Z2V0RGF0YUZyb21BUEk6IGZ1bmN0aW9uKCBZVFBsYXllciApIHtcblx0XHRcdFlUUGxheWVyLnZpZGVvRGF0YSA9IGpRdWVyeS5tYlN0b3JhZ2UuZ2V0KCBcIllUUGxheWVyX2RhdGFfXCIgKyBZVFBsYXllci52aWRlb0lEICk7XG5cdFx0XHRqUXVlcnkoIFlUUGxheWVyICkub2ZmKCBcIllUUERhdGEuWVRQbGF5ZXJcIiApLm9uKCBcIllUUERhdGEuWVRQbGF5ZXJcIiwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmKCBZVFBsYXllci5oYXNEYXRhICkge1xuXG5cdFx0XHRcdFx0aWYoIFlUUGxheWVyLmlzUGxheWVyICYmICFZVFBsYXllci5vcHQuYXV0b1BsYXkgKSB7XG5cdFx0XHRcdFx0XHR2YXIgYmduZFVSTCA9IFlUUGxheWVyLnZpZGVvRGF0YS50aHVtYl9tYXggfHwgWVRQbGF5ZXIudmlkZW9EYXRhLnRodW1iX2hpZ2ggfHwgWVRQbGF5ZXIudmlkZW9EYXRhLnRodW1iX21lZGl1bTtcblxuXHRcdFx0XHRcdFx0WVRQbGF5ZXIub3B0LmNvbnRhaW5tZW50LmNzcygge1xuXHRcdFx0XHRcdFx0XHRiYWNrZ3JvdW5kOiBcInJnYmEoMCwwLDAsMC41KSB1cmwoXCIgKyBiZ25kVVJMICsgXCIpIGNlbnRlciBjZW50ZXJcIixcblx0XHRcdFx0XHRcdFx0YmFja2dyb3VuZFNpemU6IFwiY292ZXJcIlxuXHRcdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIub3B0LmJhY2tncm91bmRVcmwgPSBiZ25kVVJMO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSApO1xuXG5cdFx0XHRpZiggWVRQbGF5ZXIudmlkZW9EYXRhICkge1xuXG5cdFx0XHRcdHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFlUUGxheWVyLm9wdC5yYXRpbyA9IFlUUGxheWVyLm9wdC5yYXRpbyA9PSBcImF1dG9cIiA/IFwiMTYvOVwiIDogWVRQbGF5ZXIub3B0LnJhdGlvO1xuXHRcdFx0XHRcdFlUUGxheWVyLmRhdGFSZWNlaXZlZCA9IHRydWU7XG5cdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLnRyaWdnZXIoIFwiWVRQQ2hhbmdlZFwiICk7XG5cdFx0XHRcdFx0dmFyIFlUUERhdGEgPSBqUXVlcnkuRXZlbnQoIFwiWVRQRGF0YVwiICk7XG5cdFx0XHRcdFx0WVRQRGF0YS5wcm9wID0ge307XG5cdFx0XHRcdFx0Zm9yKCB2YXIgeCBpbiBZVFBsYXllci52aWRlb0RhdGEgKSBZVFBEYXRhLnByb3BbIHggXSA9IFlUUGxheWVyLnZpZGVvRGF0YVsgeCBdO1xuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBZVFBEYXRhICk7XG5cdFx0XHRcdH0sIFlUUGxheWVyLm9wdC5mYWRlT25TdGFydFRpbWUgKTtcblxuXHRcdFx0XHRZVFBsYXllci5oYXNEYXRhID0gdHJ1ZTtcblx0XHRcdH0gZWxzZSBpZiggalF1ZXJ5Lm1iWVRQbGF5ZXIuYXBpS2V5ICkge1xuXHRcdFx0XHQvLyBHZXQgdmlkZW8gaW5mbyBmcm9tIEFQSTMgKG5lZWRzIGFwaSBrZXkpXG5cdFx0XHRcdC8vIHNuaXBwZXQscGxheWVyLGNvbnRlbnREZXRhaWxzLHN0YXRpc3RpY3Msc3RhdHVzXG5cdFx0XHRcdGpRdWVyeS5nZXRKU09OKCBqUXVlcnkubWJZVFBsYXllci5sb2NhdGlvblByb3RvY29sICsgXCIvL3d3dy5nb29nbGVhcGlzLmNvbS95b3V0dWJlL3YzL3ZpZGVvcz9pZD1cIiArIFlUUGxheWVyLnZpZGVvSUQgKyBcIiZrZXk9XCIgKyBqUXVlcnkubWJZVFBsYXllci5hcGlLZXkgKyBcIiZwYXJ0PXNuaXBwZXRcIiwgZnVuY3Rpb24oIGRhdGEgKSB7XG5cdFx0XHRcdFx0WVRQbGF5ZXIuZGF0YVJlY2VpdmVkID0gdHJ1ZTtcblx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkudHJpZ2dlciggXCJZVFBDaGFuZ2VkXCIgKTtcblxuXHRcdFx0XHRcdGZ1bmN0aW9uIHBhcnNlWVRQbGF5ZXJfZGF0YSggZGF0YSApIHtcblx0XHRcdFx0XHRcdFlUUGxheWVyLnZpZGVvRGF0YSA9IHt9O1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIudmlkZW9EYXRhLmlkID0gWVRQbGF5ZXIudmlkZW9JRDtcblx0XHRcdFx0XHRcdFlUUGxheWVyLnZpZGVvRGF0YS5jaGFubmVsVGl0bGUgPSBkYXRhLmNoYW5uZWxUaXRsZTtcblx0XHRcdFx0XHRcdFlUUGxheWVyLnZpZGVvRGF0YS50aXRsZSA9IGRhdGEudGl0bGU7XG5cdFx0XHRcdFx0XHRZVFBsYXllci52aWRlb0RhdGEuZGVzY3JpcHRpb24gPSBkYXRhLmRlc2NyaXB0aW9uLmxlbmd0aCA8IDQwMCA/IGRhdGEuZGVzY3JpcHRpb24gOiBkYXRhLmRlc2NyaXB0aW9uLnN1YnN0cmluZyggMCwgNDAwICkgKyBcIiAuLi5cIjtcblx0XHRcdFx0XHRcdFlUUGxheWVyLnZpZGVvRGF0YS5hc3BlY3RyYXRpbyA9IFlUUGxheWVyLm9wdC5yYXRpbyA9PSBcImF1dG9cIiA/IFwiMTYvOVwiIDogWVRQbGF5ZXIub3B0LnJhdGlvO1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIub3B0LnJhdGlvID0gWVRQbGF5ZXIudmlkZW9EYXRhLmFzcGVjdHJhdGlvO1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIudmlkZW9EYXRhLnRodW1iX21heCA9IGRhdGEudGh1bWJuYWlscy5tYXhyZXMgPyBkYXRhLnRodW1ibmFpbHMubWF4cmVzLnVybCA6IG51bGw7XG5cdFx0XHRcdFx0XHRZVFBsYXllci52aWRlb0RhdGEudGh1bWJfaGlnaCA9IGRhdGEudGh1bWJuYWlscy5oaWdoID8gZGF0YS50aHVtYm5haWxzLmhpZ2gudXJsIDogbnVsbDtcblx0XHRcdFx0XHRcdFlUUGxheWVyLnZpZGVvRGF0YS50aHVtYl9tZWRpdW0gPSBkYXRhLnRodW1ibmFpbHMubWVkaXVtID8gZGF0YS50aHVtYm5haWxzLm1lZGl1bS51cmwgOiBudWxsO1xuXHRcdFx0XHRcdFx0alF1ZXJ5Lm1iU3RvcmFnZS5zZXQoIFwiWVRQbGF5ZXJfZGF0YV9cIiArIFlUUGxheWVyLnZpZGVvSUQsIFlUUGxheWVyLnZpZGVvRGF0YSApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHBhcnNlWVRQbGF5ZXJfZGF0YSggZGF0YS5pdGVtc1sgMCBdLnNuaXBwZXQgKTtcblx0XHRcdFx0XHRZVFBsYXllci5oYXNEYXRhID0gdHJ1ZTtcblx0XHRcdFx0XHR2YXIgWVRQRGF0YSA9IGpRdWVyeS5FdmVudCggXCJZVFBEYXRhXCIgKTtcblx0XHRcdFx0XHRZVFBEYXRhLnByb3AgPSB7fTtcblx0XHRcdFx0XHRmb3IoIHZhciB4IGluIFlUUGxheWVyLnZpZGVvRGF0YSApIFlUUERhdGEucHJvcFsgeCBdID0gWVRQbGF5ZXIudmlkZW9EYXRhWyB4IF07XG5cdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLnRyaWdnZXIoIFlUUERhdGEgKTtcblx0XHRcdFx0fSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLnRyaWdnZXIoIFwiWVRQQ2hhbmdlZFwiICk7XG5cdFx0XHRcdH0sIDUwICk7XG5cdFx0XHRcdGlmKCBZVFBsYXllci5pc1BsYXllciAmJiAhWVRQbGF5ZXIub3B0LmF1dG9QbGF5ICkge1xuXHRcdFx0XHRcdHZhciBiZ25kVVJMID0galF1ZXJ5Lm1iWVRQbGF5ZXIubG9jYXRpb25Qcm90b2NvbCArIFwiLy9pLnl0aW1nLmNvbS92aS9cIiArIFlUUGxheWVyLnZpZGVvSUQgKyBcIi9ocWRlZmF1bHQuanBnXCI7XG5cblx0XHRcdFx0XHRpZiggYmduZFVSTCApXG5cdFx0XHRcdFx0XHRZVFBsYXllci5vcHQuY29udGFpbm1lbnQuY3NzKCB7XG5cdFx0XHRcdFx0XHRcdGJhY2tncm91bmQ6IFwicmdiYSgwLDAsMCwwLjUpIHVybChcIiArIGJnbmRVUkwgKyBcIikgY2VudGVyIGNlbnRlclwiLFxuXHRcdFx0XHRcdFx0XHRiYWNrZ3JvdW5kU2l6ZTogXCJjb3ZlclwiXG5cdFx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0WVRQbGF5ZXIub3B0LmJhY2tncm91bmRVcmwgPSBiZ25kVVJMO1xuXG5cdFx0XHRcdH1cblx0XHRcdFx0WVRQbGF5ZXIudmlkZW9EYXRhID0gbnVsbDtcblx0XHRcdFx0WVRQbGF5ZXIub3B0LnJhdGlvID0gWVRQbGF5ZXIub3B0LnJhdGlvID09IFwiYXV0b1wiID8gXCIxNi85XCIgOiBZVFBsYXllci5vcHQucmF0aW87XG5cdFx0XHR9XG5cdFx0XHRpZiggWVRQbGF5ZXIuaXNQbGF5ZXIgJiYgIVlUUGxheWVyLm9wdC5hdXRvUGxheSAmJiAoICFqUXVlcnkubWJCcm93c2VyLm1vYmlsZSAmJiAhalF1ZXJ5LmlzVGFibGV0ICkgKSB7XG5cdFx0XHRcdFlUUGxheWVyLmxvYWRpbmcgPSBqUXVlcnkoIFwiPGRpdi8+XCIgKS5hZGRDbGFzcyggXCJsb2FkaW5nXCIgKS5odG1sKCBcIkxvYWRpbmdcIiApLmhpZGUoKTtcblx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLmFwcGVuZCggWVRQbGF5ZXIubG9hZGluZyApO1xuXHRcdFx0XHRZVFBsYXllci5sb2FkaW5nLmZhZGVJbigpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKi9cblx0XHRyZW1vdmVTdG9yZWREYXRhOiBmdW5jdGlvbigpIHtcblx0XHRcdGpRdWVyeS5tYlN0b3JhZ2UucmVtb3ZlKCk7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHsqfFlUUGxheWVyLnZpZGVvRGF0YX1cblx0XHQgKi9cblx0XHRnZXRWaWRlb0RhdGE6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcy5nZXQoIDAgKTtcblx0XHRcdHJldHVybiBZVFBsYXllci52aWRlb0RhdGE7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHsqfFlUUGxheWVyLnZpZGVvSUR8Ym9vbGVhbn1cblx0XHQgKi9cblx0XHRnZXRWaWRlb0lEOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRyZXR1cm4gWVRQbGF5ZXIudmlkZW9JRCB8fCBmYWxzZTtcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHF1YWxpdHlcblx0XHQgKi9cblx0XHRzZXRWaWRlb1F1YWxpdHk6IGZ1bmN0aW9uKCBxdWFsaXR5ICkge1xuXHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcy5nZXQoIDAgKTtcblx0XHRcdFlUUGxheWVyLnBsYXllci5zZXRQbGF5YmFja1F1YWxpdHkoIHF1YWxpdHkgKTtcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHZpZGVvc1xuXHRcdCAqIEBwYXJhbSBzaHVmZmxlXG5cdFx0ICogQHBhcmFtIGNhbGxiYWNrXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdHBsYXlsaXN0OiBmdW5jdGlvbiggdmlkZW9zLCBzaHVmZmxlLCBjYWxsYmFjayApIHtcblx0XHRcdHZhciAkWVRQbGF5ZXIgPSB0aGlzO1xuXHRcdFx0dmFyIFlUUGxheWVyID0gJFlUUGxheWVyLmdldCggMCApO1xuXHRcdFx0WVRQbGF5ZXIuaXNQbGF5TGlzdCA9IHRydWU7XG5cdFx0XHRpZiggc2h1ZmZsZSApIHZpZGVvcyA9IGpRdWVyeS5zaHVmZmxlKCB2aWRlb3MgKTtcblx0XHRcdGlmKCAhWVRQbGF5ZXIudmlkZW9JRCApIHtcblx0XHRcdFx0WVRQbGF5ZXIudmlkZW9zID0gdmlkZW9zO1xuXHRcdFx0XHRZVFBsYXllci52aWRlb0NvdW50ZXIgPSAwO1xuXHRcdFx0XHRZVFBsYXllci52aWRlb0xlbmd0aCA9IHZpZGVvcy5sZW5ndGg7XG5cdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5kYXRhKCBcInByb3BlcnR5XCIsIHZpZGVvc1sgMCBdICk7XG5cdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5tYl9ZVFBsYXllcigpO1xuXHRcdFx0fVxuXHRcdFx0aWYoIHR5cGVvZiBjYWxsYmFjayA9PSBcImZ1bmN0aW9uXCIgKSBqUXVlcnkoIFlUUGxheWVyICkub25lKCBcIllUUENoYW5nZWRcIiwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGNhbGxiYWNrKCBZVFBsYXllciApO1xuXHRcdFx0fSApO1xuXHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLm9uKCBcIllUUEVuZFwiLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLnBsYXlOZXh0KCk7XG5cdFx0XHR9ICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdHBsYXlOZXh0OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cblx0XHRcdGlmKCBZVFBsYXllci5jaGVja0ZvclN0YXJ0QXQgKSB7XG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwoIFlUUGxheWVyLmNoZWNrRm9yU3RhcnRBdCApO1xuXHRcdFx0XHRjbGVhckludGVydmFsKCBZVFBsYXllci5nZXRTdGF0ZSApO1xuXHRcdFx0fVxuXG5cdFx0XHRZVFBsYXllci52aWRlb0NvdW50ZXIrKztcblxuXHRcdFx0aWYoIFlUUGxheWVyLnZpZGVvQ291bnRlciA+PSBZVFBsYXllci52aWRlb0xlbmd0aCApXG5cdFx0XHRcdFlUUGxheWVyLnZpZGVvQ291bnRlciA9IDA7XG5cblx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBDaGFuZ2VNb3ZpZSggWVRQbGF5ZXIudmlkZW9zWyBZVFBsYXllci52aWRlb0NvdW50ZXIgXSApO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdHBsYXlQcmV2OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cblx0XHRcdGlmKCBZVFBsYXllci5jaGVja0ZvclN0YXJ0QXQgKSB7XG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwoIFlUUGxheWVyLmNoZWNrRm9yU3RhcnRBdCApO1xuXHRcdFx0XHRjbGVhckludGVydmFsKCBZVFBsYXllci5nZXRTdGF0ZSApO1xuXHRcdFx0fVxuXG5cdFx0XHRZVFBsYXllci52aWRlb0NvdW50ZXItLTtcblxuXHRcdFx0aWYoIFlUUGxheWVyLnZpZGVvQ291bnRlciA8IDAgKVxuXHRcdFx0XHRZVFBsYXllci52aWRlb0NvdW50ZXIgPSBZVFBsYXllci52aWRlb0xlbmd0aCAtIDE7XG5cblx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBDaGFuZ2VNb3ZpZSggWVRQbGF5ZXIudmlkZW9zWyBZVFBsYXllci52aWRlb0NvdW50ZXIgXSApO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdHBsYXlJbmRleDogZnVuY3Rpb24oIGlkeCApIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cblx0XHRcdGlkeCA9IGlkeCAtIDE7XG5cblx0XHRcdGlmKCBZVFBsYXllci5jaGVja0ZvclN0YXJ0QXQgKSB7XG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwoIFlUUGxheWVyLmNoZWNrRm9yU3RhcnRBdCApO1xuXHRcdFx0XHRjbGVhckludGVydmFsKCBZVFBsYXllci5nZXRTdGF0ZSApO1xuXHRcdFx0fVxuXG5cdFx0XHRZVFBsYXllci52aWRlb0NvdW50ZXIgPSBpZHg7XG5cdFx0XHRpZiggWVRQbGF5ZXIudmlkZW9Db3VudGVyID49IFlUUGxheWVyLnZpZGVvTGVuZ3RoIC0gMSApXG5cdFx0XHRcdFlUUGxheWVyLnZpZGVvQ291bnRlciA9IFlUUGxheWVyLnZpZGVvTGVuZ3RoIC0gMTtcblx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBDaGFuZ2VNb3ZpZSggWVRQbGF5ZXIudmlkZW9zWyBZVFBsYXllci52aWRlb0NvdW50ZXIgXSApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBvcHRcblx0XHQgKi9cblx0XHRjaGFuZ2VNb3ZpZTogZnVuY3Rpb24oIG9wdCApIHtcblxuXHRcdFx0dmFyICRZVFBsYXllciA9IHRoaXM7XG5cdFx0XHR2YXIgWVRQbGF5ZXIgPSAkWVRQbGF5ZXIuZ2V0KCAwICk7XG5cdFx0XHRZVFBsYXllci5vcHQuc3RhcnRBdCA9IDA7XG5cdFx0XHRZVFBsYXllci5vcHQuc3RvcEF0ID0gMDtcblx0XHRcdFlUUGxheWVyLm9wdC5tYXNrID0gZmFsc2U7XG5cdFx0XHRZVFBsYXllci5vcHQubXV0ZSA9IHRydWU7XG5cdFx0XHRZVFBsYXllci5oYXNEYXRhID0gZmFsc2U7XG5cdFx0XHRZVFBsYXllci5oYXNDaGFuZ2VkID0gdHJ1ZTtcblx0XHRcdFlUUGxheWVyLnBsYXllci5sb29wVGltZSA9IHVuZGVmaW5lZDtcblxuXHRcdFx0aWYoIG9wdCApXG5cdFx0XHRcdGpRdWVyeS5leHRlbmQoIFlUUGxheWVyLm9wdCwgb3B0ICk7IC8vWVRQbGF5ZXIuZGVmYXVsdE9wdCxcblx0XHRcdFlUUGxheWVyLnZpZGVvSUQgPSBnZXRZVFBWaWRlb0lEKCBZVFBsYXllci5vcHQudmlkZW9VUkwgKS52aWRlb0lEO1xuXG5cdFx0XHRpZiggWVRQbGF5ZXIub3B0Lmxvb3AgPT0gXCJ0cnVlXCIgKVxuXHRcdFx0XHRZVFBsYXllci5vcHQubG9vcCA9IDk5OTk7XG5cblx0XHRcdGpRdWVyeSggWVRQbGF5ZXIucGxheWVyRWwgKS5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdG9wYWNpdHk6IDBcblx0XHRcdH0sIFlUUGxheWVyLm9wdC5mYWRlT25TdGFydFRpbWUsIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdHZhciBZVFBDaGFuZ2VNb3ZpZSA9IGpRdWVyeS5FdmVudCggXCJZVFBDaGFuZ2VNb3ZpZVwiICk7XG5cdFx0XHRcdFlUUENoYW5nZU1vdmllLnRpbWUgPSBZVFBsYXllci5jdXJyZW50VGltZTtcblx0XHRcdFx0WVRQQ2hhbmdlTW92aWUudmlkZW9JZCA9IFlUUGxheWVyLnZpZGVvSUQ7XG5cdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBZVFBDaGFuZ2VNb3ZpZSApO1xuXG5cdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBHZXRQbGF5ZXIoKS5jdWVWaWRlb0J5VXJsKCBlbmNvZGVVUkkoIGpRdWVyeS5tYllUUGxheWVyLmxvY2F0aW9uUHJvdG9jb2wgKyBcIi8vd3d3LnlvdXR1YmUuY29tL3YvXCIgKyBZVFBsYXllci52aWRlb0lEICksIDEsIFlUUGxheWVyLm9wdC5xdWFsaXR5ICk7XG5cdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5vcHRpbWl6ZURpc3BsYXkoKTtcblxuXHRcdFx0XHRqUXVlcnkubWJZVFBsYXllci5jaGVja0ZvclN0YXRlKCBZVFBsYXllciApO1xuXHRcdFx0XHRqUXVlcnkubWJZVFBsYXllci5nZXREYXRhRnJvbUFQSSggWVRQbGF5ZXIgKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0XHRqUXVlcnkubWJZVFBsYXllci5hcHBseU1hc2soIFlUUGxheWVyICk7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHtwbGF5ZXJ9XG5cdFx0ICovXG5cdFx0Z2V0UGxheWVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiBqUXVlcnkoIHRoaXMgKS5nZXQoIDAgKS5wbGF5ZXI7XG5cdFx0fSxcblxuXHRcdHBsYXllckRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcy5nZXQoIDAgKTtcblx0XHRcdHl0cC5ZVEFQSVJlYWR5ID0gdHJ1ZTtcblx0XHRcdHl0cC5iYWNrZ3JvdW5kSXNJbml0ZWQgPSBmYWxzZTtcblx0XHRcdFlUUGxheWVyLmlzSW5pdCA9IGZhbHNlO1xuXHRcdFx0WVRQbGF5ZXIudmlkZW9JRCA9IG51bGw7XG5cdFx0XHRZVFBsYXllci5pc1JlYWR5ID0gZmFsc2U7XG5cdFx0XHR2YXIgcGxheWVyQm94ID0gWVRQbGF5ZXIud3JhcHBlcjtcblx0XHRcdHBsYXllckJveC5yZW1vdmUoKTtcblx0XHRcdGpRdWVyeSggXCIjY29udHJvbEJhcl9cIiArIFlUUGxheWVyLmlkICkucmVtb3ZlKCk7XG5cdFx0XHRjbGVhckludGVydmFsKCBZVFBsYXllci5jaGVja0ZvclN0YXJ0QXQgKTtcblx0XHRcdGNsZWFySW50ZXJ2YWwoIFlUUGxheWVyLmdldFN0YXRlICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gcmVhbFxuXHRcdCAqIEByZXR1cm5zIHtqUXVlcnkubWJZVFBsYXllcn1cblx0XHQgKi9cblx0XHRmdWxsc2NyZWVuOiBmdW5jdGlvbiggcmVhbCApIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRpZiggdHlwZW9mIHJlYWwgPT0gXCJ1bmRlZmluZWRcIiApIHJlYWwgPSBZVFBsYXllci5vcHQucmVhbGZ1bGxzY3JlZW47XG5cdFx0XHRyZWFsID0gZXZhbCggcmVhbCApO1xuXHRcdFx0dmFyIGNvbnRyb2xzID0galF1ZXJ5KCBcIiNjb250cm9sQmFyX1wiICsgWVRQbGF5ZXIuaWQgKTtcblx0XHRcdHZhciBmdWxsU2NyZWVuQnRuID0gY29udHJvbHMuZmluZCggXCIubWJfT25seVlUXCIgKTtcblx0XHRcdHZhciB2aWRlb1dyYXBwZXIgPSBZVFBsYXllci5pc1NlbGYgPyBZVFBsYXllci5vcHQuY29udGFpbm1lbnQgOiBZVFBsYXllci53cmFwcGVyO1xuXHRcdFx0Ly92YXIgdmlkZW9XcmFwcGVyID0gWVRQbGF5ZXIud3JhcHBlcjtcblx0XHRcdGlmKCByZWFsICkge1xuXHRcdFx0XHR2YXIgZnVsbHNjcmVlbmNoYW5nZSA9IGpRdWVyeS5tYkJyb3dzZXIubW96aWxsYSA/IFwibW96ZnVsbHNjcmVlbmNoYW5nZVwiIDogalF1ZXJ5Lm1iQnJvd3Nlci53ZWJraXQgPyBcIndlYmtpdGZ1bGxzY3JlZW5jaGFuZ2VcIiA6IFwiZnVsbHNjcmVlbmNoYW5nZVwiO1xuXHRcdFx0XHRqUXVlcnkoIGRvY3VtZW50ICkub2ZmKCBmdWxsc2NyZWVuY2hhbmdlICkub24oIGZ1bGxzY3JlZW5jaGFuZ2UsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBpc0Z1bGxTY3JlZW4gPSBSdW5QcmVmaXhNZXRob2QoIGRvY3VtZW50LCBcIklzRnVsbFNjcmVlblwiICkgfHwgUnVuUHJlZml4TWV0aG9kKCBkb2N1bWVudCwgXCJGdWxsU2NyZWVuXCIgKTtcblx0XHRcdFx0XHRpZiggIWlzRnVsbFNjcmVlbiApIHtcblx0XHRcdFx0XHRcdFlUUGxheWVyLmlzQWxvbmUgPSBmYWxzZTtcblx0XHRcdFx0XHRcdGZ1bGxTY3JlZW5CdG4uaHRtbCggalF1ZXJ5Lm1iWVRQbGF5ZXIuY29udHJvbHMub25seVlUICk7XG5cdFx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkuWVRQU2V0VmlkZW9RdWFsaXR5KCBZVFBsYXllci5vcHQucXVhbGl0eSApO1xuXHRcdFx0XHRcdFx0dmlkZW9XcmFwcGVyLnJlbW92ZUNsYXNzKCBcIllUUEZ1bGxzY3JlZW5cIiApO1xuXHRcdFx0XHRcdFx0dmlkZW9XcmFwcGVyLkNTU0FuaW1hdGUoIHtcblx0XHRcdFx0XHRcdFx0b3BhY2l0eTogWVRQbGF5ZXIub3B0Lm9wYWNpdHlcblx0XHRcdFx0XHRcdH0sIFlUUGxheWVyLm9wdC5mYWRlT25TdGFydFRpbWUgKTtcblx0XHRcdFx0XHRcdHZpZGVvV3JhcHBlci5jc3MoIHtcblx0XHRcdFx0XHRcdFx0ekluZGV4OiAwXG5cdFx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0XHRpZiggWVRQbGF5ZXIuaXNCYWNrZ3JvdW5kICkge1xuXHRcdFx0XHRcdFx0XHRqUXVlcnkoIFwiYm9keVwiICkuYWZ0ZXIoIGNvbnRyb2xzICk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRZVFBsYXllci53cmFwcGVyLmJlZm9yZSggY29udHJvbHMgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGpRdWVyeSggd2luZG93ICkucmVzaXplKCk7XG5cdFx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkudHJpZ2dlciggXCJZVFBGdWxsU2NyZWVuRW5kXCIgKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLllUUFNldFZpZGVvUXVhbGl0eSggXCJkZWZhdWx0XCIgKTtcblx0XHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBcIllUUEZ1bGxTY3JlZW5TdGFydFwiICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9ICk7XG5cdFx0XHR9XG5cdFx0XHRpZiggIVlUUGxheWVyLmlzQWxvbmUgKSB7XG5cdFx0XHRcdGZ1bmN0aW9uIGhpZGVNb3VzZSgpIHtcblx0XHRcdFx0XHRZVFBsYXllci5vdmVybGF5LmNzcygge1xuXHRcdFx0XHRcdFx0Y3Vyc29yOiBcIm5vbmVcIlxuXHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGpRdWVyeSggZG9jdW1lbnQgKS5vbiggXCJtb3VzZW1vdmUuWVRQbGF5ZXJcIiwgZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdFx0WVRQbGF5ZXIub3ZlcmxheS5jc3MoIHtcblx0XHRcdFx0XHRcdGN1cnNvcjogXCJhdXRvXCJcblx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KCBZVFBsYXllci5oaWRlQ3Vyc29yICk7XG5cdFx0XHRcdFx0aWYoICFqUXVlcnkoIGUudGFyZ2V0ICkucGFyZW50cygpLmlzKCBcIi5tYl9ZVFBCYXJcIiApICkgWVRQbGF5ZXIuaGlkZUN1cnNvciA9IHNldFRpbWVvdXQoIGhpZGVNb3VzZSwgMzAwMCApO1xuXHRcdFx0XHR9ICk7XG5cdFx0XHRcdGhpZGVNb3VzZSgpO1xuXHRcdFx0XHRpZiggcmVhbCApIHtcblx0XHRcdFx0XHR2aWRlb1dyYXBwZXIuY3NzKCB7XG5cdFx0XHRcdFx0XHRvcGFjaXR5OiAwXG5cdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdHZpZGVvV3JhcHBlci5hZGRDbGFzcyggXCJZVFBGdWxsc2NyZWVuXCIgKTtcblx0XHRcdFx0XHRsYXVuY2hGdWxsc2NyZWVuKCB2aWRlb1dyYXBwZXIuZ2V0KCAwICkgKTtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHZpZGVvV3JhcHBlci5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdFx0XHRcdG9wYWNpdHk6IDFcblx0XHRcdFx0XHRcdH0sIFlUUGxheWVyLm9wdC5mYWRlT25TdGFydFRpbWUgKiAyICk7XG5cdFx0XHRcdFx0XHRZVFBsYXllci53cmFwcGVyLmFwcGVuZCggY29udHJvbHMgKTtcblx0XHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5vcHRpbWl6ZURpc3BsYXkoKTtcblx0XHRcdFx0XHRcdFlUUGxheWVyLnBsYXllci5zZWVrVG8oIFlUUGxheWVyLnBsYXllci5nZXRDdXJyZW50VGltZSgpICsgLjEsIHRydWUgKTtcblx0XHRcdFx0XHR9LCBZVFBsYXllci5vcHQuZmFkZU9uU3RhcnRUaW1lICk7XG5cdFx0XHRcdH0gZWxzZSB2aWRlb1dyYXBwZXIuY3NzKCB7XG5cdFx0XHRcdFx0ekluZGV4OiAxMDAwMFxuXHRcdFx0XHR9ICkuQ1NTQW5pbWF0ZSgge1xuXHRcdFx0XHRcdG9wYWNpdHk6IDFcblx0XHRcdFx0fSwgWVRQbGF5ZXIub3B0LmZhZGVPblN0YXJ0VGltZSAqIDIgKTtcblx0XHRcdFx0ZnVsbFNjcmVlbkJ0bi5odG1sKCBqUXVlcnkubWJZVFBsYXllci5jb250cm9scy5zaG93U2l0ZSApO1xuXHRcdFx0XHRZVFBsYXllci5pc0Fsb25lID0gdHJ1ZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGpRdWVyeSggZG9jdW1lbnQgKS5vZmYoIFwibW91c2Vtb3ZlLllUUGxheWVyXCIgKTtcblx0XHRcdFx0Y2xlYXJUaW1lb3V0KCBZVFBsYXllci5oaWRlQ3Vyc29yICk7XG5cdFx0XHRcdFlUUGxheWVyLm92ZXJsYXkuY3NzKCB7XG5cdFx0XHRcdFx0Y3Vyc29yOiBcImF1dG9cIlxuXHRcdFx0XHR9ICk7XG5cdFx0XHRcdGlmKCByZWFsICkge1xuXHRcdFx0XHRcdGNhbmNlbEZ1bGxzY3JlZW4oKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR2aWRlb1dyYXBwZXIuQ1NTQW5pbWF0ZSgge1xuXHRcdFx0XHRcdFx0b3BhY2l0eTogWVRQbGF5ZXIub3B0Lm9wYWNpdHlcblx0XHRcdFx0XHR9LCBZVFBsYXllci5vcHQuZmFkZU9uU3RhcnRUaW1lICk7XG5cdFx0XHRcdFx0dmlkZW9XcmFwcGVyLmNzcygge1xuXHRcdFx0XHRcdFx0ekluZGV4OiAwXG5cdFx0XHRcdFx0fSApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGZ1bGxTY3JlZW5CdG4uaHRtbCggalF1ZXJ5Lm1iWVRQbGF5ZXIuY29udHJvbHMub25seVlUICk7XG5cdFx0XHRcdFlUUGxheWVyLmlzQWxvbmUgPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gUnVuUHJlZml4TWV0aG9kKCBvYmosIG1ldGhvZCApIHtcblx0XHRcdFx0dmFyIHBmeCA9IFsgXCJ3ZWJraXRcIiwgXCJtb3pcIiwgXCJtc1wiLCBcIm9cIiwgXCJcIiBdO1xuXHRcdFx0XHR2YXIgcCA9IDAsXG5cdFx0XHRcdFx0bSwgdDtcblx0XHRcdFx0d2hpbGUoIHAgPCBwZngubGVuZ3RoICYmICFvYmpbIG0gXSApIHtcblx0XHRcdFx0XHRtID0gbWV0aG9kO1xuXHRcdFx0XHRcdGlmKCBwZnhbIHAgXSA9PSBcIlwiICkge1xuXHRcdFx0XHRcdFx0bSA9IG0uc3Vic3RyKCAwLCAxICkudG9Mb3dlckNhc2UoKSArIG0uc3Vic3RyKCAxICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdG0gPSBwZnhbIHAgXSArIG07XG5cdFx0XHRcdFx0dCA9IHR5cGVvZiBvYmpbIG0gXTtcblx0XHRcdFx0XHRpZiggdCAhPSBcInVuZGVmaW5lZFwiICkge1xuXHRcdFx0XHRcdFx0cGZ4ID0gWyBwZnhbIHAgXSBdO1xuXHRcdFx0XHRcdFx0cmV0dXJuKCB0ID09IFwiZnVuY3Rpb25cIiA/IG9ialsgbSBdKCkgOiBvYmpbIG0gXSApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRwKys7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gbGF1bmNoRnVsbHNjcmVlbiggZWxlbWVudCApIHtcblx0XHRcdFx0UnVuUHJlZml4TWV0aG9kKCBlbGVtZW50LCBcIlJlcXVlc3RGdWxsU2NyZWVuXCIgKTtcblx0XHRcdH1cblxuXHRcdFx0ZnVuY3Rpb24gY2FuY2VsRnVsbHNjcmVlbigpIHtcblx0XHRcdFx0aWYoIFJ1blByZWZpeE1ldGhvZCggZG9jdW1lbnQsIFwiRnVsbFNjcmVlblwiICkgfHwgUnVuUHJlZml4TWV0aG9kKCBkb2N1bWVudCwgXCJJc0Z1bGxTY3JlZW5cIiApICkge1xuXHRcdFx0XHRcdFJ1blByZWZpeE1ldGhvZCggZG9jdW1lbnQsIFwiQ2FuY2VsRnVsbFNjcmVlblwiICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHtqUXVlcnkubWJZVFBsYXllcn1cblx0XHQgKi9cblx0XHR0b2dnbGVMb29wczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzLmdldCggMCApO1xuXHRcdFx0dmFyIGRhdGEgPSBZVFBsYXllci5vcHQ7XG5cdFx0XHRpZiggZGF0YS5sb29wID09IDEgKSB7XG5cdFx0XHRcdGRhdGEubG9vcCA9IDA7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiggZGF0YS5zdGFydEF0ICkge1xuXHRcdFx0XHRcdFlUUGxheWVyLnBsYXllci5zZWVrVG8oIGRhdGEuc3RhcnRBdCApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFlUUGxheWVyLnBsYXllci5wbGF5VmlkZW8oKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRkYXRhLmxvb3AgPSAxO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHtqUXVlcnkubWJZVFBsYXllcn1cblx0XHQgKi9cblx0XHRwbGF5OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRpZiggIVlUUGxheWVyLmlzUmVhZHkgKVxuXHRcdFx0XHRyZXR1cm4gdGhpcztcblxuXHRcdFx0WVRQbGF5ZXIucGxheWVyLnBsYXlWaWRlbygpO1xuXHRcdFx0WVRQbGF5ZXIud3JhcHBlci5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdG9wYWNpdHk6IFlUUGxheWVyLmlzQWxvbmUgPyAxIDogWVRQbGF5ZXIub3B0Lm9wYWNpdHlcblx0XHRcdH0sIFlUUGxheWVyLm9wdC5mYWRlT25TdGFydFRpbWUgKiA0ICk7XG5cblx0XHRcdGpRdWVyeSggWVRQbGF5ZXIucGxheWVyRWwgKS5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdG9wYWNpdHk6IDFcblx0XHRcdH0sIFlUUGxheWVyLm9wdC5mYWRlT25TdGFydFRpbWUgKiAyICk7XG5cblx0XHRcdHZhciBjb250cm9scyA9IGpRdWVyeSggXCIjY29udHJvbEJhcl9cIiArIFlUUGxheWVyLmlkICk7XG5cdFx0XHR2YXIgcGxheUJ0biA9IGNvbnRyb2xzLmZpbmQoIFwiLm1iX1lUUFBsYXlwYXVzZVwiICk7XG5cdFx0XHRwbGF5QnRuLmh0bWwoIGpRdWVyeS5tYllUUGxheWVyLmNvbnRyb2xzLnBhdXNlICk7XG5cdFx0XHRZVFBsYXllci5zdGF0ZSA9IDE7XG5cdFx0XHRZVFBsYXllci5vcmlnX2JhY2tncm91bmQgPSBqUXVlcnkoIFlUUGxheWVyICkuY3NzKCBcImJhY2tncm91bmQtaW1hZ2VcIiApO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGNhbGxiYWNrXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdHRvZ2dsZVBsYXk6IGZ1bmN0aW9uKCBjYWxsYmFjayApIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRpZiggWVRQbGF5ZXIuc3RhdGUgPT0gMSApXG5cdFx0XHRcdHRoaXMuWVRQUGF1c2UoKTtcblx0XHRcdGVsc2Vcblx0XHRcdFx0dGhpcy5ZVFBQbGF5KCk7XG5cblx0XHRcdGlmKCB0eXBlb2YgY2FsbGJhY2sgPT0gXCJmdW5jdGlvblwiIClcblx0XHRcdFx0Y2FsbGJhY2soIFlUUGxheWVyLnN0YXRlICk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJucyB7alF1ZXJ5Lm1iWVRQbGF5ZXJ9XG5cdFx0ICovXG5cdFx0c3RvcDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzLmdldCggMCApO1xuXHRcdFx0dmFyIGNvbnRyb2xzID0galF1ZXJ5KCBcIiNjb250cm9sQmFyX1wiICsgWVRQbGF5ZXIuaWQgKTtcblx0XHRcdHZhciBwbGF5QnRuID0gY29udHJvbHMuZmluZCggXCIubWJfWVRQUGxheXBhdXNlXCIgKTtcblx0XHRcdHBsYXlCdG4uaHRtbCggalF1ZXJ5Lm1iWVRQbGF5ZXIuY29udHJvbHMucGxheSApO1xuXHRcdFx0WVRQbGF5ZXIucGxheWVyLnN0b3BWaWRlbygpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHtqUXVlcnkubWJZVFBsYXllcn1cblx0XHQgKi9cblx0XHRwYXVzZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzLmdldCggMCApO1xuXHRcdFx0WVRQbGF5ZXIucGxheWVyLnBhdXNlVmlkZW8oKTtcblx0XHRcdFlUUGxheWVyLnN0YXRlID0gMjtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gdmFsXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdHNlZWtUbzogZnVuY3Rpb24oIHZhbCApIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRZVFBsYXllci5wbGF5ZXIuc2Vla1RvKCB2YWwsIHRydWUgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gdmFsXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdHNldFZvbHVtZTogZnVuY3Rpb24oIHZhbCApIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRpZiggIXZhbCAmJiAhWVRQbGF5ZXIub3B0LnZvbCAmJiBZVFBsYXllci5wbGF5ZXIuZ2V0Vm9sdW1lKCkgPT0gMCApIGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBVbm11dGUoKTtcblx0XHRcdGVsc2UgaWYoICggIXZhbCAmJiBZVFBsYXllci5wbGF5ZXIuZ2V0Vm9sdW1lKCkgPiAwICkgfHwgKCB2YWwgJiYgWVRQbGF5ZXIub3B0LnZvbCA9PSB2YWwgKSApIHtcblx0XHRcdFx0aWYoICFZVFBsYXllci5pc011dGUgKSBqUXVlcnkoIFlUUGxheWVyICkuWVRQTXV0ZSgpO1xuXHRcdFx0XHRlbHNlIGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBVbm11dGUoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFlUUGxheWVyLm9wdC52b2wgPSB2YWw7XG5cdFx0XHRcdFlUUGxheWVyLnBsYXllci5zZXRWb2x1bWUoIFlUUGxheWVyLm9wdC52b2wgKTtcblx0XHRcdFx0aWYoIFlUUGxheWVyLnZvbHVtZUJhciAmJiBZVFBsYXllci52b2x1bWVCYXIubGVuZ3RoICkgWVRQbGF5ZXIudm9sdW1lQmFyLnVwZGF0ZVNsaWRlclZhbCggdmFsICk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHJldHVybnMge2Jvb2xlYW59XG5cdFx0ICovXG5cdFx0dG9nZ2xlVm9sdW1lOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRpZiggIVlUUGxheWVyICkgcmV0dXJuO1xuXHRcdFx0aWYoIFlUUGxheWVyLnBsYXllci5pc011dGVkKCkgKSB7XG5cdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBVbm11dGUoKTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkuWVRQTXV0ZSgpO1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHtqUXVlcnkubWJZVFBsYXllcn1cblx0XHQgKi9cblx0XHRtdXRlOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRpZiggWVRQbGF5ZXIuaXNNdXRlICkgcmV0dXJuO1xuXHRcdFx0WVRQbGF5ZXIucGxheWVyLm11dGUoKTtcblx0XHRcdFlUUGxheWVyLmlzTXV0ZSA9IHRydWU7XG5cdFx0XHRZVFBsYXllci5wbGF5ZXIuc2V0Vm9sdW1lKCAwICk7XG5cdFx0XHRpZiggWVRQbGF5ZXIudm9sdW1lQmFyICYmIFlUUGxheWVyLnZvbHVtZUJhci5sZW5ndGggJiYgWVRQbGF5ZXIudm9sdW1lQmFyLndpZHRoKCkgPiAxMCApIHtcblx0XHRcdFx0WVRQbGF5ZXIudm9sdW1lQmFyLnVwZGF0ZVNsaWRlclZhbCggMCApO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGNvbnRyb2xzID0galF1ZXJ5KCBcIiNjb250cm9sQmFyX1wiICsgWVRQbGF5ZXIuaWQgKTtcblx0XHRcdHZhciBtdXRlQnRuID0gY29udHJvbHMuZmluZCggXCIubWJfWVRQTXV0ZVVubXV0ZVwiICk7XG5cdFx0XHRtdXRlQnRuLmh0bWwoIGpRdWVyeS5tYllUUGxheWVyLmNvbnRyb2xzLnVubXV0ZSApO1xuXHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLmFkZENsYXNzKCBcImlzTXV0ZWRcIiApO1xuXHRcdFx0aWYoIFlUUGxheWVyLnZvbHVtZUJhciAmJiBZVFBsYXllci52b2x1bWVCYXIubGVuZ3RoICkgWVRQbGF5ZXIudm9sdW1lQmFyLmFkZENsYXNzKCBcIm11dGVkXCIgKTtcblx0XHRcdHZhciBZVFBFdmVudCA9IGpRdWVyeS5FdmVudCggXCJZVFBNdXRlZFwiICk7XG5cdFx0XHRZVFBFdmVudC50aW1lID0gWVRQbGF5ZXIuY3VycmVudFRpbWU7XG5cdFx0XHRpZiggWVRQbGF5ZXIuY2FuVHJpZ2dlciApIGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBZVFBFdmVudCApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHtqUXVlcnkubWJZVFBsYXllcn1cblx0XHQgKi9cblx0XHR1bm11dGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcy5nZXQoIDAgKTtcblx0XHRcdGlmKCAhWVRQbGF5ZXIuaXNNdXRlICkgcmV0dXJuO1xuXHRcdFx0WVRQbGF5ZXIucGxheWVyLnVuTXV0ZSgpO1xuXHRcdFx0WVRQbGF5ZXIuaXNNdXRlID0gZmFsc2U7XG5cdFx0XHRZVFBsYXllci5wbGF5ZXIuc2V0Vm9sdW1lKCBZVFBsYXllci5vcHQudm9sICk7XG5cdFx0XHRpZiggWVRQbGF5ZXIudm9sdW1lQmFyICYmIFlUUGxheWVyLnZvbHVtZUJhci5sZW5ndGggKSBZVFBsYXllci52b2x1bWVCYXIudXBkYXRlU2xpZGVyVmFsKCBZVFBsYXllci5vcHQudm9sID4gMTAgPyBZVFBsYXllci5vcHQudm9sIDogMTAgKTtcblx0XHRcdHZhciBjb250cm9scyA9IGpRdWVyeSggXCIjY29udHJvbEJhcl9cIiArIFlUUGxheWVyLmlkICk7XG5cdFx0XHR2YXIgbXV0ZUJ0biA9IGNvbnRyb2xzLmZpbmQoIFwiLm1iX1lUUE11dGVVbm11dGVcIiApO1xuXHRcdFx0bXV0ZUJ0bi5odG1sKCBqUXVlcnkubWJZVFBsYXllci5jb250cm9scy5tdXRlICk7XG5cdFx0XHRqUXVlcnkoIFlUUGxheWVyICkucmVtb3ZlQ2xhc3MoIFwiaXNNdXRlZFwiICk7XG5cdFx0XHRpZiggWVRQbGF5ZXIudm9sdW1lQmFyICYmIFlUUGxheWVyLnZvbHVtZUJhci5sZW5ndGggKSBZVFBsYXllci52b2x1bWVCYXIucmVtb3ZlQ2xhc3MoIFwibXV0ZWRcIiApO1xuXHRcdFx0dmFyIFlUUEV2ZW50ID0galF1ZXJ5LkV2ZW50KCBcIllUUFVubXV0ZWRcIiApO1xuXHRcdFx0WVRQRXZlbnQudGltZSA9IFlUUGxheWVyLmN1cnJlbnRUaW1lO1xuXHRcdFx0aWYoIFlUUGxheWVyLmNhblRyaWdnZXIgKSBqUXVlcnkoIFlUUGxheWVyICkudHJpZ2dlciggWVRQRXZlbnQgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICogRklMVEVSU1xuXHRcdCAqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZmlsdGVyXG5cdFx0ICogQHBhcmFtIHZhbHVlXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdGFwcGx5RmlsdGVyOiBmdW5jdGlvbiggZmlsdGVyLCB2YWx1ZSApIHtcblx0XHRcdHJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzO1xuXHRcdFx0XHRZVFBsYXllci5maWx0ZXJzWyBmaWx0ZXIgXS52YWx1ZSA9IHZhbHVlO1xuXHRcdFx0XHRpZiggWVRQbGF5ZXIuZmlsdGVyc0VuYWJsZWQgKVxuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBFbmFibGVGaWx0ZXJzKCk7XG5cdFx0XHR9ICk7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBmaWx0ZXJzXG5cdFx0ICogQHJldHVybnMge2pRdWVyeS5tYllUUGxheWVyfVxuXHRcdCAqL1xuXHRcdGFwcGx5RmlsdGVyczogZnVuY3Rpb24oIGZpbHRlcnMgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcztcblx0XHRcdFx0aWYoICFZVFBsYXllci5pc1JlYWR5ICkge1xuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5vbiggXCJZVFBSZWFkeVwiLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBBcHBseUZpbHRlcnMoIGZpbHRlcnMgKTtcblx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Zm9yKCB2YXIga2V5IGluIGZpbHRlcnMgKVxuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBBcHBseUZpbHRlcigga2V5LCBmaWx0ZXJzWyBrZXkgXSApO1xuXG5cdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBcIllUUEZpbHRlcnNBcHBsaWVkXCIgKTtcblx0XHRcdH0gKTtcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGZpbHRlclxuXHRcdCAqIEBwYXJhbSB2YWx1ZVxuXHRcdCAqIEByZXR1cm5zIHsqfVxuXHRcdCAqL1xuXHRcdHRvZ2dsZUZpbHRlcjogZnVuY3Rpb24oIGZpbHRlciwgdmFsdWUgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcztcblx0XHRcdFx0aWYoICFZVFBsYXllci5maWx0ZXJzWyBmaWx0ZXIgXS52YWx1ZSApIFlUUGxheWVyLmZpbHRlcnNbIGZpbHRlciBdLnZhbHVlID0gdmFsdWU7XG5cdFx0XHRcdGVsc2UgWVRQbGF5ZXIuZmlsdGVyc1sgZmlsdGVyIF0udmFsdWUgPSAwO1xuXHRcdFx0XHRpZiggWVRQbGF5ZXIuZmlsdGVyc0VuYWJsZWQgKSBqUXVlcnkoIHRoaXMgKS5ZVFBFbmFibGVGaWx0ZXJzKCk7XG5cdFx0XHR9ICk7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBjYWxsYmFja1xuXHRcdCAqIEByZXR1cm5zIHsqfVxuXHRcdCAqL1xuXHRcdHRvZ2dsZUZpbHRlcnM6IGZ1bmN0aW9uKCBjYWxsYmFjayApIHtcblx0XHRcdHJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzO1xuXHRcdFx0XHRpZiggWVRQbGF5ZXIuZmlsdGVyc0VuYWJsZWQgKSB7XG5cdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLnRyaWdnZXIoIFwiWVRQRGlzYWJsZUZpbHRlcnNcIiApO1xuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBEaXNhYmxlRmlsdGVycygpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBFbmFibGVGaWx0ZXJzKCk7XG5cdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLnRyaWdnZXIoIFwiWVRQRW5hYmxlRmlsdGVyc1wiICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYoIHR5cGVvZiBjYWxsYmFjayA9PSBcImZ1bmN0aW9uXCIgKVxuXHRcdFx0XHRcdGNhbGxiYWNrKCBZVFBsYXllci5maWx0ZXJzRW5hYmxlZCApO1xuXHRcdFx0fSApO1xuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJucyB7Kn1cblx0XHQgKi9cblx0XHRkaXNhYmxlRmlsdGVyczogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcztcblx0XHRcdFx0dmFyIGlmcmFtZSA9IGpRdWVyeSggWVRQbGF5ZXIucGxheWVyRWwgKTtcblx0XHRcdFx0aWZyYW1lLmNzcyggXCItd2Via2l0LWZpbHRlclwiLCBcIlwiICk7XG5cdFx0XHRcdGlmcmFtZS5jc3MoIFwiZmlsdGVyXCIsIFwiXCIgKTtcblx0XHRcdFx0WVRQbGF5ZXIuZmlsdGVyc0VuYWJsZWQgPSBmYWxzZTtcblx0XHRcdH0gKTtcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHJldHVybnMgeyp9XG5cdFx0ICovXG5cdFx0ZW5hYmxlRmlsdGVyczogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcztcblx0XHRcdFx0dmFyIGlmcmFtZSA9IGpRdWVyeSggWVRQbGF5ZXIucGxheWVyRWwgKTtcblx0XHRcdFx0dmFyIGZpbHRlclN0eWxlID0gXCJcIjtcblx0XHRcdFx0Zm9yKCB2YXIga2V5IGluIFlUUGxheWVyLmZpbHRlcnMgKSB7XG5cdFx0XHRcdFx0aWYoIFlUUGxheWVyLmZpbHRlcnNbIGtleSBdLnZhbHVlIClcblx0XHRcdFx0XHRcdGZpbHRlclN0eWxlICs9IGtleS5yZXBsYWNlKCBcIl9cIiwgXCItXCIgKSArIFwiKFwiICsgWVRQbGF5ZXIuZmlsdGVyc1sga2V5IF0udmFsdWUgKyBZVFBsYXllci5maWx0ZXJzWyBrZXkgXS51bml0ICsgXCIpIFwiO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmcmFtZS5jc3MoIFwiLXdlYmtpdC1maWx0ZXJcIiwgZmlsdGVyU3R5bGUgKTtcblx0XHRcdFx0aWZyYW1lLmNzcyggXCJmaWx0ZXJcIiwgZmlsdGVyU3R5bGUgKTtcblx0XHRcdFx0WVRQbGF5ZXIuZmlsdGVyc0VuYWJsZWQgPSB0cnVlO1xuXHRcdFx0fSApO1xuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZmlsdGVyXG5cdFx0ICogQHBhcmFtIGNhbGxiYWNrXG5cdFx0ICogQHJldHVybnMgeyp9XG5cdFx0ICovXG5cdFx0cmVtb3ZlRmlsdGVyOiBmdW5jdGlvbiggZmlsdGVyLCBjYWxsYmFjayApIHtcblx0XHRcdHJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzO1xuXHRcdFx0XHRpZiggdHlwZW9mIGZpbHRlciA9PSBcImZ1bmN0aW9uXCIgKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2sgPSBmaWx0ZXI7XG5cdFx0XHRcdFx0ZmlsdGVyID0gbnVsbDtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiggIWZpbHRlciApXG5cdFx0XHRcdFx0Zm9yKCB2YXIga2V5IGluIFlUUGxheWVyLmZpbHRlcnMgKSB7XG5cdFx0XHRcdFx0XHRqUXVlcnkoIHRoaXMgKS5ZVFBBcHBseUZpbHRlcigga2V5LCAwICk7XG5cdFx0XHRcdFx0XHRpZiggdHlwZW9mIGNhbGxiYWNrID09IFwiZnVuY3Rpb25cIiApIGNhbGxiYWNrKCBrZXkgKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0alF1ZXJ5KCB0aGlzICkuWVRQQXBwbHlGaWx0ZXIoIGZpbHRlciwgMCApO1xuXHRcdFx0XHRcdFx0aWYoIHR5cGVvZiBjYWxsYmFjayA9PSBcImZ1bmN0aW9uXCIgKSBjYWxsYmFjayggZmlsdGVyICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0fSApO1xuXG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHsqfVxuXHRcdCAqL1xuXHRcdGdldEZpbHRlcnM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcy5nZXQoIDAgKTtcblx0XHRcdHJldHVybiBZVFBsYXllci5maWx0ZXJzO1xuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICogTUFTS1xuXHRcdCAqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gbWFza1xuXHRcdCAqIEByZXR1cm5zIHtqUXVlcnkubWJZVFBsYXllcn1cblx0XHQgKi9cblx0XHRhZGRNYXNrOiBmdW5jdGlvbiggbWFzayApIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHR2YXIgb3ZlcmxheSA9IFlUUGxheWVyLm92ZXJsYXk7XG5cblx0XHRcdGlmKCAhbWFzayApIHtcblx0XHRcdFx0bWFzayA9IFlUUGxheWVyLmFjdHVhbE1hc2s7XG5cdFx0XHR9XG5cblx0XHRcdHZhciB0ZW1wSW1nID0galF1ZXJ5KCBcIjxpbWcvPlwiICkuYXR0ciggXCJzcmNcIiwgbWFzayApLm9uKCBcImxvYWRcIiwgZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0b3ZlcmxheS5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdFx0b3BhY2l0eTogMFxuXHRcdFx0XHR9LCBZVFBsYXllci5vcHQuZmFkZU9uU3RhcnRUaW1lLCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHRcdFlUUGxheWVyLmhhc01hc2sgPSB0cnVlO1xuXG5cdFx0XHRcdFx0dGVtcEltZy5yZW1vdmUoKTtcblxuXHRcdFx0XHRcdG92ZXJsYXkuY3NzKCB7XG5cdFx0XHRcdFx0XHRiYWNrZ3JvdW5kSW1hZ2U6IFwidXJsKFwiICsgbWFzayArIFwiKVwiLFxuXHRcdFx0XHRcdFx0YmFja2dyb3VuZFJlcGVhdDogXCJuby1yZXBlYXRcIixcblx0XHRcdFx0XHRcdGJhY2tncm91bmRQb3NpdGlvbjogXCJjZW50ZXIgY2VudGVyXCIsXG5cdFx0XHRcdFx0XHRiYWNrZ3JvdW5kU2l6ZTogXCJjb3ZlclwiXG5cdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0b3ZlcmxheS5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdFx0XHRvcGFjaXR5OiAxXG5cdFx0XHRcdFx0fSwgWVRQbGF5ZXIub3B0LmZhZGVPblN0YXJ0VGltZSApO1xuXG5cdFx0XHRcdH0gKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblxuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJucyB7alF1ZXJ5Lm1iWVRQbGF5ZXJ9XG5cdFx0ICovXG5cdFx0cmVtb3ZlTWFzazogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzLmdldCggMCApO1xuXHRcdFx0dmFyIG92ZXJsYXkgPSBZVFBsYXllci5vdmVybGF5O1xuXHRcdFx0b3ZlcmxheS5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdG9wYWNpdHk6IDBcblx0XHRcdH0sIFlUUGxheWVyLm9wdC5mYWRlT25TdGFydFRpbWUsIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdFlUUGxheWVyLmhhc01hc2sgPSBmYWxzZTtcblxuXHRcdFx0XHRvdmVybGF5LmNzcygge1xuXHRcdFx0XHRcdGJhY2tncm91bmRJbWFnZTogXCJcIixcblx0XHRcdFx0XHRiYWNrZ3JvdW5kUmVwZWF0OiBcIlwiLFxuXHRcdFx0XHRcdGJhY2tncm91bmRQb3NpdGlvbjogXCJcIixcblx0XHRcdFx0XHRiYWNrZ3JvdW5kU2l6ZTogXCJcIlxuXHRcdFx0XHR9ICk7XG5cdFx0XHRcdG92ZXJsYXkuQ1NTQW5pbWF0ZSgge1xuXHRcdFx0XHRcdG9wYWNpdHk6IDFcblx0XHRcdFx0fSwgWVRQbGF5ZXIub3B0LmZhZGVPblN0YXJ0VGltZSApO1xuXG5cdFx0XHR9ICk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBZVFBsYXllclxuXHRcdCAqL1xuXHRcdGFwcGx5TWFzazogZnVuY3Rpb24oIFlUUGxheWVyICkge1xuXHRcdFx0dmFyICRZVFBsYXllciA9IGpRdWVyeSggWVRQbGF5ZXIgKTtcblx0XHRcdCRZVFBsYXllci5vZmYoIFwiWVRQVGltZS5tYXNrXCIgKTtcblxuXHRcdFx0aWYoIFlUUGxheWVyLm9wdC5tYXNrICkge1xuXG5cdFx0XHRcdGlmKCB0eXBlb2YgWVRQbGF5ZXIub3B0Lm1hc2sgPT0gXCJzdHJpbmdcIiApIHtcblx0XHRcdFx0XHQkWVRQbGF5ZXIuWVRQQWRkTWFzayggWVRQbGF5ZXIub3B0Lm1hc2sgKTtcblxuXHRcdFx0XHRcdFlUUGxheWVyLmFjdHVhbE1hc2sgPSBZVFBsYXllci5vcHQubWFzaztcblxuXHRcdFx0XHR9IGVsc2UgaWYoIHR5cGVvZiBZVFBsYXllci5vcHQubWFzayA9PSBcIm9iamVjdFwiICkge1xuXG5cdFx0XHRcdFx0Zm9yKCB2YXIgdGltZSBpbiBZVFBsYXllci5vcHQubWFzayApIHtcblx0XHRcdFx0XHRcdGlmKCBZVFBsYXllci5vcHQubWFza1sgdGltZSBdIClcblx0XHRcdFx0XHRcdFx0dmFyIGltZyA9IGpRdWVyeSggXCI8aW1nLz5cIiApLmF0dHIoIFwic3JjXCIsIFlUUGxheWVyLm9wdC5tYXNrWyB0aW1lIF0gKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiggWVRQbGF5ZXIub3B0Lm1hc2tbIDAgXSApXG5cdFx0XHRcdFx0XHQkWVRQbGF5ZXIuWVRQQWRkTWFzayggWVRQbGF5ZXIub3B0Lm1hc2tbIDAgXSApO1xuXG5cdFx0XHRcdFx0JFlUUGxheWVyLm9uKCBcIllUUFRpbWUubWFza1wiLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0XHRcdGZvciggdmFyIHRpbWUgaW4gWVRQbGF5ZXIub3B0Lm1hc2sgKSB7XG5cdFx0XHRcdFx0XHRcdGlmKCBlLnRpbWUgPT0gdGltZSApXG5cdFx0XHRcdFx0XHRcdFx0aWYoICFZVFBsYXllci5vcHQubWFza1sgdGltZSBdICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0JFlUUGxheWVyLllUUFJlbW92ZU1hc2soKTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQkWVRQbGF5ZXIuWVRQQWRkTWFzayggWVRQbGF5ZXIub3B0Lm1hc2tbIHRpbWUgXSApO1xuXHRcdFx0XHRcdFx0XHRcdFx0WVRQbGF5ZXIuYWN0dWFsTWFzayA9IFlUUGxheWVyLm9wdC5tYXNrWyB0aW1lIF07XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdH1cblxuXG5cdFx0XHR9XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqL1xuXHRcdHRvZ2dsZU1hc2s6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcy5nZXQoIDAgKTtcblx0XHRcdHZhciAkWVRQbGF5ZXIgPSAkKCBZVFBsYXllciApO1xuXHRcdFx0aWYoIFlUUGxheWVyLmhhc01hc2sgKVxuXHRcdFx0XHQkWVRQbGF5ZXIuWVRQUmVtb3ZlTWFzaygpO1xuXHRcdFx0ZWxzZVxuXHRcdFx0XHQkWVRQbGF5ZXIuWVRQQWRkTWFzaygpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHJldHVybnMge3t0b3RhbFRpbWU6IG51bWJlciwgY3VycmVudFRpbWU6IG51bWJlcn19XG5cdFx0ICovXG5cdFx0bWFuYWdlUHJvZ3Jlc3M6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIFlUUGxheWVyID0gdGhpcy5nZXQoIDAgKTtcblx0XHRcdHZhciBjb250cm9scyA9IGpRdWVyeSggXCIjY29udHJvbEJhcl9cIiArIFlUUGxheWVyLmlkICk7XG5cdFx0XHR2YXIgcHJvZ3Jlc3NCYXIgPSBjb250cm9scy5maW5kKCBcIi5tYl9ZVFBQcm9ncmVzc1wiICk7XG5cdFx0XHR2YXIgbG9hZGVkQmFyID0gY29udHJvbHMuZmluZCggXCIubWJfWVRQTG9hZGVkXCIgKTtcblx0XHRcdHZhciB0aW1lQmFyID0gY29udHJvbHMuZmluZCggXCIubWJfWVRQc2Vla2JhclwiICk7XG5cdFx0XHR2YXIgdG90VyA9IHByb2dyZXNzQmFyLm91dGVyV2lkdGgoKTtcblx0XHRcdHZhciBjdXJyZW50VGltZSA9IE1hdGguZmxvb3IoIFlUUGxheWVyLnBsYXllci5nZXRDdXJyZW50VGltZSgpICk7XG5cdFx0XHR2YXIgdG90YWxUaW1lID0gTWF0aC5mbG9vciggWVRQbGF5ZXIucGxheWVyLmdldER1cmF0aW9uKCkgKTtcblx0XHRcdHZhciB0aW1lVyA9ICggY3VycmVudFRpbWUgKiB0b3RXICkgLyB0b3RhbFRpbWU7XG5cdFx0XHR2YXIgc3RhcnRMZWZ0ID0gMDtcblx0XHRcdHZhciBsb2FkZWRXID0gWVRQbGF5ZXIucGxheWVyLmdldFZpZGVvTG9hZGVkRnJhY3Rpb24oKSAqIDEwMDtcblx0XHRcdGxvYWRlZEJhci5jc3MoIHtcblx0XHRcdFx0bGVmdDogc3RhcnRMZWZ0LFxuXHRcdFx0XHR3aWR0aDogbG9hZGVkVyArIFwiJVwiXG5cdFx0XHR9ICk7XG5cdFx0XHR0aW1lQmFyLmNzcygge1xuXHRcdFx0XHRsZWZ0OiAwLFxuXHRcdFx0XHR3aWR0aDogdGltZVdcblx0XHRcdH0gKTtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHRvdGFsVGltZTogdG90YWxUaW1lLFxuXHRcdFx0XHRjdXJyZW50VGltZTogY3VycmVudFRpbWVcblx0XHRcdH07XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBZVFBsYXllclxuXHRcdCAqL1xuXHRcdGJ1aWxkQ29udHJvbHM6IGZ1bmN0aW9uKCBZVFBsYXllciApIHtcblx0XHRcdHZhciBkYXRhID0gWVRQbGF5ZXIub3B0O1xuXHRcdFx0Ly8gQGRhdGEucHJpbnRVcmw6IGlzIGRlcHJlY2F0ZWQ7IHVzZSBkYXRhLnNob3dZVExvZ29cblx0XHRcdGRhdGEuc2hvd1lUTG9nbyA9IGRhdGEuc2hvd1lUTG9nbyB8fCBkYXRhLnByaW50VXJsO1xuXG5cdFx0XHRpZiggalF1ZXJ5KCBcIiNjb250cm9sQmFyX1wiICsgWVRQbGF5ZXIuaWQgKS5sZW5ndGggKVxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHRZVFBsYXllci5jb250cm9sQmFyID0galF1ZXJ5KCBcIjxzcGFuLz5cIiApLmF0dHIoIFwiaWRcIiwgXCJjb250cm9sQmFyX1wiICsgWVRQbGF5ZXIuaWQgKS5hZGRDbGFzcyggXCJtYl9ZVFBCYXJcIiApLmNzcygge1xuXHRcdFx0XHR3aGl0ZVNwYWNlOiBcIm5vV3JhcFwiLFxuXHRcdFx0XHRwb3NpdGlvbjogWVRQbGF5ZXIuaXNCYWNrZ3JvdW5kID8gXCJmaXhlZFwiIDogXCJhYnNvbHV0ZVwiLFxuXHRcdFx0XHR6SW5kZXg6IFlUUGxheWVyLmlzQmFja2dyb3VuZCA/IDEwMDAwIDogMTAwMFxuXHRcdFx0fSApLmhpZGUoKTtcblx0XHRcdHZhciBidXR0b25CYXIgPSBqUXVlcnkoIFwiPGRpdi8+XCIgKS5hZGRDbGFzcyggXCJidXR0b25CYXJcIiApO1xuXHRcdFx0LyogcGxheS9wYXVzZSBidXR0b24qL1xuXHRcdFx0dmFyIHBsYXlwYXVzZSA9IGpRdWVyeSggXCI8c3Bhbj5cIiArIGpRdWVyeS5tYllUUGxheWVyLmNvbnRyb2xzLnBsYXkgKyBcIjwvc3Bhbj5cIiApLmFkZENsYXNzKCBcIm1iX1lUUFBsYXlwYXVzZSB5dHBpY29uXCIgKS5jbGljayggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmKCBZVFBsYXllci5wbGF5ZXIuZ2V0UGxheWVyU3RhdGUoKSA9PSAxICkgalF1ZXJ5KCBZVFBsYXllciApLllUUFBhdXNlKCk7XG5cdFx0XHRcdGVsc2UgalF1ZXJ5KCBZVFBsYXllciApLllUUFBsYXkoKTtcblx0XHRcdH0gKTtcblx0XHRcdC8qIG11dGUvdW5tdXRlIGJ1dHRvbiovXG5cdFx0XHR2YXIgTXV0ZVVubXV0ZSA9IGpRdWVyeSggXCI8c3Bhbj5cIiArIGpRdWVyeS5tYllUUGxheWVyLmNvbnRyb2xzLm11dGUgKyBcIjwvc3Bhbj5cIiApLmFkZENsYXNzKCBcIm1iX1lUUE11dGVVbm11dGUgeXRwaWNvblwiICkuY2xpY2soIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiggWVRQbGF5ZXIucGxheWVyLmdldFZvbHVtZSgpID09IDAgKSB7XG5cdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLllUUFVubXV0ZSgpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBNdXRlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gKTtcblx0XHRcdC8qIHZvbHVtZSBiYXIqL1xuXHRcdFx0dmFyIHZvbHVtZUJhciA9IGpRdWVyeSggXCI8ZGl2Lz5cIiApLmFkZENsYXNzKCBcIm1iX1lUUFZvbHVtZUJhclwiICkuY3NzKCB7XG5cdFx0XHRcdGRpc3BsYXk6IFwiaW5saW5lLWJsb2NrXCJcblx0XHRcdH0gKTtcblx0XHRcdFlUUGxheWVyLnZvbHVtZUJhciA9IHZvbHVtZUJhcjtcblx0XHRcdC8qIHRpbWUgZWxhcHNlZCAqL1xuXHRcdFx0dmFyIGlkeCA9IGpRdWVyeSggXCI8c3Bhbi8+XCIgKS5hZGRDbGFzcyggXCJtYl9ZVFBUaW1lXCIgKTtcblx0XHRcdHZhciB2VVJMID0gZGF0YS52aWRlb1VSTCA/IGRhdGEudmlkZW9VUkwgOiBcIlwiO1xuXHRcdFx0aWYoIHZVUkwuaW5kZXhPZiggXCJodHRwXCIgKSA8IDAgKSB2VVJMID0galF1ZXJ5Lm1iWVRQbGF5ZXIubG9jYXRpb25Qcm90b2NvbCArIFwiLy93d3cueW91dHViZS5jb20vd2F0Y2g/dj1cIiArIGRhdGEudmlkZW9VUkw7XG5cdFx0XHR2YXIgbW92aWVVcmwgPSBqUXVlcnkoIFwiPHNwYW4vPlwiICkuaHRtbCggalF1ZXJ5Lm1iWVRQbGF5ZXIuY29udHJvbHMueXRMb2dvICkuYWRkQ2xhc3MoIFwibWJfWVRQVXJsIHl0cGljb25cIiApLmF0dHIoIFwidGl0bGVcIiwgXCJ2aWV3IG9uIFlvdVR1YmVcIiApLm9uKCBcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR3aW5kb3cub3BlbiggdlVSTCwgXCJ2aWV3T25ZVFwiICk7XG5cdFx0XHR9ICk7XG5cdFx0XHR2YXIgb25seVZpZGVvID0galF1ZXJ5KCBcIjxzcGFuLz5cIiApLmh0bWwoIGpRdWVyeS5tYllUUGxheWVyLmNvbnRyb2xzLm9ubHlZVCApLmFkZENsYXNzKCBcIm1iX09ubHlZVCB5dHBpY29uXCIgKS5vbiggXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLllUUEZ1bGxzY3JlZW4oIGRhdGEucmVhbGZ1bGxzY3JlZW4gKTtcblx0XHRcdH0gKTtcblx0XHRcdHZhciBwcm9ncmVzc0JhciA9IGpRdWVyeSggXCI8ZGl2Lz5cIiApLmFkZENsYXNzKCBcIm1iX1lUUFByb2dyZXNzXCIgKS5jc3MoIFwicG9zaXRpb25cIiwgXCJhYnNvbHV0ZVwiICkuY2xpY2soIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHR0aW1lQmFyLmNzcygge1xuXHRcdFx0XHRcdHdpZHRoOiAoIGUuY2xpZW50WCAtIHRpbWVCYXIub2Zmc2V0KCkubGVmdCApXG5cdFx0XHRcdH0gKTtcblx0XHRcdFx0WVRQbGF5ZXIudGltZVcgPSBlLmNsaWVudFggLSB0aW1lQmFyLm9mZnNldCgpLmxlZnQ7XG5cdFx0XHRcdFlUUGxheWVyLmNvbnRyb2xCYXIuZmluZCggXCIubWJfWVRQTG9hZGVkXCIgKS5jc3MoIHtcblx0XHRcdFx0XHR3aWR0aDogMFxuXHRcdFx0XHR9ICk7XG5cdFx0XHRcdHZhciB0b3RhbFRpbWUgPSBNYXRoLmZsb29yKCBZVFBsYXllci5wbGF5ZXIuZ2V0RHVyYXRpb24oKSApO1xuICAgICAgICAgICAgICAgIHZhciBnb3RvID0gKCB0aW1lQmFyLm91dGVyV2lkdGgoKSAqIHRvdGFsVGltZSApIC8gcHJvZ3Jlc3NCYXIub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgICAgIFlUUGxheWVyLnBsYXllci5zZWVrVG8oIHBhcnNlRmxvYXQoIGdvdG8gKSwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgIFlUUGxheWVyLmNvbnRyb2xCYXIuZmluZCggXCIubWJfWVRQTG9hZGVkXCIgKS5jc3MoIHtcblx0XHRcdFx0XHR3aWR0aDogMFxuXHRcdFx0XHR9ICk7XG5cdFx0XHR9ICk7XG5cdFx0XHR2YXIgbG9hZGVkQmFyID0galF1ZXJ5KCBcIjxkaXYvPlwiICkuYWRkQ2xhc3MoIFwibWJfWVRQTG9hZGVkXCIgKS5jc3MoIFwicG9zaXRpb25cIiwgXCJhYnNvbHV0ZVwiICk7XG5cdFx0XHR2YXIgdGltZUJhciA9IGpRdWVyeSggXCI8ZGl2Lz5cIiApLmFkZENsYXNzKCBcIm1iX1lUUHNlZWtiYXJcIiApLmNzcyggXCJwb3NpdGlvblwiLCBcImFic29sdXRlXCIgKTtcblx0XHRcdHByb2dyZXNzQmFyLmFwcGVuZCggbG9hZGVkQmFyICkuYXBwZW5kKCB0aW1lQmFyICk7XG5cdFx0XHRidXR0b25CYXIuYXBwZW5kKCBwbGF5cGF1c2UgKS5hcHBlbmQoIE11dGVVbm11dGUgKS5hcHBlbmQoIHZvbHVtZUJhciApLmFwcGVuZCggaWR4ICk7XG5cdFx0XHRpZiggZGF0YS5zaG93WVRMb2dvICkge1xuXHRcdFx0XHRidXR0b25CYXIuYXBwZW5kKCBtb3ZpZVVybCApO1xuXHRcdFx0fVxuXHRcdFx0aWYoIFlUUGxheWVyLmlzQmFja2dyb3VuZCB8fCAoIGV2YWwoIFlUUGxheWVyLm9wdC5yZWFsZnVsbHNjcmVlbiApICYmICFZVFBsYXllci5pc0JhY2tncm91bmQgKSApIGJ1dHRvbkJhci5hcHBlbmQoIG9ubHlWaWRlbyApO1xuXHRcdFx0WVRQbGF5ZXIuY29udHJvbEJhci5hcHBlbmQoIGJ1dHRvbkJhciApLmFwcGVuZCggcHJvZ3Jlc3NCYXIgKTtcblx0XHRcdGlmKCAhWVRQbGF5ZXIuaXNCYWNrZ3JvdW5kICkge1xuXHRcdFx0XHRZVFBsYXllci5jb250cm9sQmFyLmFkZENsYXNzKCBcImlubGluZVBsYXllclwiICk7XG5cdFx0XHRcdFlUUGxheWVyLndyYXBwZXIuYmVmb3JlKCBZVFBsYXllci5jb250cm9sQmFyICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRqUXVlcnkoIFwiYm9keVwiICkuYWZ0ZXIoIFlUUGxheWVyLmNvbnRyb2xCYXIgKTtcblx0XHRcdH1cblx0XHRcdHZvbHVtZUJhci5zaW1wbGVTbGlkZXIoIHtcblx0XHRcdFx0aW5pdGlhbHZhbDogWVRQbGF5ZXIub3B0LnZvbCxcblx0XHRcdFx0c2NhbGU6IDEwMCxcblx0XHRcdFx0b3JpZW50YXRpb246IFwiaFwiLFxuXHRcdFx0XHRjYWxsYmFjazogZnVuY3Rpb24oIGVsICkge1xuXHRcdFx0XHRcdGlmKCBlbC52YWx1ZSA9PSAwICkge1xuXHRcdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLllUUE11dGUoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLllUUFVubXV0ZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRZVFBsYXllci5wbGF5ZXIuc2V0Vm9sdW1lKCBlbC52YWx1ZSApO1xuXHRcdFx0XHRcdGlmKCAhWVRQbGF5ZXIuaXNNdXRlICkgWVRQbGF5ZXIub3B0LnZvbCA9IGVsLnZhbHVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9ICk7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBZVFBsYXllclxuXHRcdCAqL1xuXHRcdGNoZWNrRm9yU3RhdGU6IGZ1bmN0aW9uKCBZVFBsYXllciApIHtcblx0XHRcdHZhciBpbnRlcnZhbCA9IFlUUGxheWVyLm9wdC5zaG93Q29udHJvbHMgPyAxMDAgOiA0MDA7XG5cdFx0XHRjbGVhckludGVydmFsKCBZVFBsYXllci5nZXRTdGF0ZSApO1xuXHRcdFx0Ly9DaGVja2luZyBpZiBwbGF5ZXIgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHNjZW5lXG5cdFx0XHRpZiggIWpRdWVyeS5jb250YWlucyggZG9jdW1lbnQsIFlUUGxheWVyICkgKSB7XG5cdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBQbGF5ZXJEZXN0cm95KCk7XG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwoIFlUUGxheWVyLmdldFN0YXRlICk7XG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwoIFlUUGxheWVyLmNoZWNrRm9yU3RhcnRBdCApO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGpRdWVyeS5tYllUUGxheWVyLmNoZWNrRm9yU3RhcnQoIFlUUGxheWVyICk7XG5cblx0XHRcdFlUUGxheWVyLmdldFN0YXRlID0gc2V0SW50ZXJ2YWwoIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdHZhciBwcm9nID0galF1ZXJ5KCBZVFBsYXllciApLllUUE1hbmFnZVByb2dyZXNzKCk7XG5cdFx0XHRcdHZhciAkWVRQbGF5ZXIgPSBqUXVlcnkoIFlUUGxheWVyICk7XG5cdFx0XHRcdHZhciBkYXRhID0gWVRQbGF5ZXIub3B0O1xuXG5cdFx0XHRcdHZhciBzdGFydEF0ID0gWVRQbGF5ZXIuc3RhcnRfZnJvbV9sYXN0ID8gWVRQbGF5ZXIuc3RhcnRfZnJvbV9sYXN0IDogWVRQbGF5ZXIub3B0LnN0YXJ0QXQgPyBZVFBsYXllci5vcHQuc3RhcnRBdCA6IDE7XG5cblx0XHRcdFx0WVRQbGF5ZXIuc3RhcnRfZnJvbV9sYXN0ID0gbnVsbDtcblxuXHRcdFx0XHR2YXIgc3RvcEF0ID0gWVRQbGF5ZXIub3B0LnN0b3BBdCA+IFlUUGxheWVyLm9wdC5zdGFydEF0ID8gWVRQbGF5ZXIub3B0LnN0b3BBdCA6IDA7XG5cdFx0XHRcdHN0b3BBdCA9IHN0b3BBdCA8IFlUUGxheWVyLnBsYXllci5nZXREdXJhdGlvbigpID8gc3RvcEF0IDogMDtcblx0XHRcdFx0aWYoIFlUUGxheWVyLmN1cnJlbnRUaW1lICE9IHByb2cuY3VycmVudFRpbWUgKSB7XG5cblx0XHRcdFx0XHR2YXIgWVRQRXZlbnQgPSBqUXVlcnkuRXZlbnQoIFwiWVRQVGltZVwiICk7XG5cdFx0XHRcdFx0WVRQRXZlbnQudGltZSA9IFlUUGxheWVyLmN1cnJlbnRUaW1lO1xuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBZVFBFdmVudCApO1xuXG5cdFx0XHRcdH1cblx0XHRcdFx0WVRQbGF5ZXIuY3VycmVudFRpbWUgPSBwcm9nLmN1cnJlbnRUaW1lO1xuXHRcdFx0XHRZVFBsYXllci50b3RhbFRpbWUgPSBZVFBsYXllci5wbGF5ZXIuZ2V0RHVyYXRpb24oKTtcblx0XHRcdFx0aWYoIFlUUGxheWVyLnBsYXllci5nZXRWb2x1bWUoKSA9PSAwICkgJFlUUGxheWVyLmFkZENsYXNzKCBcImlzTXV0ZWRcIiApO1xuXHRcdFx0XHRlbHNlICRZVFBsYXllci5yZW1vdmVDbGFzcyggXCJpc011dGVkXCIgKTtcblxuXHRcdFx0XHRpZiggWVRQbGF5ZXIub3B0LnNob3dDb250cm9scyApXG5cdFx0XHRcdFx0aWYoIHByb2cudG90YWxUaW1lICkge1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIuY29udHJvbEJhci5maW5kKCBcIi5tYl9ZVFBUaW1lXCIgKS5odG1sKCBqUXVlcnkubWJZVFBsYXllci5mb3JtYXRUaW1lKCBwcm9nLmN1cnJlbnRUaW1lICkgKyBcIiAvIFwiICsgalF1ZXJ5Lm1iWVRQbGF5ZXIuZm9ybWF0VGltZSggcHJvZy50b3RhbFRpbWUgKSApO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRZVFBsYXllci5jb250cm9sQmFyLmZpbmQoIFwiLm1iX1lUUFRpbWVcIiApLmh0bWwoIFwiLS0gOiAtLSAvIC0tIDogLS1cIiApO1xuXHRcdFx0XHRcdH1cblxuXG5cdFx0XHRcdGlmKCBldmFsKCBZVFBsYXllci5vcHQuc3RvcE1vdmllT25CbHVyICkgKSB7XG5cdFx0XHRcdFx0aWYoICFkb2N1bWVudC5oYXNGb2N1cygpICkge1xuXHRcdFx0XHRcdFx0aWYoIFlUUGxheWVyLnN0YXRlID09IDEgKSB7XG5cdFx0XHRcdFx0XHRcdFlUUGxheWVyLmhhc0ZvY3VzID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdCRZVFBsYXllci5ZVFBQYXVzZSgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSBpZiggZG9jdW1lbnQuaGFzRm9jdXMoKSAmJiAhWVRQbGF5ZXIuaGFzRm9jdXMgJiYgISggWVRQbGF5ZXIuc3RhdGUgPT0gLTEgfHwgWVRQbGF5ZXIuc3RhdGUgPT0gMCApICkge1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIuaGFzRm9jdXMgPSB0cnVlO1xuXHRcdFx0XHRcdFx0JFlUUGxheWVyLllUUFBsYXkoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiggWVRQbGF5ZXIub3B0LnBsYXlPbmx5SWZWaXNpYmxlICkge1xuXG5cdFx0XHRcdFx0dmFyIGlzT25TY3JlZW4gPSBqUXVlcnkubWJZVFBsYXllci5pc09uU2NyZWVuKCBZVFBsYXllciApO1xuXG5cdFx0XHRcdFx0aWYoICFpc09uU2NyZWVuICYmIFlUUGxheWVyLnN0YXRlID09IDEgKSB7XG5cblx0XHRcdFx0XHRcdFlUUGxheWVyLmhhc0ZvY3VzID0gZmFsc2U7XG5cdFx0XHRcdFx0XHQkWVRQbGF5ZXIuWVRQUGF1c2UoKTtcblxuXHRcdFx0XHRcdFx0Y29uc29sZS5kZWJ1ZyggWVRQbGF5ZXIuaWQsIGlzT25TY3JlZW4gKTtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZGVidWcoIFlUUGxheWVyLnN0YXRlICk7XG5cblx0XHRcdFx0XHR9IGVsc2UgaWYoICFZVFBsYXllci5oYXNGb2N1cyAmJiAhKCBZVFBsYXllci5zdGF0ZSA9PSAtMSB8fCBZVFBsYXllci5zdGF0ZSA9PSAwICkgKSB7XG5cblx0XHRcdFx0XHRcdFlUUGxheWVyLmhhc0ZvY3VzID0gdHJ1ZTtcblx0XHRcdFx0XHRcdCRZVFBsYXllci5ZVFBQbGF5KCk7XG5cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXG5cdFx0XHRcdGlmKCBZVFBsYXllci5jb250cm9sQmFyLmxlbmd0aCAmJiBZVFBsYXllci5jb250cm9sQmFyLm91dGVyV2lkdGgoKSA8PSA0MDAgJiYgIVlUUGxheWVyLmlzQ29tcGFjdCApIHtcblx0XHRcdFx0XHRZVFBsYXllci5jb250cm9sQmFyLmFkZENsYXNzKCBcImNvbXBhY3RcIiApO1xuXHRcdFx0XHRcdFlUUGxheWVyLmlzQ29tcGFjdCA9IHRydWU7XG5cdFx0XHRcdFx0aWYoICFZVFBsYXllci5pc011dGUgJiYgWVRQbGF5ZXIudm9sdW1lQmFyICkgWVRQbGF5ZXIudm9sdW1lQmFyLnVwZGF0ZVNsaWRlclZhbCggWVRQbGF5ZXIub3B0LnZvbCApO1xuXHRcdFx0XHR9IGVsc2UgaWYoIFlUUGxheWVyLmNvbnRyb2xCYXIubGVuZ3RoICYmIFlUUGxheWVyLmNvbnRyb2xCYXIub3V0ZXJXaWR0aCgpID4gNDAwICYmIFlUUGxheWVyLmlzQ29tcGFjdCApIHtcblx0XHRcdFx0XHRZVFBsYXllci5jb250cm9sQmFyLnJlbW92ZUNsYXNzKCBcImNvbXBhY3RcIiApO1xuXHRcdFx0XHRcdFlUUGxheWVyLmlzQ29tcGFjdCA9IGZhbHNlO1xuXHRcdFx0XHRcdGlmKCAhWVRQbGF5ZXIuaXNNdXRlICYmIFlUUGxheWVyLnZvbHVtZUJhciApIFlUUGxheWVyLnZvbHVtZUJhci51cGRhdGVTbGlkZXJWYWwoIFlUUGxheWVyLm9wdC52b2wgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmKCBZVFBsYXllci5wbGF5ZXIuZ2V0UGxheWVyU3RhdGUoKSA9PSAxICYmICggcGFyc2VGbG9hdCggWVRQbGF5ZXIucGxheWVyLmdldER1cmF0aW9uKCkgLSAuNSApIDwgWVRQbGF5ZXIucGxheWVyLmdldEN1cnJlbnRUaW1lKCkgfHwgKCBzdG9wQXQgPiAwICYmIHBhcnNlRmxvYXQoIFlUUGxheWVyLnBsYXllci5nZXRDdXJyZW50VGltZSgpICkgPiBzdG9wQXQgKSApICkge1xuXHRcdFx0XHRcdGlmKCBZVFBsYXllci5pc0VuZGVkICkgcmV0dXJuO1xuXHRcdFx0XHRcdFlUUGxheWVyLmlzRW5kZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIuaXNFbmRlZCA9IGZhbHNlO1xuXHRcdFx0XHRcdH0sIDEwMDAgKTtcblxuXHRcdFx0XHRcdGlmKCBZVFBsYXllci5pc1BsYXlMaXN0ICkge1xuXG5cdFx0XHRcdFx0XHRpZiggIWRhdGEubG9vcCB8fCAoIGRhdGEubG9vcCA+IDAgJiYgWVRQbGF5ZXIucGxheWVyLmxvb3BUaW1lID09PSBkYXRhLmxvb3AgLSAxICkgKSB7XG5cblx0XHRcdFx0XHRcdFx0WVRQbGF5ZXIucGxheWVyLmxvb3BUaW1lID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRcdFx0XHRjbGVhckludGVydmFsKCBZVFBsYXllci5nZXRTdGF0ZSApO1xuXHRcdFx0XHRcdFx0XHR2YXIgWVRQRW5kID0galF1ZXJ5LkV2ZW50KCBcIllUUEVuZFwiICk7XG5cdFx0XHRcdFx0XHRcdFlUUEVuZC50aW1lID0gWVRQbGF5ZXIuY3VycmVudFRpbWU7XG5cdFx0XHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBZVFBFbmQgKTtcblx0XHRcdFx0XHRcdFx0Ly9ZVFBsYXllci5zdGF0ZSA9IDA7XG5cblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0fSBlbHNlIGlmKCAhZGF0YS5sb29wIHx8ICggZGF0YS5sb29wID4gMCAmJiBZVFBsYXllci5wbGF5ZXIubG9vcFRpbWUgPT09IGRhdGEubG9vcCAtIDEgKSApIHtcblxuXHRcdFx0XHRcdFx0WVRQbGF5ZXIucGxheWVyLmxvb3BUaW1lID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIucHJldmVudFRyaWdnZXIgPSB0cnVlO1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIuc3RhdGUgPSAyO1xuXHRcdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLllUUFBhdXNlKCk7XG5cblx0XHRcdFx0XHRcdFlUUGxheWVyLndyYXBwZXIuQ1NTQW5pbWF0ZSgge1xuXHRcdFx0XHRcdFx0XHRvcGFjaXR5OiAwXG5cdFx0XHRcdFx0XHR9LCBZVFBsYXllci5vcHQuZmFkZU9uU3RhcnRUaW1lLCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHRcdFx0XHRpZiggWVRQbGF5ZXIuY29udHJvbEJhci5sZW5ndGggKVxuXHRcdFx0XHRcdFx0XHRcdFlUUGxheWVyLmNvbnRyb2xCYXIuZmluZCggXCIubWJfWVRQUGxheXBhdXNlXCIgKS5odG1sKCBqUXVlcnkubWJZVFBsYXllci5jb250cm9scy5wbGF5ICk7XG5cblx0XHRcdFx0XHRcdFx0dmFyIFlUUEVuZCA9IGpRdWVyeS5FdmVudCggXCJZVFBFbmRcIiApO1xuXHRcdFx0XHRcdFx0XHRZVFBFbmQudGltZSA9IFlUUGxheWVyLmN1cnJlbnRUaW1lO1xuXHRcdFx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkudHJpZ2dlciggWVRQRW5kICk7XG5cblx0XHRcdFx0XHRcdFx0WVRQbGF5ZXIucGxheWVyLnNlZWtUbyggc3RhcnRBdCwgdHJ1ZSApO1xuXHRcdFx0XHRcdFx0XHRpZiggIVlUUGxheWVyLmlzQmFja2dyb3VuZCApIHtcblx0XHRcdFx0XHRcdFx0XHRpZiggWVRQbGF5ZXIub3B0LmJhY2tncm91bmRVcmwgJiYgWVRQbGF5ZXIuaXNQbGF5ZXIgKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRZVFBsYXllci5vcHQuYmFja2dyb3VuZFVybCA9IFlUUGxheWVyLm9wdC5iYWNrZ3JvdW5kVXJsIHx8IFlUUGxheWVyLm9yaWdfYmFja2dyb3VuZDtcblx0XHRcdFx0XHRcdFx0XHRcdFlUUGxheWVyLm9wdC5jb250YWlubWVudC5jc3MoIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YmFja2dyb3VuZDogXCJ1cmwoXCIgKyBZVFBsYXllci5vcHQuYmFja2dyb3VuZFVybCArIFwiKSBjZW50ZXIgY2VudGVyXCIsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGJhY2tncm91bmRTaXplOiBcImNvdmVyXCJcblx0XHRcdFx0XHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYoIFlUUGxheWVyLm9yaWdfYmFja2dyb3VuZCApXG5cdFx0XHRcdFx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkuY3NzKCBcImJhY2tncm91bmQtaW1hZ2VcIiwgWVRQbGF5ZXIub3JpZ19iYWNrZ3JvdW5kICk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0gKTtcblxuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0WVRQbGF5ZXIucGxheWVyLmxvb3BUaW1lID0gWVRQbGF5ZXIucGxheWVyLmxvb3BUaW1lID8gKytZVFBsYXllci5wbGF5ZXIubG9vcFRpbWUgOiAxO1xuXHRcdFx0XHRcdHN0YXJ0QXQgPSBzdGFydEF0IHx8IDE7XG5cdFx0XHRcdFx0WVRQbGF5ZXIucHJldmVudFRyaWdnZXIgPSB0cnVlO1xuXHRcdFx0XHRcdFlUUGxheWVyLnN0YXRlID0gMjtcblx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkuWVRQUGF1c2UoKTtcblx0XHRcdFx0XHRZVFBsYXllci5wbGF5ZXIuc2Vla1RvKCBzdGFydEF0LCB0cnVlICk7XG5cdFx0XHRcdFx0JFlUUGxheWVyLllUUFBsYXkoKTtcblxuXG5cdFx0XHRcdH1cblx0XHRcdH0sIGludGVydmFsICk7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEByZXR1cm5zIHtzdHJpbmd9IHRpbWVcblx0XHQgKi9cblx0XHRnZXRUaW1lOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBZVFBsYXllciA9IHRoaXMuZ2V0KCAwICk7XG5cdFx0XHRyZXR1cm4galF1ZXJ5Lm1iWVRQbGF5ZXIuZm9ybWF0VGltZSggWVRQbGF5ZXIuY3VycmVudFRpbWUgKTtcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHJldHVybnMge3N0cmluZ30gdG90YWwgdGltZVxuXHRcdCAqL1xuXHRcdGdldFRvdGFsVGltZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzLmdldCggMCApO1xuXHRcdFx0cmV0dXJuIGpRdWVyeS5tYllUUGxheWVyLmZvcm1hdFRpbWUoIFlUUGxheWVyLnRvdGFsVGltZSApO1xuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gWVRQbGF5ZXJcblx0XHQgKi9cblx0XHRjaGVja0ZvclN0YXJ0OiBmdW5jdGlvbiggWVRQbGF5ZXIgKSB7XG5cblx0XHRcdHZhciAkWVRQbGF5ZXIgPSBqUXVlcnkoIFlUUGxheWVyICk7XG5cblx0XHRcdC8vQ2hlY2tpbmcgaWYgcGxheWVyIGhhcyBiZWVuIHJlbW92ZWQgZnJvbSBzY2VuZVxuXHRcdFx0aWYoICFqUXVlcnkuY29udGFpbnMoIGRvY3VtZW50LCBZVFBsYXllciApICkge1xuXHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkuWVRQUGxheWVyRGVzdHJveSgpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdFlUUGxheWVyLnByZXZlbnRUcmlnZ2VyID0gdHJ1ZTtcblx0XHRcdFlUUGxheWVyLnN0YXRlID0gMjtcblx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS5ZVFBQYXVzZSgpO1xuXG5cdFx0XHRqUXVlcnkoIFlUUGxheWVyICkubXV0ZVlUUFZvbHVtZSgpO1xuXHRcdFx0alF1ZXJ5KCBcIiNjb250cm9sQmFyX1wiICsgWVRQbGF5ZXIuaWQgKS5yZW1vdmUoKTtcblxuXHRcdFx0WVRQbGF5ZXIuY29udHJvbEJhciA9IGZhbHNlO1xuXG5cdFx0XHRpZiggWVRQbGF5ZXIub3B0LnNob3dDb250cm9scyApXG5cdFx0XHRcdGpRdWVyeS5tYllUUGxheWVyLmJ1aWxkQ29udHJvbHMoIFlUUGxheWVyICk7XG5cblx0XHRcdGlmKCBZVFBsYXllci5vdmVybGF5IClcblx0XHRcdFx0aWYoIFlUUGxheWVyLm9wdC5hZGRSYXN0ZXIgKSB7XG5cblx0XHRcdFx0XHR2YXIgY2xhc3NOID0gWVRQbGF5ZXIub3B0LmFkZFJhc3RlciA9PSBcImRvdFwiID8gXCJyYXN0ZXItZG90XCIgOiBcInJhc3RlclwiO1xuXHRcdFx0XHRcdFlUUGxheWVyLm92ZXJsYXkuYWRkQ2xhc3MoIFlUUGxheWVyLmlzUmV0aW5hID8gY2xhc3NOICsgXCIgcmV0aW5hXCIgOiBjbGFzc04gKTtcblxuXHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0WVRQbGF5ZXIub3ZlcmxheS5yZW1vdmVDbGFzcyggZnVuY3Rpb24oIGluZGV4LCBjbGFzc05hbWVzICkge1xuXHRcdFx0XHRcdFx0Ly8gY2hhbmdlIHRoZSBsaXN0IGludG8gYW4gYXJyYXlcblx0XHRcdFx0XHRcdHZhciBjdXJyZW50X2NsYXNzZXMgPSBjbGFzc05hbWVzLnNwbGl0KCBcIiBcIiApLFxuXHRcdFx0XHRcdFx0XHQvLyBhcnJheSBvZiBjbGFzc2VzIHdoaWNoIGFyZSB0byBiZSByZW1vdmVkXG5cdFx0XHRcdFx0XHRcdGNsYXNzZXNfdG9fcmVtb3ZlID0gW107XG5cdFx0XHRcdFx0XHRqUXVlcnkuZWFjaCggY3VycmVudF9jbGFzc2VzLCBmdW5jdGlvbiggaW5kZXgsIGNsYXNzX25hbWUgKSB7XG5cdFx0XHRcdFx0XHRcdC8vIGlmIHRoZSBjbGFzc25hbWUgYmVnaW5zIHdpdGggYmcgYWRkIGl0IHRvIHRoZSBjbGFzc2VzX3RvX3JlbW92ZSBhcnJheVxuXHRcdFx0XHRcdFx0XHRpZiggL3Jhc3Rlci4qLy50ZXN0KCBjbGFzc19uYW1lICkgKSB7XG5cdFx0XHRcdFx0XHRcdFx0Y2xhc3Nlc190b19yZW1vdmUucHVzaCggY2xhc3NfbmFtZSApO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0XHRjbGFzc2VzX3RvX3JlbW92ZS5wdXNoKCBcInJldGluYVwiICk7XG5cdFx0XHRcdFx0XHQvLyB0dXJuIHRoZSBhcnJheSBiYWNrIGludG8gYSBzdHJpbmdcblx0XHRcdFx0XHRcdHJldHVybiBjbGFzc2VzX3RvX3JlbW92ZS5qb2luKCBcIiBcIiApO1xuXHRcdFx0XHRcdH0gKTtcblxuXHRcdFx0XHR9XG5cblx0XHRcdHZhciBzdGFydEF0ID0gWVRQbGF5ZXIuc3RhcnRfZnJvbV9sYXN0ID8gWVRQbGF5ZXIuc3RhcnRfZnJvbV9sYXN0IDogWVRQbGF5ZXIub3B0LnN0YXJ0QXQgPyBZVFBsYXllci5vcHQuc3RhcnRBdCA6IDE7XG5cblx0XHRcdFlUUGxheWVyLnN0YXJ0X2Zyb21fbGFzdCA9IG51bGw7XG5cblx0XHRcdFlUUGxheWVyLnBsYXllci5wbGF5VmlkZW8oKTtcblx0XHRcdFlUUGxheWVyLnBsYXllci5zZWVrVG8oIHN0YXJ0QXQsIHRydWUgKTtcblxuXHRcdFx0Y2xlYXJJbnRlcnZhbCggWVRQbGF5ZXIuY2hlY2tGb3JTdGFydEF0ICk7XG5cdFx0XHRZVFBsYXllci5jaGVja0ZvclN0YXJ0QXQgPSBzZXRJbnRlcnZhbCggZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLllUUE11dGUoKTtcblxuXHRcdFx0XHR2YXIgY2FuUGxheVZpZGVvID0gWVRQbGF5ZXIucGxheWVyLmdldFZpZGVvTG9hZGVkRnJhY3Rpb24oKSA+PSBzdGFydEF0IC8gWVRQbGF5ZXIucGxheWVyLmdldER1cmF0aW9uKCk7XG5cblx0XHRcdFx0aWYoIFlUUGxheWVyLnBsYXllci5nZXREdXJhdGlvbigpID4gMCAmJiBZVFBsYXllci5wbGF5ZXIuZ2V0Q3VycmVudFRpbWUoKSA+PSBzdGFydEF0ICYmIGNhblBsYXlWaWRlbyApIHtcblxuXHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwoIFlUUGxheWVyLmNoZWNrRm9yU3RhcnRBdCApO1xuXG5cdFx0XHRcdFx0aWYoIHR5cGVvZiBZVFBsYXllci5vcHQub25SZWFkeSA9PSBcImZ1bmN0aW9uXCIgKVxuXHRcdFx0XHRcdFx0WVRQbGF5ZXIub3B0Lm9uUmVhZHkoIFlUUGxheWVyICk7XG5cblx0XHRcdFx0XHRZVFBsYXllci5pc1JlYWR5ID0gdHJ1ZTtcblxuXHRcdFx0XHRcdHZhciBZVFByZWFkeSA9IGpRdWVyeS5FdmVudCggXCJZVFBSZWFkeVwiICk7XG5cdFx0XHRcdFx0WVRQcmVhZHkudGltZSA9IFlUUGxheWVyLmN1cnJlbnRUaW1lO1xuXHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBZVFByZWFkeSApO1xuXG5cdFx0XHRcdFx0WVRQbGF5ZXIucHJldmVudFRyaWdnZXIgPSB0cnVlO1xuXHRcdFx0XHRcdFlUUGxheWVyLnN0YXRlID0gMjtcblx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyICkuWVRQUGF1c2UoKTtcblxuXHRcdFx0XHRcdGlmKCAhWVRQbGF5ZXIub3B0Lm11dGUgKVxuXHRcdFx0XHRcdFx0alF1ZXJ5KCBZVFBsYXllciApLllUUFVubXV0ZSgpO1xuXHRcdFx0XHRcdFlUUGxheWVyLmNhblRyaWdnZXIgPSB0cnVlO1xuXG5cdFx0XHRcdFx0aWYoIFlUUGxheWVyLm9wdC5hdXRvUGxheSApIHtcblxuXHRcdFx0XHRcdFx0dmFyIFlUUFN0YXJ0ID0galF1ZXJ5LkV2ZW50KCBcIllUUFN0YXJ0XCIgKTtcblx0XHRcdFx0XHRcdFlUUFN0YXJ0LnRpbWUgPSBZVFBsYXllci5jdXJyZW50VGltZTtcblx0XHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIgKS50cmlnZ2VyKCBZVFBTdGFydCApO1xuXG5cdFx0XHRcdFx0XHRqUXVlcnkoIFlUUGxheWVyLnBsYXllckVsICkuQ1NTQW5pbWF0ZSgge1xuXHRcdFx0XHRcdFx0XHRvcGFjaXR5OiAxXG5cdFx0XHRcdFx0XHR9LCAxMDAwICk7XG5cblx0XHRcdFx0XHRcdCRZVFBsYXllci5ZVFBQbGF5KCk7XG5cblx0XHRcdFx0XHRcdFlUUGxheWVyLndyYXBwZXIuQ1NTQW5pbWF0ZSgge1xuXHRcdFx0XHRcdFx0XHRvcGFjaXR5OiBZVFBsYXllci5pc0Fsb25lID8gMSA6IFlUUGxheWVyLm9wdC5vcGFjaXR5XG5cdFx0XHRcdFx0XHR9LCBZVFBsYXllci5vcHQuZmFkZU9uU3RhcnRUaW1lICogMiApO1xuXG5cdFx0XHRcdFx0XHQvKiBGaXggZm9yIFNhZmFyaSBmcmVlemUgKi9cblxuXHRcdFx0XHRcdFx0aWYoIGpRdWVyeS5tYkJyb3dzZXIub3MubmFtZSA9PSBcIm1hY1wiICYmIGpRdWVyeS5tYkJyb3dzZXIuc2FmYXJpICYmIGpRdWVyeS5tYkJyb3dzZXIudmVyc2lvbkNvbXBhcmUoIGpRdWVyeS5tYkJyb3dzZXIuZnVsbFZlcnNpb24sIFwiMTAuMVwiICkgPCAwICkgeyAvL2pRdWVyeS5tYkJyb3dzZXIub3MubWlub3JfdmVyc2lvbiA8IDExXG5cblx0XHRcdFx0XHRcdFx0WVRQbGF5ZXIuc2FmYXJpUGxheSA9IHNldEludGVydmFsKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiggWVRQbGF5ZXIuc3RhdGUgIT0gMSApXG5cdFx0XHRcdFx0XHRcdFx0XHQkWVRQbGF5ZXIuWVRQUGxheSgpO1xuXHRcdFx0XHRcdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwoIFlUUGxheWVyLnNhZmFyaVBsYXkgKTtcblx0XHRcdFx0XHRcdFx0fSwgMTAgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdCRZVFBsYXllci5vbmUoIFwiWVRQUmVhZHlcIiwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdCRZVFBsYXllci5ZVFBQbGF5KCk7XG5cdFx0XHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHQvLyRZVFBsYXllci5ZVFBQYXVzZSgpO1xuXHRcdFx0XHRcdFx0WVRQbGF5ZXIucGxheWVyLnBhdXNlVmlkZW8oKTtcblx0XHRcdFx0XHRcdGlmKCAhWVRQbGF5ZXIuaXNQbGF5ZXIgKSB7XG5cdFx0XHRcdFx0XHRcdGpRdWVyeSggWVRQbGF5ZXIucGxheWVyRWwgKS5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdFx0XHRcdFx0b3BhY2l0eTogMVxuXHRcdFx0XHRcdFx0XHR9LCBZVFBsYXllci5vcHQuZmFkZU9uU3RhcnRUaW1lICk7XG5cblx0XHRcdFx0XHRcdFx0WVRQbGF5ZXIud3JhcHBlci5DU1NBbmltYXRlKCB7XG5cdFx0XHRcdFx0XHRcdFx0b3BhY2l0eTogWVRQbGF5ZXIuaXNBbG9uZSA/IDEgOiBZVFBsYXllci5vcHQub3BhY2l0eVxuXHRcdFx0XHRcdFx0XHR9LCBZVFBsYXllci5vcHQuZmFkZU9uU3RhcnRUaW1lICk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmKCBZVFBsYXllci5jb250cm9sQmFyLmxlbmd0aCApXG5cdFx0XHRcdFx0XHRcdFlUUGxheWVyLmNvbnRyb2xCYXIuZmluZCggXCIubWJfWVRQUGxheXBhdXNlXCIgKS5odG1sKCBqUXVlcnkubWJZVFBsYXllci5jb250cm9scy5wbGF5ICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYoIFlUUGxheWVyLmlzUGxheWVyICYmICFZVFBsYXllci5vcHQuYXV0b1BsYXkgJiYgKCBZVFBsYXllci5sb2FkaW5nICYmIFlUUGxheWVyLmxvYWRpbmcubGVuZ3RoICkgKSB7XG5cdFx0XHRcdFx0XHRZVFBsYXllci5sb2FkaW5nLmh0bWwoIFwiUmVhZHlcIiApO1xuXHRcdFx0XHRcdFx0c2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdFlUUGxheWVyLmxvYWRpbmcuZmFkZU91dCgpO1xuXHRcdFx0XHRcdFx0fSwgMTAwICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYoIFlUUGxheWVyLmNvbnRyb2xCYXIgJiYgWVRQbGF5ZXIuY29udHJvbEJhci5sZW5ndGggKVxuXHRcdFx0XHRcdFx0WVRQbGF5ZXIuY29udHJvbEJhci5zbGlkZURvd24oIDEwMDAgKTtcblxuXHRcdFx0XHR9IGVsc2UgaWYoIGpRdWVyeS5tYkJyb3dzZXIub3MubmFtZSA9PSBcIm1hY1wiICYmIGpRdWVyeS5tYkJyb3dzZXIuc2FmYXJpICYmIGpRdWVyeS5tYkJyb3dzZXIuZnVsbFZlcnNpb24gJiYgalF1ZXJ5Lm1iQnJvd3Nlci52ZXJzaW9uQ29tcGFyZSggalF1ZXJ5Lm1iQnJvd3Nlci5mdWxsVmVyc2lvbiwgXCIxMC4xXCIgKSA8IDAgKSB7IC8valF1ZXJ5Lm1iQnJvd3Nlci5vcy5taW5vcl92ZXJzaW9uIDwgMTFcblx0XHRcdFx0XHRZVFBsYXllci5wbGF5ZXIucGxheVZpZGVvKCk7XG5cdFx0XHRcdFx0aWYoIHN0YXJ0QXQgPj0gMCApXG5cdFx0XHRcdFx0XHRZVFBsYXllci5wbGF5ZXIuc2Vla1RvKCBzdGFydEF0LCB0cnVlICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSwgMTAgKTtcblxuXHRcdH0sXG5cdFx0LyoqXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gYW5jaG9yXG5cdFx0ICovXG5cdFx0c2V0QW5jaG9yOiBmdW5jdGlvbiggYW5jaG9yICkge1xuXHRcdFx0dmFyICRZVHBsYXllciA9IHRoaXM7XG5cdFx0XHQkWVRwbGF5ZXIub3B0aW1pemVEaXNwbGF5KCBhbmNob3IgKTtcblx0XHR9LFxuXHRcdC8qKlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGFuY2hvclxuXHRcdCAqL1xuXHRcdGdldEFuY2hvcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgWVRQbGF5ZXIgPSB0aGlzLmdldCggMCApO1xuXHRcdFx0cmV0dXJuIFlUUGxheWVyLm9wdC5hbmNob3I7XG5cdFx0fSxcblx0XHQvKipcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBzXG5cdFx0ICogQHJldHVybnMge3N0cmluZ31cblx0XHQgKi9cblx0XHRmb3JtYXRUaW1lOiBmdW5jdGlvbiggcyApIHtcblx0XHRcdHZhciBtaW4gPSBNYXRoLmZsb29yKCBzIC8gNjAgKTtcblx0XHRcdHZhciBzZWMgPSBNYXRoLmZsb29yKCBzIC0gKCA2MCAqIG1pbiApICk7XG5cdFx0XHRyZXR1cm4oIG1pbiA8PSA5ID8gXCIwXCIgKyBtaW4gOiBtaW4gKSArIFwiIDogXCIgKyAoIHNlYyA8PSA5ID8gXCIwXCIgKyBzZWMgOiBzZWMgKTtcblx0XHR9XG5cdH07XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSBhbmNob3Jcblx0ICogY2FuIGJlIGNlbnRlciwgdG9wLCBib3R0b20sIHJpZ2h0LCBsZWZ0OyAoZGVmYXVsdCBpcyBjZW50ZXIsY2VudGVyKVxuXHQgKi9cblx0alF1ZXJ5LmZuLm9wdGltaXplRGlzcGxheSA9IGZ1bmN0aW9uKCBhbmNob3IgKSB7XG5cdFx0dmFyIFlUUGxheWVyID0gdGhpcy5nZXQoIDAgKTtcblx0XHR2YXIgcGxheWVyQm94ID0galF1ZXJ5KCBZVFBsYXllci5wbGF5ZXJFbCApO1xuXHRcdHZhciB2aWQgPSB7fTtcblxuXHRcdFlUUGxheWVyLm9wdC5hbmNob3IgPSBhbmNob3IgfHwgWVRQbGF5ZXIub3B0LmFuY2hvcjtcblxuXHRcdFlUUGxheWVyLm9wdC5hbmNob3IgPSB0eXBlb2YgWVRQbGF5ZXIub3B0LmFuY2hvciAhPSBcInVuZGVmaW5lZCBcIiA/IFlUUGxheWVyLm9wdC5hbmNob3IgOiBcImNlbnRlcixjZW50ZXJcIjtcblx0XHR2YXIgWVRQQWxpZ24gPSBZVFBsYXllci5vcHQuYW5jaG9yLnNwbGl0KCBcIixcIiApO1xuXG5cdFx0Ly9kYXRhLm9wdGltaXplRGlzcGxheSA9IFlUUGxheWVyLmlzUGxheWVyID8gZmFsc2UgOiBkYXRhLm9wdGltaXplRGlzcGxheTtcblxuXHRcdGlmKCBZVFBsYXllci5vcHQub3B0aW1pemVEaXNwbGF5ICkge1xuXHRcdFx0dmFyIGFidW5kYW5jZSA9IFlUUGxheWVyLmlzUGxheWVyID8gMCA6IDE4MDtcblx0XHRcdHZhciB3aW4gPSB7fTtcblx0XHRcdHZhciBlbCA9IFlUUGxheWVyLndyYXBwZXI7XG5cblx0XHRcdHdpbi53aWR0aCA9IGVsLm91dGVyV2lkdGgoKTtcblx0XHRcdHdpbi5oZWlnaHQgPSBlbC5vdXRlckhlaWdodCgpICsgYWJ1bmRhbmNlO1xuXG5cdFx0XHRZVFBsYXllci5vcHQucmF0aW8gPSBldmFsKCBZVFBsYXllci5vcHQucmF0aW8gKTtcblxuXHRcdFx0dmlkLndpZHRoID0gd2luLndpZHRoO1xuXHRcdFx0Ly9cdFx0XHR2aWQuaGVpZ2h0ID0gWVRQbGF5ZXIub3B0LnJhdGlvID09IFwiMTYvOVwiID8gTWF0aC5jZWlsKCB2aWQud2lkdGggKiAoIDkgLyAxNiApICkgOiBNYXRoLmNlaWwoIHZpZC53aWR0aCAqICggMyAvIDQgKSApO1xuXHRcdFx0dmlkLmhlaWdodCA9IE1hdGguY2VpbCggdmlkLndpZHRoIC8gWVRQbGF5ZXIub3B0LnJhdGlvICk7XG5cblx0XHRcdHZpZC5tYXJnaW5Ub3AgPSBNYXRoLmNlaWwoIC0oICggdmlkLmhlaWdodCAtIHdpbi5oZWlnaHQgKSAvIDIgKSApO1xuXHRcdFx0dmlkLm1hcmdpbkxlZnQgPSAwO1xuXG5cdFx0XHR2YXIgbG93ZXN0ID0gdmlkLmhlaWdodCA8IHdpbi5oZWlnaHQ7XG5cblx0XHRcdGlmKCBsb3dlc3QgKSB7XG5cblx0XHRcdFx0dmlkLmhlaWdodCA9IHdpbi5oZWlnaHQ7XG5cdFx0XHRcdC8vXHRcdFx0XHR2aWQud2lkdGggPSBZVFBsYXllci5vcHQucmF0aW8gPT0gXCIxNi85XCIgPyBNYXRoLmZsb29yKCB2aWQuaGVpZ2h0ICogKCAxNiAvIDkgKSApIDogTWF0aC5mbG9vciggdmlkLmhlaWdodCAqICggNCAvIDMgKSApO1xuXHRcdFx0XHR2aWQud2lkdGggPSBNYXRoLmNlaWwoIHZpZC5oZWlnaHQgKiBZVFBsYXllci5vcHQucmF0aW8gKTtcblxuXHRcdFx0XHR2aWQubWFyZ2luVG9wID0gMDtcblx0XHRcdFx0dmlkLm1hcmdpbkxlZnQgPSBNYXRoLmNlaWwoIC0oICggdmlkLndpZHRoIC0gd2luLndpZHRoICkgLyAyICkgKTtcblxuXHRcdFx0fVxuXG5cdFx0XHRmb3IoIHZhciBhIGluIFlUUEFsaWduICkge1xuXG5cdFx0XHRcdGlmKCBZVFBBbGlnbi5oYXNPd25Qcm9wZXJ0eSggYSApICkge1xuXG5cdFx0XHRcdFx0dmFyIGFsID0gWVRQQWxpZ25bIGEgXS5yZXBsYWNlKCAvIC9nLCBcIlwiICk7XG5cblx0XHRcdFx0XHRzd2l0Y2goIGFsICkge1xuXG5cdFx0XHRcdFx0XHRjYXNlIFwidG9wXCI6XG5cdFx0XHRcdFx0XHRcdHZpZC5tYXJnaW5Ub3AgPSBsb3dlc3QgPyAtKCAoIHZpZC5oZWlnaHQgLSB3aW4uaGVpZ2h0ICkgLyAyICkgOiAwO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSBcImJvdHRvbVwiOlxuXHRcdFx0XHRcdFx0XHR2aWQubWFyZ2luVG9wID0gbG93ZXN0ID8gMCA6IC0oIHZpZC5oZWlnaHQgLSAoIHdpbi5oZWlnaHQgKSApO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSBcImxlZnRcIjpcblx0XHRcdFx0XHRcdFx0dmlkLm1hcmdpbkxlZnQgPSAwO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0Y2FzZSBcInJpZ2h0XCI6XG5cdFx0XHRcdFx0XHRcdHZpZC5tYXJnaW5MZWZ0ID0gbG93ZXN0ID8gLSggdmlkLndpZHRoIC0gd2luLndpZHRoICkgOiAwO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdFx0aWYoIHZpZC53aWR0aCA+IHdpbi53aWR0aCApXG5cdFx0XHRcdFx0XHRcdFx0dmlkLm1hcmdpbkxlZnQgPSAtKCAoIHZpZC53aWR0aCAtIHdpbi53aWR0aCApIC8gMiApO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fVxuXG5cdFx0XHR9XG5cblx0XHR9IGVsc2Uge1xuXHRcdFx0dmlkLndpZHRoID0gXCIxMDAlXCI7XG5cdFx0XHR2aWQuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdFx0XHR2aWQubWFyZ2luVG9wID0gMDtcblx0XHRcdHZpZC5tYXJnaW5MZWZ0ID0gMDtcblx0XHR9XG5cblx0XHRwbGF5ZXJCb3guY3NzKCB7XG5cdFx0XHR3aWR0aDogdmlkLndpZHRoLFxuXHRcdFx0aGVpZ2h0OiB2aWQuaGVpZ2h0LFxuXHRcdFx0bWFyZ2luVG9wOiB2aWQubWFyZ2luVG9wLFxuXHRcdFx0bWFyZ2luTGVmdDogdmlkLm1hcmdpbkxlZnQsXG5cdFx0XHRtYXhXaWR0aDogXCJpbml0aWFsXCJcblx0XHR9ICk7XG5cblx0fTtcblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSBhcnJcblx0ICogQHJldHVybnMge0FycmF5fHN0cmluZ3xCbG9ifCp9XG5cdCAqXG5cdCAqL1xuXHRqUXVlcnkuc2h1ZmZsZSA9IGZ1bmN0aW9uKCBhcnIgKSB7XG5cdFx0dmFyIG5ld0FycmF5ID0gYXJyLnNsaWNlKCk7XG5cdFx0dmFyIGxlbiA9IG5ld0FycmF5Lmxlbmd0aDtcblx0XHR2YXIgaSA9IGxlbjtcblx0XHR3aGlsZSggaS0tICkge1xuXHRcdFx0dmFyIHAgPSBwYXJzZUludCggTWF0aC5yYW5kb20oKSAqIGxlbiApO1xuXHRcdFx0dmFyIHQgPSBuZXdBcnJheVsgaSBdO1xuXHRcdFx0bmV3QXJyYXlbIGkgXSA9IG5ld0FycmF5WyBwIF07XG5cdFx0XHRuZXdBcnJheVsgcCBdID0gdDtcblx0XHR9XG5cdFx0cmV0dXJuIG5ld0FycmF5O1xuXHR9O1xuXG5cdGpRdWVyeS5mbi51bnNlbGVjdGFibGUgPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gdGhpcy5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdGpRdWVyeSggdGhpcyApLmNzcygge1xuXHRcdFx0XHRcIi1tb3otdXNlci1zZWxlY3RcIjogXCJub25lXCIsXG5cdFx0XHRcdFwiLXdlYmtpdC11c2VyLXNlbGVjdFwiOiBcIm5vbmVcIixcblx0XHRcdFx0XCJ1c2VyLXNlbGVjdFwiOiBcIm5vbmVcIlxuXHRcdFx0fSApLmF0dHIoIFwidW5zZWxlY3RhYmxlXCIsIFwib25cIiApO1xuXHRcdH0gKTtcblx0fTtcblxuXHQvKiBFeHBvc2VkIHB1YmxpYyBtZXRob2QgKi9cblx0alF1ZXJ5LmZuLllUUGxheWVyID0galF1ZXJ5Lm1iWVRQbGF5ZXIuYnVpbGRQbGF5ZXI7XG5cdGpRdWVyeS5mbi5ZVFBHZXRQbGF5ZXIgPSBqUXVlcnkubWJZVFBsYXllci5nZXRQbGF5ZXI7XG5cdGpRdWVyeS5mbi5ZVFBHZXRWaWRlb0lEID0galF1ZXJ5Lm1iWVRQbGF5ZXIuZ2V0VmlkZW9JRDtcblx0alF1ZXJ5LmZuLllUUENoYW5nZU1vdmllID0galF1ZXJ5Lm1iWVRQbGF5ZXIuY2hhbmdlTW92aWU7XG5cdGpRdWVyeS5mbi5ZVFBQbGF5ZXJEZXN0cm95ID0galF1ZXJ5Lm1iWVRQbGF5ZXIucGxheWVyRGVzdHJveTtcblxuXHRqUXVlcnkuZm4uWVRQUGxheSA9IGpRdWVyeS5tYllUUGxheWVyLnBsYXk7XG5cdGpRdWVyeS5mbi5ZVFBUb2dnbGVQbGF5ID0galF1ZXJ5Lm1iWVRQbGF5ZXIudG9nZ2xlUGxheTtcblx0alF1ZXJ5LmZuLllUUFN0b3AgPSBqUXVlcnkubWJZVFBsYXllci5zdG9wO1xuXHRqUXVlcnkuZm4uWVRQUGF1c2UgPSBqUXVlcnkubWJZVFBsYXllci5wYXVzZTtcblx0alF1ZXJ5LmZuLllUUFNlZWtUbyA9IGpRdWVyeS5tYllUUGxheWVyLnNlZWtUbztcblxuXHRqUXVlcnkuZm4uWVRQbGF5bGlzdCA9IGpRdWVyeS5tYllUUGxheWVyLnBsYXlsaXN0O1xuXHRqUXVlcnkuZm4uWVRQUGxheU5leHQgPSBqUXVlcnkubWJZVFBsYXllci5wbGF5TmV4dDtcblx0alF1ZXJ5LmZuLllUUFBsYXlQcmV2ID0galF1ZXJ5Lm1iWVRQbGF5ZXIucGxheVByZXY7XG5cdGpRdWVyeS5mbi5ZVFBQbGF5SW5kZXggPSBqUXVlcnkubWJZVFBsYXllci5wbGF5SW5kZXg7XG5cblx0alF1ZXJ5LmZuLllUUE11dGUgPSBqUXVlcnkubWJZVFBsYXllci5tdXRlO1xuXHRqUXVlcnkuZm4uWVRQVW5tdXRlID0galF1ZXJ5Lm1iWVRQbGF5ZXIudW5tdXRlO1xuXHRqUXVlcnkuZm4uWVRQVG9nZ2xlVm9sdW1lID0galF1ZXJ5Lm1iWVRQbGF5ZXIudG9nZ2xlVm9sdW1lO1xuXHRqUXVlcnkuZm4uWVRQU2V0Vm9sdW1lID0galF1ZXJ5Lm1iWVRQbGF5ZXIuc2V0Vm9sdW1lO1xuXG5cdGpRdWVyeS5mbi5ZVFBHZXRWaWRlb0RhdGEgPSBqUXVlcnkubWJZVFBsYXllci5nZXRWaWRlb0RhdGE7XG5cdGpRdWVyeS5mbi5ZVFBGdWxsc2NyZWVuID0galF1ZXJ5Lm1iWVRQbGF5ZXIuZnVsbHNjcmVlbjtcblx0alF1ZXJ5LmZuLllUUFRvZ2dsZUxvb3BzID0galF1ZXJ5Lm1iWVRQbGF5ZXIudG9nZ2xlTG9vcHM7XG5cdGpRdWVyeS5mbi5ZVFBTZXRWaWRlb1F1YWxpdHkgPSBqUXVlcnkubWJZVFBsYXllci5zZXRWaWRlb1F1YWxpdHk7XG5cdGpRdWVyeS5mbi5ZVFBNYW5hZ2VQcm9ncmVzcyA9IGpRdWVyeS5tYllUUGxheWVyLm1hbmFnZVByb2dyZXNzO1xuXG5cdGpRdWVyeS5mbi5ZVFBBcHBseUZpbHRlciA9IGpRdWVyeS5tYllUUGxheWVyLmFwcGx5RmlsdGVyO1xuXHRqUXVlcnkuZm4uWVRQQXBwbHlGaWx0ZXJzID0galF1ZXJ5Lm1iWVRQbGF5ZXIuYXBwbHlGaWx0ZXJzO1xuXHRqUXVlcnkuZm4uWVRQVG9nZ2xlRmlsdGVyID0galF1ZXJ5Lm1iWVRQbGF5ZXIudG9nZ2xlRmlsdGVyO1xuXHRqUXVlcnkuZm4uWVRQVG9nZ2xlRmlsdGVycyA9IGpRdWVyeS5tYllUUGxheWVyLnRvZ2dsZUZpbHRlcnM7XG5cdGpRdWVyeS5mbi5ZVFBSZW1vdmVGaWx0ZXIgPSBqUXVlcnkubWJZVFBsYXllci5yZW1vdmVGaWx0ZXI7XG5cdGpRdWVyeS5mbi5ZVFBEaXNhYmxlRmlsdGVycyA9IGpRdWVyeS5tYllUUGxheWVyLmRpc2FibGVGaWx0ZXJzO1xuXHRqUXVlcnkuZm4uWVRQRW5hYmxlRmlsdGVycyA9IGpRdWVyeS5tYllUUGxheWVyLmVuYWJsZUZpbHRlcnM7XG5cdGpRdWVyeS5mbi5ZVFBHZXRGaWx0ZXJzID0galF1ZXJ5Lm1iWVRQbGF5ZXIuZ2V0RmlsdGVycztcblxuXHRqUXVlcnkuZm4uWVRQR2V0VGltZSA9IGpRdWVyeS5tYllUUGxheWVyLmdldFRpbWU7XG5cdGpRdWVyeS5mbi5ZVFBHZXRUb3RhbFRpbWUgPSBqUXVlcnkubWJZVFBsYXllci5nZXRUb3RhbFRpbWU7XG5cblx0alF1ZXJ5LmZuLllUUEFkZE1hc2sgPSBqUXVlcnkubWJZVFBsYXllci5hZGRNYXNrO1xuXHRqUXVlcnkuZm4uWVRQUmVtb3ZlTWFzayA9IGpRdWVyeS5tYllUUGxheWVyLnJlbW92ZU1hc2s7XG5cdGpRdWVyeS5mbi5ZVFBUb2dnbGVNYXNrID0galF1ZXJ5Lm1iWVRQbGF5ZXIudG9nZ2xlTWFzaztcblxuXHRqUXVlcnkuZm4uWVRQU2V0QW5jaG9yID0galF1ZXJ5Lm1iWVRQbGF5ZXIuc2V0QW5jaG9yO1xuXHRqUXVlcnkuZm4uWVRQR2V0QW5jaG9yID0galF1ZXJ5Lm1iWVRQbGF5ZXIuZ2V0QW5jaG9yO1xuXG5cdC8qKlxuXHQgKlxuXHQgKiBAZGVwcmVjYXRlZFxuXHQgKiB0b2RvOiBBYm92ZSBtZXRob2RzIHdpbGwgYmUgcmVtb3ZlZCB3aXRoIHZlcnNpb24gMy41LjBcblx0ICpcblx0ICoqL1xuXHRqUXVlcnkuZm4ubWJfWVRQbGF5ZXIgPSBqUXVlcnkubWJZVFBsYXllci5idWlsZFBsYXllcjtcblx0alF1ZXJ5LmZuLnBsYXlOZXh0ID0galF1ZXJ5Lm1iWVRQbGF5ZXIucGxheU5leHQ7XG5cdGpRdWVyeS5mbi5wbGF5UHJldiA9IGpRdWVyeS5tYllUUGxheWVyLnBsYXlQcmV2O1xuXHRqUXVlcnkuZm4uY2hhbmdlTW92aWUgPSBqUXVlcnkubWJZVFBsYXllci5jaGFuZ2VNb3ZpZTtcblx0alF1ZXJ5LmZuLmdldFZpZGVvSUQgPSBqUXVlcnkubWJZVFBsYXllci5nZXRWaWRlb0lEO1xuXHRqUXVlcnkuZm4uZ2V0UGxheWVyID0galF1ZXJ5Lm1iWVRQbGF5ZXIuZ2V0UGxheWVyO1xuXHRqUXVlcnkuZm4ucGxheWVyRGVzdHJveSA9IGpRdWVyeS5tYllUUGxheWVyLnBsYXllckRlc3Ryb3k7XG5cdGpRdWVyeS5mbi5mdWxsc2NyZWVuID0galF1ZXJ5Lm1iWVRQbGF5ZXIuZnVsbHNjcmVlbjtcblx0alF1ZXJ5LmZuLmJ1aWxkWVRQQ29udHJvbHMgPSBqUXVlcnkubWJZVFBsYXllci5idWlsZENvbnRyb2xzO1xuXHRqUXVlcnkuZm4ucGxheVlUUCA9IGpRdWVyeS5tYllUUGxheWVyLnBsYXk7XG5cdGpRdWVyeS5mbi50b2dnbGVMb29wcyA9IGpRdWVyeS5tYllUUGxheWVyLnRvZ2dsZUxvb3BzO1xuXHRqUXVlcnkuZm4uc3RvcFlUUCA9IGpRdWVyeS5tYllUUGxheWVyLnN0b3A7XG5cdGpRdWVyeS5mbi5wYXVzZVlUUCA9IGpRdWVyeS5tYllUUGxheWVyLnBhdXNlO1xuXHRqUXVlcnkuZm4uc2Vla1RvWVRQID0galF1ZXJ5Lm1iWVRQbGF5ZXIuc2Vla1RvO1xuXHRqUXVlcnkuZm4ubXV0ZVlUUFZvbHVtZSA9IGpRdWVyeS5tYllUUGxheWVyLm11dGU7XG5cdGpRdWVyeS5mbi51bm11dGVZVFBWb2x1bWUgPSBqUXVlcnkubWJZVFBsYXllci51bm11dGU7XG5cdGpRdWVyeS5mbi5zZXRZVFBWb2x1bWUgPSBqUXVlcnkubWJZVFBsYXllci5zZXRWb2x1bWU7XG5cdGpRdWVyeS5mbi5zZXRWaWRlb1F1YWxpdHkgPSBqUXVlcnkubWJZVFBsYXllci5zZXRWaWRlb1F1YWxpdHk7XG5cdGpRdWVyeS5mbi5tYW5hZ2VZVFBQcm9ncmVzcyA9IGpRdWVyeS5tYllUUGxheWVyLm1hbmFnZVByb2dyZXNzO1xuXHRqUXVlcnkuZm4uWVRQR2V0RGF0YUZyb21GZWVkID0galF1ZXJ5Lm1iWVRQbGF5ZXIuZ2V0VmlkZW9EYXRhO1xuXG5cbn0gKSggalF1ZXJ5LCB5dHAgKTtcblxuLypcbiAqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogIGpxdWVyeS5tYi5jb21wb25lbnRzXG4gKiAgZmlsZToganF1ZXJ5Lm1iLkNTU0FuaW1hdGUubWluLmpzXG4gKlxuICogIENvcHlyaWdodCAoYykgMjAwMS0yMDE0LiBNYXR0ZW8gQmljb2NjaGkgKFB1cHVuemkpO1xuICogIE9wZW4gbGFiIHNybCwgRmlyZW56ZSAtIEl0YWx5XG4gKiAgZW1haWw6IG1hdHRlb0BvcGVuLWxhYi5jb21cbiAqICBzaXRlOiBcdGh0dHA6Ly9wdXB1bnppLmNvbVxuICogIGJsb2c6XHRodHRwOi8vcHVwdW56aS5vcGVuLWxhYi5jb21cbiAqIFx0aHR0cDovL29wZW4tbGFiLmNvbVxuICpcbiAqICBMaWNlbmNlczogTUlULCBHUExcbiAqICBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICogIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbFxuICpcbiAqICBsYXN0IG1vZGlmaWVkOiAyNi8wMy8xNCAyMS40MFxuICogICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKi9cblxuZnVuY3Rpb24gdW5jYW1lbChlKXtyZXR1cm4gZS5yZXBsYWNlKC8oW0EtWl0pL2csZnVuY3Rpb24oZSl7cmV0dXJuXCItXCIrZS50b0xvd2VyQ2FzZSgpO30pO31mdW5jdGlvbiBzZXRVbml0KGUsdCl7cmV0dXJuXCJzdHJpbmdcIiE9dHlwZW9mIGV8fGUubWF0Y2goL15bXFwtMC05XFwuXStqUXVlcnkvKT9cIlwiK2UrdDplO31mdW5jdGlvbiBzZXRGaWx0ZXIoZSx0LHIpe3ZhciBpPXVuY2FtZWwodCksbj1qUXVlcnkuYnJvd3Nlci5tb3ppbGxhP1wiXCI6alF1ZXJ5LkNTUy5zZng7ZVtuK1wiZmlsdGVyXCJdPWVbbitcImZpbHRlclwiXXx8XCJcIixyPXNldFVuaXQocj5qUXVlcnkuQ1NTLmZpbHRlcnNbdF0ubWF4P2pRdWVyeS5DU1MuZmlsdGVyc1t0XS5tYXg6cixqUXVlcnkuQ1NTLmZpbHRlcnNbdF0udW5pdCksZVtuK1wiZmlsdGVyXCJdKz1pK1wiKFwiK3IrXCIpIFwiLGRlbGV0ZSBlW3RdO31qUXVlcnkuc3VwcG9ydC5DU1N0cmFuc2l0aW9uPWZ1bmN0aW9uKCl7dmFyIGU9ZG9jdW1lbnQuYm9keXx8ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LHQ9ZS5zdHlsZTtyZXR1cm4gdm9pZCAwIT09dC50cmFuc2l0aW9ufHx2b2lkIDAhPT10LldlYmtpdFRyYW5zaXRpb258fHZvaWQgMCE9PXQuTW96VHJhbnNpdGlvbnx8dm9pZCAwIT09dC5Nc1RyYW5zaXRpb258fHZvaWQgMCE9PXQuT1RyYW5zaXRpb247fSgpLGpRdWVyeS5DU1M9e25hbWU6XCJtYi5DU1NBbmltYXRlXCIsYXV0aG9yOlwiTWF0dGVvIEJpY29jY2hpXCIsdmVyc2lvbjpcIjIuMC4wXCIsdHJhbnNpdGlvbkVuZDpcInRyYW5zaXRpb25FbmRcIixzZng6XCJcIixmaWx0ZXJzOntibHVyOnttaW46MCxtYXg6MTAwLHVuaXQ6XCJweFwifSxicmlnaHRuZXNzOnttaW46MCxtYXg6NDAwLHVuaXQ6XCIlXCJ9LGNvbnRyYXN0OnttaW46MCxtYXg6NDAwLHVuaXQ6XCIlXCJ9LGdyYXlzY2FsZTp7bWluOjAsbWF4OjEwMCx1bml0OlwiJVwifSxodWVSb3RhdGU6e21pbjowLG1heDozNjAsdW5pdDpcImRlZ1wifSxpbnZlcnQ6e21pbjowLG1heDoxMDAsdW5pdDpcIiVcIn0sc2F0dXJhdGU6e21pbjowLG1heDo0MDAsdW5pdDpcIiVcIn0sc2VwaWE6e21pbjowLG1heDoxMDAsdW5pdDpcIiVcIn19LG5vcm1hbGl6ZUNzczpmdW5jdGlvbihlKXt2YXIgdD1qUXVlcnkuZXh0ZW5kKCEwLHt9LGUpO2pRdWVyeS5icm93c2VyLndlYmtpdHx8alF1ZXJ5LmJyb3dzZXIub3BlcmE/alF1ZXJ5LkNTUy5zZng9XCItd2Via2l0LVwiOmpRdWVyeS5icm93c2VyLm1vemlsbGE/alF1ZXJ5LkNTUy5zZng9XCItbW96LVwiOmpRdWVyeS5icm93c2VyLm1zaWUmJihqUXVlcnkuQ1NTLnNmeD1cIi1tcy1cIik7Zm9yKHZhciByIGluIHQpe1widHJhbnNmb3JtXCI9PT1yJiYodFtqUXVlcnkuQ1NTLnNmeCtcInRyYW5zZm9ybVwiXT10W3JdLGRlbGV0ZSB0W3JdKSxcInRyYW5zZm9ybS1vcmlnaW5cIj09PXImJih0W2pRdWVyeS5DU1Muc2Z4K1widHJhbnNmb3JtLW9yaWdpblwiXT1lW3JdLGRlbGV0ZSB0W3JdKSxcImZpbHRlclwiIT09cnx8alF1ZXJ5LmJyb3dzZXIubW96aWxsYXx8KHRbalF1ZXJ5LkNTUy5zZngrXCJmaWx0ZXJcIl09ZVtyXSxkZWxldGUgdFtyXSksXCJibHVyXCI9PT1yJiZzZXRGaWx0ZXIodCxcImJsdXJcIixlW3JdKSxcImJyaWdodG5lc3NcIj09PXImJnNldEZpbHRlcih0LFwiYnJpZ2h0bmVzc1wiLGVbcl0pLFwiY29udHJhc3RcIj09PXImJnNldEZpbHRlcih0LFwiY29udHJhc3RcIixlW3JdKSxcImdyYXlzY2FsZVwiPT09ciYmc2V0RmlsdGVyKHQsXCJncmF5c2NhbGVcIixlW3JdKSxcImh1ZVJvdGF0ZVwiPT09ciYmc2V0RmlsdGVyKHQsXCJodWVSb3RhdGVcIixlW3JdKSxcImludmVydFwiPT09ciYmc2V0RmlsdGVyKHQsXCJpbnZlcnRcIixlW3JdKSxcInNhdHVyYXRlXCI9PT1yJiZzZXRGaWx0ZXIodCxcInNhdHVyYXRlXCIsZVtyXSksXCJzZXBpYVwiPT09ciYmc2V0RmlsdGVyKHQsXCJzZXBpYVwiLGVbcl0pO3ZhciBpPVwiXCI7XCJ4XCI9PT1yJiYoaT1qUXVlcnkuQ1NTLnNmeCtcInRyYW5zZm9ybVwiLHRbaV09dFtpXXx8XCJcIix0W2ldKz1cIiB0cmFuc2xhdGVYKFwiK3NldFVuaXQoZVtyXSxcInB4XCIpK1wiKVwiLGRlbGV0ZSB0W3JdKSxcInlcIj09PXImJihpPWpRdWVyeS5DU1Muc2Z4K1widHJhbnNmb3JtXCIsdFtpXT10W2ldfHxcIlwiLHRbaV0rPVwiIHRyYW5zbGF0ZVkoXCIrc2V0VW5pdChlW3JdLFwicHhcIikrXCIpXCIsZGVsZXRlIHRbcl0pLFwielwiPT09ciYmKGk9alF1ZXJ5LkNTUy5zZngrXCJ0cmFuc2Zvcm1cIix0W2ldPXRbaV18fFwiXCIsdFtpXSs9XCIgdHJhbnNsYXRlWihcIitzZXRVbml0KGVbcl0sXCJweFwiKStcIilcIixkZWxldGUgdFtyXSksXCJyb3RhdGVcIj09PXImJihpPWpRdWVyeS5DU1Muc2Z4K1widHJhbnNmb3JtXCIsdFtpXT10W2ldfHxcIlwiLHRbaV0rPVwiIHJvdGF0ZShcIitzZXRVbml0KGVbcl0sXCJkZWdcIikrXCIpXCIsZGVsZXRlIHRbcl0pLFwicm90YXRlWFwiPT09ciYmKGk9alF1ZXJ5LkNTUy5zZngrXCJ0cmFuc2Zvcm1cIix0W2ldPXRbaV18fFwiXCIsdFtpXSs9XCIgcm90YXRlWChcIitzZXRVbml0KGVbcl0sXCJkZWdcIikrXCIpXCIsZGVsZXRlIHRbcl0pLFwicm90YXRlWVwiPT09ciYmKGk9alF1ZXJ5LkNTUy5zZngrXCJ0cmFuc2Zvcm1cIix0W2ldPXRbaV18fFwiXCIsdFtpXSs9XCIgcm90YXRlWShcIitzZXRVbml0KGVbcl0sXCJkZWdcIikrXCIpXCIsZGVsZXRlIHRbcl0pLFwicm90YXRlWlwiPT09ciYmKGk9alF1ZXJ5LkNTUy5zZngrXCJ0cmFuc2Zvcm1cIix0W2ldPXRbaV18fFwiXCIsdFtpXSs9XCIgcm90YXRlWihcIitzZXRVbml0KGVbcl0sXCJkZWdcIikrXCIpXCIsZGVsZXRlIHRbcl0pLFwic2NhbGVcIj09PXImJihpPWpRdWVyeS5DU1Muc2Z4K1widHJhbnNmb3JtXCIsdFtpXT10W2ldfHxcIlwiLHRbaV0rPVwiIHNjYWxlKFwiK3NldFVuaXQoZVtyXSxcIlwiKStcIilcIixkZWxldGUgdFtyXSksXCJzY2FsZVhcIj09PXImJihpPWpRdWVyeS5DU1Muc2Z4K1widHJhbnNmb3JtXCIsdFtpXT10W2ldfHxcIlwiLHRbaV0rPVwiIHNjYWxlWChcIitzZXRVbml0KGVbcl0sXCJcIikrXCIpXCIsZGVsZXRlIHRbcl0pLFwic2NhbGVZXCI9PT1yJiYoaT1qUXVlcnkuQ1NTLnNmeCtcInRyYW5zZm9ybVwiLHRbaV09dFtpXXx8XCJcIix0W2ldKz1cIiBzY2FsZVkoXCIrc2V0VW5pdChlW3JdLFwiXCIpK1wiKVwiLGRlbGV0ZSB0W3JdKSxcInNjYWxlWlwiPT09ciYmKGk9alF1ZXJ5LkNTUy5zZngrXCJ0cmFuc2Zvcm1cIix0W2ldPXRbaV18fFwiXCIsdFtpXSs9XCIgc2NhbGVaKFwiK3NldFVuaXQoZVtyXSxcIlwiKStcIilcIixkZWxldGUgdFtyXSksXCJza2V3XCI9PT1yJiYoaT1qUXVlcnkuQ1NTLnNmeCtcInRyYW5zZm9ybVwiLHRbaV09dFtpXXx8XCJcIix0W2ldKz1cIiBza2V3KFwiK3NldFVuaXQoZVtyXSxcImRlZ1wiKStcIilcIixkZWxldGUgdFtyXSksXCJza2V3WFwiPT09ciYmKGk9alF1ZXJ5LkNTUy5zZngrXCJ0cmFuc2Zvcm1cIix0W2ldPXRbaV18fFwiXCIsdFtpXSs9XCIgc2tld1goXCIrc2V0VW5pdChlW3JdLFwiZGVnXCIpK1wiKVwiLGRlbGV0ZSB0W3JdKSxcInNrZXdZXCI9PT1yJiYoaT1qUXVlcnkuQ1NTLnNmeCtcInRyYW5zZm9ybVwiLHRbaV09dFtpXXx8XCJcIix0W2ldKz1cIiBza2V3WShcIitzZXRVbml0KGVbcl0sXCJkZWdcIikrXCIpXCIsZGVsZXRlIHRbcl0pLFwicGVyc3BlY3RpdmVcIj09PXImJihpPWpRdWVyeS5DU1Muc2Z4K1widHJhbnNmb3JtXCIsdFtpXT10W2ldfHxcIlwiLHRbaV0rPVwiIHBlcnNwZWN0aXZlKFwiK3NldFVuaXQoZVtyXSxcInB4XCIpK1wiKVwiLGRlbGV0ZSB0W3JdKTt9cmV0dXJuIHQ7fSxnZXRQcm9wOmZ1bmN0aW9uKGUpe3ZhciB0PVtdO2Zvcih2YXIgciBpbiBlKXQuaW5kZXhPZihyKTwwJiZ0LnB1c2godW5jYW1lbChyKSk7cmV0dXJuIHQuam9pbihcIixcIik7fSxhbmltYXRlOmZ1bmN0aW9uKGUsdCxyLGksbil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2Z1bmN0aW9uIHMoKXt1LmNhbGxlZD0hMCx1LkNTU0FJc1J1bm5pbmc9ITEsYS5vZmYoalF1ZXJ5LkNTUy50cmFuc2l0aW9uRW5kK1wiLlwiK3UuaWQpLGNsZWFyVGltZW91dCh1LnRpbWVvdXQpLGEuY3NzKGpRdWVyeS5DU1Muc2Z4K1widHJhbnNpdGlvblwiLFwiXCIpLFwiZnVuY3Rpb25cIj09dHlwZW9mIG4mJm4uYXBwbHkodSksXCJmdW5jdGlvblwiPT10eXBlb2YgdS5DU1NxdWV1ZSYmKHUuQ1NTcXVldWUoKSx1LkNTU3F1ZXVlPW51bGwpO312YXIgdT10aGlzLGE9alF1ZXJ5KHRoaXMpO3UuaWQ9dS5pZHx8XCJDU1NBX1wiKyhuZXcgRGF0ZSkuZ2V0VGltZSgpO3ZhciBvPW98fHt0eXBlOlwibm9FdmVudFwifTtpZih1LkNTU0FJc1J1bm5pbmcmJnUuZXZlbnRUeXBlPT1vLnR5cGUmJiFqUXVlcnkuYnJvd3Nlci5tc2llJiZqUXVlcnkuYnJvd3Nlci52ZXJzaW9uPD05KXJldHVybiB2b2lkKHUuQ1NTcXVldWU9ZnVuY3Rpb24oKXthLkNTU0FuaW1hdGUoZSx0LHIsaSxuKTt9KTtpZih1LkNTU3F1ZXVlPW51bGwsdS5ldmVudFR5cGU9by50eXBlLDAhPT1hLmxlbmd0aCYmZSl7aWYoZT1qUXVlcnkubm9ybWFsaXplQ3NzKGUpLHUuQ1NTQUlzUnVubmluZz0hMCxcImZ1bmN0aW9uXCI9PXR5cGVvZiB0JiYobj10LHQ9alF1ZXJ5LmZ4LnNwZWVkcy5fZGVmYXVsdCksXCJmdW5jdGlvblwiPT10eXBlb2YgciYmKGk9cixyPTApLFwic3RyaW5nXCI9PXR5cGVvZiByJiYobj1yLHI9MCksXCJmdW5jdGlvblwiPT10eXBlb2YgaSYmKG49aSxpPVwiY3ViaWMtYmV6aWVyKDAuNjUsMC4wMywwLjM2LDAuNzIpXCIpLFwic3RyaW5nXCI9PXR5cGVvZiB0KWZvcih2YXIgZiBpbiBqUXVlcnkuZnguc3BlZWRzKXtpZih0PT1mKXt0PWpRdWVyeS5meC5zcGVlZHNbZl07YnJlYWs7fXQ9alF1ZXJ5LmZ4LnNwZWVkcy5fZGVmYXVsdDt9aWYodHx8KHQ9alF1ZXJ5LmZ4LnNwZWVkcy5fZGVmYXVsdCksXCJzdHJpbmdcIj09dHlwZW9mIG4mJihpPW4sbj1udWxsKSwhalF1ZXJ5LnN1cHBvcnQuQ1NTdHJhbnNpdGlvbil7Zm9yKHZhciBjIGluIGUpe2lmKFwidHJhbnNmb3JtXCI9PT1jJiZkZWxldGUgZVtjXSxcImZpbHRlclwiPT09YyYmZGVsZXRlIGVbY10sXCJ0cmFuc2Zvcm0tb3JpZ2luXCI9PT1jJiZkZWxldGUgZVtjXSxcImF1dG9cIj09PWVbY10mJmRlbGV0ZSBlW2NdLFwieFwiPT09Yyl7dmFyIFM9ZVtjXSxsPVwibGVmdFwiO2VbbF09UyxkZWxldGUgZVtjXTt9aWYoXCJ5XCI9PT1jKXt2YXIgUz1lW2NdLGw9XCJ0b3BcIjtlW2xdPVMsZGVsZXRlIGVbY107fShcIi1tcy10cmFuc2Zvcm1cIj09PWN8fFwiLW1zLWZpbHRlclwiPT09YykmJmRlbGV0ZSBlW2NdO31yZXR1cm4gdm9pZCBhLmRlbGF5KHIpLmFuaW1hdGUoZSx0LG4pO312YXIgeT17XCJkZWZhdWx0XCI6XCJlYXNlXCIsXCJpblwiOlwiZWFzZS1pblwiLG91dDpcImVhc2Utb3V0XCIsXCJpbi1vdXRcIjpcImVhc2UtaW4tb3V0XCIsc25hcDpcImN1YmljLWJlemllcigwLDEsLjUsMSlcIixlYXNlT3V0Q3ViaWM6XCJjdWJpYy1iZXppZXIoLjIxNSwuNjEsLjM1NSwxKVwiLGVhc2VJbk91dEN1YmljOlwiY3ViaWMtYmV6aWVyKC42NDUsLjA0NSwuMzU1LDEpXCIsZWFzZUluQ2lyYzpcImN1YmljLWJlemllciguNiwuMDQsLjk4LC4zMzUpXCIsZWFzZU91dENpcmM6XCJjdWJpYy1iZXppZXIoLjA3NSwuODIsLjE2NSwxKVwiLGVhc2VJbk91dENpcmM6XCJjdWJpYy1iZXppZXIoLjc4NSwuMTM1LC4xNSwuODYpXCIsZWFzZUluRXhwbzpcImN1YmljLWJlemllciguOTUsLjA1LC43OTUsLjAzNSlcIixlYXNlT3V0RXhwbzpcImN1YmljLWJlemllciguMTksMSwuMjIsMSlcIixlYXNlSW5PdXRFeHBvOlwiY3ViaWMtYmV6aWVyKDEsMCwwLDEpXCIsZWFzZUluUXVhZDpcImN1YmljLWJlemllciguNTUsLjA4NSwuNjgsLjUzKVwiLGVhc2VPdXRRdWFkOlwiY3ViaWMtYmV6aWVyKC4yNSwuNDYsLjQ1LC45NClcIixlYXNlSW5PdXRRdWFkOlwiY3ViaWMtYmV6aWVyKC40NTUsLjAzLC41MTUsLjk1NSlcIixlYXNlSW5RdWFydDpcImN1YmljLWJlemllciguODk1LC4wMywuNjg1LC4yMilcIixlYXNlT3V0UXVhcnQ6XCJjdWJpYy1iZXppZXIoLjE2NSwuODQsLjQ0LDEpXCIsZWFzZUluT3V0UXVhcnQ6XCJjdWJpYy1iZXppZXIoLjc3LDAsLjE3NSwxKVwiLGVhc2VJblF1aW50OlwiY3ViaWMtYmV6aWVyKC43NTUsLjA1LC44NTUsLjA2KVwiLGVhc2VPdXRRdWludDpcImN1YmljLWJlemllciguMjMsMSwuMzIsMSlcIixlYXNlSW5PdXRRdWludDpcImN1YmljLWJlemllciguODYsMCwuMDcsMSlcIixlYXNlSW5TaW5lOlwiY3ViaWMtYmV6aWVyKC40NywwLC43NDUsLjcxNSlcIixlYXNlT3V0U2luZTpcImN1YmljLWJlemllciguMzksLjU3NSwuNTY1LDEpXCIsZWFzZUluT3V0U2luZTpcImN1YmljLWJlemllciguNDQ1LC4wNSwuNTUsLjk1KVwiLGVhc2VJbkJhY2s6XCJjdWJpYy1iZXppZXIoLjYsLS4yOCwuNzM1LC4wNDUpXCIsZWFzZU91dEJhY2s6XCJjdWJpYy1iZXppZXIoLjE3NSwgLjg4NSwuMzIsMS4yNzUpXCIsZWFzZUluT3V0QmFjazpcImN1YmljLWJlemllciguNjgsLS41NSwuMjY1LDEuNTUpXCJ9O3lbaV0mJihpPXlbaV0pLGEub2ZmKGpRdWVyeS5DU1MudHJhbnNpdGlvbkVuZCtcIi5cIit1LmlkKTt2YXIgbT1qUXVlcnkuQ1NTLmdldFByb3AoZSksZD17fTtqUXVlcnkuZXh0ZW5kKGQsZSksZFtqUXVlcnkuQ1NTLnNmeCtcInRyYW5zaXRpb24tcHJvcGVydHlcIl09bSxkW2pRdWVyeS5DU1Muc2Z4K1widHJhbnNpdGlvbi1kdXJhdGlvblwiXT10K1wibXNcIixkW2pRdWVyeS5DU1Muc2Z4K1widHJhbnNpdGlvbi1kZWxheVwiXT1yK1wibXNcIixkW2pRdWVyeS5DU1Muc2Z4K1widHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb25cIl09aSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YS5vbmUoalF1ZXJ5LkNTUy50cmFuc2l0aW9uRW5kK1wiLlwiK3UuaWQscyksYS5jc3MoZCk7fSwxKSx1LnRpbWVvdXQ9c2V0VGltZW91dChmdW5jdGlvbigpe3JldHVybiB1LmNhbGxlZHx8IW4/KHUuY2FsbGVkPSExLHZvaWQodS5DU1NBSXNSdW5uaW5nPSExKSk6KGEuY3NzKGpRdWVyeS5DU1Muc2Z4K1widHJhbnNpdGlvblwiLFwiXCIpLG4uYXBwbHkodSksdS5DU1NBSXNSdW5uaW5nPSExLHZvaWQoXCJmdW5jdGlvblwiPT10eXBlb2YgdS5DU1NxdWV1ZSYmKHUuQ1NTcXVldWUoKSx1LkNTU3F1ZXVlPW51bGwpKSk7fSx0K3IrMTApO319KTt9fSxqUXVlcnkuZm4uQ1NTQW5pbWF0ZT1qUXVlcnkuQ1NTLmFuaW1hdGUsalF1ZXJ5Lm5vcm1hbGl6ZUNzcz1qUXVlcnkuQ1NTLm5vcm1hbGl6ZUNzcyxqUXVlcnkuZm4uY3NzMz1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIHQ9alF1ZXJ5KHRoaXMpLHI9alF1ZXJ5Lm5vcm1hbGl6ZUNzcyhlKTt0LmNzcyhyKTt9KTt9O1xuLypfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19cbiBfIGpxdWVyeS5tYi5jb21wb25lbnRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gZmlsZToganF1ZXJ5Lm1iLmJyb3dzZXIubWluLmpzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIGxhc3QgbW9kaWZpZWQ6IDI0LzA1LzE3IDE5LjU2ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gT3BlbiBMYWIgcy5yLmwuLCBGbG9yZW5jZSAtIEl0YWx5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyBlbWFpbDogbWF0dGVvQG9wZW4tbGFiLmNvbSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gc2l0ZTogaHR0cDovL3B1cHVuemkuY29tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgICAgIGh0dHA6Ly9vcGVuLWxhYi5jb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyBibG9nOiBodHRwOi8vcHVwdW56aS5vcGVuLWxhYi5jb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gUSZBOiAgaHR0cDovL2pxdWVyeS5wdXB1bnppLmNvbSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyBMaWNlbmNlczogTUlULCBHUEwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gICAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gQ29weXJpZ2h0IChjKSAyMDAxLTIwMTcuIE1hdHRlbyBCaWNvY2NoaSAoUHVwdW56aSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18qL1xuXG52YXIgbkFndD1uYXZpZ2F0b3IudXNlckFnZW50O2pRdWVyeS5icm93c2VyPWpRdWVyeS5icm93c2VyfHx7fTtqUXVlcnkuYnJvd3Nlci5tb3ppbGxhPSExO2pRdWVyeS5icm93c2VyLndlYmtpdD0hMTtqUXVlcnkuYnJvd3Nlci5vcGVyYT0hMTtqUXVlcnkuYnJvd3Nlci5zYWZhcmk9ITE7alF1ZXJ5LmJyb3dzZXIuY2hyb21lPSExO2pRdWVyeS5icm93c2VyLmFuZHJvaWRTdG9jaz0hMTtqUXVlcnkuYnJvd3Nlci5tc2llPSExO2pRdWVyeS5icm93c2VyLmVkZ2U9ITE7alF1ZXJ5LmJyb3dzZXIudWE9bkFndDtmdW5jdGlvbiBpc1RvdWNoU3VwcG9ydGVkKCl7dmFyIGE9bkFndC5tc01heFRvdWNoUG9pbnRzLGU9XCJvbnRvdWNoc3RhcnRcImluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7cmV0dXJuIGF8fGU/ITA6ITE7fVxudmFyIGdldE9TPWZ1bmN0aW9uKCl7dmFyIGE9e3ZlcnNpb246XCJVbmtub3duIHZlcnNpb25cIixuYW1lOlwiVW5rbm93biBPU1wifTstMSE9bmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZihcIldpblwiKSYmKGEubmFtZT1cIldpbmRvd3NcIik7LTEhPW5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoXCJNYWNcIikmJjA+bmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZihcIk1vYmlsZVwiKSYmKGEubmFtZT1cIk1hY1wiKTstMSE9bmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZihcIkxpbnV4XCIpJiYoYS5uYW1lPVwiTGludXhcIik7L01hYyBPUyBYLy50ZXN0KG5BZ3QpJiYhL01vYmlsZS8udGVzdChuQWd0KSYmKGEudmVyc2lvbj0vTWFjIE9TIFggKDEwW1xcLlxcX1xcZF0rKS8uZXhlYyhuQWd0KVsxXSxhLnZlcnNpb249YS52ZXJzaW9uLnJlcGxhY2UoL18vZyxcIi5cIikuc3Vic3RyaW5nKDAsNSkpOy9XaW5kb3dzLy50ZXN0KG5BZ3QpJiYoYS52ZXJzaW9uPVwiVW5rbm93bi5Vbmtub3duXCIpOy9XaW5kb3dzIE5UIDUuMS8udGVzdChuQWd0KSYmXG4oYS52ZXJzaW9uPVwiNS4xXCIpOy9XaW5kb3dzIE5UIDYuMC8udGVzdChuQWd0KSYmKGEudmVyc2lvbj1cIjYuMFwiKTsvV2luZG93cyBOVCA2LjEvLnRlc3QobkFndCkmJihhLnZlcnNpb249XCI2LjFcIik7L1dpbmRvd3MgTlQgNi4yLy50ZXN0KG5BZ3QpJiYoYS52ZXJzaW9uPVwiNi4yXCIpOy9XaW5kb3dzIE5UIDEwLjAvLnRlc3QobkFndCkmJihhLnZlcnNpb249XCIxMC4wXCIpOy9MaW51eC8udGVzdChuQWd0KSYmL0xpbnV4Ly50ZXN0KG5BZ3QpJiYoYS52ZXJzaW9uPVwiVW5rbm93bi5Vbmtub3duXCIpO2EubmFtZT1hLm5hbWUudG9Mb3dlckNhc2UoKTthLm1ham9yX3ZlcnNpb249XCJVbmtub3duXCI7YS5taW5vcl92ZXJzaW9uPVwiVW5rbm93blwiO1wiVW5rbm93bi5Vbmtub3duXCIhPWEudmVyc2lvbiYmKGEubWFqb3JfdmVyc2lvbj1wYXJzZUZsb2F0KGEudmVyc2lvbi5zcGxpdChcIi5cIilbMF0pLGEubWlub3JfdmVyc2lvbj1wYXJzZUZsb2F0KGEudmVyc2lvbi5zcGxpdChcIi5cIilbMV0pKTtyZXR1cm4gYTt9O1xualF1ZXJ5LmJyb3dzZXIub3M9Z2V0T1MoKTtqUXVlcnkuYnJvd3Nlci5oYXNUb3VjaD1pc1RvdWNoU3VwcG9ydGVkKCk7alF1ZXJ5LmJyb3dzZXIubmFtZT1uYXZpZ2F0b3IuYXBwTmFtZTtqUXVlcnkuYnJvd3Nlci5mdWxsVmVyc2lvbj1cIlwiK3BhcnNlRmxvYXQobmF2aWdhdG9yLmFwcFZlcnNpb24pO2pRdWVyeS5icm93c2VyLm1ham9yVmVyc2lvbj1wYXJzZUludChuYXZpZ2F0b3IuYXBwVmVyc2lvbiwxMCk7dmFyIG5hbWVPZmZzZXQsdmVyT2Zmc2V0LGl4O1xuaWYoLTEhPSh2ZXJPZmZzZXQ9bkFndC5pbmRleE9mKFwiT3BlcmFcIikpKWpRdWVyeS5icm93c2VyLm9wZXJhPSEwLGpRdWVyeS5icm93c2VyLm5hbWU9XCJPcGVyYVwiLGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPW5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCs2KSwtMSE9KHZlck9mZnNldD1uQWd0LmluZGV4T2YoXCJWZXJzaW9uXCIpKSYmKGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPW5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCs4KSk7ZWxzZSBpZigtMSE9KHZlck9mZnNldD1uQWd0LmluZGV4T2YoXCJPUFJcIikpKWpRdWVyeS5icm93c2VyLm9wZXJhPSEwLGpRdWVyeS5icm93c2VyLm5hbWU9XCJPcGVyYVwiLGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPW5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCs0KTtlbHNlIGlmKC0xIT0odmVyT2Zmc2V0PW5BZ3QuaW5kZXhPZihcIk1TSUVcIikpKWpRdWVyeS5icm93c2VyLm1zaWU9ITAsalF1ZXJ5LmJyb3dzZXIubmFtZT1cIk1pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlclwiLFxuXHRcdGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPW5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCs1KTtlbHNlIGlmKC0xIT1uQWd0LmluZGV4T2YoXCJUcmlkZW50XCIpKXtqUXVlcnkuYnJvd3Nlci5tc2llPSEwO2pRdWVyeS5icm93c2VyLm5hbWU9XCJNaWNyb3NvZnQgSW50ZXJuZXQgRXhwbG9yZXJcIjt2YXIgc3RhcnQ9bkFndC5pbmRleE9mKFwicnY6XCIpKzMsZW5kPXN0YXJ0KzQ7alF1ZXJ5LmJyb3dzZXIuZnVsbFZlcnNpb249bkFndC5zdWJzdHJpbmcoc3RhcnQsZW5kKTt9ZWxzZS0xIT0odmVyT2Zmc2V0PW5BZ3QuaW5kZXhPZihcIkVkZ2VcIikpPyhqUXVlcnkuYnJvd3Nlci5lZGdlPSEwLGpRdWVyeS5icm93c2VyLm5hbWU9XCJNaWNyb3NvZnQgRWRnZVwiLGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPW5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCs1KSk6LTEhPSh2ZXJPZmZzZXQ9bkFndC5pbmRleE9mKFwiQ2hyb21lXCIpKT8oalF1ZXJ5LmJyb3dzZXIud2Via2l0PSEwLGpRdWVyeS5icm93c2VyLmNocm9tZT1cblx0XHQhMCxqUXVlcnkuYnJvd3Nlci5uYW1lPVwiQ2hyb21lXCIsalF1ZXJ5LmJyb3dzZXIuZnVsbFZlcnNpb249bkFndC5zdWJzdHJpbmcodmVyT2Zmc2V0KzcpKTotMTxuQWd0LmluZGV4T2YoXCJtb3ppbGxhLzUuMFwiKSYmLTE8bkFndC5pbmRleE9mKFwiYW5kcm9pZCBcIikmJi0xPG5BZ3QuaW5kZXhPZihcImFwcGxld2Via2l0XCIpJiYhKC0xPG5BZ3QuaW5kZXhPZihcImNocm9tZVwiKSk/KHZlck9mZnNldD1uQWd0LmluZGV4T2YoXCJDaHJvbWVcIiksalF1ZXJ5LmJyb3dzZXIud2Via2l0PSEwLGpRdWVyeS5icm93c2VyLmFuZHJvaWRTdG9jaz0hMCxqUXVlcnkuYnJvd3Nlci5uYW1lPVwiYW5kcm9pZFN0b2NrXCIsalF1ZXJ5LmJyb3dzZXIuZnVsbFZlcnNpb249bkFndC5zdWJzdHJpbmcodmVyT2Zmc2V0KzcpKTotMSE9KHZlck9mZnNldD1uQWd0LmluZGV4T2YoXCJTYWZhcmlcIikpPyhqUXVlcnkuYnJvd3Nlci53ZWJraXQ9ITAsalF1ZXJ5LmJyb3dzZXIuc2FmYXJpPSEwLGpRdWVyeS5icm93c2VyLm5hbWU9XG5cdFx0XCJTYWZhcmlcIixqUXVlcnkuYnJvd3Nlci5mdWxsVmVyc2lvbj1uQWd0LnN1YnN0cmluZyh2ZXJPZmZzZXQrNyksLTEhPSh2ZXJPZmZzZXQ9bkFndC5pbmRleE9mKFwiVmVyc2lvblwiKSkmJihqUXVlcnkuYnJvd3Nlci5mdWxsVmVyc2lvbj1uQWd0LnN1YnN0cmluZyh2ZXJPZmZzZXQrOCkpKTotMSE9KHZlck9mZnNldD1uQWd0LmluZGV4T2YoXCJBcHBsZVdlYmtpdFwiKSk/KGpRdWVyeS5icm93c2VyLndlYmtpdD0hMCxqUXVlcnkuYnJvd3Nlci5zYWZhcmk9ITAsalF1ZXJ5LmJyb3dzZXIubmFtZT1cIlNhZmFyaVwiLGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPW5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCs3KSwtMSE9KHZlck9mZnNldD1uQWd0LmluZGV4T2YoXCJWZXJzaW9uXCIpKSYmKGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPW5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCs4KSkpOi0xIT0odmVyT2Zmc2V0PW5BZ3QuaW5kZXhPZihcIkZpcmVmb3hcIikpPyhqUXVlcnkuYnJvd3Nlci5tb3ppbGxhPVxuXHRcdCEwLGpRdWVyeS5icm93c2VyLm5hbWU9XCJGaXJlZm94XCIsalF1ZXJ5LmJyb3dzZXIuZnVsbFZlcnNpb249bkFndC5zdWJzdHJpbmcodmVyT2Zmc2V0KzgpKToobmFtZU9mZnNldD1uQWd0Lmxhc3RJbmRleE9mKFwiIFwiKSsxKTwodmVyT2Zmc2V0PW5BZ3QubGFzdEluZGV4T2YoXCIvXCIpKSYmKGpRdWVyeS5icm93c2VyLm5hbWU9bkFndC5zdWJzdHJpbmcobmFtZU9mZnNldCx2ZXJPZmZzZXQpLGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPW5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCsxKSxqUXVlcnkuYnJvd3Nlci5uYW1lLnRvTG93ZXJDYXNlKCk9PWpRdWVyeS5icm93c2VyLm5hbWUudG9VcHBlckNhc2UoKSYmKGpRdWVyeS5icm93c2VyLm5hbWU9bmF2aWdhdG9yLmFwcE5hbWUpKTtcbi0xIT0oaXg9alF1ZXJ5LmJyb3dzZXIuZnVsbFZlcnNpb24uaW5kZXhPZihcIjtcIikpJiYoalF1ZXJ5LmJyb3dzZXIuZnVsbFZlcnNpb249alF1ZXJ5LmJyb3dzZXIuZnVsbFZlcnNpb24uc3Vic3RyaW5nKDAsaXgpKTstMSE9KGl4PWpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uLmluZGV4T2YoXCIgXCIpKSYmKGpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uPWpRdWVyeS5icm93c2VyLmZ1bGxWZXJzaW9uLnN1YnN0cmluZygwLGl4KSk7alF1ZXJ5LmJyb3dzZXIubWFqb3JWZXJzaW9uPXBhcnNlSW50KFwiXCIralF1ZXJ5LmJyb3dzZXIuZnVsbFZlcnNpb24sMTApO2lzTmFOKGpRdWVyeS5icm93c2VyLm1ham9yVmVyc2lvbikmJihqUXVlcnkuYnJvd3Nlci5mdWxsVmVyc2lvbj1cIlwiK3BhcnNlRmxvYXQobmF2aWdhdG9yLmFwcFZlcnNpb24pLGpRdWVyeS5icm93c2VyLm1ham9yVmVyc2lvbj1wYXJzZUludChuYXZpZ2F0b3IuYXBwVmVyc2lvbiwxMCkpO1xualF1ZXJ5LmJyb3dzZXIudmVyc2lvbj1qUXVlcnkuYnJvd3Nlci5tYWpvclZlcnNpb247alF1ZXJ5LmJyb3dzZXIuYW5kcm9pZD0vQW5kcm9pZC9pLnRlc3QobkFndCk7alF1ZXJ5LmJyb3dzZXIuYmxhY2tiZXJyeT0vQmxhY2tCZXJyeXxCQnxQbGF5Qm9vay9pLnRlc3QobkFndCk7alF1ZXJ5LmJyb3dzZXIuaW9zPS9pUGhvbmV8aVBhZHxpUG9kfHdlYk9TL2kudGVzdChuQWd0KTtqUXVlcnkuYnJvd3Nlci5vcGVyYU1vYmlsZT0vT3BlcmEgTWluaS9pLnRlc3QobkFndCk7alF1ZXJ5LmJyb3dzZXIud2luZG93c01vYmlsZT0vSUVNb2JpbGV8V2luZG93cyBQaG9uZS9pLnRlc3QobkFndCk7alF1ZXJ5LmJyb3dzZXIua2luZGxlPS9LaW5kbGV8U2lsay9pLnRlc3QobkFndCk7XG5qUXVlcnkuYnJvd3Nlci5tb2JpbGU9alF1ZXJ5LmJyb3dzZXIuYW5kcm9pZHx8alF1ZXJ5LmJyb3dzZXIuYmxhY2tiZXJyeXx8alF1ZXJ5LmJyb3dzZXIuaW9zfHxqUXVlcnkuYnJvd3Nlci53aW5kb3dzTW9iaWxlfHxqUXVlcnkuYnJvd3Nlci5vcGVyYU1vYmlsZXx8alF1ZXJ5LmJyb3dzZXIua2luZGxlO2pRdWVyeS5pc01vYmlsZT1qUXVlcnkuYnJvd3Nlci5tb2JpbGU7alF1ZXJ5LmlzVGFibGV0PWpRdWVyeS5icm93c2VyLm1vYmlsZSYmNzY1PGpRdWVyeSh3aW5kb3cpLndpZHRoKCk7alF1ZXJ5LmlzQW5kcm9pZERlZmF1bHQ9alF1ZXJ5LmJyb3dzZXIuYW5kcm9pZCYmIS9jaHJvbWUvaS50ZXN0KG5BZ3QpO2pRdWVyeS5tYkJyb3dzZXI9alF1ZXJ5LmJyb3dzZXI7XG5qUXVlcnkuYnJvd3Nlci52ZXJzaW9uQ29tcGFyZT1mdW5jdGlvbihhLGUpe2lmKFwic3RyaW5nc3RyaW5nXCIhPXR5cGVvZiBhK3R5cGVvZiBlKXJldHVybiExO2Zvcih2YXIgYz1hLnNwbGl0KFwiLlwiKSxkPWUuc3BsaXQoXCIuXCIpLGI9MCxmPU1hdGgubWF4KGMubGVuZ3RoLGQubGVuZ3RoKTtiPGY7YisrKXtpZihjW2JdJiYhZFtiXSYmMDxwYXJzZUludChjW2JdKXx8cGFyc2VJbnQoY1tiXSk+cGFyc2VJbnQoZFtiXSkpcmV0dXJuIDE7aWYoZFtiXSYmIWNbYl0mJjA8cGFyc2VJbnQoZFtiXSl8fHBhcnNlSW50KGNbYl0pPHBhcnNlSW50KGRbYl0pKXJldHVybi0xO31yZXR1cm4gMDt9O1xuLypfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19cbiBfIGpxdWVyeS5tYi5jb21wb25lbnRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gZmlsZToganF1ZXJ5Lm1iLnNpbXBsZVNsaWRlci5taW4uanMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIGxhc3QgbW9kaWZpZWQ6IDA5LzA1LzE3IDE5LjMxICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gT3BlbiBMYWIgcy5yLmwuLCBGbG9yZW5jZSAtIEl0YWx5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyBlbWFpbDogbWF0dGVvQG9wZW4tbGFiLmNvbSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gc2l0ZTogaHR0cDovL3B1cHVuemkuY29tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgICAgIGh0dHA6Ly9vcGVuLWxhYi5jb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyBibG9nOiBodHRwOi8vcHVwdW56aS5vcGVuLWxhYi5jb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gUSZBOiAgaHR0cDovL2pxdWVyeS5wdXB1bnppLmNvbSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyBMaWNlbmNlczogTUlULCBHUEwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gICAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gQ29weXJpZ2h0IChjKSAyMDAxLTIwMTcuIE1hdHRlbyBCaWNvY2NoaSAoUHVwdW56aSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18qL1xuXG4oZnVuY3Rpb24oYil7Yi5zaW1wbGVTbGlkZXI9e2RlZmF1bHRzOntpbml0aWFsdmFsOjAsc2NhbGU6MTAwLG9yaWVudGF0aW9uOlwiaFwiLHJlYWRvbmx5OiExLGNhbGxiYWNrOiExfSxldmVudHM6e3N0YXJ0OmIuYnJvd3Nlci5tb2JpbGU/XCJ0b3VjaHN0YXJ0XCI6XCJtb3VzZWRvd25cIixlbmQ6Yi5icm93c2VyLm1vYmlsZT9cInRvdWNoZW5kXCI6XCJtb3VzZXVwXCIsbW92ZTpiLmJyb3dzZXIubW9iaWxlP1widG91Y2htb3ZlXCI6XCJtb3VzZW1vdmVcIn0saW5pdDpmdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGE9dGhpcyxkPWIoYSk7ZC5hZGRDbGFzcyhcInNpbXBsZVNsaWRlclwiKTthLm9wdD17fTtiLmV4dGVuZChhLm9wdCxiLnNpbXBsZVNsaWRlci5kZWZhdWx0cyxjKTtiLmV4dGVuZChhLm9wdCxkLmRhdGEoKSk7dmFyIGU9XCJoXCI9PWEub3B0Lm9yaWVudGF0aW9uP1wiaG9yaXpvbnRhbFwiOlwidmVydGljYWxcIixlPWIoXCI8ZGl2Lz5cIikuYWRkQ2xhc3MoXCJsZXZlbFwiKS5hZGRDbGFzcyhlKTtcblx0ZC5wcmVwZW5kKGUpO2EubGV2ZWw9ZTtkLmNzcyh7Y3Vyc29yOlwiZGVmYXVsdFwifSk7XCJhdXRvXCI9PWEub3B0LnNjYWxlJiYoYS5vcHQuc2NhbGU9YihhKS5vdXRlcldpZHRoKCkpO2QudXBkYXRlU2xpZGVyVmFsKCk7YS5vcHQucmVhZG9ubHl8fChkLm9uKGIuc2ltcGxlU2xpZGVyLmV2ZW50cy5zdGFydCxmdW5jdGlvbihjKXtiLmJyb3dzZXIubW9iaWxlJiYoYz1jLmNoYW5nZWRUb3VjaGVzWzBdKTthLmNhblNsaWRlPSEwO2QudXBkYXRlU2xpZGVyVmFsKGMpO1wiaFwiPT1hLm9wdC5vcmllbnRhdGlvbj9kLmNzcyh7Y3Vyc29yOlwiY29sLXJlc2l6ZVwifSk6ZC5jc3Moe2N1cnNvcjpcInJvdy1yZXNpemVcIn0pO2MucHJldmVudERlZmF1bHQoKTtjLnN0b3BQcm9wYWdhdGlvbigpO30pLGIoZG9jdW1lbnQpLm9uKGIuc2ltcGxlU2xpZGVyLmV2ZW50cy5tb3ZlLGZ1bmN0aW9uKGMpe2IuYnJvd3Nlci5tb2JpbGUmJihjPWMuY2hhbmdlZFRvdWNoZXNbMF0pO2EuY2FuU2xpZGUmJihiKGRvY3VtZW50KS5jc3Moe2N1cnNvcjpcImRlZmF1bHRcIn0pLFxuXHRcdFx0ZC51cGRhdGVTbGlkZXJWYWwoYyksYy5wcmV2ZW50RGVmYXVsdCgpLGMuc3RvcFByb3BhZ2F0aW9uKCkpO30pLm9uKGIuc2ltcGxlU2xpZGVyLmV2ZW50cy5lbmQsZnVuY3Rpb24oKXtiKGRvY3VtZW50KS5jc3Moe2N1cnNvcjpcImF1dG9cIn0pO2EuY2FuU2xpZGU9ITE7ZC5jc3Moe2N1cnNvcjpcImF1dG9cIn0pO30pKTt9KTt9LHVwZGF0ZVNsaWRlclZhbDpmdW5jdGlvbihjKXt2YXIgYT10aGlzLmdldCgwKTtpZihhLm9wdCl7YS5vcHQuaW5pdGlhbHZhbD1cIm51bWJlclwiPT10eXBlb2YgYS5vcHQuaW5pdGlhbHZhbD9hLm9wdC5pbml0aWFsdmFsOmEub3B0LmluaXRpYWx2YWwoYSk7dmFyIGQ9YihhKS5vdXRlcldpZHRoKCksZT1iKGEpLm91dGVySGVpZ2h0KCk7YS54PVwib2JqZWN0XCI9PXR5cGVvZiBjP2MuY2xpZW50WCtkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQtdGhpcy5vZmZzZXQoKS5sZWZ0OlwibnVtYmVyXCI9PXR5cGVvZiBjP2MqZC9hLm9wdC5zY2FsZTphLm9wdC5pbml0aWFsdmFsKmQvYS5vcHQuc2NhbGU7XG5cdGEueT1cIm9iamVjdFwiPT10eXBlb2YgYz9jLmNsaWVudFkrZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AtdGhpcy5vZmZzZXQoKS50b3A6XCJudW1iZXJcIj09dHlwZW9mIGM/KGEub3B0LnNjYWxlLWEub3B0LmluaXRpYWx2YWwtYykqZS9hLm9wdC5zY2FsZTphLm9wdC5pbml0aWFsdmFsKmUvYS5vcHQuc2NhbGU7YS55PXRoaXMub3V0ZXJIZWlnaHQoKS1hLnk7YS5zY2FsZVg9YS54KmEub3B0LnNjYWxlL2Q7YS5zY2FsZVk9YS55KmEub3B0LnNjYWxlL2U7YS5vdXRPZlJhbmdlWD1hLnNjYWxlWD5hLm9wdC5zY2FsZT9hLnNjYWxlWC1hLm9wdC5zY2FsZTowPmEuc2NhbGVYP2Euc2NhbGVYOjA7YS5vdXRPZlJhbmdlWT1hLnNjYWxlWT5hLm9wdC5zY2FsZT9hLnNjYWxlWS1hLm9wdC5zY2FsZTowPmEuc2NhbGVZP2Euc2NhbGVZOjA7YS5vdXRPZlJhbmdlPVwiaFwiPT1hLm9wdC5vcmllbnRhdGlvbj9hLm91dE9mUmFuZ2VYOmEub3V0T2ZSYW5nZVk7YS52YWx1ZT1cInVuZGVmaW5lZFwiIT10eXBlb2YgYz9cblx0XHRcdFx0XHRcImhcIj09YS5vcHQub3JpZW50YXRpb24/YS54Pj10aGlzLm91dGVyV2lkdGgoKT9hLm9wdC5zY2FsZTowPj1hLng/MDphLnNjYWxlWDphLnk+PXRoaXMub3V0ZXJIZWlnaHQoKT9hLm9wdC5zY2FsZTowPj1hLnk/MDphLnNjYWxlWTpcImhcIj09YS5vcHQub3JpZW50YXRpb24/YS5zY2FsZVg6YS5zY2FsZVk7XCJoXCI9PWEub3B0Lm9yaWVudGF0aW9uP2EubGV2ZWwud2lkdGgoTWF0aC5mbG9vcigxMDAqYS54L2QpK1wiJVwiKTphLmxldmVsLmhlaWdodChNYXRoLmZsb29yKDEwMCphLnkvZSkpO1wiZnVuY3Rpb25cIj09dHlwZW9mIGEub3B0LmNhbGxiYWNrJiZhLm9wdC5jYWxsYmFjayhhKTt9fX07Yi5mbi5zaW1wbGVTbGlkZXI9Yi5zaW1wbGVTbGlkZXIuaW5pdDtiLmZuLnVwZGF0ZVNsaWRlclZhbD1iLnNpbXBsZVNsaWRlci51cGRhdGVTbGlkZXJWYWw7fSkoalF1ZXJ5KTtcbi8qX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXG4gXyBqcXVlcnkubWIuY29tcG9uZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIGZpbGU6IGpxdWVyeS5tYi5zdG9yYWdlLm1pbi5qcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyBsYXN0IG1vZGlmaWVkOiAyNC8wNS8xNSAxNi4wOCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIE9wZW4gTGFiIHMuci5sLiwgRmxvcmVuY2UgLSBJdGFseSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gZW1haWw6IG1hdHRlb0BvcGVuLWxhYi5jb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIHNpdGU6IGh0dHA6Ly9wdXB1bnppLmNvbSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICBodHRwOi8vb3Blbi1sYWIuY29tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gYmxvZzogaHR0cDovL3B1cHVuemkub3Blbi1sYWIuY29tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIFEmQTogIGh0dHA6Ly9qcXVlcnkucHVwdW56aS5jb20gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gTGljZW5jZXM6IE1JVCwgR1BMICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfICAgIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gXyAgICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLmh0bWwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1xuIF8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9cbiBfIENvcHlyaWdodCAoYykgMjAwMS0yMDE1LiBNYXR0ZW8gQmljb2NjaGkgKFB1cHVuemkpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXG4gX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fKi9cblxuKGZ1bmN0aW9uKGQpe2QubWJDb29raWU9e3NldDpmdW5jdGlvbihhLGMsZixiKXtcIm9iamVjdFwiPT10eXBlb2YgYyYmKGM9SlNPTi5zdHJpbmdpZnkoYykpO2I9Yj9cIjsgZG9tYWluPVwiK2I6XCJcIjt2YXIgZT1uZXcgRGF0ZSxkPVwiXCI7MDxmJiYoZS5zZXRUaW1lKGUuZ2V0VGltZSgpKzg2NEU1KmYpLGQ9XCI7IGV4cGlyZXM9XCIrZS50b0dNVFN0cmluZygpKTtkb2N1bWVudC5jb29raWU9YStcIj1cIitjK2QrXCI7IHBhdGg9L1wiK2I7fSxnZXQ6ZnVuY3Rpb24oYSl7YSs9XCI9XCI7Zm9yKHZhciBjPWRvY3VtZW50LmNvb2tpZS5zcGxpdChcIjtcIiksZD0wO2Q8Yy5sZW5ndGg7ZCsrKXtmb3IodmFyIGI9Y1tkXTtcIiBcIj09Yi5jaGFyQXQoMCk7KWI9Yi5zdWJzdHJpbmcoMSxiLmxlbmd0aCk7aWYoMD09Yi5pbmRleE9mKGEpKXRyeXtyZXR1cm4gSlNPTi5wYXJzZShiLnN1YnN0cmluZyhhLmxlbmd0aCxiLmxlbmd0aCkpO31jYXRjaChlKXtyZXR1cm4gYi5zdWJzdHJpbmcoYS5sZW5ndGgsYi5sZW5ndGgpO319cmV0dXJuIG51bGw7fSxcblx0cmVtb3ZlOmZ1bmN0aW9uKGEpe2QubWJDb29raWUuc2V0KGEsXCJcIiwtMSk7fX07ZC5tYlN0b3JhZ2U9e3NldDpmdW5jdGlvbihhLGMpe1wib2JqZWN0XCI9PXR5cGVvZiBjJiYoYz1KU09OLnN0cmluZ2lmeShjKSk7bG9jYWxTdG9yYWdlLnNldEl0ZW0oYSxjKTt9LGdldDpmdW5jdGlvbihhKXtpZihsb2NhbFN0b3JhZ2VbYV0pdHJ5e3JldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZVthXSk7fWNhdGNoKGMpe3JldHVybiBsb2NhbFN0b3JhZ2VbYV07fWVsc2UgcmV0dXJuIG51bGw7fSxyZW1vdmU6ZnVuY3Rpb24oYSl7YT9sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShhKTpsb2NhbFN0b3JhZ2UuY2xlYXIoKTt9fTt9KShqUXVlcnkpO1xuIiwiLyohIFN3aXBlYm94IHYxLjQuNCB8IENvbnN0YW50aW4gU2FndWluIGNzYWcuY28gfCBNSVQgTGljZW5zZSB8IGdpdGh1Yi5jb20vYnJ1dGFsZGVzaWduL3N3aXBlYm94ICovXG5cbiggZnVuY3Rpb24gKCB3aW5kb3csIGRvY3VtZW50LCAkLCB1bmRlZmluZWQgKSB7XG5cblx0JC5zd2lwZWJveCA9IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zICkge1xuXG5cdFx0Ly8gRGVmYXVsdCBvcHRpb25zXG5cdFx0dmFyIHVpLFxuXHRcdFx0ZGVmYXVsdHMgPSB7XG5cdFx0XHRcdHVzZUNTUyA6IHRydWUsXG5cdFx0XHRcdHVzZVNWRyA6IHRydWUsXG5cdFx0XHRcdGluaXRpYWxJbmRleE9uQXJyYXkgOiAwLFxuXHRcdFx0XHRyZW1vdmVCYXJzT25Nb2JpbGUgOiB0cnVlLFxuXHRcdFx0XHRoaWRlQ2xvc2VCdXR0b25Pbk1vYmlsZSA6IGZhbHNlLFxuXHRcdFx0XHRoaWRlQmFyc0RlbGF5IDogMzAwMCxcblx0XHRcdFx0dmlkZW9NYXhXaWR0aCA6IDExNDAsXG5cdFx0XHRcdHZpbWVvQ29sb3IgOiAnY2NjY2NjJyxcblx0XHRcdFx0YmVmb3JlT3BlbjogbnVsbCxcblx0XHRcdFx0YWZ0ZXJPcGVuOiBudWxsLFxuXHRcdFx0XHRhZnRlckNsb3NlOiBudWxsLFxuXHRcdFx0XHRhZnRlck1lZGlhOiBudWxsLFxuXHRcdFx0XHRuZXh0U2xpZGU6IG51bGwsXG5cdFx0XHRcdHByZXZTbGlkZTogbnVsbCxcblx0XHRcdFx0bG9vcEF0RW5kOiBmYWxzZSxcblx0XHRcdFx0YXV0b3BsYXlWaWRlb3M6IGZhbHNlLFxuXHRcdFx0XHRxdWVyeVN0cmluZ0RhdGE6IHt9LFxuXHRcdFx0XHR0b2dnbGVDbGFzc09uTG9hZDogJydcblx0XHRcdH0sXG5cblx0XHRcdHBsdWdpbiA9IHRoaXMsXG5cdFx0XHRlbGVtZW50cyA9IFtdLCAvLyBzbGlkZXMgYXJyYXkgWyB7IGhyZWY6Jy4uLicsIHRpdGxlOicuLi4nIH0sIC4uLl0sXG5cdFx0XHQkZWxlbSxcblx0XHRcdHNlbGVjdG9yID0gZWxlbS5zZWxlY3Rvcixcblx0XHRcdGlzTW9iaWxlID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCggLyhpUGFkKXwoaVBob25lKXwoaVBvZCl8KEFuZHJvaWQpfChQbGF5Qm9vayl8KEJCMTApfChCbGFja0JlcnJ5KXwoT3BlcmEgTWluaSl8KElFTW9iaWxlKXwod2ViT1MpfChNZWVHbykvaSApLFxuXHRcdFx0aXNUb3VjaCA9IGlzTW9iaWxlICE9PSBudWxsIHx8IGRvY3VtZW50LmNyZWF0ZVRvdWNoICE9PSB1bmRlZmluZWQgfHwgKCAnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cgKSB8fCAoICdvbm1zZ2VzdHVyZWNoYW5nZScgaW4gd2luZG93ICkgfHwgbmF2aWdhdG9yLm1zTWF4VG91Y2hQb2ludHMsXG5cdFx0XHRzdXBwb3J0U1ZHID0gISEgZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TICYmICEhIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyggJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpLmNyZWF0ZVNWR1JlY3QsXG5cdFx0XHR3aW5XaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoID8gd2luZG93LmlubmVyV2lkdGggOiAkKCB3aW5kb3cgKS53aWR0aCgpLFxuXHRcdFx0d2luSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0ID8gd2luZG93LmlubmVySGVpZ2h0IDogJCggd2luZG93ICkuaGVpZ2h0KCksXG5cdFx0XHRjdXJyZW50WCA9IDAsXG5cdFx0XHQvKiBqc2hpbnQgbXVsdGlzdHI6IHRydWUgKi9cblx0XHRcdGh0bWwgPSAnPGRpdiBpZD1cInN3aXBlYm94LW92ZXJsYXlcIj5cXFxuXHRcdFx0XHRcdDxkaXYgaWQ9XCJzd2lwZWJveC1jb250YWluZXJcIj5cXFxuXHRcdFx0XHRcdFx0PGRpdiBpZD1cInN3aXBlYm94LXNsaWRlclwiPjwvZGl2PlxcXG5cdFx0XHRcdFx0XHQ8ZGl2IGlkPVwic3dpcGVib3gtdG9wLWJhclwiPlxcXG5cdFx0XHRcdFx0XHRcdDxkaXYgaWQ9XCJzd2lwZWJveC10aXRsZVwiPjwvZGl2PlxcXG5cdFx0XHRcdFx0XHQ8L2Rpdj5cXFxuXHRcdFx0XHRcdFx0PGRpdiBpZD1cInN3aXBlYm94LWJvdHRvbS1iYXJcIj5cXFxuXHRcdFx0XHRcdFx0XHQ8ZGl2IGlkPVwic3dpcGVib3gtYXJyb3dzXCI+XFxcblx0XHRcdFx0XHRcdFx0XHQ8YSBpZD1cInN3aXBlYm94LXByZXZcIj48L2E+XFxcblx0XHRcdFx0XHRcdFx0XHQ8YSBpZD1cInN3aXBlYm94LW5leHRcIj48L2E+XFxcblx0XHRcdFx0XHRcdFx0PC9kaXY+XFxcblx0XHRcdFx0XHRcdDwvZGl2PlxcXG5cdFx0XHRcdFx0XHQ8YSBpZD1cInN3aXBlYm94LWNsb3NlXCI+PC9hPlxcXG5cdFx0XHRcdFx0PC9kaXY+XFxcblx0XHRcdDwvZGl2Pic7XG5cblx0XHRwbHVnaW4uc2V0dGluZ3MgPSB7fTtcblxuXHRcdCQuc3dpcGVib3guY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHR1aS5jbG9zZVNsaWRlKCk7XG5cdFx0fTtcblxuXHRcdCQuc3dpcGVib3guZXh0ZW5kID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIHVpO1xuXHRcdH07XG5cblx0XHRwbHVnaW4uaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRwbHVnaW4uc2V0dGluZ3MgPSAkLmV4dGVuZCgge30sIGRlZmF1bHRzLCBvcHRpb25zICk7XG5cblx0XHRcdGlmICggJC5pc0FycmF5KCBlbGVtICkgKSB7XG5cblx0XHRcdFx0ZWxlbWVudHMgPSBlbGVtO1xuXHRcdFx0XHR1aS50YXJnZXQgPSAkKCB3aW5kb3cgKTtcblx0XHRcdFx0dWkuaW5pdCggcGx1Z2luLnNldHRpbmdzLmluaXRpYWxJbmRleE9uQXJyYXkgKTtcblxuXHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHQkKCBkb2N1bWVudCApLm9uKCAnY2xpY2snLCBzZWxlY3RvciwgZnVuY3Rpb24oIGV2ZW50ICkge1xuXG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coIGlzVG91Y2ggKTtcblxuXHRcdFx0XHRcdGlmICggZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NOYW1lID09PSAnc2xpZGUgY3VycmVudCcgKSB7XG5cblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoICEgJC5pc0FycmF5KCBlbGVtICkgKSB7XG5cdFx0XHRcdFx0XHR1aS5kZXN0cm95KCk7XG5cdFx0XHRcdFx0XHQkZWxlbSA9ICQoIHNlbGVjdG9yICk7XG5cdFx0XHRcdFx0XHR1aS5hY3Rpb25zKCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZWxlbWVudHMgPSBbXTtcblx0XHRcdFx0XHR2YXIgaW5kZXgsIHJlbFR5cGUsIHJlbFZhbDtcblxuXHRcdFx0XHRcdC8vIEFsbG93IGZvciBIVE1MNSBjb21wbGlhbnQgYXR0cmlidXRlIGJlZm9yZSBsZWdhY3kgdXNlIG9mIHJlbFxuXHRcdFx0XHRcdGlmICggISByZWxWYWwgKSB7XG5cdFx0XHRcdFx0XHRyZWxUeXBlID0gJ2RhdGEtcmVsJztcblx0XHRcdFx0XHRcdHJlbFZhbCA9ICQoIHRoaXMgKS5hdHRyKCByZWxUeXBlICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCAhIHJlbFZhbCApIHtcblx0XHRcdFx0XHRcdHJlbFR5cGUgPSAncmVsJztcblx0XHRcdFx0XHRcdHJlbFZhbCA9ICQoIHRoaXMgKS5hdHRyKCByZWxUeXBlICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCByZWxWYWwgJiYgcmVsVmFsICE9PSAnJyAmJiByZWxWYWwgIT09ICdub2ZvbGxvdycgKSB7XG5cdFx0XHRcdFx0XHQkZWxlbSA9ICQoIHNlbGVjdG9yICkuZmlsdGVyKCAnWycgKyByZWxUeXBlICsgJz1cIicgKyByZWxWYWwgKyAnXCJdJyApO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQkZWxlbSA9ICQoIHNlbGVjdG9yICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0JGVsZW0uZWFjaCggZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0XHRcdHZhciB0aXRsZSA9IG51bGwsXG5cdFx0XHRcdFx0XHRcdGhyZWYgPSBudWxsO1xuXG5cdFx0XHRcdFx0XHRpZiAoICQoIHRoaXMgKS5hdHRyKCAndGl0bGUnICkgKSB7XG5cdFx0XHRcdFx0XHRcdHRpdGxlID0gJCggdGhpcyApLmF0dHIoICd0aXRsZScgKTtcblx0XHRcdFx0XHRcdH1cblxuXG5cdFx0XHRcdFx0XHRpZiAoICQoIHRoaXMgKS5hdHRyKCAnaHJlZicgKSApIHtcblx0XHRcdFx0XHRcdFx0aHJlZiA9ICQoIHRoaXMgKS5hdHRyKCAnaHJlZicgKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0ZWxlbWVudHMucHVzaCgge1xuXHRcdFx0XHRcdFx0XHRocmVmOiBocmVmLFxuXHRcdFx0XHRcdFx0XHR0aXRsZTogdGl0bGVcblx0XHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0XHRpbmRleCA9ICRlbGVtLmluZGV4KCAkKCB0aGlzICkgKTtcblx0XHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHVpLnRhcmdldCA9ICQoIGV2ZW50LnRhcmdldCApO1xuXHRcdFx0XHRcdHVpLmluaXQoIGluZGV4ICk7XG5cdFx0XHRcdH0gKTtcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0dWkgPSB7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogSW5pdGlhdGUgU3dpcGVib3hcblx0XHRcdCAqL1xuXHRcdFx0aW5pdCA6IGZ1bmN0aW9uKCBpbmRleCApIHtcblx0XHRcdFx0aWYgKCBwbHVnaW4uc2V0dGluZ3MuYmVmb3JlT3BlbiApIHtcblx0XHRcdFx0XHRwbHVnaW4uc2V0dGluZ3MuYmVmb3JlT3BlbigpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoaXMudGFyZ2V0LnRyaWdnZXIoICdzd2lwZWJveC1zdGFydCcgKTtcblx0XHRcdFx0JC5zd2lwZWJveC5pc09wZW4gPSB0cnVlO1xuXHRcdFx0XHR0aGlzLmJ1aWxkKCk7XG5cdFx0XHRcdHRoaXMub3BlblNsaWRlKCBpbmRleCApO1xuXHRcdFx0XHR0aGlzLm9wZW5NZWRpYSggaW5kZXggKTtcblx0XHRcdFx0dGhpcy5wcmVsb2FkTWVkaWEoIGluZGV4KzEgKTtcblx0XHRcdFx0dGhpcy5wcmVsb2FkTWVkaWEoIGluZGV4LTEgKTtcblx0XHRcdFx0aWYgKCBwbHVnaW4uc2V0dGluZ3MuYWZ0ZXJPcGVuICkge1xuXHRcdFx0XHRcdHBsdWdpbi5zZXR0aW5ncy5hZnRlck9wZW4oaW5kZXgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIEJ1aWx0IEhUTUwgY29udGFpbmVycyBhbmQgZmlyZSBtYWluIGZ1bmN0aW9uc1xuXHRcdFx0ICovXG5cdFx0XHRidWlsZCA6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0dmFyICR0aGlzID0gdGhpcywgYmc7XG5cblx0XHRcdFx0JCggJ2JvZHknICkuYXBwZW5kKCBodG1sICk7XG5cblx0XHRcdFx0aWYgKCBzdXBwb3J0U1ZHICYmIHBsdWdpbi5zZXR0aW5ncy51c2VTVkcgPT09IHRydWUgKSB7XG5cdFx0XHRcdFx0YmcgPSAkKCAnI3N3aXBlYm94LWNsb3NlJyApLmNzcyggJ2JhY2tncm91bmQtaW1hZ2UnICk7XG5cdFx0XHRcdFx0YmcgPSBiZy5yZXBsYWNlKCAncG5nJywgJ3N2ZycgKTtcblx0XHRcdFx0XHQkKCAnI3N3aXBlYm94LXByZXYsICNzd2lwZWJveC1uZXh0LCAjc3dpcGVib3gtY2xvc2UnICkuY3NzKCB7XG5cdFx0XHRcdFx0XHQnYmFja2dyb3VuZC1pbWFnZScgOiBiZ1xuXHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggaXNNb2JpbGUgJiYgcGx1Z2luLnNldHRpbmdzLnJlbW92ZUJhcnNPbk1vYmlsZSApIHtcblx0XHRcdFx0XHQkKCAnI3N3aXBlYm94LWJvdHRvbS1iYXIsICNzd2lwZWJveC10b3AtYmFyJyApLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0JC5lYWNoKCBlbGVtZW50cywgIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtc2xpZGVyJyApLmFwcGVuZCggJzxkaXYgY2xhc3M9XCJzbGlkZVwiPjwvZGl2PicgKTtcblx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdCR0aGlzLnNldERpbSgpO1xuXHRcdFx0XHQkdGhpcy5hY3Rpb25zKCk7XG5cblx0XHRcdFx0aWYgKCBpc1RvdWNoICkge1xuXHRcdFx0XHRcdCR0aGlzLmdlc3R1cmUoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIERldmljZXMgY2FuIGhhdmUgYm90aCB0b3VjaCBhbmQga2V5Ym9hcmQgaW5wdXQgc28gYWx3YXlzIGFsbG93IGtleSBldmVudHNcblx0XHRcdFx0JHRoaXMua2V5Ym9hcmQoKTtcblxuXHRcdFx0XHQkdGhpcy5hbmltQmFycygpO1xuXHRcdFx0XHQkdGhpcy5yZXNpemUoKTtcblxuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBTZXQgZGltZW5zaW9ucyBkZXBlbmRpbmcgb24gd2luZG93cyB3aWR0aCBhbmQgaGVpZ2h0XG5cdFx0XHQgKi9cblx0XHRcdHNldERpbSA6IGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHR2YXIgd2lkdGgsIGhlaWdodCwgc2xpZGVyQ3NzID0ge307XG5cblx0XHRcdFx0Ly8gUmVzZXQgZGltZW5zaW9ucyBvbiBtb2JpbGUgb3JpZW50YXRpb24gY2hhbmdlXG5cdFx0XHRcdGlmICggJ29ub3JpZW50YXRpb25jaGFuZ2UnIGluIHdpbmRvdyApIHtcblxuXHRcdFx0XHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAnb3JpZW50YXRpb25jaGFuZ2UnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGlmICggd2luZG93Lm9yaWVudGF0aW9uID09PSAwICkge1xuXHRcdFx0XHRcdFx0XHR3aWR0aCA9IHdpbldpZHRoO1xuXHRcdFx0XHRcdFx0XHRoZWlnaHQgPSB3aW5IZWlnaHQ7XG5cdFx0XHRcdFx0XHR9IGVsc2UgaWYgKCB3aW5kb3cub3JpZW50YXRpb24gPT09IDkwIHx8IHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gLTkwICkge1xuXHRcdFx0XHRcdFx0XHR3aWR0aCA9IHdpbkhlaWdodDtcblx0XHRcdFx0XHRcdFx0aGVpZ2h0ID0gd2luV2lkdGg7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSwgZmFsc2UgKTtcblxuXG5cdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHR3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoID8gd2luZG93LmlubmVyV2lkdGggOiAkKCB3aW5kb3cgKS53aWR0aCgpO1xuXHRcdFx0XHRcdGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCA/IHdpbmRvdy5pbm5lckhlaWdodCA6ICQoIHdpbmRvdyApLmhlaWdodCgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2xpZGVyQ3NzID0ge1xuXHRcdFx0XHRcdHdpZHRoIDogd2lkdGgsXG5cdFx0XHRcdFx0aGVpZ2h0IDogaGVpZ2h0XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0JCggJyNzd2lwZWJveC1vdmVybGF5JyApLmNzcyggc2xpZGVyQ3NzICk7XG5cblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogUmVzZXQgZGltZW5zaW9ucyBvbiB3aW5kb3cgcmVzaXplIGVudmVudFxuXHRcdFx0ICovXG5cdFx0XHRyZXNpemUgOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciAkdGhpcyA9IHRoaXM7XG5cblx0XHRcdFx0JCggd2luZG93ICkucmVzaXplKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkdGhpcy5zZXREaW0oKTtcblx0XHRcdFx0fSApLnJlc2l6ZSgpO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBDaGVjayBpZiBkZXZpY2Ugc3VwcG9ydHMgQ1NTIHRyYW5zaXRpb25zXG5cdFx0XHQgKi9cblx0XHRcdHN1cHBvcnRUcmFuc2l0aW9uIDogZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdHZhciBwcmVmaXhlcyA9ICd0cmFuc2l0aW9uIFdlYmtpdFRyYW5zaXRpb24gTW96VHJhbnNpdGlvbiBPVHJhbnNpdGlvbiBtc1RyYW5zaXRpb24gS2h0bWxUcmFuc2l0aW9uJy5zcGxpdCggJyAnICksXG5cdFx0XHRcdFx0aTtcblxuXHRcdFx0XHRmb3IgKCBpID0gMDsgaSA8IHByZWZpeGVzLmxlbmd0aDsgaSsrICkge1xuXHRcdFx0XHRcdGlmICggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKS5zdHlsZVsgcHJlZml4ZXNbaV0gXSAhPT0gdW5kZWZpbmVkICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHByZWZpeGVzW2ldO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIENoZWNrIGlmIENTUyB0cmFuc2l0aW9ucyBhcmUgYWxsb3dlZCAob3B0aW9ucyArIGRldmljZXN1cHBvcnQpXG5cdFx0XHQgKi9cblx0XHRcdGRvQ3NzVHJhbnMgOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlmICggcGx1Z2luLnNldHRpbmdzLnVzZUNTUyAmJiB0aGlzLnN1cHBvcnRUcmFuc2l0aW9uKCkgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogVG91Y2ggbmF2aWdhdGlvblxuXHRcdFx0ICovXG5cdFx0XHRnZXN0dXJlIDogZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdHZhciAkdGhpcyA9IHRoaXMsXG5cdFx0XHRcdFx0aW5kZXgsXG5cdFx0XHRcdFx0aERpc3RhbmNlLFxuXHRcdFx0XHRcdHZEaXN0YW5jZSxcblx0XHRcdFx0XHRoRGlzdGFuY2VMYXN0LFxuXHRcdFx0XHRcdHZEaXN0YW5jZUxhc3QsXG5cdFx0XHRcdFx0aERpc3RhbmNlUGVyY2VudCxcblx0XHRcdFx0XHR2U3dpcGUgPSBmYWxzZSxcblx0XHRcdFx0XHRoU3dpcGUgPSBmYWxzZSxcblx0XHRcdFx0XHRoU3dpcE1pbkRpc3RhbmNlID0gMTAsXG5cdFx0XHRcdFx0dlN3aXBNaW5EaXN0YW5jZSA9IDUwLFxuXHRcdFx0XHRcdHN0YXJ0Q29vcmRzID0ge30sXG5cdFx0XHRcdFx0ZW5kQ29vcmRzID0ge30sXG5cdFx0XHRcdFx0YmFycyA9ICQoICcjc3dpcGVib3gtdG9wLWJhciwgI3N3aXBlYm94LWJvdHRvbS1iYXInICksXG5cdFx0XHRcdFx0c2xpZGVyID0gJCggJyNzd2lwZWJveC1zbGlkZXInICk7XG5cblx0XHRcdFx0YmFycy5hZGRDbGFzcyggJ3Zpc2libGUtYmFycycgKTtcblx0XHRcdFx0JHRoaXMuc2V0VGltZW91dCgpO1xuXG5cdFx0XHRcdCQoICdib2R5JyApLmJpbmQoICd0b3VjaHN0YXJ0JywgZnVuY3Rpb24oIGV2ZW50ICkge1xuXG5cdFx0XHRcdFx0JCggdGhpcyApLmFkZENsYXNzKCAndG91Y2hpbmcnICk7XG5cdFx0XHRcdFx0aW5kZXggPSAkKCAnI3N3aXBlYm94LXNsaWRlciAuc2xpZGUnICkuaW5kZXgoICQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZS5jdXJyZW50JyApICk7XG5cdFx0XHRcdFx0ZW5kQ29vcmRzID0gZXZlbnQub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzWzBdO1xuXHRcdFx0XHRcdHN0YXJ0Q29vcmRzLnBhZ2VYID0gZXZlbnQub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzWzBdLnBhZ2VYO1xuXHRcdFx0XHRcdHN0YXJ0Q29vcmRzLnBhZ2VZID0gZXZlbnQub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzWzBdLnBhZ2VZO1xuXG5cdFx0XHRcdFx0JCggJyNzd2lwZWJveC1zbGlkZXInICkuY3NzKCB7XG5cdFx0XHRcdFx0XHQnLXdlYmtpdC10cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZTNkKCcgKyBjdXJyZW50WCArJyUsIDAsIDApJyxcblx0XHRcdFx0XHRcdCd0cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZTNkKCcgKyBjdXJyZW50WCArICclLCAwLCAwKSdcblx0XHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0XHQkKCAnLnRvdWNoaW5nJyApLmJpbmQoICd0b3VjaG1vdmUnLGZ1bmN0aW9uKCBldmVudCApIHtcblx0XHRcdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdGVuZENvb3JkcyA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQudGFyZ2V0VG91Y2hlc1swXTtcblxuXHRcdFx0XHRcdFx0aWYgKCAhIGhTd2lwZSApIHtcblx0XHRcdFx0XHRcdFx0dkRpc3RhbmNlTGFzdCA9IHZEaXN0YW5jZTtcblx0XHRcdFx0XHRcdFx0dkRpc3RhbmNlID0gZW5kQ29vcmRzLnBhZ2VZIC0gc3RhcnRDb29yZHMucGFnZVk7XG5cdFx0XHRcdFx0XHRcdGlmICggTWF0aC5hYnMoIHZEaXN0YW5jZSApID49IHZTd2lwTWluRGlzdGFuY2UgfHwgdlN3aXBlICkge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBvcGFjaXR5ID0gMC43NSAtIE1hdGguYWJzKHZEaXN0YW5jZSkgLyBzbGlkZXIuaGVpZ2h0KCk7XG5cblx0XHRcdFx0XHRcdFx0XHRzbGlkZXIuY3NzKCB7ICd0b3AnOiB2RGlzdGFuY2UgKyAncHgnIH0gKTtcblx0XHRcdFx0XHRcdFx0XHRzbGlkZXIuY3NzKCB7ICdvcGFjaXR5Jzogb3BhY2l0eSB9ICk7XG5cblx0XHRcdFx0XHRcdFx0XHR2U3dpcGUgPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGhEaXN0YW5jZUxhc3QgPSBoRGlzdGFuY2U7XG5cdFx0XHRcdFx0XHRoRGlzdGFuY2UgPSBlbmRDb29yZHMucGFnZVggLSBzdGFydENvb3Jkcy5wYWdlWDtcblx0XHRcdFx0XHRcdGhEaXN0YW5jZVBlcmNlbnQgPSBoRGlzdGFuY2UgKiAxMDAgLyB3aW5XaWR0aDtcblxuXHRcdFx0XHRcdFx0aWYgKCAhIGhTd2lwZSAmJiAhIHZTd2lwZSAmJiBNYXRoLmFicyggaERpc3RhbmNlICkgPj0gaFN3aXBNaW5EaXN0YW5jZSApIHtcblx0XHRcdFx0XHRcdFx0JCggJyNzd2lwZWJveC1zbGlkZXInICkuY3NzKCB7XG5cdFx0XHRcdFx0XHRcdFx0Jy13ZWJraXQtdHJhbnNpdGlvbicgOiAnJyxcblx0XHRcdFx0XHRcdFx0XHQndHJhbnNpdGlvbicgOiAnJ1xuXHRcdFx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0XHRcdGhTd2lwZSA9IHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICggaFN3aXBlICkge1xuXG5cdFx0XHRcdFx0XHRcdC8vIHN3aXBlIGxlZnRcblx0XHRcdFx0XHRcdFx0aWYgKCAwIDwgaERpc3RhbmNlICkge1xuXG5cdFx0XHRcdFx0XHRcdFx0Ly8gZmlyc3Qgc2xpZGVcblx0XHRcdFx0XHRcdFx0XHRpZiAoIDAgPT09IGluZGV4ICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coICdmaXJzdCcgKTtcblx0XHRcdFx0XHRcdFx0XHRcdCQoICcjc3dpcGVib3gtb3ZlcmxheScgKS5hZGRDbGFzcyggJ2xlZnRTcHJpbmdUb3VjaCcgKTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gRm9sbG93IGdlc3R1cmVcblx0XHRcdFx0XHRcdFx0XHRcdCQoICcjc3dpcGVib3gtb3ZlcmxheScgKS5yZW1vdmVDbGFzcyggJ2xlZnRTcHJpbmdUb3VjaCcgKS5yZW1vdmVDbGFzcyggJ3JpZ2h0U3ByaW5nVG91Y2gnICk7XG5cdFx0XHRcdFx0XHRcdFx0XHQkKCAnI3N3aXBlYm94LXNsaWRlcicgKS5jc3MoIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0Jy13ZWJraXQtdHJhbnNmb3JtJyA6ICd0cmFuc2xhdGUzZCgnICsgKCBjdXJyZW50WCArIGhEaXN0YW5jZVBlcmNlbnQgKSArJyUsIDAsIDApJyxcblx0XHRcdFx0XHRcdFx0XHRcdFx0J3RyYW5zZm9ybScgOiAndHJhbnNsYXRlM2QoJyArICggY3VycmVudFggKyBoRGlzdGFuY2VQZXJjZW50ICkgKyAnJSwgMCwgMCknXG5cdFx0XHRcdFx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdC8vIHN3aXBlIHJ1Z2h0XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoIDAgPiBoRGlzdGFuY2UgKSB7XG5cblx0XHRcdFx0XHRcdFx0XHQvLyBsYXN0IFNsaWRlXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCBlbGVtZW50cy5sZW5ndGggPT09IGluZGV4ICsxICkge1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coICdsYXN0JyApO1xuXHRcdFx0XHRcdFx0XHRcdFx0JCggJyNzd2lwZWJveC1vdmVybGF5JyApLmFkZENsYXNzKCAncmlnaHRTcHJpbmdUb3VjaCcgKTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0JCggJyNzd2lwZWJveC1vdmVybGF5JyApLnJlbW92ZUNsYXNzKCAnbGVmdFNwcmluZ1RvdWNoJyApLnJlbW92ZUNsYXNzKCAncmlnaHRTcHJpbmdUb3VjaCcgKTtcblx0XHRcdFx0XHRcdFx0XHRcdCQoICcjc3dpcGVib3gtc2xpZGVyJyApLmNzcygge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQnLXdlYmtpdC10cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZTNkKCcgKyAoIGN1cnJlbnRYICsgaERpc3RhbmNlUGVyY2VudCApICsnJSwgMCwgMCknLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHQndHJhbnNmb3JtJyA6ICd0cmFuc2xhdGUzZCgnICsgKCBjdXJyZW50WCArIGhEaXN0YW5jZVBlcmNlbnQgKSArICclLCAwLCAwKSdcblx0XHRcdFx0XHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gKTtcblxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblxuXHRcdFx0XHR9ICkuYmluZCggJ3RvdWNoZW5kJyxmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0XHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtc2xpZGVyJyApLmNzcygge1xuXHRcdFx0XHRcdFx0Jy13ZWJraXQtdHJhbnNpdGlvbicgOiAnLXdlYmtpdC10cmFuc2Zvcm0gMC40cyBlYXNlJyxcblx0XHRcdFx0XHRcdCd0cmFuc2l0aW9uJyA6ICd0cmFuc2Zvcm0gMC40cyBlYXNlJ1xuXHRcdFx0XHRcdH0gKTtcblxuXHRcdFx0XHRcdHZEaXN0YW5jZSA9IGVuZENvb3Jkcy5wYWdlWSAtIHN0YXJ0Q29vcmRzLnBhZ2VZO1xuXHRcdFx0XHRcdGhEaXN0YW5jZSA9IGVuZENvb3Jkcy5wYWdlWCAtIHN0YXJ0Q29vcmRzLnBhZ2VYO1xuXHRcdFx0XHRcdGhEaXN0YW5jZVBlcmNlbnQgPSBoRGlzdGFuY2UqMTAwL3dpbldpZHRoO1xuXG5cdFx0XHRcdFx0Ly8gU3dpcGUgdG8gYm90dG9tIHRvIGNsb3NlXG5cdFx0XHRcdFx0aWYgKCB2U3dpcGUgKSB7XG5cdFx0XHRcdFx0XHR2U3dpcGUgPSBmYWxzZTtcblx0XHRcdFx0XHRcdGlmICggTWF0aC5hYnMoIHZEaXN0YW5jZSApID49IDIgKiB2U3dpcE1pbkRpc3RhbmNlICYmIE1hdGguYWJzKCB2RGlzdGFuY2UgKSA+IE1hdGguYWJzKCB2RGlzdGFuY2VMYXN0ICkgKSB7XG5cdFx0XHRcdFx0XHRcdHZhciB2T2Zmc2V0ID0gdkRpc3RhbmNlID4gMCA/IHNsaWRlci5oZWlnaHQoKSA6IC0gc2xpZGVyLmhlaWdodCgpO1xuXHRcdFx0XHRcdFx0XHRzbGlkZXIuYW5pbWF0ZSggeyB0b3A6IHZPZmZzZXQgKyAncHgnLCAnb3BhY2l0eSc6IDAgfSxcblx0XHRcdFx0XHRcdFx0XHQzMDAsXG5cdFx0XHRcdFx0XHRcdFx0ZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0JHRoaXMuY2xvc2VTbGlkZSgpO1xuXHRcdFx0XHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHNsaWRlci5hbmltYXRlKCB7IHRvcDogMCwgJ29wYWNpdHknOiAxIH0sIDMwMCApO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0fSBlbHNlIGlmICggaFN3aXBlICkge1xuXG5cdFx0XHRcdFx0XHRoU3dpcGUgPSBmYWxzZTtcblxuXHRcdFx0XHRcdFx0Ly8gc3dpcGVMZWZ0XG5cdFx0XHRcdFx0XHRpZiggaERpc3RhbmNlID49IGhTd2lwTWluRGlzdGFuY2UgJiYgaERpc3RhbmNlID49IGhEaXN0YW5jZUxhc3QpIHtcblxuXHRcdFx0XHRcdFx0XHQkdGhpcy5nZXRQcmV2KCk7XG5cblx0XHRcdFx0XHRcdC8vIHN3aXBlUmlnaHRcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoIGhEaXN0YW5jZSA8PSAtaFN3aXBNaW5EaXN0YW5jZSAmJiBoRGlzdGFuY2UgPD0gaERpc3RhbmNlTGFzdCkge1xuXG5cdFx0XHRcdFx0XHRcdCR0aGlzLmdldE5leHQoKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdH0gZWxzZSB7IC8vIFRvcCBhbmQgYm90dG9tIGJhcnMgaGF2ZSBiZWVuIHJlbW92ZWQgb24gdG91Y2hhYmxlIGRldmljZXNcblx0XHRcdFx0XHRcdC8vIHRhcFxuXHRcdFx0XHRcdFx0aWYgKCAhIGJhcnMuaGFzQ2xhc3MoICd2aXNpYmxlLWJhcnMnICkgKSB7XG5cdFx0XHRcdFx0XHRcdCR0aGlzLnNob3dCYXJzKCk7XG5cdFx0XHRcdFx0XHRcdCR0aGlzLnNldFRpbWVvdXQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdCR0aGlzLmNsZWFyVGltZW91dCgpO1xuXHRcdFx0XHRcdFx0XHQkdGhpcy5oaWRlQmFycygpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtc2xpZGVyJyApLmNzcygge1xuXHRcdFx0XHRcdFx0Jy13ZWJraXQtdHJhbnNmb3JtJyA6ICd0cmFuc2xhdGUzZCgnICsgY3VycmVudFggKyAnJSwgMCwgMCknLFxuXHRcdFx0XHRcdFx0J3RyYW5zZm9ybScgOiAndHJhbnNsYXRlM2QoJyArIGN1cnJlbnRYICsgJyUsIDAsIDApJ1xuXHRcdFx0XHRcdH0gKTtcblxuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtb3ZlcmxheScgKS5yZW1vdmVDbGFzcyggJ2xlZnRTcHJpbmdUb3VjaCcgKS5yZW1vdmVDbGFzcyggJ3JpZ2h0U3ByaW5nVG91Y2gnICk7XG5cdFx0XHRcdFx0JCggJy50b3VjaGluZycgKS5vZmYoICd0b3VjaG1vdmUnICkucmVtb3ZlQ2xhc3MoICd0b3VjaGluZycgKTtcblxuXHRcdFx0XHR9ICk7XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFNldCB0aW1lciB0byBoaWRlIHRoZSBhY3Rpb24gYmFyc1xuXHRcdFx0ICovXG5cdFx0XHRzZXRUaW1lb3V0OiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlmICggcGx1Z2luLnNldHRpbmdzLmhpZGVCYXJzRGVsYXkgPiAwICkge1xuXHRcdFx0XHRcdHZhciAkdGhpcyA9IHRoaXM7XG5cdFx0XHRcdFx0JHRoaXMuY2xlYXJUaW1lb3V0KCk7XG5cdFx0XHRcdFx0JHRoaXMudGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0JHRoaXMuaGlkZUJhcnMoKTtcblx0XHRcdFx0XHRcdH0sXG5cblx0XHRcdFx0XHRcdHBsdWdpbi5zZXR0aW5ncy5oaWRlQmFyc0RlbGF5XG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBDbGVhciB0aW1lclxuXHRcdFx0ICovXG5cdFx0XHRjbGVhclRpbWVvdXQ6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0d2luZG93LmNsZWFyVGltZW91dCggdGhpcy50aW1lb3V0ICk7XG5cdFx0XHRcdHRoaXMudGltZW91dCA9IG51bGw7XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFNob3cgbmF2aWdhdGlvbiBhbmQgdGl0bGUgYmFyc1xuXHRcdFx0ICovXG5cdFx0XHRzaG93QmFycyA6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0dmFyIGJhcnMgPSAkKCAnI3N3aXBlYm94LXRvcC1iYXIsICNzd2lwZWJveC1ib3R0b20tYmFyJyApO1xuXHRcdFx0XHRpZiAoIHRoaXMuZG9Dc3NUcmFucygpICkge1xuXHRcdFx0XHRcdGJhcnMuYWRkQ2xhc3MoICd2aXNpYmxlLWJhcnMnICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JCggJyNzd2lwZWJveC10b3AtYmFyJyApLmFuaW1hdGUoIHsgdG9wIDogMCB9LCA1MDAgKTtcblx0XHRcdFx0XHQkKCAnI3N3aXBlYm94LWJvdHRvbS1iYXInICkuYW5pbWF0ZSggeyBib3R0b20gOiAwIH0sIDUwMCApO1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0YmFycy5hZGRDbGFzcyggJ3Zpc2libGUtYmFycycgKTtcblx0XHRcdFx0XHR9LCAxMDAwICk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogSGlkZSBuYXZpZ2F0aW9uIGFuZCB0aXRsZSBiYXJzXG5cdFx0XHQgKi9cblx0XHRcdGhpZGVCYXJzIDogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR2YXIgYmFycyA9ICQoICcjc3dpcGVib3gtdG9wLWJhciwgI3N3aXBlYm94LWJvdHRvbS1iYXInICk7XG5cdFx0XHRcdGlmICggdGhpcy5kb0Nzc1RyYW5zKCkgKSB7XG5cdFx0XHRcdFx0YmFycy5yZW1vdmVDbGFzcyggJ3Zpc2libGUtYmFycycgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkKCAnI3N3aXBlYm94LXRvcC1iYXInICkuYW5pbWF0ZSggeyB0b3AgOiAnLTUwcHgnIH0sIDUwMCApO1xuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtYm90dG9tLWJhcicgKS5hbmltYXRlKCB7IGJvdHRvbSA6ICctNTBweCcgfSwgNTAwICk7XG5cdFx0XHRcdFx0c2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRiYXJzLnJlbW92ZUNsYXNzKCAndmlzaWJsZS1iYXJzJyApO1xuXHRcdFx0XHRcdH0sIDEwMDAgKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBBbmltYXRlIG5hdmlnYXRpb24gYW5kIHRvcCBiYXJzXG5cdFx0XHQgKi9cblx0XHRcdGFuaW1CYXJzIDogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR2YXIgJHRoaXMgPSB0aGlzLFxuXHRcdFx0XHRcdGJhcnMgPSAkKCAnI3N3aXBlYm94LXRvcC1iYXIsICNzd2lwZWJveC1ib3R0b20tYmFyJyApO1xuXG5cdFx0XHRcdGJhcnMuYWRkQ2xhc3MoICd2aXNpYmxlLWJhcnMnICk7XG5cdFx0XHRcdCR0aGlzLnNldFRpbWVvdXQoKTtcblxuXHRcdFx0XHQkKCAnI3N3aXBlYm94LXNsaWRlcicgKS5jbGljayggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0aWYgKCAhIGJhcnMuaGFzQ2xhc3MoICd2aXNpYmxlLWJhcnMnICkgKSB7XG5cdFx0XHRcdFx0XHQkdGhpcy5zaG93QmFycygpO1xuXHRcdFx0XHRcdFx0JHRoaXMuc2V0VGltZW91dCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdCQoICcjc3dpcGVib3gtYm90dG9tLWJhcicgKS5ob3ZlciggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0JHRoaXMuc2hvd0JhcnMoKTtcblx0XHRcdFx0XHRiYXJzLmFkZENsYXNzKCAndmlzaWJsZS1iYXJzJyApO1xuXHRcdFx0XHRcdCR0aGlzLmNsZWFyVGltZW91dCgpO1xuXG5cdFx0XHRcdH0sIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlmICggcGx1Z2luLnNldHRpbmdzLmhpZGVCYXJzRGVsYXkgPiAwICkge1xuXHRcdFx0XHRcdFx0YmFycy5yZW1vdmVDbGFzcyggJ3Zpc2libGUtYmFycycgKTtcblx0XHRcdFx0XHRcdCR0aGlzLnNldFRpbWVvdXQoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSApO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBLZXlib2FyZCBuYXZpZ2F0aW9uXG5cdFx0XHQgKi9cblx0XHRcdGtleWJvYXJkIDogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR2YXIgJHRoaXMgPSB0aGlzO1xuXHRcdFx0XHQkKCB3aW5kb3cgKS5iaW5kKCAna2V5dXAnLCBmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0XHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuXHRcdFx0XHRcdGlmICggZXZlbnQua2V5Q29kZSA9PT0gMzcgKSB7XG5cblx0XHRcdFx0XHRcdCR0aGlzLmdldFByZXYoKTtcblxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoIGV2ZW50LmtleUNvZGUgPT09IDM5ICkge1xuXG5cdFx0XHRcdFx0XHQkdGhpcy5nZXROZXh0KCk7XG5cblx0XHRcdFx0XHR9IGVsc2UgaWYgKCBldmVudC5rZXlDb2RlID09PSAyNyApIHtcblxuXHRcdFx0XHRcdFx0JHRoaXMuY2xvc2VTbGlkZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSApO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBOYXZpZ2F0aW9uIGV2ZW50cyA6IGdvIHRvIG5leHQgc2xpZGUsIGdvIHRvIHByZXZvdXMgc2xpZGUgYW5kIGNsb3NlXG5cdFx0XHQgKi9cblx0XHRcdGFjdGlvbnMgOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciAkdGhpcyA9IHRoaXMsXG5cdFx0XHRcdFx0YWN0aW9uID0gJ3RvdWNoZW5kIGNsaWNrJzsgLy8gSnVzdCBkZXRlY3QgZm9yIGJvdGggZXZlbnQgdHlwZXMgdG8gYWxsb3cgZm9yIG11bHRpLWlucHV0XG5cblx0XHRcdFx0aWYgKCBlbGVtZW50cy5sZW5ndGggPCAyICkge1xuXG5cdFx0XHRcdFx0JCggJyNzd2lwZWJveC1ib3R0b20tYmFyJyApLmhpZGUoKTtcblxuXHRcdFx0XHRcdGlmICggdW5kZWZpbmVkID09PSBlbGVtZW50c1sgMSBdICkge1xuXHRcdFx0XHRcdFx0JCggJyNzd2lwZWJveC10b3AtYmFyJyApLmhpZGUoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkKCAnI3N3aXBlYm94LXByZXYnICkuYmluZCggYWN0aW9uLCBmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0XHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHQkdGhpcy5nZXRQcmV2KCk7XG5cdFx0XHRcdFx0XHQkdGhpcy5zZXRUaW1lb3V0KCk7XG5cdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0JCggJyNzd2lwZWJveC1uZXh0JyApLmJpbmQoIGFjdGlvbiwgZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdFx0XHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0JHRoaXMuZ2V0TmV4dCgpO1xuXHRcdFx0XHRcdFx0JHRoaXMuc2V0VGltZW91dCgpO1xuXHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdCQoICcjc3dpcGVib3gtY2xvc2UnICkuYmluZCggYWN0aW9uLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkdGhpcy5jbG9zZVNsaWRlKCk7XG5cdFx0XHRcdH0gKTtcblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogU2V0IGN1cnJlbnQgc2xpZGVcblx0XHRcdCAqL1xuXHRcdFx0c2V0U2xpZGUgOiBmdW5jdGlvbiAoIGluZGV4LCBpc0ZpcnN0ICkge1xuXG5cdFx0XHRcdGlzRmlyc3QgPSBpc0ZpcnN0IHx8IGZhbHNlO1xuXG5cdFx0XHRcdHZhciBzbGlkZXIgPSAkKCAnI3N3aXBlYm94LXNsaWRlcicgKTtcblxuXHRcdFx0XHRjdXJyZW50WCA9IC1pbmRleCoxMDA7XG5cblx0XHRcdFx0aWYgKCB0aGlzLmRvQ3NzVHJhbnMoKSApIHtcblx0XHRcdFx0XHRzbGlkZXIuY3NzKCB7XG5cdFx0XHRcdFx0XHQnLXdlYmtpdC10cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZTNkKCcgKyAoLWluZGV4KjEwMCkrJyUsIDAsIDApJyxcblx0XHRcdFx0XHRcdCd0cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZTNkKCcgKyAoLWluZGV4KjEwMCkrJyUsIDAsIDApJ1xuXHRcdFx0XHRcdH0gKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzbGlkZXIuYW5pbWF0ZSggeyBsZWZ0IDogKCAtaW5kZXgqMTAwICkrJyUnIH0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdCQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5yZW1vdmVDbGFzcyggJ2N1cnJlbnQnICk7XG5cdFx0XHRcdCQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5lcSggaW5kZXggKS5hZGRDbGFzcyggJ2N1cnJlbnQnICk7XG5cdFx0XHRcdHRoaXMuc2V0VGl0bGUoIGluZGV4ICk7XG5cblx0XHRcdFx0aWYgKCBpc0ZpcnN0ICkge1xuXHRcdFx0XHRcdHNsaWRlci5mYWRlSW4oKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdCQoICcjc3dpcGVib3gtcHJldiwgI3N3aXBlYm94LW5leHQnICkucmVtb3ZlQ2xhc3MoICdkaXNhYmxlZCcgKTtcblxuXHRcdFx0XHRpZiAoIGluZGV4ID09PSAwICkge1xuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtcHJldicgKS5hZGRDbGFzcyggJ2Rpc2FibGVkJyApO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCBpbmRleCA9PT0gZWxlbWVudHMubGVuZ3RoIC0gMSAmJiBwbHVnaW4uc2V0dGluZ3MubG9vcEF0RW5kICE9PSB0cnVlICkge1xuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtbmV4dCcgKS5hZGRDbGFzcyggJ2Rpc2FibGVkJyApO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIE9wZW4gc2xpZGVcblx0XHRcdCAqL1xuXHRcdFx0b3BlblNsaWRlIDogZnVuY3Rpb24gKCBpbmRleCApIHtcblx0XHRcdFx0JCggJ2h0bWwnICkuYWRkQ2xhc3MoICdzd2lwZWJveC1odG1sJyApO1xuXHRcdFx0XHRpZiAoIGlzVG91Y2ggKSB7XG5cdFx0XHRcdFx0JCggJ2h0bWwnICkuYWRkQ2xhc3MoICdzd2lwZWJveC10b3VjaCcgKTtcblxuXHRcdFx0XHRcdGlmICggcGx1Z2luLnNldHRpbmdzLmhpZGVDbG9zZUJ1dHRvbk9uTW9iaWxlICkge1xuXHRcdFx0XHRcdFx0JCggJ2h0bWwnICkuYWRkQ2xhc3MoICdzd2lwZWJveC1uby1jbG9zZS1idXR0b24nICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdCQoICdodG1sJyApLmFkZENsYXNzKCAnc3dpcGVib3gtbm8tdG91Y2gnICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0JCggd2luZG93ICkudHJpZ2dlciggJ3Jlc2l6ZScgKTsgLy8gZml4IHNjcm9sbCBiYXIgdmlzaWJpbGl0eSBvbiBkZXNrdG9wXG5cdFx0XHRcdHRoaXMuc2V0U2xpZGUoIGluZGV4LCB0cnVlICk7XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFNldCBhIHRpbWUgb3V0IGlmIHRoZSBtZWRpYSBpcyBhIHZpZGVvXG5cdFx0XHQgKi9cblx0XHRcdHByZWxvYWRNZWRpYSA6IGZ1bmN0aW9uICggaW5kZXggKSB7XG5cdFx0XHRcdHZhciAkdGhpcyA9IHRoaXMsXG5cdFx0XHRcdFx0c3JjID0gbnVsbDtcblxuXHRcdFx0XHRpZiAoIGVsZW1lbnRzWyBpbmRleCBdICE9PSB1bmRlZmluZWQgKSB7XG5cdFx0XHRcdFx0c3JjID0gZWxlbWVudHNbIGluZGV4IF0uaHJlZjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggISAkdGhpcy5pc1ZpZGVvKCBzcmMgKSApIHtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdCR0aGlzLm9wZW5NZWRpYSggaW5kZXggKTtcblx0XHRcdFx0XHR9LCAxMDAwKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkdGhpcy5vcGVuTWVkaWEoIGluZGV4ICk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogT3BlblxuXHRcdFx0ICovXG5cdFx0XHRvcGVuTWVkaWEgOiBmdW5jdGlvbiAoIGluZGV4ICkge1xuXHRcdFx0XHR2YXIgJHRoaXMgPSB0aGlzLFxuXHRcdFx0XHRcdHNyYyxcblx0XHRcdFx0XHRzbGlkZTtcblxuXHRcdFx0XHRpZiAoIGVsZW1lbnRzWyBpbmRleCBdICE9PSB1bmRlZmluZWQgKSB7XG5cdFx0XHRcdFx0c3JjID0gZWxlbWVudHNbIGluZGV4IF0uaHJlZjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggaW5kZXggPCAwIHx8IGluZGV4ID49IGVsZW1lbnRzLmxlbmd0aCApIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzbGlkZSA9ICQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5lcSggaW5kZXggKTtcblxuXHRcdFx0XHRpZiAoICEgJHRoaXMuaXNWaWRlbyggc3JjICkgKSB7XG5cdFx0XHRcdFx0c2xpZGUuYWRkQ2xhc3MoICdzbGlkZS1sb2FkaW5nJyApO1xuXHRcdFx0XHRcdCR0aGlzLmxvYWRNZWRpYSggc3JjLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHNsaWRlLnJlbW92ZUNsYXNzKCAnc2xpZGUtbG9hZGluZycgKTtcblx0XHRcdFx0XHRcdHNsaWRlLmh0bWwoIHRoaXMgKTtcblxuXHRcdFx0XHRcdFx0aWYgKCBwbHVnaW4uc2V0dGluZ3MuYWZ0ZXJNZWRpYSApIHtcblx0XHRcdFx0XHRcdFx0cGx1Z2luLnNldHRpbmdzLmFmdGVyTWVkaWEoIGluZGV4ICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNsaWRlLmh0bWwoICR0aGlzLmdldFZpZGVvKCBzcmMgKSApO1xuXG5cdFx0XHRcdFx0aWYgKCBwbHVnaW4uc2V0dGluZ3MuYWZ0ZXJNZWRpYSApIHtcblx0XHRcdFx0XHRcdHBsdWdpbi5zZXR0aW5ncy5hZnRlck1lZGlhKCBpbmRleCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFNldCBsaW5rIHRpdGxlIGF0dHJpYnV0ZSBhcyBjYXB0aW9uXG5cdFx0XHQgKi9cblx0XHRcdHNldFRpdGxlIDogZnVuY3Rpb24gKCBpbmRleCApIHtcblx0XHRcdFx0dmFyIHRpdGxlID0gbnVsbDtcblxuXHRcdFx0XHQkKCAnI3N3aXBlYm94LXRpdGxlJyApLmVtcHR5KCk7XG5cblx0XHRcdFx0aWYgKCBlbGVtZW50c1sgaW5kZXggXSAhPT0gdW5kZWZpbmVkICkge1xuXHRcdFx0XHRcdHRpdGxlID0gZWxlbWVudHNbIGluZGV4IF0udGl0bGU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIHRpdGxlICkge1xuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtdG9wLWJhcicgKS5zaG93KCk7XG5cdFx0XHRcdFx0JCggJyNzd2lwZWJveC10aXRsZScgKS5hcHBlbmQoIHRpdGxlICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JCggJyNzd2lwZWJveC10b3AtYmFyJyApLmhpZGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBDaGVjayBpZiB0aGUgVVJMIGlzIGEgdmlkZW9cblx0XHRcdCAqL1xuXHRcdFx0aXNWaWRlbyA6IGZ1bmN0aW9uICggc3JjICkge1xuXG5cdFx0XHRcdGlmICggc3JjICkge1xuXHRcdFx0XHRcdGlmICggc3JjLm1hdGNoKCAvKHlvdXR1YmVcXC5jb218eW91dHViZS1ub2Nvb2tpZVxcLmNvbSlcXC93YXRjaFxcP3Y9KFthLXpBLVowLTlcXC1fXSspLykgfHwgc3JjLm1hdGNoKCAvdmltZW9cXC5jb21cXC8oWzAtOV0qKS8gKSB8fCBzcmMubWF0Y2goIC95b3V0dVxcLmJlXFwvKFthLXpBLVowLTlcXC1fXSspLyApICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzcmMudG9Mb3dlckNhc2UoKS5pbmRleE9mKCAnc3dpcGVib3h2aWRlbz0xJyApID49IDAgKSB7XG5cblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIFBhcnNlIFVSSSBxdWVyeXN0cmluZyBhbmQ6XG5cdFx0XHQgKiAtIG92ZXJyaWRlcyB2YWx1ZSBwcm92aWRlZCB2aWEgZGljdGlvbmFyeVxuXHRcdFx0ICogLSByZWJ1aWxkIGl0IGFnYWluIHJldHVybmluZyBhIHN0cmluZ1xuXHRcdFx0ICovXG5cdFx0XHRwYXJzZVVyaSA6IGZ1bmN0aW9uICh1cmksIGN1c3RvbURhdGEpIHtcblx0XHRcdFx0dmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyksXG5cdFx0XHRcdFx0cXMgPSB7fTtcblxuXHRcdFx0XHQvLyBEZWNvZGUgdGhlIFVSSVxuXHRcdFx0XHRhLmhyZWYgPSBkZWNvZGVVUklDb21wb25lbnQoIHVyaSApO1xuXG5cdFx0XHRcdC8vIFF1ZXJ5U3RyaW5nIHRvIE9iamVjdFxuXHRcdFx0XHRpZiAoIGEuc2VhcmNoICkge1xuXHRcdFx0XHRcdHFzID0gSlNPTi5wYXJzZSggJ3tcIicgKyBhLnNlYXJjaC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJz8nLCcnKS5yZXBsYWNlKC8mL2csJ1wiLFwiJykucmVwbGFjZSgvPS9nLCdcIjpcIicpICsgJ1wifScgKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0Ly8gRXh0ZW5kIHdpdGggY3VzdG9tIGRhdGFcblx0XHRcdFx0aWYgKCAkLmlzUGxhaW5PYmplY3QoIGN1c3RvbURhdGEgKSApIHtcblx0XHRcdFx0XHRxcyA9ICQuZXh0ZW5kKCBxcywgY3VzdG9tRGF0YSwgcGx1Z2luLnNldHRpbmdzLnF1ZXJ5U3RyaW5nRGF0YSApOyAvLyBUaGUgZGV2IGhhcyBhbHdheXMgdGhlIGZpbmFsIHdvcmRcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIFJldHVybiBxdWVyeXN0cmluZyBhcyBhIHN0cmluZ1xuXHRcdFx0XHRyZXR1cm4gJFxuXHRcdFx0XHRcdC5tYXAoIHFzLCBmdW5jdGlvbiAodmFsLCBrZXkpIHtcblx0XHRcdFx0XHRcdGlmICggdmFsICYmIHZhbCA+ICcnICkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KCBrZXkgKSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCggdmFsICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuam9pbignJicpO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBHZXQgdmlkZW8gaWZyYW1lIGNvZGUgZnJvbSBVUkxcblx0XHRcdCAqL1xuXHRcdFx0Z2V0VmlkZW8gOiBmdW5jdGlvbiggdXJsICkge1xuXHRcdFx0XHR2YXIgaWZyYW1lID0gJycsXG5cdFx0XHRcdFx0eW91dHViZVVybCA9IHVybC5tYXRjaCggLygoPzp3d3dcXC4pP3lvdXR1YmVcXC5jb218KD86d3d3XFwuKT95b3V0dWJlLW5vY29va2llXFwuY29tKVxcL3dhdGNoXFw/dj0oW2EtekEtWjAtOVxcLV9dKykvICksXG5cdFx0XHRcdFx0eW91dHViZVNob3J0VXJsID0gdXJsLm1hdGNoKC8oPzp3d3dcXC4pP3lvdXR1XFwuYmVcXC8oW2EtekEtWjAtOVxcLV9dKykvKSxcblx0XHRcdFx0XHR2aW1lb1VybCA9IHVybC5tYXRjaCggLyg/Ond3d1xcLik/dmltZW9cXC5jb21cXC8oWzAtOV0qKS8gKSxcblx0XHRcdFx0XHRxcyA9ICcnO1xuXHRcdFx0XHRpZiAoIHlvdXR1YmVVcmwgfHwgeW91dHViZVNob3J0VXJsKSB7XG5cdFx0XHRcdFx0aWYgKCB5b3V0dWJlU2hvcnRVcmwgKSB7XG5cdFx0XHRcdFx0XHR5b3V0dWJlVXJsID0geW91dHViZVNob3J0VXJsO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRxcyA9IHVpLnBhcnNlVXJpKCB1cmwsIHtcblx0XHRcdFx0XHRcdCdhdXRvcGxheScgOiAoIHBsdWdpbi5zZXR0aW5ncy5hdXRvcGxheVZpZGVvcyA/ICcxJyA6ICcwJyApLFxuXHRcdFx0XHRcdFx0J3YnIDogJydcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRpZnJhbWUgPSAnPGlmcmFtZSB3aWR0aD1cIjU2MFwiIGhlaWdodD1cIjMxNVwiIHNyYz1cIi8vJyArIHlvdXR1YmVVcmxbMV0gKyAnL2VtYmVkLycgKyB5b3V0dWJlVXJsWzJdICsgJz8nICsgcXMgKyAnXCIgZnJhbWVib3JkZXI9XCIwXCIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPic7XG5cblx0XHRcdFx0fSBlbHNlIGlmICggdmltZW9VcmwgKSB7XG5cdFx0XHRcdFx0cXMgPSB1aS5wYXJzZVVyaSggdXJsLCB7XG5cdFx0XHRcdFx0XHQnYXV0b3BsYXknIDogKCBwbHVnaW4uc2V0dGluZ3MuYXV0b3BsYXlWaWRlb3MgPyAnMScgOiAnMCcgKSxcblx0XHRcdFx0XHRcdCdieWxpbmUnIDogJzAnLFxuXHRcdFx0XHRcdFx0J3BvcnRyYWl0JyA6ICcwJyxcblx0XHRcdFx0XHRcdCdjb2xvcic6IHBsdWdpbi5zZXR0aW5ncy52aW1lb0NvbG9yXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0aWZyYW1lID0gJzxpZnJhbWUgd2lkdGg9XCI1NjBcIiBoZWlnaHQ9XCIzMTVcIiAgc3JjPVwiLy9wbGF5ZXIudmltZW8uY29tL3ZpZGVvLycgKyB2aW1lb1VybFsxXSArICc/JyArIHFzICsgJ1wiIGZyYW1lYm9yZGVyPVwiMFwiIHdlYmtpdEFsbG93RnVsbFNjcmVlbiBtb3phbGxvd2Z1bGxzY3JlZW4gYWxsb3dGdWxsU2NyZWVuPjwvaWZyYW1lPic7XG5cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpZnJhbWUgPSAnPGlmcmFtZSB3aWR0aD1cIjU2MFwiIGhlaWdodD1cIjMxNVwiIHNyYz1cIicgKyB1cmwgKyAnXCIgZnJhbWVib3JkZXI9XCIwXCIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPic7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gJzxkaXYgY2xhc3M9XCJzd2lwZWJveC12aWRlby1jb250YWluZXJcIiBzdHlsZT1cIm1heC13aWR0aDonICsgcGx1Z2luLnNldHRpbmdzLnZpZGVvTWF4V2lkdGggKyAncHhcIj48ZGl2IGNsYXNzPVwic3dpcGVib3gtdmlkZW9cIj4nICsgaWZyYW1lICsgJzwvZGl2PjwvZGl2Pic7XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIExvYWQgaW1hZ2Vcblx0XHRcdCAqL1xuXHRcdFx0bG9hZE1lZGlhIDogZnVuY3Rpb24gKCBzcmMsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgICAgIC8vIElubGluZSBjb250ZW50XG4gICAgICAgICAgICAgICAgaWYgKCBzcmMudHJpbSgpLmluZGV4T2YoJyMnKSA9PT0gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChcbiAgICAgICAgICAgICAgICAgICAgXHQkKCc8ZGl2PicsIHtcbiAgICAgICAgICAgICAgICAgICAgXHRcdCdjbGFzcycgOiAnc3dpcGVib3gtaW5saW5lLWNvbnRhaW5lcidcbiAgICAgICAgICAgICAgICAgICAgXHR9KVxuICAgICAgICAgICAgICAgICAgICBcdC5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgIFx0XHQkKHNyYylcblx0ICAgICAgICAgICAgICAgICAgICBcdC5jbG9uZSgpXG5cdCAgICAgICAgICAgICAgICAgICAgXHQudG9nZ2xlQ2xhc3MoIHBsdWdpbi5zZXR0aW5ncy50b2dnbGVDbGFzc09uTG9hZCApXG5cdCAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBFdmVyeXRoaW5nIGVsc2VcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICBcdFx0XHRcdGlmICggISB0aGlzLmlzVmlkZW8oIHNyYyApICkge1xuICAgIFx0XHRcdFx0XHR2YXIgaW1nID0gJCggJzxpbWc+JyApLm9uKCAnbG9hZCcsIGZ1bmN0aW9uKCkge1xuICAgIFx0XHRcdFx0XHRcdGNhbGxiYWNrLmNhbGwoIGltZyApO1xuICAgIFx0XHRcdFx0XHR9ICk7XG5cbiAgICBcdFx0XHRcdFx0aW1nLmF0dHIoICdzcmMnLCBzcmMgKTtcbiAgICBcdFx0XHRcdH1cbiAgICAgICAgICAgICAgICB9XG5cdFx0XHR9LFxuXG5cdFx0XHQvKipcblx0XHRcdCAqIEdldCBuZXh0IHNsaWRlXG5cdFx0XHQgKi9cblx0XHRcdGdldE5leHQgOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciAkdGhpcyA9IHRoaXMsXG5cdFx0XHRcdFx0c3JjLFxuXHRcdFx0XHRcdGluZGV4ID0gJCggJyNzd2lwZWJveC1zbGlkZXIgLnNsaWRlJyApLmluZGV4KCAkKCAnI3N3aXBlYm94LXNsaWRlciAuc2xpZGUuY3VycmVudCcgKSApO1xuXHRcdFx0XHRpZiAoIGluZGV4ICsgMSA8IGVsZW1lbnRzLmxlbmd0aCApIHtcblxuXHRcdFx0XHRcdHNyYyA9ICQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5lcSggaW5kZXggKS5jb250ZW50cygpLmZpbmQoICdpZnJhbWUnICkuYXR0ciggJ3NyYycgKTtcblx0XHRcdFx0XHQkKCAnI3N3aXBlYm94LXNsaWRlciAuc2xpZGUnICkuZXEoIGluZGV4ICkuY29udGVudHMoKS5maW5kKCAnaWZyYW1lJyApLmF0dHIoICdzcmMnLCBzcmMgKTtcblx0XHRcdFx0XHRpbmRleCsrO1xuXHRcdFx0XHRcdCR0aGlzLnNldFNsaWRlKCBpbmRleCApO1xuXHRcdFx0XHRcdCR0aGlzLnByZWxvYWRNZWRpYSggaW5kZXgrMSApO1xuXHRcdFx0XHRcdGlmICggcGx1Z2luLnNldHRpbmdzLm5leHRTbGlkZSApIHtcblx0XHRcdFx0XHRcdHBsdWdpbi5zZXR0aW5ncy5uZXh0U2xpZGUoaW5kZXgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdGlmICggcGx1Z2luLnNldHRpbmdzLmxvb3BBdEVuZCA9PT0gdHJ1ZSApIHtcblx0XHRcdFx0XHRcdHNyYyA9ICQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5lcSggaW5kZXggKS5jb250ZW50cygpLmZpbmQoICdpZnJhbWUnICkuYXR0ciggJ3NyYycgKTtcblx0XHRcdFx0XHRcdCQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5lcSggaW5kZXggKS5jb250ZW50cygpLmZpbmQoICdpZnJhbWUnICkuYXR0ciggJ3NyYycsIHNyYyApO1xuXHRcdFx0XHRcdFx0aW5kZXggPSAwO1xuXHRcdFx0XHRcdFx0JHRoaXMucHJlbG9hZE1lZGlhKCBpbmRleCApO1xuXHRcdFx0XHRcdFx0JHRoaXMuc2V0U2xpZGUoIGluZGV4ICk7XG5cdFx0XHRcdFx0XHQkdGhpcy5wcmVsb2FkTWVkaWEoIGluZGV4ICsgMSApO1xuXHRcdFx0XHRcdFx0aWYgKCBwbHVnaW4uc2V0dGluZ3MubmV4dFNsaWRlICkge1xuXHRcdFx0XHRcdFx0XHRwbHVnaW4uc2V0dGluZ3MubmV4dFNsaWRlKGluZGV4KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0JCggJyNzd2lwZWJveC1vdmVybGF5JyApLmFkZENsYXNzKCAncmlnaHRTcHJpbmcnICk7XG5cdFx0XHRcdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0JCggJyNzd2lwZWJveC1vdmVybGF5JyApLnJlbW92ZUNsYXNzKCAncmlnaHRTcHJpbmcnICk7XG5cdFx0XHRcdFx0XHR9LCA1MDAgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cblx0XHRcdC8qKlxuXHRcdFx0ICogR2V0IHByZXZpb3VzIHNsaWRlXG5cdFx0XHQgKi9cblx0XHRcdGdldFByZXYgOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciBpbmRleCA9ICQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5pbmRleCggJCggJyNzd2lwZWJveC1zbGlkZXIgLnNsaWRlLmN1cnJlbnQnICkgKSxcblx0XHRcdFx0XHRzcmM7XG5cdFx0XHRcdGlmICggaW5kZXggPiAwICkge1xuXHRcdFx0XHRcdHNyYyA9ICQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5lcSggaW5kZXggKS5jb250ZW50cygpLmZpbmQoICdpZnJhbWUnKS5hdHRyKCAnc3JjJyApO1xuXHRcdFx0XHRcdCQoICcjc3dpcGVib3gtc2xpZGVyIC5zbGlkZScgKS5lcSggaW5kZXggKS5jb250ZW50cygpLmZpbmQoICdpZnJhbWUnICkuYXR0ciggJ3NyYycsIHNyYyApO1xuXHRcdFx0XHRcdGluZGV4LS07XG5cdFx0XHRcdFx0dGhpcy5zZXRTbGlkZSggaW5kZXggKTtcblx0XHRcdFx0XHR0aGlzLnByZWxvYWRNZWRpYSggaW5kZXgtMSApO1xuXHRcdFx0XHRcdGlmICggcGx1Z2luLnNldHRpbmdzLnByZXZTbGlkZSApIHtcblx0XHRcdFx0XHRcdHBsdWdpbi5zZXR0aW5ncy5wcmV2U2xpZGUoaW5kZXgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkKCAnI3N3aXBlYm94LW92ZXJsYXknICkuYWRkQ2xhc3MoICdsZWZ0U3ByaW5nJyApO1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0JCggJyNzd2lwZWJveC1vdmVybGF5JyApLnJlbW92ZUNsYXNzKCAnbGVmdFNwcmluZycgKTtcblx0XHRcdFx0XHR9LCA1MDAgKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdC8qIGpzaGludCB1bnVzZWQ6ZmFsc2UgKi9cblx0XHRcdG5leHRTbGlkZSA6IGZ1bmN0aW9uICggaW5kZXggKSB7XG5cdFx0XHRcdC8vIENhbGxiYWNrIGZvciBuZXh0IHNsaWRlXG5cdFx0XHR9LFxuXG5cdFx0XHRwcmV2U2xpZGUgOiBmdW5jdGlvbiAoIGluZGV4ICkge1xuXHRcdFx0XHQvLyBDYWxsYmFjayBmb3IgcHJldiBzbGlkZVxuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBDbG9zZVxuXHRcdFx0ICovXG5cdFx0XHRjbG9zZVNsaWRlIDogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQkKCAnaHRtbCcgKS5yZW1vdmVDbGFzcyggJ3N3aXBlYm94LWh0bWwnICk7XG5cdFx0XHRcdCQoICdodG1sJyApLnJlbW92ZUNsYXNzKCAnc3dpcGVib3gtdG91Y2gnICk7XG5cdFx0XHRcdCQoIHdpbmRvdyApLnRyaWdnZXIoICdyZXNpemUnICk7XG5cdFx0XHRcdHRoaXMuZGVzdHJveSgpO1xuXHRcdFx0fSxcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBEZXN0cm95IHRoZSB3aG9sZSB0aGluZ1xuXHRcdFx0ICovXG5cdFx0XHRkZXN0cm95IDogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQkKCB3aW5kb3cgKS51bmJpbmQoICdrZXl1cCcgKTtcblx0XHRcdFx0JCggJ2JvZHknICkudW5iaW5kKCAndG91Y2hzdGFydCcgKTtcblx0XHRcdFx0JCggJ2JvZHknICkudW5iaW5kKCAndG91Y2htb3ZlJyApO1xuXHRcdFx0XHQkKCAnYm9keScgKS51bmJpbmQoICd0b3VjaGVuZCcgKTtcblx0XHRcdFx0JCggJyNzd2lwZWJveC1zbGlkZXInICkudW5iaW5kKCk7XG5cdFx0XHRcdCQoICcjc3dpcGVib3gtb3ZlcmxheScgKS5yZW1vdmUoKTtcblxuXHRcdFx0XHRpZiAoICEgJC5pc0FycmF5KCBlbGVtICkgKSB7XG5cdFx0XHRcdFx0ZWxlbS5yZW1vdmVEYXRhKCAnX3N3aXBlYm94JyApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCB0aGlzLnRhcmdldCApIHtcblx0XHRcdFx0XHR0aGlzLnRhcmdldC50cmlnZ2VyKCAnc3dpcGVib3gtZGVzdHJveScgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdCQuc3dpcGVib3guaXNPcGVuID0gZmFsc2U7XG5cblx0XHRcdFx0aWYgKCBwbHVnaW4uc2V0dGluZ3MuYWZ0ZXJDbG9zZSApIHtcblx0XHRcdFx0XHRwbHVnaW4uc2V0dGluZ3MuYWZ0ZXJDbG9zZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdHBsdWdpbi5pbml0KCk7XG5cdH07XG5cblx0JC5mbi5zd2lwZWJveCA9IGZ1bmN0aW9uKCBvcHRpb25zICkge1xuXG5cdFx0aWYgKCAhICQuZGF0YSggdGhpcywgJ19zd2lwZWJveCcgKSApIHtcblx0XHRcdHZhciBzd2lwZWJveCA9IG5ldyAkLnN3aXBlYm94KCB0aGlzLCBvcHRpb25zICk7XG5cdFx0XHR0aGlzLmRhdGEoICdfc3dpcGVib3gnLCBzd2lwZWJveCApO1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5kYXRhKCAnX3N3aXBlYm94JyApO1xuXG5cdH07XG5cbn0oIHdpbmRvdywgZG9jdW1lbnQsIGpRdWVyeSApICk7XG4iLCIvKiFcbiAqIGpRdWVyeSB0aHJvdHRsZSAvIGRlYm91bmNlIC0gdjEuMSAtIDMvNy8yMDEwXG4gKiBodHRwOi8vYmVuYWxtYW4uY29tL3Byb2plY3RzL2pxdWVyeS10aHJvdHRsZS1kZWJvdW5jZS1wbHVnaW4vXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEwIFwiQ293Ym95XCIgQmVuIEFsbWFuXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9iZW5hbG1hbi5jb20vYWJvdXQvbGljZW5zZS9cbiAqL1xuXG4vLyBTY3JpcHQ6IGpRdWVyeSB0aHJvdHRsZSAvIGRlYm91bmNlOiBTb21ldGltZXMsIGxlc3MgaXMgbW9yZSFcbi8vXG4vLyAqVmVyc2lvbjogMS4xLCBMYXN0IHVwZGF0ZWQ6IDMvNy8yMDEwKlxuLy9cbi8vIFByb2plY3QgSG9tZSAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vcHJvamVjdHMvanF1ZXJ5LXRocm90dGxlLWRlYm91bmNlLXBsdWdpbi9cbi8vIEdpdEh1YiAgICAgICAtIGh0dHA6Ly9naXRodWIuY29tL2Nvd2JveS9qcXVlcnktdGhyb3R0bGUtZGVib3VuY2UvXG4vLyBTb3VyY2UgICAgICAgLSBodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kvanF1ZXJ5LXRocm90dGxlLWRlYm91bmNlL3Jhdy9tYXN0ZXIvanF1ZXJ5LmJhLXRocm90dGxlLWRlYm91bmNlLmpzXG4vLyAoTWluaWZpZWQpICAgLSBodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kvanF1ZXJ5LXRocm90dGxlLWRlYm91bmNlL3Jhdy9tYXN0ZXIvanF1ZXJ5LmJhLXRocm90dGxlLWRlYm91bmNlLm1pbi5qcyAoMC43a2IpXG4vL1xuLy8gQWJvdXQ6IExpY2Vuc2Vcbi8vXG4vLyBDb3B5cmlnaHQgKGMpIDIwMTAgXCJDb3dib3lcIiBCZW4gQWxtYW4sXG4vLyBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlcy5cbi8vIGh0dHA6Ly9iZW5hbG1hbi5jb20vYWJvdXQvbGljZW5zZS9cbi8vXG4vLyBBYm91dDogRXhhbXBsZXNcbi8vXG4vLyBUaGVzZSB3b3JraW5nIGV4YW1wbGVzLCBjb21wbGV0ZSB3aXRoIGZ1bGx5IGNvbW1lbnRlZCBjb2RlLCBpbGx1c3RyYXRlIGEgZmV3XG4vLyB3YXlzIGluIHdoaWNoIHRoaXMgcGx1Z2luIGNhbiBiZSB1c2VkLlxuLy9cbi8vIFRocm90dGxlIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS10aHJvdHRsZS1kZWJvdW5jZS9leGFtcGxlcy90aHJvdHRsZS9cbi8vIERlYm91bmNlIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS10aHJvdHRsZS1kZWJvdW5jZS9leGFtcGxlcy9kZWJvdW5jZS9cbi8vXG4vLyBBYm91dDogU3VwcG9ydCBhbmQgVGVzdGluZ1xuLy9cbi8vIEluZm9ybWF0aW9uIGFib3V0IHdoYXQgdmVyc2lvbiBvciB2ZXJzaW9ucyBvZiBqUXVlcnkgdGhpcyBwbHVnaW4gaGFzIGJlZW5cbi8vIHRlc3RlZCB3aXRoLCB3aGF0IGJyb3dzZXJzIGl0IGhhcyBiZWVuIHRlc3RlZCBpbiwgYW5kIHdoZXJlIHRoZSB1bml0IHRlc3RzXG4vLyByZXNpZGUgKHNvIHlvdSBjYW4gdGVzdCBpdCB5b3Vyc2VsZikuXG4vL1xuLy8galF1ZXJ5IFZlcnNpb25zIC0gbm9uZSwgMS4zLjIsIDEuNC4yXG4vLyBCcm93c2VycyBUZXN0ZWQgLSBJbnRlcm5ldCBFeHBsb3JlciA2LTgsIEZpcmVmb3ggMi0zLjYsIFNhZmFyaSAzLTQsIENocm9tZSA0LTUsIE9wZXJhIDkuNi0xMC4xLlxuLy8gVW5pdCBUZXN0cyAgICAgIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS10aHJvdHRsZS1kZWJvdW5jZS91bml0L1xuLy9cbi8vIEFib3V0OiBSZWxlYXNlIEhpc3Rvcnlcbi8vXG4vLyAxLjEgLSAoMy83LzIwMTApIEZpeGVkIGEgYnVnIGluIDxqUXVlcnkudGhyb3R0bGU+IHdoZXJlIHRyYWlsaW5nIGNhbGxiYWNrc1xuLy8gICAgICAgZXhlY3V0ZWQgbGF0ZXIgdGhhbiB0aGV5IHNob3VsZC4gUmV3b3JrZWQgYSBmYWlyIGFtb3VudCBvZiBpbnRlcm5hbFxuLy8gICAgICAgbG9naWMgYXMgd2VsbC5cbi8vIDEuMCAtICgzLzYvMjAxMCkgSW5pdGlhbCByZWxlYXNlIGFzIGEgc3RhbmQtYWxvbmUgcHJvamVjdC4gTWlncmF0ZWQgb3ZlclxuLy8gICAgICAgZnJvbSBqcXVlcnktbWlzYyByZXBvIHYwLjQgdG8ganF1ZXJ5LXRocm90dGxlIHJlcG8gdjEuMCwgYWRkZWQgdGhlXG4vLyAgICAgICBub190cmFpbGluZyB0aHJvdHRsZSBwYXJhbWV0ZXIgYW5kIGRlYm91bmNlIGZ1bmN0aW9uYWxpdHkuXG4vL1xuLy8gVG9waWM6IE5vdGUgZm9yIG5vbi1qUXVlcnkgdXNlcnNcbi8vXG4vLyBqUXVlcnkgaXNuJ3QgYWN0dWFsbHkgcmVxdWlyZWQgZm9yIHRoaXMgcGx1Z2luLCBiZWNhdXNlIG5vdGhpbmcgaW50ZXJuYWxcbi8vIHVzZXMgYW55IGpRdWVyeSBtZXRob2RzIG9yIHByb3BlcnRpZXMuIGpRdWVyeSBpcyBqdXN0IHVzZWQgYXMgYSBuYW1lc3BhY2Vcbi8vIHVuZGVyIHdoaWNoIHRoZXNlIG1ldGhvZHMgY2FuIGV4aXN0LlxuLy9cbi8vIFNpbmNlIGpRdWVyeSBpc24ndCBhY3R1YWxseSByZXF1aXJlZCBmb3IgdGhpcyBwbHVnaW4sIGlmIGpRdWVyeSBkb2Vzbid0IGV4aXN0XG4vLyB3aGVuIHRoaXMgcGx1Z2luIGlzIGxvYWRlZCwgdGhlIG1ldGhvZCBkZXNjcmliZWQgYmVsb3cgd2lsbCBiZSBjcmVhdGVkIGluXG4vLyB0aGUgYENvd2JveWAgbmFtZXNwYWNlLiBVc2FnZSB3aWxsIGJlIGV4YWN0bHkgdGhlIHNhbWUsIGJ1dCBpbnN0ZWFkIG9mXG4vLyAkLm1ldGhvZCgpIG9yIGpRdWVyeS5tZXRob2QoKSwgeW91J2xsIG5lZWQgdG8gdXNlIENvd2JveS5tZXRob2QoKS5cblxuKGZ1bmN0aW9uKHdpbmRvdyx1bmRlZmluZWQpe1xuICAgICckOm5vbXVuZ2UnOyAvLyBVc2VkIGJ5IFlVSSBjb21wcmVzc29yLlxuXG4gICAgLy8gU2luY2UgalF1ZXJ5IHJlYWxseSBpc24ndCByZXF1aXJlZCBmb3IgdGhpcyBwbHVnaW4sIHVzZSBgalF1ZXJ5YCBhcyB0aGVcbiAgICAvLyBuYW1lc3BhY2Ugb25seSBpZiBpdCBhbHJlYWR5IGV4aXN0cywgb3RoZXJ3aXNlIHVzZSB0aGUgYENvd2JveWAgbmFtZXNwYWNlLFxuICAgIC8vIGNyZWF0aW5nIGl0IGlmIG5lY2Vzc2FyeS5cbiAgICB2YXIgJCA9IHdpbmRvdy5qUXVlcnkgfHwgd2luZG93LkNvd2JveSB8fCAoIHdpbmRvdy5Db3dib3kgPSB7fSApLFxuXG4gICAgICAgIC8vIEludGVybmFsIG1ldGhvZCByZWZlcmVuY2UuXG4gICAgICAgIGpxX3Rocm90dGxlO1xuXG4gICAgLy8gTWV0aG9kOiBqUXVlcnkudGhyb3R0bGVcbiAgICAvL1xuICAgIC8vIFRocm90dGxlIGV4ZWN1dGlvbiBvZiBhIGZ1bmN0aW9uLiBFc3BlY2lhbGx5IHVzZWZ1bCBmb3IgcmF0ZSBsaW1pdGluZ1xuICAgIC8vIGV4ZWN1dGlvbiBvZiBoYW5kbGVycyBvbiBldmVudHMgbGlrZSByZXNpemUgYW5kIHNjcm9sbC4gSWYgeW91IHdhbnQgdG9cbiAgICAvLyByYXRlLWxpbWl0IGV4ZWN1dGlvbiBvZiBhIGZ1bmN0aW9uIHRvIGEgc2luZ2xlIHRpbWUsIHNlZSB0aGVcbiAgICAvLyA8alF1ZXJ5LmRlYm91bmNlPiBtZXRob2QuXG4gICAgLy9cbiAgICAvLyBJbiB0aGlzIHZpc3VhbGl6YXRpb24sIHwgaXMgYSB0aHJvdHRsZWQtZnVuY3Rpb24gY2FsbCBhbmQgWCBpcyB0aGUgYWN0dWFsXG4gICAgLy8gY2FsbGJhY2sgZXhlY3V0aW9uOlxuICAgIC8vXG4gICAgLy8gPiBUaHJvdHRsZWQgd2l0aCBgbm9fdHJhaWxpbmdgIHNwZWNpZmllZCBhcyBmYWxzZSBvciB1bnNwZWNpZmllZDpcbiAgICAvLyA+IHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHwgKHBhdXNlKSB8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8XG4gICAgLy8gPiBYICAgIFggICAgWCAgICBYICAgIFggICAgWCAgICAgICAgWCAgICBYICAgIFggICAgWCAgICBYICAgIFhcbiAgICAvLyA+XG4gICAgLy8gPiBUaHJvdHRsZWQgd2l0aCBgbm9fdHJhaWxpbmdgIHNwZWNpZmllZCBhcyB0cnVlOlxuICAgIC8vID4gfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fCAocGF1c2UpIHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHxcbiAgICAvLyA+IFggICAgWCAgICBYICAgIFggICAgWCAgICAgICAgICAgICBYICAgIFggICAgWCAgICBYICAgIFhcbiAgICAvL1xuICAgIC8vIFVzYWdlOlxuICAgIC8vXG4gICAgLy8gPiB2YXIgdGhyb3R0bGVkID0galF1ZXJ5LnRocm90dGxlKCBkZWxheSwgWyBub190cmFpbGluZywgXSBjYWxsYmFjayApO1xuICAgIC8vID5cbiAgICAvLyA+IGpRdWVyeSgnc2VsZWN0b3InKS5iaW5kKCAnc29tZWV2ZW50JywgdGhyb3R0bGVkICk7XG4gICAgLy8gPiBqUXVlcnkoJ3NlbGVjdG9yJykudW5iaW5kKCAnc29tZWV2ZW50JywgdGhyb3R0bGVkICk7XG4gICAgLy9cbiAgICAvLyBUaGlzIGFsc28gd29ya3MgaW4galF1ZXJ5IDEuNCs6XG4gICAgLy9cbiAgICAvLyA+IGpRdWVyeSgnc2VsZWN0b3InKS5iaW5kKCAnc29tZWV2ZW50JywgalF1ZXJ5LnRocm90dGxlKCBkZWxheSwgWyBub190cmFpbGluZywgXSBjYWxsYmFjayApICk7XG4gICAgLy8gPiBqUXVlcnkoJ3NlbGVjdG9yJykudW5iaW5kKCAnc29tZWV2ZW50JywgY2FsbGJhY2sgKTtcbiAgICAvL1xuICAgIC8vIEFyZ3VtZW50czpcbiAgICAvL1xuICAgIC8vICBkZWxheSAtIChOdW1iZXIpIEEgemVyby1vci1ncmVhdGVyIGRlbGF5IGluIG1pbGxpc2Vjb25kcy4gRm9yIGV2ZW50XG4gICAgLy8gICAgY2FsbGJhY2tzLCB2YWx1ZXMgYXJvdW5kIDEwMCBvciAyNTAgKG9yIGV2ZW4gaGlnaGVyKSBhcmUgbW9zdCB1c2VmdWwuXG4gICAgLy8gIG5vX3RyYWlsaW5nIC0gKEJvb2xlYW4pIE9wdGlvbmFsLCBkZWZhdWx0cyB0byBmYWxzZS4gSWYgbm9fdHJhaWxpbmcgaXNcbiAgICAvLyAgICB0cnVlLCBjYWxsYmFjayB3aWxsIG9ubHkgZXhlY3V0ZSBldmVyeSBgZGVsYXlgIG1pbGxpc2Vjb25kcyB3aGlsZSB0aGVcbiAgICAvLyAgICB0aHJvdHRsZWQtZnVuY3Rpb24gaXMgYmVpbmcgY2FsbGVkLiBJZiBub190cmFpbGluZyBpcyBmYWxzZSBvclxuICAgIC8vICAgIHVuc3BlY2lmaWVkLCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIG9uZSBmaW5hbCB0aW1lIGFmdGVyIHRoZSBsYXN0XG4gICAgLy8gICAgdGhyb3R0bGVkLWZ1bmN0aW9uIGNhbGwuIChBZnRlciB0aGUgdGhyb3R0bGVkLWZ1bmN0aW9uIGhhcyBub3QgYmVlblxuICAgIC8vICAgIGNhbGxlZCBmb3IgYGRlbGF5YCBtaWxsaXNlY29uZHMsIHRoZSBpbnRlcm5hbCBjb3VudGVyIGlzIHJlc2V0KVxuICAgIC8vICBjYWxsYmFjayAtIChGdW5jdGlvbikgQSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCBhZnRlciBkZWxheSBtaWxsaXNlY29uZHMuXG4gICAgLy8gICAgVGhlIGB0aGlzYCBjb250ZXh0IGFuZCBhbGwgYXJndW1lbnRzIGFyZSBwYXNzZWQgdGhyb3VnaCwgYXMtaXMsIHRvXG4gICAgLy8gICAgYGNhbGxiYWNrYCB3aGVuIHRoZSB0aHJvdHRsZWQtZnVuY3Rpb24gaXMgZXhlY3V0ZWQuXG4gICAgLy9cbiAgICAvLyBSZXR1cm5zOlxuICAgIC8vXG4gICAgLy8gIChGdW5jdGlvbikgQSBuZXcsIHRocm90dGxlZCwgZnVuY3Rpb24uXG5cbiAgICAkLnRocm90dGxlID0ganFfdGhyb3R0bGUgPSBmdW5jdGlvbiggZGVsYXksIG5vX3RyYWlsaW5nLCBjYWxsYmFjaywgZGVib3VuY2VfbW9kZSApIHtcbiAgICAgICAgLy8gQWZ0ZXIgd3JhcHBlciBoYXMgc3RvcHBlZCBiZWluZyBjYWxsZWQsIHRoaXMgdGltZW91dCBlbnN1cmVzIHRoYXRcbiAgICAgICAgLy8gYGNhbGxiYWNrYCBpcyBleGVjdXRlZCBhdCB0aGUgcHJvcGVyIHRpbWVzIGluIGB0aHJvdHRsZWAgYW5kIGBlbmRgXG4gICAgICAgIC8vIGRlYm91bmNlIG1vZGVzLlxuICAgICAgICB2YXIgdGltZW91dF9pZCxcblxuICAgICAgICAgICAgLy8gS2VlcCB0cmFjayBvZiB0aGUgbGFzdCB0aW1lIGBjYWxsYmFja2Agd2FzIGV4ZWN1dGVkLlxuICAgICAgICAgICAgbGFzdF9leGVjID0gMDtcblxuICAgICAgICAvLyBgbm9fdHJhaWxpbmdgIGRlZmF1bHRzIHRvIGZhbHN5LlxuICAgICAgICBpZiAoIHR5cGVvZiBub190cmFpbGluZyAhPT0gJ2Jvb2xlYW4nICkge1xuICAgICAgICAgICAgZGVib3VuY2VfbW9kZSA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgY2FsbGJhY2sgPSBub190cmFpbGluZztcbiAgICAgICAgICAgIG5vX3RyYWlsaW5nID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGhlIGB3cmFwcGVyYCBmdW5jdGlvbiBlbmNhcHN1bGF0ZXMgYWxsIG9mIHRoZSB0aHJvdHRsaW5nIC8gZGVib3VuY2luZ1xuICAgICAgICAvLyBmdW5jdGlvbmFsaXR5IGFuZCB3aGVuIGV4ZWN1dGVkIHdpbGwgbGltaXQgdGhlIHJhdGUgYXQgd2hpY2ggYGNhbGxiYWNrYFxuICAgICAgICAvLyBpcyBleGVjdXRlZC5cbiAgICAgICAgZnVuY3Rpb24gd3JhcHBlcigpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBlbGFwc2VkID0gK25ldyBEYXRlKCkgLSBsYXN0X2V4ZWMsXG4gICAgICAgICAgICAgICAgYXJncyA9IGFyZ3VtZW50cztcblxuICAgICAgICAgICAgLy8gRXhlY3V0ZSBgY2FsbGJhY2tgIGFuZCB1cGRhdGUgdGhlIGBsYXN0X2V4ZWNgIHRpbWVzdGFtcC5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGV4ZWMoKSB7XG4gICAgICAgICAgICAgICAgbGFzdF9leGVjID0gK25ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoIHRoYXQsIGFyZ3MgKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIElmIGBkZWJvdW5jZV9tb2RlYCBpcyB0cnVlIChhdF9iZWdpbikgdGhpcyBpcyB1c2VkIHRvIGNsZWFyIHRoZSBmbGFnXG4gICAgICAgICAgICAvLyB0byBhbGxvdyBmdXR1cmUgYGNhbGxiYWNrYCBleGVjdXRpb25zLlxuICAgICAgICAgICAgZnVuY3Rpb24gY2xlYXIoKSB7XG4gICAgICAgICAgICAgICAgdGltZW91dF9pZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICggZGVib3VuY2VfbW9kZSAmJiAhdGltZW91dF9pZCApIHtcbiAgICAgICAgICAgICAgICAvLyBTaW5jZSBgd3JhcHBlcmAgaXMgYmVpbmcgY2FsbGVkIGZvciB0aGUgZmlyc3QgdGltZSBhbmRcbiAgICAgICAgICAgICAgICAvLyBgZGVib3VuY2VfbW9kZWAgaXMgdHJ1ZSAoYXRfYmVnaW4pLCBleGVjdXRlIGBjYWxsYmFja2AuXG4gICAgICAgICAgICAgICAgZXhlYygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgdGltZW91dC5cbiAgICAgICAgICAgIHRpbWVvdXRfaWQgJiYgY2xlYXJUaW1lb3V0KCB0aW1lb3V0X2lkICk7XG5cbiAgICAgICAgICAgIGlmICggZGVib3VuY2VfbW9kZSA9PT0gdW5kZWZpbmVkICYmIGVsYXBzZWQgPiBkZWxheSApIHtcbiAgICAgICAgICAgICAgICAvLyBJbiB0aHJvdHRsZSBtb2RlLCBpZiBgZGVsYXlgIHRpbWUgaGFzIGJlZW4gZXhjZWVkZWQsIGV4ZWN1dGVcbiAgICAgICAgICAgICAgICAvLyBgY2FsbGJhY2tgLlxuICAgICAgICAgICAgICAgIGV4ZWMoKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICggbm9fdHJhaWxpbmcgIT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgLy8gSW4gdHJhaWxpbmcgdGhyb3R0bGUgbW9kZSwgc2luY2UgYGRlbGF5YCB0aW1lIGhhcyBub3QgYmVlblxuICAgICAgICAgICAgICAgIC8vIGV4Y2VlZGVkLCBzY2hlZHVsZSBgY2FsbGJhY2tgIHRvIGV4ZWN1dGUgYGRlbGF5YCBtcyBhZnRlciBtb3N0XG4gICAgICAgICAgICAgICAgLy8gcmVjZW50IGV4ZWN1dGlvbi5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIElmIGBkZWJvdW5jZV9tb2RlYCBpcyB0cnVlIChhdF9iZWdpbiksIHNjaGVkdWxlIGBjbGVhcmAgdG8gZXhlY3V0ZVxuICAgICAgICAgICAgICAgIC8vIGFmdGVyIGBkZWxheWAgbXMuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBJZiBgZGVib3VuY2VfbW9kZWAgaXMgZmFsc2UgKGF0IGVuZCksIHNjaGVkdWxlIGBjYWxsYmFja2AgdG9cbiAgICAgICAgICAgICAgICAvLyBleGVjdXRlIGFmdGVyIGBkZWxheWAgbXMuXG4gICAgICAgICAgICAgICAgdGltZW91dF9pZCA9IHNldFRpbWVvdXQoIGRlYm91bmNlX21vZGUgPyBjbGVhciA6IGV4ZWMsIGRlYm91bmNlX21vZGUgPT09IHVuZGVmaW5lZCA/IGRlbGF5IC0gZWxhcHNlZCA6IGRlbGF5ICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gU2V0IHRoZSBndWlkIG9mIGB3cmFwcGVyYCBmdW5jdGlvbiB0byB0aGUgc2FtZSBvZiBvcmlnaW5hbCBjYWxsYmFjaywgc29cbiAgICAgICAgLy8gaXQgY2FuIGJlIHJlbW92ZWQgaW4galF1ZXJ5IDEuNCsgLnVuYmluZCBvciAuZGllIGJ5IHVzaW5nIHRoZSBvcmlnaW5hbFxuICAgICAgICAvLyBjYWxsYmFjayBhcyBhIHJlZmVyZW5jZS5cbiAgICAgICAgaWYgKCAkLmd1aWQgKSB7XG4gICAgICAgICAgICB3cmFwcGVyLmd1aWQgPSBjYWxsYmFjay5ndWlkID0gY2FsbGJhY2suZ3VpZCB8fCAkLmd1aWQrKztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJldHVybiB0aGUgd3JhcHBlciBmdW5jdGlvbi5cbiAgICAgICAgcmV0dXJuIHdyYXBwZXI7XG4gICAgfTtcblxuICAgIC8vIE1ldGhvZDogalF1ZXJ5LmRlYm91bmNlXG4gICAgLy9cbiAgICAvLyBEZWJvdW5jZSBleGVjdXRpb24gb2YgYSBmdW5jdGlvbi4gRGVib3VuY2luZywgdW5saWtlIHRocm90dGxpbmcsXG4gICAgLy8gZ3VhcmFudGVlcyB0aGF0IGEgZnVuY3Rpb24gaXMgb25seSBleGVjdXRlZCBhIHNpbmdsZSB0aW1lLCBlaXRoZXIgYXQgdGhlXG4gICAgLy8gdmVyeSBiZWdpbm5pbmcgb2YgYSBzZXJpZXMgb2YgY2FsbHMsIG9yIGF0IHRoZSB2ZXJ5IGVuZC4gSWYgeW91IHdhbnQgdG9cbiAgICAvLyBzaW1wbHkgcmF0ZS1saW1pdCBleGVjdXRpb24gb2YgYSBmdW5jdGlvbiwgc2VlIHRoZSA8alF1ZXJ5LnRocm90dGxlPlxuICAgIC8vIG1ldGhvZC5cbiAgICAvL1xuICAgIC8vIEluIHRoaXMgdmlzdWFsaXphdGlvbiwgfCBpcyBhIGRlYm91bmNlZC1mdW5jdGlvbiBjYWxsIGFuZCBYIGlzIHRoZSBhY3R1YWxcbiAgICAvLyBjYWxsYmFjayBleGVjdXRpb246XG4gICAgLy9cbiAgICAvLyA+IERlYm91bmNlZCB3aXRoIGBhdF9iZWdpbmAgc3BlY2lmaWVkIGFzIGZhbHNlIG9yIHVuc3BlY2lmaWVkOlxuICAgIC8vID4gfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fCAocGF1c2UpIHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHxcbiAgICAvLyA+ICAgICAgICAgICAgICAgICAgICAgICAgICBYICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWFxuICAgIC8vID5cbiAgICAvLyA+IERlYm91bmNlZCB3aXRoIGBhdF9iZWdpbmAgc3BlY2lmaWVkIGFzIHRydWU6XG4gICAgLy8gPiB8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8IChwYXVzZSkgfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fFxuICAgIC8vID4gWCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhcbiAgICAvL1xuICAgIC8vIFVzYWdlOlxuICAgIC8vXG4gICAgLy8gPiB2YXIgZGVib3VuY2VkID0galF1ZXJ5LmRlYm91bmNlKCBkZWxheSwgWyBhdF9iZWdpbiwgXSBjYWxsYmFjayApO1xuICAgIC8vID5cbiAgICAvLyA+IGpRdWVyeSgnc2VsZWN0b3InKS5iaW5kKCAnc29tZWV2ZW50JywgZGVib3VuY2VkICk7XG4gICAgLy8gPiBqUXVlcnkoJ3NlbGVjdG9yJykudW5iaW5kKCAnc29tZWV2ZW50JywgZGVib3VuY2VkICk7XG4gICAgLy9cbiAgICAvLyBUaGlzIGFsc28gd29ya3MgaW4galF1ZXJ5IDEuNCs6XG4gICAgLy9cbiAgICAvLyA+IGpRdWVyeSgnc2VsZWN0b3InKS5iaW5kKCAnc29tZWV2ZW50JywgalF1ZXJ5LmRlYm91bmNlKCBkZWxheSwgWyBhdF9iZWdpbiwgXSBjYWxsYmFjayApICk7XG4gICAgLy8gPiBqUXVlcnkoJ3NlbGVjdG9yJykudW5iaW5kKCAnc29tZWV2ZW50JywgY2FsbGJhY2sgKTtcbiAgICAvL1xuICAgIC8vIEFyZ3VtZW50czpcbiAgICAvL1xuICAgIC8vICBkZWxheSAtIChOdW1iZXIpIEEgemVyby1vci1ncmVhdGVyIGRlbGF5IGluIG1pbGxpc2Vjb25kcy4gRm9yIGV2ZW50XG4gICAgLy8gICAgY2FsbGJhY2tzLCB2YWx1ZXMgYXJvdW5kIDEwMCBvciAyNTAgKG9yIGV2ZW4gaGlnaGVyKSBhcmUgbW9zdCB1c2VmdWwuXG4gICAgLy8gIGF0X2JlZ2luIC0gKEJvb2xlYW4pIE9wdGlvbmFsLCBkZWZhdWx0cyB0byBmYWxzZS4gSWYgYXRfYmVnaW4gaXMgZmFsc2Ugb3JcbiAgICAvLyAgICB1bnNwZWNpZmllZCwgY2FsbGJhY2sgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIGBkZWxheWAgbWlsbGlzZWNvbmRzIGFmdGVyXG4gICAgLy8gICAgdGhlIGxhc3QgZGVib3VuY2VkLWZ1bmN0aW9uIGNhbGwuIElmIGF0X2JlZ2luIGlzIHRydWUsIGNhbGxiYWNrIHdpbGwgYmVcbiAgICAvLyAgICBleGVjdXRlZCBvbmx5IGF0IHRoZSBmaXJzdCBkZWJvdW5jZWQtZnVuY3Rpb24gY2FsbC4gKEFmdGVyIHRoZVxuICAgIC8vICAgIHRocm90dGxlZC1mdW5jdGlvbiBoYXMgbm90IGJlZW4gY2FsbGVkIGZvciBgZGVsYXlgIG1pbGxpc2Vjb25kcywgdGhlXG4gICAgLy8gICAgaW50ZXJuYWwgY291bnRlciBpcyByZXNldClcbiAgICAvLyAgY2FsbGJhY2sgLSAoRnVuY3Rpb24pIEEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgYWZ0ZXIgZGVsYXkgbWlsbGlzZWNvbmRzLlxuICAgIC8vICAgIFRoZSBgdGhpc2AgY29udGV4dCBhbmQgYWxsIGFyZ3VtZW50cyBhcmUgcGFzc2VkIHRocm91Z2gsIGFzLWlzLCB0b1xuICAgIC8vICAgIGBjYWxsYmFja2Agd2hlbiB0aGUgZGVib3VuY2VkLWZ1bmN0aW9uIGlzIGV4ZWN1dGVkLlxuICAgIC8vXG4gICAgLy8gUmV0dXJuczpcbiAgICAvL1xuICAgIC8vICAoRnVuY3Rpb24pIEEgbmV3LCBkZWJvdW5jZWQsIGZ1bmN0aW9uLlxuXG4gICAgJC5kZWJvdW5jZSA9IGZ1bmN0aW9uKCBkZWxheSwgYXRfYmVnaW4sIGNhbGxiYWNrICkge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sgPT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgPyBqcV90aHJvdHRsZSggZGVsYXksIGF0X2JlZ2luLCBmYWxzZSApXG4gICAgICAgICAgICA6IGpxX3Rocm90dGxlKCBkZWxheSwgY2FsbGJhY2ssIGF0X2JlZ2luICE9PSBmYWxzZSApO1xuICAgIH07XG5cbn0pKHRoaXMpOyIsIi8vIFRoZSBNSVQgTGljZW5zZSAoTUlUKVxuXG4vLyBUeXBlZC5qcyB8IENvcHlyaWdodCAoYykgMjAxNCBNYXR0IEJvbGR0IHwgd3d3Lm1hdHRib2xkdC5jb21cblxuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5cblxuXG4hIGZ1bmN0aW9uKCQpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIFR5cGVkID0gZnVuY3Rpb24oZWwsIG9wdGlvbnMpIHtcblxuICAgICAgICAvLyBjaG9zZW4gZWxlbWVudCB0byBtYW5pcHVsYXRlIHRleHRcbiAgICAgICAgdGhpcy5lbCA9ICQoZWwpO1xuXG4gICAgICAgIC8vIG9wdGlvbnNcbiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sICQuZm4udHlwZWQuZGVmYXVsdHMsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8vIGF0dHJpYnV0ZSB0byB0eXBlIGludG9cbiAgICAgICAgdGhpcy5pc0lucHV0ID0gdGhpcy5lbC5pcygnaW5wdXQnKTtcbiAgICAgICAgdGhpcy5hdHRyID0gdGhpcy5vcHRpb25zLmF0dHI7XG5cbiAgICAgICAgLy8gc2hvdyBjdXJzb3JcbiAgICAgICAgdGhpcy5zaG93Q3Vyc29yID0gdGhpcy5pc0lucHV0ID8gZmFsc2UgOiB0aGlzLm9wdGlvbnMuc2hvd0N1cnNvcjtcblxuICAgICAgICAvLyB0ZXh0IGNvbnRlbnQgb2YgZWxlbWVudFxuICAgICAgICB0aGlzLmVsQ29udGVudCA9IHRoaXMuYXR0ciA/IHRoaXMuZWwuYXR0cih0aGlzLmF0dHIpIDogdGhpcy5lbC50ZXh0KClcblxuICAgICAgICAvLyBodG1sIG9yIHBsYWluIHRleHRcbiAgICAgICAgdGhpcy5jb250ZW50VHlwZSA9IHRoaXMub3B0aW9ucy5jb250ZW50VHlwZTtcblxuICAgICAgICAvLyB0eXBpbmcgc3BlZWRcbiAgICAgICAgdGhpcy50eXBlU3BlZWQgPSB0aGlzLm9wdGlvbnMudHlwZVNwZWVkO1xuXG4gICAgICAgIC8vIGFkZCBhIGRlbGF5IGJlZm9yZSB0eXBpbmcgc3RhcnRzXG4gICAgICAgIHRoaXMuc3RhcnREZWxheSA9IHRoaXMub3B0aW9ucy5zdGFydERlbGF5O1xuXG4gICAgICAgIC8vIGJhY2tzcGFjaW5nIHNwZWVkXG4gICAgICAgIHRoaXMuYmFja1NwZWVkID0gdGhpcy5vcHRpb25zLmJhY2tTcGVlZDtcblxuICAgICAgICAvLyBhbW91bnQgb2YgdGltZSB0byB3YWl0IGJlZm9yZSBiYWNrc3BhY2luZ1xuICAgICAgICB0aGlzLmJhY2tEZWxheSA9IHRoaXMub3B0aW9ucy5iYWNrRGVsYXk7XG5cbiAgICAgICAgLy8gZGl2IGNvbnRhaW5pbmcgc3RyaW5nc1xuICAgICAgICB0aGlzLnN0cmluZ3NFbGVtZW50ID0gdGhpcy5vcHRpb25zLnN0cmluZ3NFbGVtZW50O1xuXG4gICAgICAgIC8vIGlucHV0IHN0cmluZ3Mgb2YgdGV4dFxuICAgICAgICB0aGlzLnN0cmluZ3MgPSB0aGlzLm9wdGlvbnMuc3RyaW5ncztcblxuICAgICAgICAvLyBjaGFyYWN0ZXIgbnVtYmVyIHBvc2l0aW9uIG9mIGN1cnJlbnQgc3RyaW5nXG4gICAgICAgIHRoaXMuc3RyUG9zID0gMDtcblxuICAgICAgICAvLyBjdXJyZW50IGFycmF5IHBvc2l0aW9uXG4gICAgICAgIHRoaXMuYXJyYXlQb3MgPSAwO1xuXG4gICAgICAgIC8vIG51bWJlciB0byBzdG9wIGJhY2tzcGFjaW5nIG9uLlxuICAgICAgICAvLyBkZWZhdWx0IDAsIGNhbiBjaGFuZ2UgZGVwZW5kaW5nIG9uIGhvdyBtYW55IGNoYXJzXG4gICAgICAgIC8vIHlvdSB3YW50IHRvIHJlbW92ZSBhdCB0aGUgdGltZVxuICAgICAgICB0aGlzLnN0b3BOdW0gPSAwO1xuXG4gICAgICAgIC8vIExvb3BpbmcgbG9naWNcbiAgICAgICAgdGhpcy5sb29wID0gdGhpcy5vcHRpb25zLmxvb3A7XG4gICAgICAgIHRoaXMubG9vcENvdW50ID0gdGhpcy5vcHRpb25zLmxvb3BDb3VudDtcbiAgICAgICAgdGhpcy5jdXJMb29wID0gMDtcblxuICAgICAgICAvLyBmb3Igc3RvcHBpbmdcbiAgICAgICAgdGhpcy5zdG9wID0gZmFsc2U7XG5cbiAgICAgICAgLy8gY3VzdG9tIGN1cnNvclxuICAgICAgICB0aGlzLmN1cnNvckNoYXIgPSB0aGlzLm9wdGlvbnMuY3Vyc29yQ2hhcjtcblxuICAgICAgICAvLyBzaHVmZmxlIHRoZSBzdHJpbmdzXG4gICAgICAgIHRoaXMuc2h1ZmZsZSA9IHRoaXMub3B0aW9ucy5zaHVmZmxlO1xuICAgICAgICAvLyB0aGUgb3JkZXIgb2Ygc3RyaW5nc1xuICAgICAgICB0aGlzLnNlcXVlbmNlID0gW107XG5cbiAgICAgICAgLy8gQWxsIHN5c3RlbXMgZ28hXG4gICAgICAgIHRoaXMuYnVpbGQoKTtcbiAgICB9O1xuXG4gICAgVHlwZWQucHJvdG90eXBlID0ge1xuXG4gICAgICAgIGNvbnN0cnVjdG9yOiBUeXBlZFxuXG4gICAgICAgICxcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBiZWdpbiB0aGUgbG9vcCB3LyBmaXJzdCBjdXJyZW50IHN0cmluZyAoZ2xvYmFsIHNlbGYuc3RyaW5ncylcbiAgICAgICAgICAgIC8vIGN1cnJlbnQgc3RyaW5nIHdpbGwgYmUgcGFzc2VkIGFzIGFuIGFyZ3VtZW50IGVhY2ggdGltZSBhZnRlciB0aGlzXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICBzZWxmLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPHNlbGYuc3RyaW5ncy5sZW5ndGg7KytpKSBzZWxmLnNlcXVlbmNlW2ldPWk7XG5cbiAgICAgICAgICAgICAgICAvLyBzaHVmZmxlIHRoZSBhcnJheSBpZiB0cnVlXG4gICAgICAgICAgICAgICAgaWYoc2VsZi5zaHVmZmxlKSBzZWxmLnNlcXVlbmNlID0gc2VsZi5zaHVmZmxlQXJyYXkoc2VsZi5zZXF1ZW5jZSk7XG5cbiAgICAgICAgICAgICAgICAvLyBTdGFydCB0eXBpbmdcbiAgICAgICAgICAgICAgICBzZWxmLnR5cGV3cml0ZShzZWxmLnN0cmluZ3Nbc2VsZi5zZXF1ZW5jZVtzZWxmLmFycmF5UG9zXV0sIHNlbGYuc3RyUG9zKTtcbiAgICAgICAgICAgIH0sIHNlbGYuc3RhcnREZWxheSk7XG4gICAgICAgIH1cblxuICAgICAgICAsXG4gICAgICAgIGJ1aWxkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIC8vIEluc2VydCBjdXJzb3JcbiAgICAgICAgICAgIGlmICh0aGlzLnNob3dDdXJzb3IgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnNvciA9ICQoXCI8c3BhbiBjbGFzcz1cXFwidHlwZWQtY3Vyc29yXFxcIj5cIiArIHRoaXMuY3Vyc29yQ2hhciArIFwiPC9zcGFuPlwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsLmFmdGVyKHRoaXMuY3Vyc29yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnN0cmluZ3NFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zdHJpbmdzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5zdHJpbmdzRWxlbWVudC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgdmFyIHN0cmluZ3MgPSB0aGlzLnN0cmluZ3NFbGVtZW50LmZpbmQoJ3AnKTtcbiAgICAgICAgICAgICAgICAkLmVhY2goc3RyaW5ncywgZnVuY3Rpb24oa2V5LCB2YWx1ZSl7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc3RyaW5ncy5wdXNoKCQodmFsdWUpLmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHBhc3MgY3VycmVudCBzdHJpbmcgc3RhdGUgdG8gZWFjaCBmdW5jdGlvbiwgdHlwZXMgMSBjaGFyIHBlciBjYWxsXG4gICAgICAgICxcbiAgICAgICAgdHlwZXdyaXRlOiBmdW5jdGlvbihjdXJTdHJpbmcsIGN1clN0clBvcykge1xuICAgICAgICAgICAgLy8gZXhpdCB3aGVuIHN0b3BwZWRcbiAgICAgICAgICAgIGlmICh0aGlzLnN0b3AgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHZhcnlpbmcgdmFsdWVzIGZvciBzZXRUaW1lb3V0IGR1cmluZyB0eXBpbmdcbiAgICAgICAgICAgIC8vIGNhbid0IGJlIGdsb2JhbCBzaW5jZSBudW1iZXIgY2hhbmdlcyBlYWNoIHRpbWUgbG9vcCBpcyBleGVjdXRlZFxuICAgICAgICAgICAgdmFyIGh1bWFuaXplID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogKDEwMCAtIDMwKSkgKyB0aGlzLnR5cGVTcGVlZDtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLSBvcHRpb25hbCAtLS0tLS0tLS0tLS0tIC8vXG4gICAgICAgICAgICAvLyBiYWNrcGFjZXMgYSBjZXJ0YWluIHN0cmluZyBmYXN0ZXJcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuICAgICAgICAgICAgLy8gaWYgKHNlbGYuYXJyYXlQb3MgPT0gMSl7XG4gICAgICAgICAgICAvLyAgc2VsZi5iYWNrRGVsYXkgPSA1MDtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIC8vIGVsc2V7IHNlbGYuYmFja0RlbGF5ID0gNTAwOyB9XG5cbiAgICAgICAgICAgIC8vIGNvbnRhaW4gdHlwaW5nIGZ1bmN0aW9uIGluIGEgdGltZW91dCBodW1hbml6ZSdkIGRlbGF5XG4gICAgICAgICAgICBzZWxmLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBhbiBlc2NhcGUgY2hhcmFjdGVyIGJlZm9yZSBhIHBhdXNlIHZhbHVlXG4gICAgICAgICAgICAgICAgLy8gZm9ybWF0OiBcXF5cXGQrIC4uIGVnOiBeMTAwMCAuLiBzaG91bGQgYmUgYWJsZSB0byBwcmludCB0aGUgXiB0b28gdXNpbmcgXl5cbiAgICAgICAgICAgICAgICAvLyBzaW5nbGUgXiBhcmUgcmVtb3ZlZCBmcm9tIHN0cmluZ1xuICAgICAgICAgICAgICAgIHZhciBjaGFyUGF1c2UgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBzdWJzdHIgPSBjdXJTdHJpbmcuc3Vic3RyKGN1clN0clBvcyk7XG4gICAgICAgICAgICAgICAgaWYgKHN1YnN0ci5jaGFyQXQoMCkgPT09ICdeJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2tpcCA9IDE7IC8vIHNraXAgYXRsZWFzdCAxXG4gICAgICAgICAgICAgICAgICAgIGlmICgvXlxcXlxcZCsvLnRlc3Qoc3Vic3RyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3Vic3RyID0gL1xcZCsvLmV4ZWMoc3Vic3RyKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNraXAgKz0gc3Vic3RyLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJQYXVzZSA9IHBhcnNlSW50KHN1YnN0cik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBzdHJpcCBvdXQgdGhlIGVzY2FwZSBjaGFyYWN0ZXIgYW5kIHBhdXNlIHZhbHVlIHNvIHRoZXkncmUgbm90IHByaW50ZWRcbiAgICAgICAgICAgICAgICAgICAgY3VyU3RyaW5nID0gY3VyU3RyaW5nLnN1YnN0cmluZygwLCBjdXJTdHJQb3MpICsgY3VyU3RyaW5nLnN1YnN0cmluZyhjdXJTdHJQb3MgKyBza2lwKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5jb250ZW50VHlwZSA9PT0gJ2h0bWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNraXAgb3ZlciBodG1sIHRhZ3Mgd2hpbGUgdHlwaW5nXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJDaGFyID0gY3VyU3RyaW5nLnN1YnN0cihjdXJTdHJQb3MpLmNoYXJBdCgwKVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VyQ2hhciA9PT0gJzwnIHx8IGN1ckNoYXIgPT09ICcmJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVuZFRhZyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1ckNoYXIgPT09ICc8Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZFRhZyA9ICc+J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRUYWcgPSAnOydcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChjdXJTdHJpbmcuc3Vic3RyKGN1clN0clBvcykuY2hhckF0KDApICE9PSBlbmRUYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWcgKz0gY3VyU3RyaW5nLnN1YnN0cihjdXJTdHJQb3MpLmNoYXJBdCgwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJTdHJQb3MrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGN1clN0clBvcysrO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFnICs9IGVuZFRhZztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHRpbWVvdXQgZm9yIGFueSBwYXVzZSBhZnRlciBhIGNoYXJhY3RlclxuICAgICAgICAgICAgICAgIHNlbGYudGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJTdHJQb3MgPT09IGN1clN0cmluZy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZpcmVzIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMub25TdHJpbmdUeXBlZChzZWxmLmFycmF5UG9zKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXMgdGhpcyB0aGUgZmluYWwgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5hcnJheVBvcyA9PT0gc2VsZi5zdHJpbmdzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmltYXRpb24gdGhhdCBvY2N1cnMgb24gdGhlIGxhc3QgdHlwZWQgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vcHRpb25zLmNhbGxiYWNrKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmN1ckxvb3ArKztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHF1aXQgaWYgd2Ugd29udCBsb29wIGJhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5sb29wID09PSBmYWxzZSB8fCBzZWxmLmN1ckxvb3AgPT09IHNlbGYubG9vcENvdW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5iYWNrc3BhY2UoY3VyU3RyaW5nLCBjdXJTdHJQb3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgc2VsZi5iYWNrRGVsYXkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvKiBjYWxsIGJlZm9yZSBmdW5jdGlvbnMgaWYgYXBwbGljYWJsZSAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1clN0clBvcyA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvbnMucHJlU3RyaW5nVHlwZWQoc2VsZi5hcnJheVBvcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0IHR5cGluZyBlYWNoIG5ldyBjaGFyIGludG8gZXhpc3Rpbmcgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjdXJTdHJpbmc6IGFyZywgc2VsZi5lbC5odG1sOiBvcmlnaW5hbCB0ZXh0IGluc2lkZSBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dFN0cmluZyA9IGN1clN0cmluZy5zdWJzdHIoMCwgY3VyU3RyUG9zICsgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5hdHRyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbC5hdHRyKHNlbGYuYXR0ciwgbmV4dFN0cmluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmlzSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbC52YWwobmV4dFN0cmluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxmLmNvbnRlbnRUeXBlID09PSAnaHRtbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbC5odG1sKG5leHRTdHJpbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWwudGV4dChuZXh0U3RyaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBjaGFyYWN0ZXJzIG9uZSBieSBvbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1clN0clBvcysrO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9vcCB0aGUgZnVuY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHlwZXdyaXRlKGN1clN0cmluZywgY3VyU3RyUG9zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBlbmQgb2YgY2hhcmFjdGVyIHBhdXNlXG4gICAgICAgICAgICAgICAgfSwgY2hhclBhdXNlKTtcblxuICAgICAgICAgICAgICAgIC8vIGh1bWFuaXplZCB2YWx1ZSBmb3IgdHlwaW5nXG4gICAgICAgICAgICB9LCBodW1hbml6ZSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgICxcbiAgICAgICAgYmFja3NwYWNlOiBmdW5jdGlvbihjdXJTdHJpbmcsIGN1clN0clBvcykge1xuICAgICAgICAgICAgLy8gZXhpdCB3aGVuIHN0b3BwZWRcbiAgICAgICAgICAgIGlmICh0aGlzLnN0b3AgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHZhcnlpbmcgdmFsdWVzIGZvciBzZXRUaW1lb3V0IGR1cmluZyB0eXBpbmdcbiAgICAgICAgICAgIC8vIGNhbid0IGJlIGdsb2JhbCBzaW5jZSBudW1iZXIgY2hhbmdlcyBlYWNoIHRpbWUgbG9vcCBpcyBleGVjdXRlZFxuICAgICAgICAgICAgdmFyIGh1bWFuaXplID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogKDEwMCAtIDMwKSkgKyB0aGlzLmJhY2tTcGVlZDtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgc2VsZi50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIC8vIC0tLS0tIHRoaXMgcGFydCBpcyBvcHRpb25hbCAtLS0tLSAvL1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIHN0cmluZyBhcnJheSBwb3NpdGlvblxuICAgICAgICAgICAgICAgIC8vIG9uIHRoZSBmaXJzdCBzdHJpbmcsIG9ubHkgZGVsZXRlIG9uZSB3b3JkXG4gICAgICAgICAgICAgICAgLy8gdGhlIHN0b3BOdW0gYWN0dWFsbHkgcmVwcmVzZW50cyB0aGUgYW1vdW50IG9mIGNoYXJzIHRvXG4gICAgICAgICAgICAgICAgLy8ga2VlcCBpbiB0aGUgY3VycmVudCBzdHJpbmcuIEluIG15IGNhc2UgaXQncyAxNC5cbiAgICAgICAgICAgICAgICAvLyBpZiAoc2VsZi5hcnJheVBvcyA9PSAxKXtcbiAgICAgICAgICAgICAgICAvLyAgc2VsZi5zdG9wTnVtID0gMTQ7XG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgIC8vZXZlcnkgb3RoZXIgdGltZSwgZGVsZXRlIHRoZSB3aG9sZSB0eXBlZCBzdHJpbmdcbiAgICAgICAgICAgICAgICAvLyBlbHNle1xuICAgICAgICAgICAgICAgIC8vICBzZWxmLnN0b3BOdW0gPSAwO1xuICAgICAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgICAgIGlmIChzZWxmLmNvbnRlbnRUeXBlID09PSAnaHRtbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2tpcCBvdmVyIGh0bWwgdGFncyB3aGlsZSBiYWNrc3BhY2luZ1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VyU3RyaW5nLnN1YnN0cihjdXJTdHJQb3MpLmNoYXJBdCgwKSA9PT0gJz4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFnID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY3VyU3RyaW5nLnN1YnN0cihjdXJTdHJQb3MpLmNoYXJBdCgwKSAhPT0gJzwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnIC09IGN1clN0cmluZy5zdWJzdHIoY3VyU3RyUG9zKS5jaGFyQXQoMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyU3RyUG9zLS07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJTdHJQb3MtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZyArPSAnPCc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyAtLS0tLSBjb250aW51ZSBpbXBvcnRhbnQgc3R1ZmYgLS0tLS0gLy9cbiAgICAgICAgICAgICAgICAvLyByZXBsYWNlIHRleHQgd2l0aCBiYXNlIHRleHQgKyB0eXBlZCBjaGFyYWN0ZXJzXG4gICAgICAgICAgICAgICAgdmFyIG5leHRTdHJpbmcgPSBjdXJTdHJpbmcuc3Vic3RyKDAsIGN1clN0clBvcyk7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuYXR0cikge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmVsLmF0dHIoc2VsZi5hdHRyLCBuZXh0U3RyaW5nKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5pc0lucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmVsLnZhbChuZXh0U3RyaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxmLmNvbnRlbnRUeXBlID09PSAnaHRtbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWwuaHRtbChuZXh0U3RyaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWwudGV4dChuZXh0U3RyaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBudW1iZXIgKGlkIG9mIGNoYXJhY3RlciBpbiBjdXJyZW50IHN0cmluZykgaXNcbiAgICAgICAgICAgICAgICAvLyBsZXNzIHRoYW4gdGhlIHN0b3AgbnVtYmVyLCBrZWVwIGdvaW5nXG4gICAgICAgICAgICAgICAgaWYgKGN1clN0clBvcyA+IHNlbGYuc3RvcE51bSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzdWJ0cmFjdCBjaGFyYWN0ZXJzIG9uZSBieSBvbmVcbiAgICAgICAgICAgICAgICAgICAgY3VyU3RyUG9zLS07XG4gICAgICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhlIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYmFja3NwYWNlKGN1clN0cmluZywgY3VyU3RyUG9zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaWYgdGhlIHN0b3AgbnVtYmVyIGhhcyBiZWVuIHJlYWNoZWQsIGluY3JlYXNlXG4gICAgICAgICAgICAgICAgLy8gYXJyYXkgcG9zaXRpb24gdG8gbmV4dCBzdHJpbmdcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJTdHJQb3MgPD0gc2VsZi5zdG9wTnVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYXJyYXlQb3MrKztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5hcnJheVBvcyA9PT0gc2VsZi5zdHJpbmdzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hcnJheVBvcyA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNodWZmbGUgc2VxdWVuY2UgYWdhaW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlbGYuc2h1ZmZsZSkgc2VsZi5zZXF1ZW5jZSA9IHNlbGYuc2h1ZmZsZUFycmF5KHNlbGYuc2VxdWVuY2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmluaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnR5cGV3cml0ZShzZWxmLnN0cmluZ3Nbc2VsZi5zZXF1ZW5jZVtzZWxmLmFycmF5UG9zXV0sIGN1clN0clBvcyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gaHVtYW5pemVkIHZhbHVlIGZvciB0eXBpbmdcbiAgICAgICAgICAgIH0sIGh1bWFuaXplKTtcblxuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaHVmZmxlcyB0aGUgbnVtYmVycyBpbiB0aGUgZ2l2ZW4gYXJyYXkuXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5XG4gICAgICAgICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICAgICAgICovXG4gICAgICAgICxzaHVmZmxlQXJyYXk6IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgICAgICAgICB2YXIgdG1wLCBjdXJyZW50LCB0b3AgPSBhcnJheS5sZW5ndGg7XG4gICAgICAgICAgICBpZih0b3ApIHdoaWxlKC0tdG9wKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0b3AgKyAxKSk7XG4gICAgICAgICAgICAgICAgdG1wID0gYXJyYXlbY3VycmVudF07XG4gICAgICAgICAgICAgICAgYXJyYXlbY3VycmVudF0gPSBhcnJheVt0b3BdO1xuICAgICAgICAgICAgICAgIGFycmF5W3RvcF0gPSB0bXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdGFydCAmIFN0b3AgY3VycmVudGx5IG5vdCB3b3JraW5nXG5cbiAgICAgICAgLy8gLCBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvLyAgICAgc2VsZi5zdG9wID0gdHJ1ZTtcbiAgICAgICAgLy8gICAgIGNsZWFySW50ZXJ2YWwoc2VsZi50aW1lb3V0KTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vICwgc3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAvLyAgICAgaWYoc2VsZi5zdG9wID09PSBmYWxzZSlcbiAgICAgICAgLy8gICAgICAgIHJldHVybjtcblxuICAgICAgICAvLyAgICAgdGhpcy5zdG9wID0gZmFsc2U7XG4gICAgICAgIC8vICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vIFJlc2V0IGFuZCByZWJ1aWxkIHRoZSBlbGVtZW50XG4gICAgICAgICxcbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChzZWxmLnRpbWVvdXQpO1xuICAgICAgICAgICAgdmFyIGlkID0gdGhpcy5lbC5hdHRyKCdpZCcpO1xuICAgICAgICAgICAgdGhpcy5lbC5hZnRlcignPHNwYW4gaWQ9XCInICsgaWQgKyAnXCIvPicpXG4gICAgICAgICAgICB0aGlzLmVsLnJlbW92ZSgpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmN1cnNvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnNvci5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFNlbmQgdGhlIGNhbGxiYWNrXG4gICAgICAgICAgICBzZWxmLm9wdGlvbnMucmVzZXRDYWxsYmFjaygpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgJC5mbi50eXBlZCA9IGZ1bmN0aW9uKG9wdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICBkYXRhID0gJHRoaXMuZGF0YSgndHlwZWQnKSxcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb247XG4gICAgICAgICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ3R5cGVkJywgKGRhdGEgPSBuZXcgVHlwZWQodGhpcywgb3B0aW9ucykpKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICQuZm4udHlwZWQuZGVmYXVsdHMgPSB7XG4gICAgICAgIHN0cmluZ3M6IFtcIlRoZXNlIGFyZSB0aGUgZGVmYXVsdCB2YWx1ZXMuLi5cIiwgXCJZb3Uga25vdyB3aGF0IHlvdSBzaG91bGQgZG8/XCIsIFwiVXNlIHlvdXIgb3duIVwiLCBcIkhhdmUgYSBncmVhdCBkYXkhXCJdLFxuICAgICAgICBzdHJpbmdzRWxlbWVudDogbnVsbCxcbiAgICAgICAgLy8gdHlwaW5nIHNwZWVkXG4gICAgICAgIHR5cGVTcGVlZDogMCxcbiAgICAgICAgLy8gdGltZSBiZWZvcmUgdHlwaW5nIHN0YXJ0c1xuICAgICAgICBzdGFydERlbGF5OiAwLFxuICAgICAgICAvLyBiYWNrc3BhY2luZyBzcGVlZFxuICAgICAgICBiYWNrU3BlZWQ6IDAsXG4gICAgICAgIC8vIHNodWZmbGUgdGhlIHN0cmluZ3NcbiAgICAgICAgc2h1ZmZsZTogZmFsc2UsXG4gICAgICAgIC8vIHRpbWUgYmVmb3JlIGJhY2tzcGFjaW5nXG4gICAgICAgIGJhY2tEZWxheTogNTAwLFxuICAgICAgICAvLyBsb29wXG4gICAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgICAvLyBmYWxzZSA9IGluZmluaXRlXG4gICAgICAgIGxvb3BDb3VudDogZmFsc2UsXG4gICAgICAgIC8vIHNob3cgY3Vyc29yXG4gICAgICAgIHNob3dDdXJzb3I6IHRydWUsXG4gICAgICAgIC8vIGNoYXJhY3RlciBmb3IgY3Vyc29yXG4gICAgICAgIGN1cnNvckNoYXI6IFwifFwiLFxuICAgICAgICAvLyBhdHRyaWJ1dGUgdG8gdHlwZSAobnVsbCA9PSB0ZXh0KVxuICAgICAgICBhdHRyOiBudWxsLFxuICAgICAgICAvLyBlaXRoZXIgaHRtbCBvciB0ZXh0XG4gICAgICAgIGNvbnRlbnRUeXBlOiAnaHRtbCcsXG4gICAgICAgIC8vIGNhbGwgd2hlbiBkb25lIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICAvLyBzdGFydGluZyBjYWxsYmFjayBmdW5jdGlvbiBiZWZvcmUgZWFjaCBzdHJpbmdcbiAgICAgICAgcHJlU3RyaW5nVHlwZWQ6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgIC8vY2FsbGJhY2sgZm9yIGV2ZXJ5IHR5cGVkIHN0cmluZ1xuICAgICAgICBvblN0cmluZ1R5cGVkOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICAvLyBjYWxsYmFjayBmb3IgcmVzZXRcbiAgICAgICAgcmVzZXRDYWxsYmFjazogZnVuY3Rpb24oKSB7fVxuICAgIH07XG5cblxufSh3aW5kb3cualF1ZXJ5KTsiLCIvKiEgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqICBBdXRob3I6IFJvbWFuIE5hemFya2luLCBFZ29yIERhbmtvdlxuICogIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgUHV6emxlVGhlbWVzXG4gKiAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEluaXRpYWxpemUgbWFpbiBoZWxwZXIgb2JqZWN0XG4gKi9cbnZhciBQWlRKUyA9IHtcbiAgICBpc19zYWZhcmkgICAgOiAvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLFxuICAgIGlzX2ZpcmVmb3ggICA6IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdmaXJlZm94JykgPiAtMSxcbiAgICBpc19jaHJvbWUgICAgOiAvQ2hyb21lLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpICYmIC9Hb29nbGUgSW5jLy50ZXN0KG5hdmlnYXRvci52ZW5kb3IpLFxuICAgIGlzX2llMTAgICAgICA6IG5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoJ01TSUUgMTAnKSAhPT0gLTEsXG4gICAgdHJhbnNpdGlvbkVuZDogJ3RyYW5zaXRpb25lbmQgd2Via2l0VHJhbnNpdGlvbkVuZCBvVHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBNU1RyYW5zaXRpb25FbmQnLFxuICAgIGFuaW1JdGVyYXRpb246ICdhbmltYXRpb25pdGVyYXRpb24gd2Via2l0QW5pbWF0aW9uSXRlcmF0aW9uIG9BbmltYXRpb25JdGVyYXRpb24gTVNBbmltYXRpb25JdGVyYXRpb24nLFxuICAgIGFuaW1hdGlvbkVuZCA6ICdhbmltYXRpb25lbmQgd2Via2l0QW5pbWF0aW9uRW5kJ1xufTtcblxuXG4vKipcbiAqIFJlcXVlc3RBbmltYXRpb25GcmFtZSBwb2x5ZmlsbFxuICovXG4oZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxhc3RUaW1lID0gMDtcbiAgICB2YXIgdmVuZG9ycyA9IFsnbXMnLCAnbW96JywgJ3dlYmtpdCcsICdvJ107XG4gICAgZm9yKHZhciB4ID0gMDsgeCA8IHZlbmRvcnMubGVuZ3RoICYmICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lOyArK3gpIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2ZW5kb3JzW3hdKydSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gd2luZG93W3ZlbmRvcnNbeF0rJ0NhbmNlbEFuaW1hdGlvbkZyYW1lJ11cbiAgICAgICAgICAgIHx8IHdpbmRvd1t2ZW5kb3JzW3hdKydDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICB9XG5cbiAgICBpZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpXG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihjYWxsYmFjaywgZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIGN1cnJUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICB2YXIgdGltZVRvQ2FsbCA9IE1hdGgubWF4KDAsIDE2IC0gKGN1cnJUaW1lIC0gbGFzdFRpbWUpKTtcbiAgICAgICAgICAgIHZhciBpZCA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBjYWxsYmFjayhjdXJyVGltZSArIHRpbWVUb0NhbGwpOyB9LFxuICAgICAgICAgICAgICAgIHRpbWVUb0NhbGwpO1xuICAgICAgICAgICAgbGFzdFRpbWUgPSBjdXJyVGltZSArIHRpbWVUb0NhbGw7XG4gICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgIH07XG5cbiAgICBpZiAoIXdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSlcbiAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChpZCk7XG4gICAgICAgIH07XG59KCkpO1xuXG5cbi8qKlxuICogU2V0IHByb3BlciB0cmFuc2l0aW9uICYgYW5pbWF0aW9uIGV2ZW50IG5hbWVzXG4gKi9cbihmdW5jdGlvbiAobSkge1xuICAgIHZhciB0cmFuc0VuZEV2ZW50TmFtZXMgPSB7XG4gICAgICAgICAgICAnV2Via2l0VHJhbnNpdGlvbic6ICd3ZWJraXRUcmFuc2l0aW9uRW5kJyxcbiAgICAgICAgICAgICdNb3pUcmFuc2l0aW9uJyAgIDogJ3RyYW5zaXRpb25lbmQnLFxuICAgICAgICAgICAgJ09UcmFuc2l0aW9uJyAgICAgOiAnb1RyYW5zaXRpb25FbmQnLFxuICAgICAgICAgICAgJ21zVHJhbnNpdGlvbicgICAgOiAnTVNUcmFuc2l0aW9uRW5kJyxcbiAgICAgICAgICAgICd0cmFuc2l0aW9uJyAgICAgIDogJ3RyYW5zaXRpb25lbmQnXG4gICAgICAgIH0sXG4gICAgICAgIGFuaW1JdGVyYXRpb25FdmVudE5hbWVzID0ge1xuICAgICAgICAgICAgJ1dlYmtpdEFuaW1hdGlvbic6ICd3ZWJraXRBbmltYXRpb25JdGVyYXRpb24nLFxuICAgICAgICAgICAgJ01vekFuaW1hdGlvbicgICA6ICdhbmltYXRpb25pdGVyYXRpb24nLFxuICAgICAgICAgICAgJ09BbmltYXRpb24nICAgICA6ICdvQW5pbWF0aW9uSXRlcmF0aW9uJyxcbiAgICAgICAgICAgICdtc0FuaW1hdGlvbicgICAgOiAnTVNBbmltYXRpb25JdGVyYXRpb24nLFxuICAgICAgICAgICAgJ2FuaW1hdGlvbicgICAgICA6ICdhbmltYXRpb25pdGVyYXRpb24nXG4gICAgICAgIH0sXG4gICAgICAgIGFuaW1FbmRFdmVudE5hbWVzID0ge1xuICAgICAgICAgICAgJ1dlYmtpdEFuaW1hdGlvbicgOiAnd2Via2l0QW5pbWF0aW9uRW5kJyxcbiAgICAgICAgICAgICdNb3pUQW5pbWF0aW9uJyAgIDogJ2FuaW1hdGlvbmVuZCcsXG4gICAgICAgICAgICAnYW5pbWF0aW9uJyAgICAgICA6ICdhbmltYXRpb25lbmQnXG4gICAgICAgIH07XG5cbiAgICBQWlRKUy50cmFuc2l0aW9uRW5kID0gdHJhbnNFbmRFdmVudE5hbWVzW20ucHJlZml4ZWQoJ3RyYW5zaXRpb24nKV07XG4gICAgUFpUSlMuYW5pbUl0ZXJhdGlvbiA9IGFuaW1JdGVyYXRpb25FdmVudE5hbWVzW20ucHJlZml4ZWQoJ2FuaW1hdGlvbicpXTtcbiAgICBQWlRKUy5hbmltYXRpb25FbmQgPSBhbmltRW5kRXZlbnROYW1lc1ttLnByZWZpeGVkKCdhbmltYXRpb24nKV07XG59KShNb2Rlcm5penIpO1xuXG5cbi8qKlxuICogUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHdyYXBwZXJcbiAqIEBwYXJhbSBjYWxsYmFja1xuICogQGNvbnN0cnVjdG9yXG4gKi9cblBaVEpTLlJBRml0ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgdmFyIG5ld19jYWxsYmFjayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKG5ld19jYWxsYmFjayk7XG4gICAgfTtcblxuICAgIG5ld19jYWxsYmFjaygpO1xufTtcblxuXG4vKipcbiAqIFJlcXVlc3RBbmltYXRpb25GcmFtZSBmb3Igc2Nyb2xsaW5nLXJlbGF0ZWQgY2FsbGJhY2tzXG4gKi9cblBaVEpTLnNjcm9sbFJBRiA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgdmFyIGxhc3RTY3JvbGxQb3MgPSAtMTtcblxuICAgIHZhciBuZXdfY2FsbGJhY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRTY3JvbGxQb3MgPSB3aW5kb3cucGFnZVlPZmZzZXQgLyBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDtcblxuICAgICAgICBpZiAobGFzdFNjcm9sbFBvcyAhPT0gY3VycmVudFNjcm9sbFBvcykgeyAvLyBhdm9pZCBjYWxjdWxhdGlvbnMgaWYgbm90IG5lZWRlZFxuICAgICAgICAgICAgbGFzdFNjcm9sbFBvcyA9IGN1cnJlbnRTY3JvbGxQb3M7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIFBaVEpTLlJBRml0KG5ld19jYWxsYmFjayk7XG59O1xuXG5cbi8qKlxuICogUmV0dXJucyBQSFAtZGVmaW5lZCB2YWx1ZVxuICovXG5QWlRKUy5waHBEYXRhID0gZnVuY3Rpb24gKGtleSwgZGVmYXVsdF92YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgZGVmYXVsdF92YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgZGVmYXVsdF92YWx1ZSA9ICd0cmFuc2xhdGlvbiBub3QgZm91bmQnO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgUFpUX1BIUF9EQVRBICE9PSAndW5kZWZpbmVkJyAmJiBQWlRfUEhQX0RBVEEuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICByZXR1cm4gUFpUX1BIUF9EQVRBW2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGRlZmF1bHRfdmFsdWU7XG59O1xuXG5cbi8qKlxuICogRGV0ZWN0cyB3aGV0aGVyIHVzZXIgaXMgdmlld2luZyBzaXRlIGZyb20gYSBtb2JpbGUgZGV2aWNlXG4gKiBAcGFyYW0gYWdlbnRcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5QWlRKUy5pc01vYmlsZSA9IGZ1bmN0aW9uIChhZ2VudCkge1xuICAgIGFnZW50ID0gYWdlbnQgfHwgbmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgICByZXR1cm4gL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbmkvaS50ZXN0KGFnZW50KTtcbn07XG5cblxuLyoqXG4gKiBEYXRlLm5vdygpIHBvbHlmaWxsXG4gKi9cbmlmICghRGF0ZS5ub3cpIHtcbiAgICBEYXRlLm5vdyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOyB9O1xufVxuXG5cbi8qKlxuICogVHJpZ2dlciBkb2N1bWVudCByZWFkeSBldmVudCBvbiB3aW5kb3cgZWxlbWVudCAoc2hvcnRoYW5kKVxuICovXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICBqUXVlcnkod2luZG93KS50cmlnZ2VyKCdkb2NyZWFkeScpO1xufSk7XG5cblxuLyoqXG4gKiBTaHVmZmxlLmpzIHByb3BlciBsYXlvdXQgcmVjYWxjdWxhdGlvbiBzaG9ydGhhbmRcbiAqL1xualF1ZXJ5LmZuLnB6dF9zaHVmZmxlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB2YXIgJCA9IGpRdWVyeSxcbiAgICAgICAgJGVsID0gJCh0aGlzKTtcblxuICAgICRlbC5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyICRjdXJyZW50ID0gJCh0aGlzKSxcbiAgICAgICAgICAgIHRocm90dGxlZExheW91dCA9ICQudGhyb3R0bGUoMzAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJGN1cnJlbnQuc2h1ZmZsZSgndXBkYXRlJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBpbnN0YW50aWF0ZSB0aGUgcGx1Z2luXG4gICAgICAgICRlbC5zaHVmZmxlKG9wdGlvbnMpO1xuXG4gICAgICAgIC8vIHJlYnVpbGQgc2h1ZmZsZSBsYXlvdXQgZXZlcnl0aW1lIGltYWdlIGdldHMgbG9hZGVkXG4gICAgICAgICRlbC5maW5kKCdpbWcnKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBsZXRlICYmIHRoaXMubmF0dXJhbFdpZHRoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwcm94eUltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICAkKHByb3h5SW1hZ2UpLm9uZSgnbG9hZCcsIHRocm90dGxlZExheW91dCk7XG4gICAgICAgICAgICBwcm94eUltYWdlLnNyYyA9IHRoaXMuc3JjO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIHJlYnVpbGQgYWxsIHNodWZmbGUgZ3JpZHMgb24gcGFnZSBsb2FkXG4gICAgJCh3aW5kb3cpLm9uZSgnbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJGVsLnNodWZmbGUoJ3VwZGF0ZScpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXM7XG59O1xuXG5cbi8qKlxuICogQ2hlY2tzIGlmIGVsZW1lbnQgaXMgdmlzaWJsZSBpbiBjdXJyZW50IHZpZXdwb3J0XG4gKiBAcGFyYW0gZWxcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5QWlRKUy5pc0VsZW1lbnRJblZpZXdwb3J0ID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgLy8gc3BlY2lhbCBib251cyBmb3IgdGhvc2UgdXNpbmcgalF1ZXJ5XG4gICAgaWYgKHR5cGVvZiBqUXVlcnkgPT09ICdmdW5jdGlvbicgJiYgZWwgaW5zdGFuY2VvZiBqUXVlcnkpIHtcbiAgICAgICAgZWwgPSBlbFswXTtcbiAgICB9XG5cbiAgICB2YXIgdG9wID0gZWwub2Zmc2V0VG9wO1xuICAgIHZhciBsZWZ0ID0gZWwub2Zmc2V0TGVmdDtcbiAgICB2YXIgd2lkdGggPSBlbC5vZmZzZXRXaWR0aDtcbiAgICB2YXIgaGVpZ2h0ID0gZWwub2Zmc2V0SGVpZ2h0O1xuXG4gICAgd2hpbGUgKGVsLm9mZnNldFBhcmVudCkge1xuICAgICAgICBlbCA9IGVsLm9mZnNldFBhcmVudDtcbiAgICAgICAgdG9wICs9IGVsLm9mZnNldFRvcDtcbiAgICAgICAgbGVmdCArPSBlbC5vZmZzZXRMZWZ0O1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICAgIHRvcCA8ICh3aW5kb3cucGFnZVlPZmZzZXQgKyB3aW5kb3cuaW5uZXJIZWlnaHQpICYmXG4gICAgICAgIGxlZnQgPCAod2luZG93LnBhZ2VYT2Zmc2V0ICsgd2luZG93LmlubmVyV2lkdGgpICYmXG4gICAgICAgICh0b3AgKyBoZWlnaHQpID4gd2luZG93LnBhZ2VZT2Zmc2V0ICYmXG4gICAgICAgIChsZWZ0ICsgd2lkdGgpID4gd2luZG93LnBhZ2VYT2Zmc2V0XG4gICAgKTtcbn07IiwiKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcbiAgICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6XG4gICAgICAgIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6XG4gICAgICAgICAgICAoZ2xvYmFsLnJldGluYWpzID0gZmFjdG9yeSgpKTtcbn0odGhpcywgKGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGhhc1dpbmRvdyA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnO1xuICAgIHZhciBlbnZpcm9ubWVudCA9IE1hdGgucm91bmQoaGFzV2luZG93ID8gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMSA6IDEpO1xuICAgIHZhciBzcmNSZXBsYWNlID0gLyhcXC5bQS16XXszLDR9XFwvPyhcXD8uKik/KSQvO1xuICAgIHZhciBpbmxpbmVSZXBsYWNlID0gL3VybFxcKCgnfFwiKT8oW14pJ1wiXSspKCd8XCIpP1xcKS9pO1xuICAgIHZhciBzZWxlY3RvciA9ICdbZGF0YS1yanNdJztcbiAgICB2YXIgcHJvY2Vzc2VkQXR0ciA9ICdkYXRhLXJqcy1wcm9jZXNzZWQnO1xuICAgIGZ1bmN0aW9uIGFycmF5aWZ5KG9iamVjdCkge1xuICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwob2JqZWN0KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gY2hvb3NlQ2FwKGNhcCkge1xuICAgICAgICB2YXIgbnVtZXJpY0NhcCA9IHBhcnNlSW50KGNhcCwgMTApO1xuICAgICAgICBpZiAoZW52aXJvbm1lbnQgPCBudW1lcmljQ2FwKSB7XG4gICAgICAgICAgICByZXR1cm4gZW52aXJvbm1lbnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVtZXJpY0NhcDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBmb3JjZU9yaWdpbmFsRGltZW5zaW9ucyhpbWFnZSkge1xuICAgICAgICBpZiAoIWltYWdlLmhhc0F0dHJpYnV0ZSgnZGF0YS1uby1yZXNpemUnKSkge1xuICAgICAgICAgICAgaWYgKGltYWdlLm9mZnNldFdpZHRoID09PSAwICYmIGltYWdlLm9mZnNldEhlaWdodCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBpbWFnZS5uYXR1cmFsV2lkdGgpO1xuICAgICAgICAgICAgICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaW1hZ2UubmF0dXJhbEhlaWdodCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBpbWFnZS5vZmZzZXRXaWR0aCk7XG4gICAgICAgICAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBpbWFnZS5vZmZzZXRIZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbWFnZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc2V0U291cmNlSWZBdmFpbGFibGUoaW1hZ2UsIHJldGluYVVSTCkge1xuICAgICAgICB2YXIgaW1nVHlwZSA9IGltYWdlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHZhciB0ZXN0SW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgdGVzdEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoaW1nVHlwZSA9PT0gJ2ltZycpIHtcbiAgICAgICAgICAgICAgICBmb3JjZU9yaWdpbmFsRGltZW5zaW9ucyhpbWFnZSkuc2V0QXR0cmlidXRlKCdzcmMnLCByZXRpbmFVUkwpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbWFnZS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSAndXJsKCcgKyByZXRpbmFVUkwgKyAnKSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0ZXN0SW1hZ2Uuc2V0QXR0cmlidXRlKCdzcmMnLCByZXRpbmFVUkwpO1xuICAgICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUocHJvY2Vzc2VkQXR0ciwgdHJ1ZSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGR5bmFtaWNTd2FwSW1hZ2UoaW1hZ2UsIHNyYykge1xuICAgICAgICB2YXIgcmpzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAxO1xuICAgICAgICB2YXIgY2FwID0gY2hvb3NlQ2FwKHJqcyk7XG4gICAgICAgIGlmIChzcmMgJiYgY2FwID4gMSkge1xuICAgICAgICAgICAgdmFyIG5ld1NyYyA9IHNyYy5yZXBsYWNlKHNyY1JlcGxhY2UsICdAJyArIGNhcCArICd4JDEnKTtcbiAgICAgICAgICAgIHNldFNvdXJjZUlmQXZhaWxhYmxlKGltYWdlLCBuZXdTcmMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIG1hbnVhbFN3YXBJbWFnZShpbWFnZSwgc3JjLCBoZHNyYykge1xuICAgICAgICBpZiAoZW52aXJvbm1lbnQgPiAxKSB7XG4gICAgICAgICAgICBzZXRTb3VyY2VJZkF2YWlsYWJsZShpbWFnZSwgaGRzcmMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldEltYWdlcyhpbWFnZXMpIHtcbiAgICAgICAgaWYgKCFpbWFnZXMpIHtcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnID8gYXJyYXlpZnkoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpIDogW107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIGltYWdlcy5mb3JFYWNoID09PSAnZnVuY3Rpb24nID8gaW1hZ2VzIDogYXJyYXlpZnkoaW1hZ2VzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBjbGVhbkJnSW1nKGltZykge1xuICAgICAgICByZXR1cm4gaW1nLnN0eWxlLmJhY2tncm91bmRJbWFnZS5yZXBsYWNlKGlubGluZVJlcGxhY2UsICckMicpO1xuICAgIH1cbiAgICBmdW5jdGlvbiByZXRpbmEoaW1hZ2VzKSB7XG4gICAgICAgIGdldEltYWdlcyhpbWFnZXMpLmZvckVhY2goZnVuY3Rpb24gKGltZykge1xuICAgICAgICAgICAgaWYgKCFpbWcuZ2V0QXR0cmlidXRlKHByb2Nlc3NlZEF0dHIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlzSW1nID0gaW1nLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbWcnO1xuICAgICAgICAgICAgICAgIHZhciBzcmMgPSBpc0ltZyA/IGltZy5nZXRBdHRyaWJ1dGUoJ3NyYycpIDogY2xlYW5CZ0ltZyhpbWcpO1xuICAgICAgICAgICAgICAgIHZhciByanMgPSBpbWcuZ2V0QXR0cmlidXRlKCdkYXRhLXJqcycpO1xuICAgICAgICAgICAgICAgIHZhciByanNJc051bWJlciA9ICFpc05hTihwYXJzZUludChyanMsIDEwKSk7XG4gICAgICAgICAgICAgICAgaWYgKHJqcyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyanNJc051bWJlcikge1xuICAgICAgICAgICAgICAgICAgICBkeW5hbWljU3dhcEltYWdlKGltZywgc3JjLCByanMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1hbnVhbFN3YXBJbWFnZShpbWcsIHNyYywgcmpzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoaGFzV2luZG93KSB7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0aW5hKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB3aW5kb3cucmV0aW5hanMgPSByZXRpbmE7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJldGluYTtcblxufSkpKTsiLCIvKiFcbiAqIFNodWZmbGUuanMgYnkgQFZlc3RyaWRlXG4gKiBDYXRlZ29yaXplLCBzb3J0LCBhbmQgZmlsdGVyIGEgcmVzcG9uc2l2ZSBncmlkIG9mIGl0ZW1zLlxuICogRGVwZW5kZW5jaWVzOiBqUXVlcnkgMS45KywgTW9kZXJuaXpyIDIuNi4yK1xuICogQGxpY2Vuc2UgTUlUIGxpY2Vuc2VcbiAqIEB2ZXJzaW9uIDMuMS4xXG4gKi9cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5JywgJ21vZGVybml6ciddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnanF1ZXJ5JyksIHdpbmRvdy5Nb2Rlcm5penIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHdpbmRvdy5TaHVmZmxlID0gZmFjdG9yeSh3aW5kb3cualF1ZXJ5LCB3aW5kb3cuTW9kZXJuaXpyKTtcbiAgICB9XG59KShmdW5jdGlvbigkLCBNb2Rlcm5penIsIHVuZGVmaW5lZCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG5cbi8vIFZhbGlkYXRlIE1vZGVybml6ciBleGlzdHMuXG4vLyBTaHVmZmxlIHJlcXVpcmVzIGBjc3N0cmFuc2l0aW9uc2AsIGBjc3N0cmFuc2Zvcm1zYCwgYGNzc3RyYW5zZm9ybXMzZGAsXG4vLyBhbmQgYHByZWZpeGVkYCB0byBleGlzdCBvbiB0aGUgTW9kZXJuaXpyIG9iamVjdC5cbiAgICBpZiAodHlwZW9mIE1vZGVybml6ciAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTaHVmZmxlLmpzIHJlcXVpcmVzIE1vZGVybml6ci5cXG4nICtcbiAgICAgICAgICAgICdodHRwOi8vdmVzdHJpZGUuZ2l0aHViLmlvL1NodWZmbGUvI2RlcGVuZGVuY2llcycpO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBjc3MgcHJlZml4ZWQgcHJvcGVydGllcyBsaWtlIGAtd2Via2l0LXRyYW5zaXRpb25gIG9yIGBib3gtc2l6aW5nYFxuICAgICAqIGZyb20gYHRyYW5zaXRpb25gIG9yIGBib3hTaXppbmdgLCByZXNwZWN0aXZlbHkuXG4gICAgICogQHBhcmFtIHsoc3RyaW5nfGJvb2xlYW4pfSBwcm9wIFByb3BlcnR5IHRvIGJlIHByZWZpeGVkLlxuICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHByZWZpeGVkIGNzcyBwcm9wZXJ0eS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkYXNoaWZ5KCBwcm9wICkge1xuICAgICAgICBpZiAoIXByb3ApIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlcGxhY2UgdXBwZXIgY2FzZSB3aXRoIGRhc2gtbG93ZXJjYXNlLFxuICAgICAgICAvLyB0aGVuIGZpeCBtcy0gcHJlZml4ZXMgYmVjYXVzZSB0aGV5J3JlIG5vdCBjYXBpdGFsaXplZC5cbiAgICAgICAgcmV0dXJuIHByb3AucmVwbGFjZSgvKFtBLVpdKS9nLCBmdW5jdGlvbiggc3RyLCBtMSApIHtcbiAgICAgICAgICAgIHJldHVybiAnLScgKyBtMS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9KS5yZXBsYWNlKC9ebXMtLywnLW1zLScpO1xuICAgIH1cblxuLy8gQ29uc3RhbnQsIHByZWZpeGVkIHZhcmlhYmxlcy5cbiAgICB2YXIgVFJBTlNJVElPTiA9IE1vZGVybml6ci5wcmVmaXhlZCgndHJhbnNpdGlvbicpO1xuICAgIHZhciBUUkFOU0lUSU9OX0RFTEFZID0gTW9kZXJuaXpyLnByZWZpeGVkKCd0cmFuc2l0aW9uRGVsYXknKTtcbiAgICB2YXIgVFJBTlNJVElPTl9EVVJBVElPTiA9IE1vZGVybml6ci5wcmVmaXhlZCgndHJhbnNpdGlvbkR1cmF0aW9uJyk7XG5cbi8vIE5vdGUoZ2xlbik6IFN0b2NrIEFuZHJvaWQgNC4xLnggYnJvd3NlciB3aWxsIGZhaWwgaGVyZSBiZWNhdXNlIGl0IHdyb25nbHlcbi8vIHNheXMgaXQgc3VwcG9ydHMgbm9uLXByZWZpeGVkIHRyYW5zaXRpb25zLlxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01vZGVybml6ci9Nb2Rlcm5penIvaXNzdWVzLzg5N1xuICAgIHZhciBUUkFOU0lUSU9ORU5EID0ge1xuICAgICAgICAnV2Via2l0VHJhbnNpdGlvbicgOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcsXG4gICAgICAgICd0cmFuc2l0aW9uJyA6ICd0cmFuc2l0aW9uZW5kJ1xuICAgIH1bIFRSQU5TSVRJT04gXTtcblxuICAgIHZhciBUUkFOU0ZPUk0gPSBNb2Rlcm5penIucHJlZml4ZWQoJ3RyYW5zZm9ybScpO1xuICAgIHZhciBDU1NfVFJBTlNGT1JNID0gZGFzaGlmeShUUkFOU0ZPUk0pO1xuXG4vLyBDb25zdGFudHNcbiAgICB2YXIgQ0FOX1RSQU5TSVRJT05fVFJBTlNGT1JNUyA9IE1vZGVybml6ci5jc3N0cmFuc2Zvcm1zICYmIE1vZGVybml6ci5jc3N0cmFuc2l0aW9ucztcbiAgICB2YXIgSEFTX1RSQU5TRk9STVNfM0QgPSBNb2Rlcm5penIuY3NzdHJhbnNmb3JtczNkO1xuICAgIHZhciBIQVNfQ09NUFVURURfU1RZTEUgPSAhIXdpbmRvdy5nZXRDb21wdXRlZFN0eWxlO1xuICAgIHZhciBTSFVGRkxFID0gJ3NodWZmbGUnO1xuXG4vLyBDb25maWd1cmFibGUuIFlvdSBjYW4gY2hhbmdlIHRoZXNlIGNvbnN0YW50cyB0byBmaXQgeW91ciBhcHBsaWNhdGlvbi5cbi8vIFRoZSBkZWZhdWx0IHNjYWxlIGFuZCBjb25jZWFsZWQgc2NhbGUsIGhvd2V2ZXIsIGhhdmUgdG8gYmUgZGlmZmVyZW50IHZhbHVlcy5cbiAgICB2YXIgQUxMX0lURU1TID0gJ2FsbCc7XG4gICAgdmFyIEZJTFRFUl9BVFRSSUJVVEVfS0VZID0gJ2dyb3Vwcyc7XG4gICAgdmFyIERFRkFVTFRfU0NBTEUgPSAxO1xuICAgIHZhciBDT05DRUFMRURfU0NBTEUgPSAwLjAwMTtcblxuLy8gVW5kZXJzY29yZSdzIHRocm90dGxlIGZ1bmN0aW9uLlxuICAgIGZ1bmN0aW9uIHRocm90dGxlKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIGNvbnRleHQsIGFyZ3MsIHJlc3VsdDtcbiAgICAgICAgdmFyIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICB2YXIgcHJldmlvdXMgPSAwO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBwcmV2aW91cyA9IG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogJC5ub3coKTtcbiAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIG5vdyA9ICQubm93KCk7XG4gICAgICAgICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBwcmV2aW91cyA9IG5vdztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZW1haW5pbmcgPSB3YWl0IC0gKG5vdyAtIHByZXZpb3VzKTtcbiAgICAgICAgICAgIGNvbnRleHQgPSB0aGlzO1xuICAgICAgICAgICAgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgIGlmIChyZW1haW5pbmcgPD0gMCB8fCByZW1haW5pbmcgPiB3YWl0KSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbm93O1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICAgICAgY29udGV4dCA9IGFyZ3MgPSBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIGlmICghdGltZW91dCAmJiBvcHRpb25zLnRyYWlsaW5nICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCByZW1haW5pbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlYWNoKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iai5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqW2ldLCBpLCBvYmopID09PSB7fSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRlZmVyKGZuLCBjb250ZXh0LCB3YWl0KSB7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KCAkLnByb3h5KCBmbiwgY29udGV4dCApLCB3YWl0ICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYXJyYXlNYXgoIGFycmF5ICkge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkoIE1hdGgsIGFycmF5ICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYXJyYXlNaW4oIGFycmF5ICkge1xuICAgICAgICByZXR1cm4gTWF0aC5taW4uYXBwbHkoIE1hdGgsIGFycmF5ICk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBBbHdheXMgcmV0dXJucyBhIG51bWVyaWMgdmFsdWUsIGdpdmVuIGEgdmFsdWUuXG4gICAgICogQHBhcmFtIHsqfSB2YWx1ZSBQb3NzaWJseSBudW1lcmljIHZhbHVlLlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gYHZhbHVlYCBvciB6ZXJvIGlmIGB2YWx1ZWAgaXNuJ3QgbnVtZXJpYy5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldE51bWJlcih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gJC5pc051bWVyaWModmFsdWUpID8gdmFsdWUgOiAwO1xuICAgIH1cblxuICAgIHZhciBnZXRTdHlsZXMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSB8fCBmdW5jdGlvbigpIHt9O1xuXG4gICAgLyoqXG4gICAgICogUmVwcmVzZW50cyBhIGNvb3JkaW5hdGUgcGFpci5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3g9MF0gWC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gWS5cbiAgICAgKi9cbiAgICB2YXIgUG9pbnQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAgIHRoaXMueCA9IGdldE51bWJlciggeCApO1xuICAgICAgICB0aGlzLnkgPSBnZXROdW1iZXIoIHkgKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHR3byBwb2ludHMgYXJlIGVxdWFsLlxuICAgICAqIEBwYXJhbSB7UG9pbnR9IGEgUG9pbnQgQS5cbiAgICAgKiBAcGFyYW0ge1BvaW50fSBiIFBvaW50IEIuXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBQb2ludC5lcXVhbHMgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIHJldHVybiBhLnggPT09IGIueCAmJiBhLnkgPT09IGIueTtcbiAgICB9O1xuXG4gICAgdmFyIENPTVBVVEVEX1NJWkVfSU5DTFVERVNfUEFERElORyA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFIQVNfQ09NUFVURURfU1RZTEUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwYXJlbnQgPSBkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICAgICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZS5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOjEwcHg7cGFkZGluZzoycHg7JyArXG4gICAgICAgICAgICAnLXdlYmtpdC1ib3gtc2l6aW5nOmJvcmRlci1ib3g7Ym94LXNpemluZzpib3JkZXItYm94Oyc7XG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChlKTtcblxuICAgICAgICB2YXIgd2lkdGggPSBnZXRTdHlsZXMoZSwgbnVsbCkud2lkdGg7XG4gICAgICAgIHZhciByZXQgPSB3aWR0aCA9PT0gJzEwcHgnO1xuXG4gICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChlKTtcblxuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH0oKSk7XG5cblxuLy8gVXNlZCBmb3IgdW5pcXVlIGluc3RhbmNlIHZhcmlhYmxlc1xuICAgIHZhciBpZCA9IDA7XG4gICAgdmFyICR3aW5kb3cgPSAkKCB3aW5kb3cgKTtcblxuXG4gICAgLyoqXG4gICAgICogQ2F0ZWdvcml6ZSwgc29ydCwgYW5kIGZpbHRlciBhIHJlc3BvbnNpdmUgZ3JpZCBvZiBpdGVtcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCBBbiBlbGVtZW50IHdoaWNoIGlzIHRoZSBwYXJlbnQgY29udGFpbmVyIGZvciB0aGUgZ3JpZCBpdGVtcy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9U2h1ZmZsZS5vcHRpb25zXSBPcHRpb25zIG9iamVjdC5cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICB2YXIgU2h1ZmZsZSA9IGZ1bmN0aW9uKCBlbGVtZW50LCBvcHRpb25zICkge1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgJC5leHRlbmQoIHRoaXMsIFNodWZmbGUub3B0aW9ucywgb3B0aW9ucywgU2h1ZmZsZS5zZXR0aW5ncyApO1xuXG4gICAgICAgIHRoaXMuJGVsID0gJChlbGVtZW50KTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgICAgdGhpcy51bmlxdWUgPSAnc2h1ZmZsZV8nICsgaWQrKztcblxuICAgICAgICB0aGlzLl9maXJlKCBTaHVmZmxlLkV2ZW50VHlwZS5MT0FESU5HICk7XG4gICAgICAgIHRoaXMuX2luaXQoKTtcblxuICAgICAgICAvLyBEaXNwYXRjaCB0aGUgZG9uZSBldmVudCBhc3luY2hyb25vdXNseSBzbyB0aGF0IHBlb3BsZSBjYW4gYmluZCB0byBpdCBhZnRlclxuICAgICAgICAvLyBTaHVmZmxlIGhhcyBiZWVuIGluaXRpYWxpemVkLlxuICAgICAgICBkZWZlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fZmlyZSggU2h1ZmZsZS5FdmVudFR5cGUuRE9ORSApO1xuICAgICAgICB9LCB0aGlzLCAxNik7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogRXZlbnRzIHRoZSBjb250YWluZXIgZWxlbWVudCBlbWl0cyB3aXRoIHRoZSAuc2h1ZmZsZSBuYW1lc3BhY2UuXG4gICAgICogRm9yIGV4YW1wbGUsIFwiZG9uZS5zaHVmZmxlXCIuXG4gICAgICogQGVudW0ge3N0cmluZ31cbiAgICAgKi9cbiAgICBTaHVmZmxlLkV2ZW50VHlwZSA9IHtcbiAgICAgICAgTE9BRElORzogJ2xvYWRpbmcnLFxuICAgICAgICBET05FOiAnZG9uZScsXG4gICAgICAgIExBWU9VVDogJ2xheW91dCcsXG4gICAgICAgIFJFTU9WRUQ6ICdyZW1vdmVkJ1xuICAgIH07XG5cblxuICAgIC8qKiBAZW51bSB7c3RyaW5nfSAqL1xuICAgIFNodWZmbGUuQ2xhc3NOYW1lID0ge1xuICAgICAgICBCQVNFOiBTSFVGRkxFLFxuICAgICAgICBTSFVGRkxFX0lURU06ICdzaHVmZmxlLWl0ZW0nLFxuICAgICAgICBGSUxURVJFRDogJ2ZpbHRlcmVkJyxcbiAgICAgICAgQ09OQ0VBTEVEOiAnY29uY2VhbGVkJ1xuICAgIH07XG5cblxuLy8gT3ZlcnJpZGVhYmxlIG9wdGlvbnNcbiAgICBTaHVmZmxlLm9wdGlvbnMgPSB7XG4gICAgICAgIGdyb3VwOiBBTExfSVRFTVMsIC8vIEluaXRpYWwgZmlsdGVyIGdyb3VwLlxuICAgICAgICBzcGVlZDogMjUwLCAvLyBUcmFuc2l0aW9uL2FuaW1hdGlvbiBzcGVlZCAobWlsbGlzZWNvbmRzKS5cbiAgICAgICAgZWFzaW5nOiAnZWFzZS1vdXQnLCAvLyBDU1MgZWFzaW5nIGZ1bmN0aW9uIHRvIHVzZS5cbiAgICAgICAgaXRlbVNlbGVjdG9yOiAnJywgLy8gZS5nLiAnLnBpY3R1cmUtaXRlbScuXG4gICAgICAgIHNpemVyOiBudWxsLCAvLyBTaXplciBlbGVtZW50LiBVc2UgYW4gZWxlbWVudCB0byBkZXRlcm1pbmUgdGhlIHNpemUgb2YgY29sdW1ucyBhbmQgZ3V0dGVycy5cbiAgICAgICAgZ3V0dGVyV2lkdGg6IDAsIC8vIEEgc3RhdGljIG51bWJlciBvciBmdW5jdGlvbiB0aGF0IHRlbGxzIHRoZSBwbHVnaW4gaG93IHdpZGUgdGhlIGd1dHRlcnMgYmV0d2VlbiBjb2x1bW5zIGFyZSAoaW4gcGl4ZWxzKS5cbiAgICAgICAgY29sdW1uV2lkdGg6IDAsIC8vIEEgc3RhdGljIG51bWJlciBvciBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBudW1iZXIgd2hpY2ggdGVsbHMgdGhlIHBsdWdpbiBob3cgd2lkZSB0aGUgY29sdW1ucyBhcmUgKGluIHBpeGVscykuXG4gICAgICAgIGRlbGltZXRlcjogbnVsbCwgLy8gSWYgeW91ciBncm91cCBpcyBub3QganNvbiwgYW5kIGlzIGNvbW1hIGRlbGltZXRlZCwgeW91IGNvdWxkIHNldCBkZWxpbWV0ZXIgdG8gJywnLlxuICAgICAgICBidWZmZXI6IDAsIC8vIFVzZWZ1bCBmb3IgcGVyY2VudGFnZSBiYXNlZCBoZWlnaHRzIHdoZW4gdGhleSBtaWdodCBub3QgYWx3YXlzIGJlIGV4YWN0bHkgdGhlIHNhbWUgKGluIHBpeGVscykuXG4gICAgICAgIGNvbHVtblRocmVzaG9sZDogSEFTX0NPTVBVVEVEX1NUWUxFID8gMC4wMSA6IDAuMSwgLy8gUmVhZGluZyB0aGUgd2lkdGggb2YgZWxlbWVudHMgaXNuJ3QgcHJlY2lzZSBlbm91Z2ggYW5kIGNhbiBjYXVzZSBjb2x1bW5zIHRvIGp1bXAgYmV0d2VlbiB2YWx1ZXMuXG4gICAgICAgIGluaXRpYWxTb3J0OiBudWxsLCAvLyBTaHVmZmxlIGNhbiBiZSBpbml0aWFsaXplZCB3aXRoIGEgc29ydCBvYmplY3QuIEl0IGlzIHRoZSBzYW1lIG9iamVjdCBnaXZlbiB0byB0aGUgc29ydCBtZXRob2QuXG4gICAgICAgIHRocm90dGxlOiB0aHJvdHRsZSwgLy8gQnkgZGVmYXVsdCwgc2h1ZmZsZSB3aWxsIHRocm90dGxlIHJlc2l6ZSBldmVudHMuIFRoaXMgY2FuIGJlIGNoYW5nZWQgb3IgcmVtb3ZlZC5cbiAgICAgICAgdGhyb3R0bGVUaW1lOiAzMDAsIC8vIEhvdyBvZnRlbiBzaHVmZmxlIGNhbiBiZSBjYWxsZWQgb24gcmVzaXplIChpbiBtaWxsaXNlY29uZHMpLlxuICAgICAgICBzZXF1ZW50aWFsRmFkZURlbGF5OiAxNTAsIC8vIERlbGF5IGJldHdlZW4gZWFjaCBpdGVtIHRoYXQgZmFkZXMgaW4gd2hlbiBhZGRpbmcgaXRlbXMuXG4gICAgICAgIHN1cHBvcnRlZDogQ0FOX1RSQU5TSVRJT05fVFJBTlNGT1JNUyAvLyBXaGV0aGVyIHRvIHVzZSB0cmFuc2Zvcm1zIG9yIGFic29sdXRlIHBvc2l0aW9uaW5nLlxuICAgIH07XG5cblxuLy8gTm90IG92ZXJyaWRlYWJsZVxuICAgIFNodWZmbGUuc2V0dGluZ3MgPSB7XG4gICAgICAgIHVzZVNpemVyOiBmYWxzZSxcbiAgICAgICAgaXRlbUNzcyA6IHsgLy8gZGVmYXVsdCBDU1MgZm9yIGVhY2ggaXRlbVxuICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnXG4gICAgICAgIH0sXG4gICAgICAgIHJldmVhbEFwcGVuZGVkRGVsYXk6IDMwMCxcbiAgICAgICAgbGFzdFNvcnQ6IHt9LFxuICAgICAgICBsYXN0RmlsdGVyOiBBTExfSVRFTVMsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGRlc3Ryb3llZDogZmFsc2UsXG4gICAgICAgIGluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgICAgX2FuaW1hdGlvbnM6IFtdLFxuICAgICAgICBfdHJhbnNpdGlvbnM6IFtdLFxuICAgICAgICBfaXNNb3ZlbWVudENhbmNlbGVkOiBmYWxzZSxcbiAgICAgICAgc3R5bGVRdWV1ZTogW11cbiAgICB9O1xuXG5cbi8vIEV4cG9zZSBmb3IgdGVzdGluZy5cbiAgICBTaHVmZmxlLlBvaW50ID0gUG9pbnQ7XG5cblxuICAgIC8qKlxuICAgICAqIFN0YXRpYyBtZXRob2RzLlxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogSWYgdGhlIGJyb3dzZXIgaGFzIDNkIHRyYW5zZm9ybXMgYXZhaWxhYmxlLCBidWlsZCBhIHN0cmluZyB3aXRoIHRob3NlLFxuICAgICAqIG90aGVyd2lzZSB1c2UgMmQgdHJhbnNmb3Jtcy5cbiAgICAgKiBAcGFyYW0ge1BvaW50fSBwb2ludCBYIGFuZCBZIHBvc2l0aW9ucy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gc2NhbGUgU2NhbGUgYW1vdW50LlxuICAgICAqIEByZXR1cm4ge3N0cmluZ30gQSBub3JtYWxpemVkIHN0cmluZyB3aGljaCBjYW4gYmUgdXNlZCB3aXRoIHRoZSB0cmFuc2Zvcm0gc3R5bGUuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLl9nZXRJdGVtVHJhbnNmb3JtU3RyaW5nID0gZnVuY3Rpb24ocG9pbnQsIHNjYWxlKSB7XG4gICAgICAgIGlmICggSEFTX1RSQU5TRk9STVNfM0QgKSB7XG4gICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZTNkKCcgKyBwb2ludC54ICsgJ3B4LCAnICsgcG9pbnQueSArICdweCwgMCkgc2NhbGUzZCgnICsgc2NhbGUgKyAnLCAnICsgc2NhbGUgKyAnLCAxKSc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgcG9pbnQueCArICdweCwgJyArIHBvaW50LnkgKyAncHgpIHNjYWxlKCcgKyBzY2FsZSArICcpJztcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIHRoZSBjb21wdXRlZCBzdHlsZSBmb3IgYW4gZWxlbWVudCwgcGFyc2VkIGFzIGEgZmxvYXQuXG4gICAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IEVsZW1lbnQgdG8gZ2V0IHN0eWxlIGZvci5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3R5bGUgU3R5bGUgcHJvcGVydHkuXG4gICAgICogQHBhcmFtIHtDU1NTdHlsZURlY2xhcmF0aW9ufSBbc3R5bGVzXSBPcHRpb25hbGx5IGluY2x1ZGUgY2xlYW4gc3R5bGVzIHRvXG4gICAgICogICAgIHVzZSBpbnN0ZWFkIG9mIGFza2luZyBmb3IgdGhlbSBhZ2Fpbi5cbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBwYXJzZWQgY29tcHV0ZWQgdmFsdWUgb3IgemVybyBpZiB0aGF0IGZhaWxzIGJlY2F1c2UgSUVcbiAgICAgKiAgICAgd2lsbCByZXR1cm4gJ2F1dG8nIHdoZW4gdGhlIGVsZW1lbnQgZG9lc24ndCBoYXZlIG1hcmdpbnMgaW5zdGVhZCBvZlxuICAgICAqICAgICB0aGUgY29tcHV0ZWQgc3R5bGUuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLl9nZXROdW1iZXJTdHlsZSA9IGZ1bmN0aW9uKCBlbGVtZW50LCBzdHlsZSwgc3R5bGVzICkge1xuICAgICAgICBpZiAoIEhBU19DT01QVVRFRF9TVFlMRSApIHtcbiAgICAgICAgICAgIHN0eWxlcyA9IHN0eWxlcyB8fCBnZXRTdHlsZXMoIGVsZW1lbnQsIG51bGwgKTtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IFNodWZmbGUuX2dldEZsb2F0KCBzdHlsZXNbIHN0eWxlIF0gKTtcblxuICAgICAgICAgICAgLy8gU3VwcG9ydCBJRTw9MTEgYW5kIFczQyBzcGVjLlxuICAgICAgICAgICAgaWYgKCAhQ09NUFVURURfU0laRV9JTkNMVURFU19QQURESU5HICYmIHN0eWxlID09PSAnd2lkdGgnICkge1xuICAgICAgICAgICAgICAgIHZhbHVlICs9IFNodWZmbGUuX2dldEZsb2F0KCBzdHlsZXMucGFkZGluZ0xlZnQgKSArXG4gICAgICAgICAgICAgICAgICAgIFNodWZmbGUuX2dldEZsb2F0KCBzdHlsZXMucGFkZGluZ1JpZ2h0ICkgK1xuICAgICAgICAgICAgICAgICAgICBTaHVmZmxlLl9nZXRGbG9hdCggc3R5bGVzLmJvcmRlckxlZnRXaWR0aCApICtcbiAgICAgICAgICAgICAgICAgICAgU2h1ZmZsZS5fZ2V0RmxvYXQoIHN0eWxlcy5ib3JkZXJSaWdodFdpZHRoICk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCAhQ09NUFVURURfU0laRV9JTkNMVURFU19QQURESU5HICYmIHN0eWxlID09PSAnaGVpZ2h0JyApIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSArPSBTaHVmZmxlLl9nZXRGbG9hdCggc3R5bGVzLnBhZGRpbmdUb3AgKSArXG4gICAgICAgICAgICAgICAgICAgIFNodWZmbGUuX2dldEZsb2F0KCBzdHlsZXMucGFkZGluZ0JvdHRvbSApICtcbiAgICAgICAgICAgICAgICAgICAgU2h1ZmZsZS5fZ2V0RmxvYXQoIHN0eWxlcy5ib3JkZXJUb3BXaWR0aCApICtcbiAgICAgICAgICAgICAgICAgICAgU2h1ZmZsZS5fZ2V0RmxvYXQoIHN0eWxlcy5ib3JkZXJCb3R0b21XaWR0aCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gU2h1ZmZsZS5fZ2V0RmxvYXQoICQoIGVsZW1lbnQgKS5jc3MoIHN0eWxlICkgICk7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBQYXJzZSBhIHN0cmluZyBhcyBhbiBmbG9hdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgU3RyaW5nIGZsb2F0LlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gVGhlIHN0cmluZyBhcyBhbiBmbG9hdCBvciB6ZXJvLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgU2h1ZmZsZS5fZ2V0RmxvYXQgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gZ2V0TnVtYmVyKCBwYXJzZUZsb2F0KCB2YWx1ZSApICk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgb3V0ZXIgd2lkdGggb2YgYW4gZWxlbWVudCwgb3B0aW9uYWxseSBpbmNsdWRpbmcgaXRzIG1hcmdpbnMuXG4gICAgICpcbiAgICAgKiBUaGVyZSBhcmUgYSBmZXcgZGlmZmVyZW50IG1ldGhvZHMgZm9yIGdldHRpbmcgdGhlIHdpZHRoIG9mIGFuIGVsZW1lbnQsIG5vbmUgb2ZcbiAgICAgKiB3aGljaCB3b3JrIHBlcmZlY3RseSBmb3IgYWxsIFNodWZmbGUncyB1c2UgY2FzZXMuXG4gICAgICpcbiAgICAgKiAxLiBnZXRCb3VuZGluZ0NsaWVudFJlY3QoKSBgbGVmdGAgYW5kIGByaWdodGAgcHJvcGVydGllcy5cbiAgICAgKiAgIC0gQWNjb3VudHMgZm9yIHRyYW5zZm9ybSBzY2FsZWQgZWxlbWVudHMsIG1ha2luZyBpdCB1c2VsZXNzIGZvciBTaHVmZmxlXG4gICAgICogICBlbGVtZW50cyB3aGljaCBoYXZlIHNocnVuay5cbiAgICAgKiAyLiBUaGUgYG9mZnNldFdpZHRoYCBwcm9wZXJ0eSAob3IgalF1ZXJ5J3MgQ1NTKS5cbiAgICAgKiAgIC0gVGhpcyB2YWx1ZSBzdGF5cyB0aGUgc2FtZSByZWdhcmRsZXNzIG9mIHRoZSBlbGVtZW50cyB0cmFuc2Zvcm0gcHJvcGVydHksXG4gICAgICogICBob3dldmVyLCBpdCBkb2VzIG5vdCByZXR1cm4gc3VicGl4ZWwgdmFsdWVzLlxuICAgICAqIDMuIGdldENvbXB1dGVkU3R5bGUoKVxuICAgICAqICAgLSBUaGlzIHdvcmtzIGdyZWF0IENocm9tZSwgRmlyZWZveCwgU2FmYXJpLCBidXQgSUU8PTExIGRvZXMgbm90IGluY2x1ZGVcbiAgICAgKiAgIHBhZGRpbmcgYW5kIGJvcmRlciB3aGVuIGJveC1zaXppbmc6IGJvcmRlci1ib3ggaXMgc2V0LCByZXF1aXJpbmcgYSBmZWF0dXJlXG4gICAgICogICB0ZXN0IGFuZCBleHRyYSB3b3JrIHRvIGFkZCB0aGUgcGFkZGluZyBiYWNrIGZvciBJRSBhbmQgb3RoZXIgYnJvd3NlcnMgd2hpY2hcbiAgICAgKiAgIGZvbGxvdyB0aGUgVzNDIHNwZWMgaGVyZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCBUaGUgZWxlbWVudC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpbmNsdWRlTWFyZ2luc10gV2hldGhlciB0byBpbmNsdWRlIG1hcmdpbnMuIERlZmF1bHQgaXMgZmFsc2UuXG4gICAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgd2lkdGguXG4gICAgICovXG4gICAgU2h1ZmZsZS5fZ2V0T3V0ZXJXaWR0aCA9IGZ1bmN0aW9uKCBlbGVtZW50LCBpbmNsdWRlTWFyZ2lucyApIHtcbiAgICAgICAgLy8gU3RvcmUgdGhlIHN0eWxlcyBzbyB0aGF0IHRoZXkgY2FuIGJlIHVzZWQgYnkgb3RoZXJzIHdpdGhvdXQgYXNraW5nIGZvciBpdCBhZ2Fpbi5cbiAgICAgICAgdmFyIHN0eWxlcyA9IGdldFN0eWxlcyggZWxlbWVudCwgbnVsbCApO1xuICAgICAgICB2YXIgd2lkdGggPSBTaHVmZmxlLl9nZXROdW1iZXJTdHlsZSggZWxlbWVudCwgJ3dpZHRoJywgc3R5bGVzICk7XG5cbiAgICAgICAgLy8gVXNlIGpRdWVyeSBoZXJlIGJlY2F1c2UgaXQgdXNlcyBnZXRDb21wdXRlZFN0eWxlIGludGVybmFsbHkgYW5kIGlzXG4gICAgICAgIC8vIGNyb3NzLWJyb3dzZXIuIFVzaW5nIHRoZSBzdHlsZSBwcm9wZXJ0eSBvZiB0aGUgZWxlbWVudCB3aWxsIG9ubHkgd29ya1xuICAgICAgICAvLyBpZiB0aGVyZSBhcmUgaW5saW5lIHN0eWxlcy5cbiAgICAgICAgaWYgKCBpbmNsdWRlTWFyZ2lucyApIHtcbiAgICAgICAgICAgIHZhciBtYXJnaW5MZWZ0ID0gU2h1ZmZsZS5fZ2V0TnVtYmVyU3R5bGUoIGVsZW1lbnQsICdtYXJnaW5MZWZ0Jywgc3R5bGVzICk7XG4gICAgICAgICAgICB2YXIgbWFyZ2luUmlnaHQgPSBTaHVmZmxlLl9nZXROdW1iZXJTdHlsZSggZWxlbWVudCwgJ21hcmdpblJpZ2h0Jywgc3R5bGVzICk7XG4gICAgICAgICAgICB3aWR0aCArPSBtYXJnaW5MZWZ0ICsgbWFyZ2luUmlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gd2lkdGg7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgb3V0ZXIgaGVpZ2h0IG9mIGFuIGVsZW1lbnQsIG9wdGlvbmFsbHkgaW5jbHVkaW5nIGl0cyBtYXJnaW5zLlxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCBUaGUgZWxlbWVudC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpbmNsdWRlTWFyZ2luc10gV2hldGhlciB0byBpbmNsdWRlIG1hcmdpbnMuIERlZmF1bHQgaXMgZmFsc2UuXG4gICAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgaGVpZ2h0LlxuICAgICAqL1xuICAgIFNodWZmbGUuX2dldE91dGVySGVpZ2h0ID0gZnVuY3Rpb24oIGVsZW1lbnQsIGluY2x1ZGVNYXJnaW5zICkge1xuICAgICAgICB2YXIgc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtZW50LCBudWxsICk7XG4gICAgICAgIHZhciBoZWlnaHQgPSBTaHVmZmxlLl9nZXROdW1iZXJTdHlsZSggZWxlbWVudCwgJ2hlaWdodCcsIHN0eWxlcyApO1xuXG4gICAgICAgIGlmICggaW5jbHVkZU1hcmdpbnMgKSB7XG4gICAgICAgICAgICB2YXIgbWFyZ2luVG9wID0gU2h1ZmZsZS5fZ2V0TnVtYmVyU3R5bGUoIGVsZW1lbnQsICdtYXJnaW5Ub3AnLCBzdHlsZXMgKTtcbiAgICAgICAgICAgIHZhciBtYXJnaW5Cb3R0b20gPSBTaHVmZmxlLl9nZXROdW1iZXJTdHlsZSggZWxlbWVudCwgJ21hcmdpbkJvdHRvbScsIHN0eWxlcyApO1xuICAgICAgICAgICAgaGVpZ2h0ICs9IG1hcmdpblRvcCArIG1hcmdpbkJvdHRvbTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBoZWlnaHQ7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQ2hhbmdlIGEgcHJvcGVydHkgb3IgZXhlY3V0ZSBhIGZ1bmN0aW9uIHdoaWNoIHdpbGwgbm90IGhhdmUgYSB0cmFuc2l0aW9uXG4gICAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IERPTSBlbGVtZW50IHRoYXQgd29uJ3QgYmUgdHJhbnNpdGlvbmVkXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQSBmdW5jdGlvbiB3aGljaCB3aWxsIGJlIGNhbGxlZCB3aGlsZSB0cmFuc2l0aW9uXG4gICAgICogICAgIGlzIHNldCB0byAwbXMuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtjb250ZXh0XSBPcHRpb25hbCBjb250ZXh0IGZvciB0aGUgY2FsbGJhY2sgZnVuY3Rpb24uXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLl9za2lwVHJhbnNpdGlvbiA9IGZ1bmN0aW9uKCBlbGVtZW50LCBjYWxsYmFjaywgY29udGV4dCApIHtcbiAgICAgICAgdmFyIGR1cmF0aW9uID0gZWxlbWVudC5zdHlsZVsgVFJBTlNJVElPTl9EVVJBVElPTiBdO1xuXG4gICAgICAgIC8vIFNldCB0aGUgZHVyYXRpb24gdG8gemVybyBzbyBpdCBoYXBwZW5zIGltbWVkaWF0ZWx5XG4gICAgICAgIGVsZW1lbnQuc3R5bGVbIFRSQU5TSVRJT05fRFVSQVRJT04gXSA9ICcwbXMnOyAvLyBtcyBuZWVkZWQgZm9yIGZpcmVmb3ghXG5cbiAgICAgICAgY2FsbGJhY2suY2FsbCggY29udGV4dCApO1xuXG4gICAgICAgIC8vIEZvcmNlIHJlZmxvd1xuICAgICAgICB2YXIgcmVmbG93ID0gZWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgICAgLy8gQXZvaWQganNoaW50IHdhcm5pbmdzOiB1bnVzZWQgdmFyaWFibGVzIGFuZCBleHByZXNzaW9ucy5cbiAgICAgICAgcmVmbG93ID0gbnVsbDtcblxuICAgICAgICAvLyBQdXQgdGhlIGR1cmF0aW9uIGJhY2tcbiAgICAgICAgZWxlbWVudC5zdHlsZVsgVFJBTlNJVElPTl9EVVJBVElPTiBdID0gZHVyYXRpb247XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogSW5zdGFuY2UgbWV0aG9kcy5cbiAgICAgKi9cblxuICAgIFNodWZmbGUucHJvdG90eXBlLl9pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuJGl0ZW1zID0gdGhpcy5fZ2V0SXRlbXMoKTtcblxuICAgICAgICB0aGlzLnNpemVyID0gdGhpcy5fZ2V0RWxlbWVudE9wdGlvbiggdGhpcy5zaXplciApO1xuXG4gICAgICAgIGlmICggdGhpcy5zaXplciApIHtcbiAgICAgICAgICAgIHRoaXMudXNlU2l6ZXIgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIGNsYXNzIGFuZCBpbnZhbGlkYXRlIHN0eWxlc1xuICAgICAgICB0aGlzLiRlbC5hZGRDbGFzcyggU2h1ZmZsZS5DbGFzc05hbWUuQkFTRSApO1xuXG4gICAgICAgIC8vIFNldCBpbml0aWFsIGNzcyBmb3IgZWFjaCBpdGVtXG4gICAgICAgIHRoaXMuX2luaXRJdGVtcygpO1xuXG4gICAgICAgIC8vIEJpbmQgcmVzaXplIGV2ZW50c1xuICAgICAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE4NTI3NTEvd2luZG93LXJlc2l6ZS1ldmVudC1maXJpbmctaW4taW50ZXJuZXQtZXhwbG9yZXJcbiAgICAgICAgJHdpbmRvdy5vbigncmVzaXplLicgKyBTSFVGRkxFICsgJy4nICsgdGhpcy51bmlxdWUsIHRoaXMuX2dldFJlc2l6ZUZ1bmN0aW9uKCkpO1xuXG4gICAgICAgIC8vIEdldCBjb250YWluZXIgY3NzIGFsbCBpbiBvbmUgcmVxdWVzdC4gQ2F1c2VzIHJlZmxvd1xuICAgICAgICB2YXIgY29udGFpbmVyQ1NTID0gdGhpcy4kZWwuY3NzKFsncG9zaXRpb24nLCAnb3ZlcmZsb3cnXSk7XG4gICAgICAgIHZhciBjb250YWluZXJXaWR0aCA9IFNodWZmbGUuX2dldE91dGVyV2lkdGgoIHRoaXMuZWxlbWVudCApO1xuXG4gICAgICAgIC8vIEFkZCBzdHlsZXMgdG8gdGhlIGNvbnRhaW5lciBpZiBpdCBkb2Vzbid0IGhhdmUgdGhlbS5cbiAgICAgICAgdGhpcy5fdmFsaWRhdGVTdHlsZXMoIGNvbnRhaW5lckNTUyApO1xuXG4gICAgICAgIC8vIFdlIGFscmVhZHkgZ290IHRoZSBjb250YWluZXIncyB3aWR0aCBhYm92ZSwgbm8gbmVlZCB0byBjYXVzZSBhbm90aGVyIHJlZmxvdyBnZXR0aW5nIGl0IGFnYWluLi4uXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgdGhlcmUgd2lsbCBiZVxuICAgICAgICB0aGlzLl9zZXRDb2x1bW5zKCBjb250YWluZXJXaWR0aCApO1xuXG4gICAgICAgIC8vIEtpY2sgb2ZmIVxuICAgICAgICB0aGlzLnNodWZmbGUoIHRoaXMuZ3JvdXAsIHRoaXMuaW5pdGlhbFNvcnQgKTtcblxuICAgICAgICAvLyBUaGUgc2h1ZmZsZSBpdGVtcyBoYXZlbid0IGhhZCB0cmFuc2l0aW9ucyBzZXQgb24gdGhlbSB5ZXRcbiAgICAgICAgLy8gc28gdGhlIHVzZXIgZG9lc24ndCBzZWUgdGhlIGZpcnN0IGxheW91dC4gU2V0IHRoZW0gbm93IHRoYXQgdGhlIGZpcnN0IGxheW91dCBpcyBkb25lLlxuICAgICAgICBpZiAoIHRoaXMuc3VwcG9ydGVkICkge1xuICAgICAgICAgICAgZGVmZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0VHJhbnNpdGlvbnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGVbIFRSQU5TSVRJT04gXSA9ICdoZWlnaHQgJyArIHRoaXMuc3BlZWQgKyAnbXMgJyArIHRoaXMuZWFzaW5nO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgdGhyb3R0bGVkIGFuZCBwcm94aWVkIGZ1bmN0aW9uIGZvciB0aGUgcmVzaXplIGhhbmRsZXIuXG4gICAgICogQHJldHVybiB7RnVuY3Rpb259XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fZ2V0UmVzaXplRnVuY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHJlc2l6ZUZ1bmN0aW9uID0gJC5wcm94eSggdGhpcy5fb25SZXNpemUsIHRoaXMgKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudGhyb3R0bGUgP1xuICAgICAgICAgICAgdGhpcy50aHJvdHRsZSggcmVzaXplRnVuY3Rpb24sIHRoaXMudGhyb3R0bGVUaW1lICkgOlxuICAgICAgICAgICAgcmVzaXplRnVuY3Rpb247XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgYW4gZWxlbWVudCBmcm9tIGFuIG9wdGlvbi5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xqUXVlcnl8RWxlbWVudH0gb3B0aW9uIFRoZSBvcHRpb24gdG8gY2hlY2suXG4gICAgICogQHJldHVybiB7P0VsZW1lbnR9IFRoZSBwbGFpbiBlbGVtZW50IG9yIG51bGwuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fZ2V0RWxlbWVudE9wdGlvbiA9IGZ1bmN0aW9uKCBvcHRpb24gKSB7XG4gICAgICAgIC8vIElmIGNvbHVtbiB3aWR0aCBpcyBhIHN0cmluZywgdHJlYXQgaXMgYXMgYSBzZWxlY3RvciBhbmQgc2VhcmNoIGZvciB0aGVcbiAgICAgICAgLy8gc2l6ZXIgZWxlbWVudCB3aXRoaW4gdGhlIG91dGVybW9zdCBjb250YWluZXJcbiAgICAgICAgaWYgKCB0eXBlb2Ygb3B0aW9uID09PSAnc3RyaW5nJyApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbC5maW5kKCBvcHRpb24gKVswXSB8fCBudWxsO1xuXG4gICAgICAgICAgICAvLyBDaGVjayBmb3IgYW4gZWxlbWVudFxuICAgICAgICB9IGVsc2UgaWYgKCBvcHRpb24gJiYgb3B0aW9uLm5vZGVUeXBlICYmIG9wdGlvbi5ub2RlVHlwZSA9PT0gMSApIHtcbiAgICAgICAgICAgIHJldHVybiBvcHRpb247XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGZvciBqUXVlcnkgb2JqZWN0XG4gICAgICAgIH0gZWxzZSBpZiAoIG9wdGlvbiAmJiBvcHRpb24uanF1ZXJ5ICkge1xuICAgICAgICAgICAgcmV0dXJuIG9wdGlvblswXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIEVuc3VyZXMgdGhlIHNodWZmbGUgY29udGFpbmVyIGhhcyB0aGUgY3NzIHN0eWxlcyBpdCBuZWVkcyBhcHBsaWVkIHRvIGl0LlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdHlsZXMgS2V5IHZhbHVlIHBhaXJzIGZvciBwb3NpdGlvbiBhbmQgb3ZlcmZsb3cuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fdmFsaWRhdGVTdHlsZXMgPSBmdW5jdGlvbihzdHlsZXMpIHtcbiAgICAgICAgLy8gUG9zaXRpb24gY2Fubm90IGJlIHN0YXRpYy5cbiAgICAgICAgaWYgKCBzdHlsZXMucG9zaXRpb24gPT09ICdzdGF0aWMnICkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE92ZXJmbG93IGhhcyB0byBiZSBoaWRkZW5cbiAgICAgICAgaWYgKCBzdHlsZXMub3ZlcmZsb3cgIT09ICdoaWRkZW4nICkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBGaWx0ZXIgdGhlIGVsZW1lbnRzIGJ5IGEgY2F0ZWdvcnkuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtjYXRlZ29yeV0gQ2F0ZWdvcnkgdG8gZmlsdGVyIGJ5LiBJZiBpdCdzIGdpdmVuLCB0aGUgbGFzdFxuICAgICAqICAgICBjYXRlZ29yeSB3aWxsIGJlIHVzZWQgdG8gZmlsdGVyIHRoZSBpdGVtcy5cbiAgICAgKiBAcGFyYW0ge0FycmF5TGlrZX0gWyRjb2xsZWN0aW9uXSBPcHRpb25hbGx5IGZpbHRlciBhIGNvbGxlY3Rpb24uIERlZmF1bHRzIHRvXG4gICAgICogICAgIGFsbCB0aGUgaXRlbXMuXG4gICAgICogQHJldHVybiB7alF1ZXJ5fSBGaWx0ZXJlZCBpdGVtcy5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9maWx0ZXIgPSBmdW5jdGlvbiggY2F0ZWdvcnksICRjb2xsZWN0aW9uICkge1xuICAgICAgICBjYXRlZ29yeSA9IGNhdGVnb3J5IHx8IHRoaXMubGFzdEZpbHRlcjtcbiAgICAgICAgJGNvbGxlY3Rpb24gPSAkY29sbGVjdGlvbiB8fCB0aGlzLiRpdGVtcztcblxuICAgICAgICB2YXIgc2V0ID0gdGhpcy5fZ2V0RmlsdGVyZWRTZXRzKCBjYXRlZ29yeSwgJGNvbGxlY3Rpb24gKTtcblxuICAgICAgICAvLyBJbmRpdmlkdWFsbHkgYWRkL3JlbW92ZSBjb25jZWFsZWQvZmlsdGVyZWQgY2xhc3Nlc1xuICAgICAgICB0aGlzLl90b2dnbGVGaWx0ZXJDbGFzc2VzKCBzZXQuZmlsdGVyZWQsIHNldC5jb25jZWFsZWQgKTtcblxuICAgICAgICAvLyBTYXZlIHRoZSBsYXN0IGZpbHRlciBpbiBjYXNlIGVsZW1lbnRzIGFyZSBhcHBlbmRlZC5cbiAgICAgICAgdGhpcy5sYXN0RmlsdGVyID0gY2F0ZWdvcnk7XG5cbiAgICAgICAgLy8gVGhpcyBpcyBzYXZlZCBtYWlubHkgYmVjYXVzZSBwcm92aWRpbmcgYSBmaWx0ZXIgZnVuY3Rpb24gKGxpa2Ugc2VhcmNoaW5nKVxuICAgICAgICAvLyB3aWxsIG92ZXJ3cml0ZSB0aGUgYGxhc3RGaWx0ZXJgIHByb3BlcnR5IGV2ZXJ5IHRpbWUgaXRzIGNhbGxlZC5cbiAgICAgICAgaWYgKCB0eXBlb2YgY2F0ZWdvcnkgPT09ICdzdHJpbmcnICkge1xuICAgICAgICAgICAgdGhpcy5ncm91cCA9IGNhdGVnb3J5O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNldC5maWx0ZXJlZDtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBmaWx0ZXJlZCBhbmQgY29uY2VhbGVkIGVsZW1lbnRzLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfEZ1bmN0aW9ufSBjYXRlZ29yeSBDYXRlZ29yeSBvciBmdW5jdGlvbiB0byBmaWx0ZXIgYnkuXG4gICAgICogQHBhcmFtIHtBcnJheUxpa2UuPEVsZW1lbnQ+fSAkaXRlbXMgQSBjb2xsZWN0aW9uIG9mIGl0ZW1zIHRvIGZpbHRlci5cbiAgICAgKiBAcmV0dXJuIHshe2ZpbHRlcmVkOiBqUXVlcnksIGNvbmNlYWxlZDogalF1ZXJ5fX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9nZXRGaWx0ZXJlZFNldHMgPSBmdW5jdGlvbiggY2F0ZWdvcnksICRpdGVtcyApIHtcbiAgICAgICAgdmFyICRmaWx0ZXJlZCA9ICQoKTtcbiAgICAgICAgdmFyICRjb25jZWFsZWQgPSAkKCk7XG5cbiAgICAgICAgLy8gY2F0ZWdvcnkgPT09ICdhbGwnLCBhZGQgZmlsdGVyZWQgY2xhc3MgdG8gZXZlcnl0aGluZ1xuICAgICAgICBpZiAoIGNhdGVnb3J5ID09PSBBTExfSVRFTVMgKSB7XG4gICAgICAgICAgICAkZmlsdGVyZWQgPSAkaXRlbXM7XG5cbiAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBlYWNoIGl0ZW0gYW5kIHVzZSBwcm92aWRlZCBmdW5jdGlvbiB0byBkZXRlcm1pbmVcbiAgICAgICAgICAgIC8vIHdoZXRoZXIgdG8gaGlkZSBpdCBvciBub3QuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlYWNoKCRpdGVtcywgZnVuY3Rpb24oIGVsICkge1xuICAgICAgICAgICAgICAgIHZhciAkaXRlbSA9ICQoZWwpO1xuICAgICAgICAgICAgICAgIGlmICggdGhpcy5fZG9lc1Bhc3NGaWx0ZXIoIGNhdGVnb3J5LCAkaXRlbSApICkge1xuICAgICAgICAgICAgICAgICAgICAkZmlsdGVyZWQgPSAkZmlsdGVyZWQuYWRkKCAkaXRlbSApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRjb25jZWFsZWQgPSAkY29uY2VhbGVkLmFkZCggJGl0ZW0gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaWx0ZXJlZDogJGZpbHRlcmVkLFxuICAgICAgICAgICAgY29uY2VhbGVkOiAkY29uY2VhbGVkXG4gICAgICAgIH07XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogVGVzdCBhbiBpdGVtIHRvIHNlZSBpZiBpdCBwYXNzZXMgYSBjYXRlZ29yeS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xGdW5jdGlvbn0gY2F0ZWdvcnkgQ2F0ZWdvcnkgb3IgZnVuY3Rpb24gdG8gZmlsdGVyIGJ5LlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkaXRlbSBBIHNpbmdsZSBpdGVtLCB3cmFwcGVkIHdpdGggalF1ZXJ5LlxuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgaXQgcGFzc2VzIHRoZSBjYXRlZ29yeS9maWx0ZXIuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fZG9lc1Bhc3NGaWx0ZXIgPSBmdW5jdGlvbiggY2F0ZWdvcnksICRpdGVtICkge1xuICAgICAgICBpZiAoICQuaXNGdW5jdGlvbiggY2F0ZWdvcnkgKSApIHtcbiAgICAgICAgICAgIHJldHVybiBjYXRlZ29yeS5jYWxsKCAkaXRlbVswXSwgJGl0ZW0sIHRoaXMgKTtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgZWFjaCBlbGVtZW50J3MgZGF0YS1ncm91cHMgYXR0cmlidXRlIGFnYWluc3QgdGhlIGdpdmVuIGNhdGVnb3J5LlxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGdyb3VwcyA9ICRpdGVtLmRhdGEoIEZJTFRFUl9BVFRSSUJVVEVfS0VZICk7XG4gICAgICAgICAgICB2YXIga2V5cyA9IHRoaXMuZGVsaW1ldGVyICYmICEkLmlzQXJyYXkoIGdyb3VwcyApID9cbiAgICAgICAgICAgICAgICBncm91cHMuc3BsaXQoIHRoaXMuZGVsaW1ldGVyICkgOlxuICAgICAgICAgICAgICAgIGdyb3VwcztcbiAgICAgICAgICAgIHJldHVybiAkLmluQXJyYXkoY2F0ZWdvcnksIGtleXMpID4gLTE7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBUb2dnbGVzIHRoZSBmaWx0ZXJlZCBhbmQgY29uY2VhbGVkIGNsYXNzIG5hbWVzLlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkZmlsdGVyZWQgRmlsdGVyZWQgc2V0LlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkY29uY2VhbGVkIENvbmNlYWxlZCBzZXQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fdG9nZ2xlRmlsdGVyQ2xhc3NlcyA9IGZ1bmN0aW9uKCAkZmlsdGVyZWQsICRjb25jZWFsZWQgKSB7XG4gICAgICAgICRmaWx0ZXJlZFxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCBTaHVmZmxlLkNsYXNzTmFtZS5DT05DRUFMRUQgKVxuICAgICAgICAgICAgLmFkZENsYXNzKCBTaHVmZmxlLkNsYXNzTmFtZS5GSUxURVJFRCApO1xuICAgICAgICAkY29uY2VhbGVkXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoIFNodWZmbGUuQ2xhc3NOYW1lLkZJTFRFUkVEIClcbiAgICAgICAgICAgIC5hZGRDbGFzcyggU2h1ZmZsZS5DbGFzc05hbWUuQ09OQ0VBTEVEICk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBpbml0aWFsIGNzcyBmb3IgZWFjaCBpdGVtXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IFskaXRlbXNdIE9wdGlvbmFsbHkgc3BlY2lmaXkgYXQgc2V0IHRvIGluaXRpYWxpemVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5faW5pdEl0ZW1zID0gZnVuY3Rpb24oICRpdGVtcyApIHtcbiAgICAgICAgJGl0ZW1zID0gJGl0ZW1zIHx8IHRoaXMuJGl0ZW1zO1xuICAgICAgICAkaXRlbXMuYWRkQ2xhc3MoW1xuICAgICAgICAgICAgU2h1ZmZsZS5DbGFzc05hbWUuU0hVRkZMRV9JVEVNLFxuICAgICAgICAgICAgU2h1ZmZsZS5DbGFzc05hbWUuRklMVEVSRURcbiAgICAgICAgXS5qb2luKCcgJykpO1xuICAgICAgICAkaXRlbXMuY3NzKCB0aGlzLml0ZW1Dc3MgKS5kYXRhKCdwb2ludCcsIG5ldyBQb2ludCgpKS5kYXRhKCdzY2FsZScsIERFRkFVTFRfU0NBTEUpO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIGZpbHRlcmVkIGl0ZW0gY291bnQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fdXBkYXRlSXRlbUNvdW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMudmlzaWJsZUl0ZW1zID0gdGhpcy5fZ2V0RmlsdGVyZWRJdGVtcygpLmxlbmd0aDtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIGNzcyB0cmFuc2Zvcm0gdHJhbnNpdGlvbiBvbiBhIGFuIGVsZW1lbnQuXG4gICAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IEVsZW1lbnQgdG8gc2V0IHRyYW5zaXRpb24gb24uXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fc2V0VHJhbnNpdGlvbiA9IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuICAgICAgICBlbGVtZW50LnN0eWxlWyBUUkFOU0lUSU9OIF0gPSBDU1NfVFJBTlNGT1JNICsgJyAnICsgdGhpcy5zcGVlZCArICdtcyAnICtcbiAgICAgICAgICAgIHRoaXMuZWFzaW5nICsgJywgb3BhY2l0eSAnICsgdGhpcy5zcGVlZCArICdtcyAnICsgdGhpcy5lYXNpbmc7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogU2V0cyBjc3MgdHJhbnNmb3JtIHRyYW5zaXRpb24gb24gYSBncm91cCBvZiBlbGVtZW50cy5cbiAgICAgKiBAcGFyYW0ge0FycmF5TGlrZS48RWxlbWVudD59ICRpdGVtcyBFbGVtZW50cyB0byBzZXQgdHJhbnNpdGlvbnMgb24uXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fc2V0VHJhbnNpdGlvbnMgPSBmdW5jdGlvbiggJGl0ZW1zICkge1xuICAgICAgICAkaXRlbXMgPSAkaXRlbXMgfHwgdGhpcy4kaXRlbXM7XG4gICAgICAgIGVhY2goJGl0ZW1zLCBmdW5jdGlvbiggZWwgKSB7XG4gICAgICAgICAgICB0aGlzLl9zZXRUcmFuc2l0aW9uKCBlbCApO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIGEgdHJhbnNpdGlvbiBkZWxheSBvbiBhIGNvbGxlY3Rpb24gb2YgZWxlbWVudHMsIG1ha2luZyBlYWNoIGRlbGF5XG4gICAgICogZ3JlYXRlciB0aGFuIHRoZSBsYXN0LlxuICAgICAqIEBwYXJhbSB7QXJyYXlMaWtlLjxFbGVtZW50Pn0gJGNvbGxlY3Rpb24gQXJyYXkgdG8gaXRlcmF0ZSBvdmVyLlxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9zZXRTZXF1ZW50aWFsRGVsYXkgPSBmdW5jdGlvbiggJGNvbGxlY3Rpb24gKSB7XG4gICAgICAgIGlmICggIXRoaXMuc3VwcG9ydGVkICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gJGNvbGxlY3Rpb24gY2FuIGJlIGFuIGFycmF5IG9mIGRvbSBlbGVtZW50cyBvciBqcXVlcnkgb2JqZWN0XG4gICAgICAgIGVhY2goJGNvbGxlY3Rpb24sIGZ1bmN0aW9uKCBlbCwgaSApIHtcbiAgICAgICAgICAgIC8vIFRoaXMgd29ya3MgYmVjYXVzZSB0aGUgdHJhbnNpdGlvbi1wcm9wZXJ0eTogdHJhbnNmb3JtLCBvcGFjaXR5O1xuICAgICAgICAgICAgZWwuc3R5bGVbIFRSQU5TSVRJT05fREVMQVkgXSA9ICcwbXMsJyArICgoaSArIDEpICogdGhpcy5zZXF1ZW50aWFsRmFkZURlbGF5KSArICdtcyc7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH07XG5cblxuICAgIFNodWZmbGUucHJvdG90eXBlLl9nZXRJdGVtcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZWwuY2hpbGRyZW4oIHRoaXMuaXRlbVNlbGVjdG9yICk7XG4gICAgfTtcblxuXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX2dldEZpbHRlcmVkSXRlbXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGl0ZW1zLmZpbHRlcignLicgKyBTaHVmZmxlLkNsYXNzTmFtZS5GSUxURVJFRCk7XG4gICAgfTtcblxuXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX2dldENvbmNlYWxlZEl0ZW1zID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRpdGVtcy5maWx0ZXIoJy4nICsgU2h1ZmZsZS5DbGFzc05hbWUuQ09OQ0VBTEVEKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBjb2x1bW4gc2l6ZSwgYmFzZWQgb24gY29sdW1uIHdpZHRoIGFuZCBzaXplciBvcHRpb25zLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb250YWluZXJXaWR0aCBTaXplIG9mIHRoZSBwYXJlbnQgY29udGFpbmVyLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBndXR0ZXJTaXplIFNpemUgb2YgdGhlIGd1dHRlcnMuXG4gICAgICogQHJldHVybiB7bnVtYmVyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX2dldENvbHVtblNpemUgPSBmdW5jdGlvbiggY29udGFpbmVyV2lkdGgsIGd1dHRlclNpemUgKSB7XG4gICAgICAgIHZhciBzaXplO1xuXG4gICAgICAgIC8vIElmIHRoZSBjb2x1bW5XaWR0aCBwcm9wZXJ0eSBpcyBhIGZ1bmN0aW9uLCB0aGVuIHRoZSBncmlkIGlzIGZsdWlkXG4gICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCB0aGlzLmNvbHVtbldpZHRoICkgKSB7XG4gICAgICAgICAgICBzaXplID0gdGhpcy5jb2x1bW5XaWR0aChjb250YWluZXJXaWR0aCk7XG5cbiAgICAgICAgICAgIC8vIGNvbHVtbldpZHRoIG9wdGlvbiBpc24ndCBhIGZ1bmN0aW9uLCBhcmUgdGhleSB1c2luZyBhIHNpemluZyBlbGVtZW50P1xuICAgICAgICB9IGVsc2UgaWYgKCB0aGlzLnVzZVNpemVyICkge1xuICAgICAgICAgICAgc2l6ZSA9IFNodWZmbGUuX2dldE91dGVyV2lkdGgodGhpcy5zaXplcik7XG5cbiAgICAgICAgICAgIC8vIGlmIG5vdCwgaG93IGFib3V0IHRoZSBleHBsaWNpdGx5IHNldCBvcHRpb24/XG4gICAgICAgIH0gZWxzZSBpZiAoIHRoaXMuY29sdW1uV2lkdGggKSB7XG4gICAgICAgICAgICBzaXplID0gdGhpcy5jb2x1bW5XaWR0aDtcblxuICAgICAgICAgICAgLy8gb3IgdXNlIHRoZSBzaXplIG9mIHRoZSBmaXJzdCBpdGVtXG4gICAgICAgIH0gZWxzZSBpZiAoIHRoaXMuJGl0ZW1zLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICBzaXplID0gU2h1ZmZsZS5fZ2V0T3V0ZXJXaWR0aCh0aGlzLiRpdGVtc1swXSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3Mgbm8gaXRlbXMsIHVzZSBzaXplIG9mIGNvbnRhaW5lclxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2l6ZSA9IGNvbnRhaW5lcldpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRG9uJ3QgbGV0IHRoZW0gc2V0IGEgY29sdW1uIHdpZHRoIG9mIHplcm8uXG4gICAgICAgIGlmICggc2l6ZSA9PT0gMCApIHtcbiAgICAgICAgICAgIHNpemUgPSBjb250YWluZXJXaWR0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzaXplICsgZ3V0dGVyU2l6ZTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBndXR0ZXIgc2l6ZSwgYmFzZWQgb24gZ3V0dGVyIHdpZHRoIGFuZCBzaXplciBvcHRpb25zLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb250YWluZXJXaWR0aCBTaXplIG9mIHRoZSBwYXJlbnQgY29udGFpbmVyLlxuICAgICAqIEByZXR1cm4ge251bWJlcn1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9nZXRHdXR0ZXJTaXplID0gZnVuY3Rpb24oIGNvbnRhaW5lcldpZHRoICkge1xuICAgICAgICB2YXIgc2l6ZTtcbiAgICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIHRoaXMuZ3V0dGVyV2lkdGggKSApIHtcbiAgICAgICAgICAgIHNpemUgPSB0aGlzLmd1dHRlcldpZHRoKGNvbnRhaW5lcldpZHRoKTtcbiAgICAgICAgfSBlbHNlIGlmICggdGhpcy51c2VTaXplciApIHtcbiAgICAgICAgICAgIHNpemUgPSBTaHVmZmxlLl9nZXROdW1iZXJTdHlsZSh0aGlzLnNpemVyLCAnbWFyZ2luTGVmdCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2l6ZSA9IHRoaXMuZ3V0dGVyV2lkdGg7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2l6ZTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgdGhlIG51bWJlciBvZiBjb2x1bW5zIHRvIGJlIHVzZWQuIEdldHMgY3NzIGlmIHVzaW5nIHNpemVyIGVsZW1lbnQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFt0aGVDb250YWluZXJXaWR0aF0gT3B0aW9uYWxseSBzcGVjaWZ5IGEgY29udGFpbmVyIHdpZHRoIGlmIGl0J3MgYWxyZWFkeSBhdmFpbGFibGUuXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX3NldENvbHVtbnMgPSBmdW5jdGlvbiggdGhlQ29udGFpbmVyV2lkdGggKSB7XG4gICAgICAgIHZhciBjb250YWluZXJXaWR0aCA9IHRoZUNvbnRhaW5lcldpZHRoIHx8IFNodWZmbGUuX2dldE91dGVyV2lkdGgoIHRoaXMuZWxlbWVudCApO1xuICAgICAgICB2YXIgZ3V0dGVyID0gdGhpcy5fZ2V0R3V0dGVyU2l6ZSggY29udGFpbmVyV2lkdGggKTtcbiAgICAgICAgdmFyIGNvbHVtbldpZHRoID0gdGhpcy5fZ2V0Q29sdW1uU2l6ZSggY29udGFpbmVyV2lkdGgsIGd1dHRlciApO1xuICAgICAgICB2YXIgY2FsY3VsYXRlZENvbHVtbnMgPSAoY29udGFpbmVyV2lkdGggKyBndXR0ZXIpIC8gY29sdW1uV2lkdGg7XG5cbiAgICAgICAgLy8gV2lkdGhzIGdpdmVuIGZyb20gZ2V0U3R5bGVzIGFyZSBub3QgcHJlY2lzZSBlbm91Z2guLi5cbiAgICAgICAgaWYgKCBNYXRoLmFicyhNYXRoLnJvdW5kKGNhbGN1bGF0ZWRDb2x1bW5zKSAtIGNhbGN1bGF0ZWRDb2x1bW5zKSA8IHRoaXMuY29sdW1uVGhyZXNob2xkICkge1xuICAgICAgICAgICAgLy8gZS5nLiBjYWxjdWxhdGVkQ29sdW1ucyA9IDExLjk5ODg3NlxuICAgICAgICAgICAgY2FsY3VsYXRlZENvbHVtbnMgPSBNYXRoLnJvdW5kKCBjYWxjdWxhdGVkQ29sdW1ucyApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jb2xzID0gTWF0aC5tYXgoIE1hdGguZmxvb3IoY2FsY3VsYXRlZENvbHVtbnMpLCAxICk7XG4gICAgICAgIHRoaXMuY29udGFpbmVyV2lkdGggPSBjb250YWluZXJXaWR0aDtcbiAgICAgICAgdGhpcy5jb2xXaWR0aCA9IGNvbHVtbldpZHRoO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBZGp1c3QgdGhlIGhlaWdodCBvZiB0aGUgZ3JpZFxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9zZXRDb250YWluZXJTaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuJGVsLmNzcyggJ2hlaWdodCcsIHRoaXMuX2dldENvbnRhaW5lclNpemUoKSApO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIEJhc2VkIG9uIHRoZSBjb2x1bW4gaGVpZ2h0cywgaXQgcmV0dXJucyB0aGUgYmlnZ2VzdCBvbmUuXG4gICAgICogQHJldHVybiB7bnVtYmVyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX2dldENvbnRhaW5lclNpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGFycmF5TWF4KCB0aGlzLnBvc2l0aW9ucyApO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIEZpcmUgZXZlbnRzIHdpdGggLnNodWZmbGUgbmFtZXNwYWNlXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX2ZpcmUgPSBmdW5jdGlvbiggbmFtZSwgYXJncyApIHtcbiAgICAgICAgdGhpcy4kZWwudHJpZ2dlciggbmFtZSArICcuJyArIFNIVUZGTEUsIGFyZ3MgJiYgYXJncy5sZW5ndGggPyBhcmdzIDogWyB0aGlzIF0gKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBaZXJvcyBvdXQgdGhlIHkgY29sdW1ucyBhcnJheSwgd2hpY2ggaXMgdXNlZCB0byBkZXRlcm1pbmUgaXRlbSBwbGFjZW1lbnQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fcmVzZXRDb2xzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpID0gdGhpcy5jb2xzO1xuICAgICAgICB0aGlzLnBvc2l0aW9ucyA9IFtdO1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9ucy5wdXNoKCAwICk7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBMb29wcyB0aHJvdWdoIGVhY2ggaXRlbSB0aGF0IHNob3VsZCBiZSBzaG93biBhbmQgY2FsY3VsYXRlcyB0aGUgeCwgeSBwb3NpdGlvbi5cbiAgICAgKiBAcGFyYW0ge0FycmF5LjxFbGVtZW50Pn0gaXRlbXMgQXJyYXkgb2YgaXRlbXMgdGhhdCB3aWxsIGJlIHNob3duL2xheWVkIG91dCBpbiBvcmRlciBpbiB0aGVpciBhcnJheS5cbiAgICAgKiAgICAgQmVjYXVzZSBqUXVlcnkgY29sbGVjdGlvbiBhcmUgYWx3YXlzIG9yZGVyZWQgaW4gRE9NIG9yZGVyLCB3ZSBjYW4ndCBwYXNzIGEganEgY29sbGVjdGlvbi5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc09ubHlQb3NpdGlvbj1mYWxzZV0gSWYgdHJ1ZSB0aGlzIHdpbGwgcG9zaXRpb24gdGhlIGl0ZW1zIHdpdGggemVybyBvcGFjaXR5LlxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9sYXlvdXQgPSBmdW5jdGlvbiggaXRlbXMsIGlzT25seVBvc2l0aW9uICkge1xuICAgICAgICBlYWNoKGl0ZW1zLCBmdW5jdGlvbiggaXRlbSApIHtcbiAgICAgICAgICAgIHRoaXMuX2xheW91dEl0ZW0oIGl0ZW0sICEhaXNPbmx5UG9zaXRpb24gKTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgLy8gYF9sYXlvdXRgIGFsd2F5cyBoYXBwZW5zIGFmdGVyIGBfc2hyaW5rYCwgc28gaXQncyBzYWZlIHRvIHByb2Nlc3MgdGhlIHN0eWxlXG4gICAgICAgIC8vIHF1ZXVlIGhlcmUgd2l0aCBzdHlsZXMgZnJvbSB0aGUgc2hyaW5rIG1ldGhvZC5cbiAgICAgICAgdGhpcy5fcHJvY2Vzc1N0eWxlUXVldWUoKTtcblxuICAgICAgICAvLyBBZGp1c3QgdGhlIGhlaWdodCBvZiB0aGUgY29udGFpbmVyLlxuICAgICAgICB0aGlzLl9zZXRDb250YWluZXJTaXplKCk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlcyB0aGUgcG9zaXRpb24gb2YgdGhlIGl0ZW0gYW5kIHB1c2hlcyBpdCBvbnRvIHRoZSBzdHlsZSBxdWV1ZS5cbiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGl0ZW0gRWxlbWVudCB3aGljaCBpcyBiZWluZyBwb3NpdGlvbmVkLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNPbmx5UG9zaXRpb24gV2hldGhlciB0byBwb3NpdGlvbiB0aGUgaXRlbSwgYnV0IHdpdGggemVyb1xuICAgICAqICAgICBvcGFjaXR5IHNvIHRoYXQgaXQgY2FuIGZhZGUgaW4gbGF0ZXIuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fbGF5b3V0SXRlbSA9IGZ1bmN0aW9uKCBpdGVtLCBpc09ubHlQb3NpdGlvbiApIHtcbiAgICAgICAgdmFyICRpdGVtID0gJChpdGVtKTtcbiAgICAgICAgdmFyIGl0ZW1EYXRhID0gJGl0ZW0uZGF0YSgpO1xuICAgICAgICB2YXIgY3VyclBvcyA9IGl0ZW1EYXRhLnBvaW50O1xuICAgICAgICB2YXIgY3VyclNjYWxlID0gaXRlbURhdGEuc2NhbGU7XG4gICAgICAgIHZhciBpdGVtU2l6ZSA9IHtcbiAgICAgICAgICAgIHdpZHRoOiBTaHVmZmxlLl9nZXRPdXRlcldpZHRoKCBpdGVtLCB0cnVlICksXG4gICAgICAgICAgICBoZWlnaHQ6IFNodWZmbGUuX2dldE91dGVySGVpZ2h0KCBpdGVtLCB0cnVlIClcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHBvcyA9IHRoaXMuX2dldEl0ZW1Qb3NpdGlvbiggaXRlbVNpemUgKTtcblxuICAgICAgICAvLyBJZiB0aGUgaXRlbSB3aWxsIG5vdCBjaGFuZ2UgaXRzIHBvc2l0aW9uLCBkbyBub3QgYWRkIGl0IHRvIHRoZSByZW5kZXJcbiAgICAgICAgLy8gcXVldWUuIFRyYW5zaXRpb25zIGRvbid0IGZpcmUgd2hlbiBzZXR0aW5nIGEgcHJvcGVydHkgdG8gdGhlIHNhbWUgdmFsdWUuXG4gICAgICAgIGlmICggUG9pbnQuZXF1YWxzKGN1cnJQb3MsIHBvcykgJiYgY3VyclNjYWxlID09PSBERUZBVUxUX1NDQUxFICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2F2ZSBkYXRhIGZvciBzaHJpbmtcbiAgICAgICAgaXRlbURhdGEucG9pbnQgPSBwb3M7XG4gICAgICAgIGl0ZW1EYXRhLnNjYWxlID0gREVGQVVMVF9TQ0FMRTtcblxuICAgICAgICB0aGlzLnN0eWxlUXVldWUucHVzaCh7XG4gICAgICAgICAgICAkaXRlbTogJGl0ZW0sXG4gICAgICAgICAgICBwb2ludDogcG9zLFxuICAgICAgICAgICAgc2NhbGU6IERFRkFVTFRfU0NBTEUsXG4gICAgICAgICAgICBvcGFjaXR5OiBpc09ubHlQb3NpdGlvbiA/IDAgOiAxLFxuICAgICAgICAgICAgLy8gU2V0IHN0eWxlcyBpbW1lZGlhdGVseSBpZiB0aGVyZSBpcyBubyB0cmFuc2l0aW9uIHNwZWVkLlxuICAgICAgICAgICAgc2tpcFRyYW5zaXRpb246IGlzT25seVBvc2l0aW9uIHx8IHRoaXMuc3BlZWQgPT09IDAsXG4gICAgICAgICAgICBjYWxsZnJvbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICggIWlzT25seVBvc2l0aW9uICkge1xuICAgICAgICAgICAgICAgICAgICAkaXRlbS5jc3MoICd2aXNpYmlsaXR5JywgJ3Zpc2libGUnICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoIGlzT25seVBvc2l0aW9uICkge1xuICAgICAgICAgICAgICAgICAgICAkaXRlbS5jc3MoICd2aXNpYmlsaXR5JywgJ2hpZGRlbicgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSB0aGUgbG9jYXRpb24gb2YgdGhlIG5leHQgaXRlbSwgYmFzZWQgb24gaXRzIHNpemUuXG4gICAgICogQHBhcmFtIHt7d2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXJ9fSBpdGVtU2l6ZSBPYmplY3Qgd2l0aCB3aWR0aCBhbmQgaGVpZ2h0LlxuICAgICAqIEByZXR1cm4ge1BvaW50fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX2dldEl0ZW1Qb3NpdGlvbiA9IGZ1bmN0aW9uKCBpdGVtU2l6ZSApIHtcbiAgICAgICAgdmFyIGNvbHVtblNwYW4gPSB0aGlzLl9nZXRDb2x1bW5TcGFuKCBpdGVtU2l6ZS53aWR0aCwgdGhpcy5jb2xXaWR0aCwgdGhpcy5jb2xzICk7XG5cbiAgICAgICAgdmFyIHNldFkgPSB0aGlzLl9nZXRDb2x1bW5TZXQoIGNvbHVtblNwYW4sIHRoaXMuY29scyApO1xuXG4gICAgICAgIC8vIEZpbmRzIHRoZSBpbmRleCBvZiB0aGUgc21hbGxlc3QgbnVtYmVyIGluIHRoZSBzZXQuXG4gICAgICAgIHZhciBzaG9ydENvbHVtbkluZGV4ID0gdGhpcy5fZ2V0U2hvcnRDb2x1bW4oIHNldFksIHRoaXMuYnVmZmVyICk7XG5cbiAgICAgICAgLy8gUG9zaXRpb24gdGhlIGl0ZW1cbiAgICAgICAgdmFyIHBvaW50ID0gbmV3IFBvaW50KFxuICAgICAgICAgICAgTWF0aC5yb3VuZCggdGhpcy5jb2xXaWR0aCAqIHNob3J0Q29sdW1uSW5kZXggKSxcbiAgICAgICAgICAgIE1hdGgucm91bmQoIHNldFlbc2hvcnRDb2x1bW5JbmRleF0gKSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBjb2x1bW5zIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZXMgZm9yIGVhY2ggY29sdW1uLlxuICAgICAgICAvLyBlLmcuIGJlZm9yZSB0aGUgdXBkYXRlIHRoZSBjb2x1bW5zIGNvdWxkIGJlIFsyNTAsIDAsIDAsIDBdIGZvciBhbiBpdGVtXG4gICAgICAgIC8vIHdoaWNoIHNwYW5zIDIgY29sdW1ucy4gQWZ0ZXIgaXQgd291bGQgYmUgWzI1MCwgaXRlbUhlaWdodCwgaXRlbUhlaWdodCwgMF0uXG4gICAgICAgIHZhciBzZXRIZWlnaHQgPSBzZXRZW3Nob3J0Q29sdW1uSW5kZXhdICsgaXRlbVNpemUuaGVpZ2h0O1xuICAgICAgICB2YXIgc2V0U3BhbiA9IHRoaXMuY29scyArIDEgLSBzZXRZLmxlbmd0aDtcbiAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgc2V0U3BhbjsgaSsrICkge1xuICAgICAgICAgICAgdGhpcy5wb3NpdGlvbnNbIHNob3J0Q29sdW1uSW5kZXggKyBpIF0gPSBzZXRIZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcG9pbnQ7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIHRoZSBudW1iZXIgb2YgY29sdW1ucyBhbiBpdGVtcyBzcGFucy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaXRlbVdpZHRoIFdpZHRoIG9mIHRoZSBpdGVtLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb2x1bW5XaWR0aCBXaWR0aCBvZiB0aGUgY29sdW1uIChpbmNsdWRlcyBndXR0ZXIpLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjb2x1bW5zIFRvdGFsIG51bWJlciBvZiBjb2x1bW5zXG4gICAgICogQHJldHVybiB7bnVtYmVyfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX2dldENvbHVtblNwYW4gPSBmdW5jdGlvbiggaXRlbVdpZHRoLCBjb2x1bW5XaWR0aCwgY29sdW1ucyApIHtcbiAgICAgICAgdmFyIGNvbHVtblNwYW4gPSBpdGVtV2lkdGggLyBjb2x1bW5XaWR0aDtcblxuICAgICAgICAvLyBJZiB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSByb3VuZGVkIGNvbHVtbiBzcGFuIG51bWJlciBhbmQgdGhlXG4gICAgICAgIC8vIGNhbGN1bGF0ZWQgY29sdW1uIHNwYW4gbnVtYmVyIGlzIHJlYWxseSBzbWFsbCwgcm91bmQgdGhlIG51bWJlciB0b1xuICAgICAgICAvLyBtYWtlIGl0IGZpdC5cbiAgICAgICAgaWYgKCBNYXRoLmFicyhNYXRoLnJvdW5kKCBjb2x1bW5TcGFuICkgLSBjb2x1bW5TcGFuICkgPCB0aGlzLmNvbHVtblRocmVzaG9sZCApIHtcbiAgICAgICAgICAgIC8vIGUuZy4gY29sdW1uU3BhbiA9IDQuMDA4OTk0NTM5MDI5ODc0NVxuICAgICAgICAgICAgY29sdW1uU3BhbiA9IE1hdGgucm91bmQoIGNvbHVtblNwYW4gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEVuc3VyZSB0aGUgY29sdW1uIHNwYW4gaXMgbm90IG1vcmUgdGhhbiB0aGUgYW1vdW50IG9mIGNvbHVtbnMgaW4gdGhlIHdob2xlIGxheW91dC5cbiAgICAgICAgcmV0dXJuIE1hdGgubWluKCBNYXRoLmNlaWwoIGNvbHVtblNwYW4gKSwgY29sdW1ucyApO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyB0aGUgY29sdW1uIHNldCB0byB1c2UgZm9yIHBsYWNlbWVudC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gY29sdW1uU3BhbiBUaGUgbnVtYmVyIG9mIGNvbHVtbnMgdGhpcyBjdXJyZW50IGl0ZW0gc3BhbnMuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGNvbHVtbnMgVGhlIHRvdGFsIGNvbHVtbnMgaW4gdGhlIGdyaWQuXG4gICAgICogQHJldHVybiB7QXJyYXkuPG51bWJlcj59IEFuIGFycmF5IG9mIG51bWJlcnMgcmVwcmVzZXRpbmcgdGhlIGNvbHVtbiBzZXQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fZ2V0Q29sdW1uU2V0ID0gZnVuY3Rpb24oIGNvbHVtblNwYW4sIGNvbHVtbnMgKSB7XG4gICAgICAgIC8vIFRoZSBpdGVtIHNwYW5zIG9ubHkgb25lIGNvbHVtbi5cbiAgICAgICAgaWYgKCBjb2x1bW5TcGFuID09PSAxICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb25zO1xuXG4gICAgICAgICAgICAvLyBUaGUgaXRlbSBzcGFucyBtb3JlIHRoYW4gb25lIGNvbHVtbiwgZmlndXJlIG91dCBob3cgbWFueSBkaWZmZXJlbnRcbiAgICAgICAgICAgIC8vIHBsYWNlcyBpdCBjb3VsZCBmaXQgaG9yaXpvbnRhbGx5LlxuICAgICAgICAgICAgLy8gVGhlIGdyb3VwIGNvdW50IGlzIHRoZSBudW1iZXIgb2YgcGxhY2VzIHdpdGhpbiB0aGUgcG9zaXRpb25zIHRoaXMgYmxvY2tcbiAgICAgICAgICAgIC8vIGNvdWxkIGZpdCwgaWdub3JpbmcgdGhlIGN1cnJlbnQgcG9zaXRpb25zIG9mIGl0ZW1zLlxuICAgICAgICAgICAgLy8gSW1hZ2luZSBhIDIgY29sdW1uIGJyaWNrIGFzIHRoZSBzZWNvbmQgaXRlbSBpbiBhIDQgY29sdW1uIGdyaWQgd2l0aFxuICAgICAgICAgICAgLy8gMTBweCBoZWlnaHQgZWFjaC4gRmluZCB0aGUgcGxhY2VzIGl0IHdvdWxkIGZpdDpcbiAgICAgICAgICAgIC8vIFsxMCwgMCwgMCwgMF1cbiAgICAgICAgICAgIC8vICB8ICAgfCAgfFxuICAgICAgICAgICAgLy8gICogICAqICAqXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gVGhlbiB0YWtlIHRoZSBwbGFjZXMgd2hpY2ggZml0IGFuZCBnZXQgdGhlIGJpZ2dlciBvZiB0aGUgdHdvOlxuICAgICAgICAgICAgLy8gbWF4KFsxMCwgMF0pLCBtYXgoWzAsIDBdKSwgbWF4KFswLCAwXSkgPSBbMTAsIDAsIDBdXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gTmV4dCwgZmluZCB0aGUgZmlyc3Qgc21hbGxlc3QgbnVtYmVyICh0aGUgc2hvcnQgY29sdW1uKS5cbiAgICAgICAgICAgIC8vIFsxMCwgMCwgMF1cbiAgICAgICAgICAgIC8vICAgICAgfFxuICAgICAgICAgICAgLy8gICAgICAqXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gQW5kIHRoYXQncyB3aGVyZSBpdCBzaG91bGQgYmUgcGxhY2VkIVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGdyb3VwQ291bnQgPSBjb2x1bW5zICsgMSAtIGNvbHVtblNwYW47XG4gICAgICAgICAgICB2YXIgZ3JvdXBZID0gW107XG5cbiAgICAgICAgICAgIC8vIEZvciBob3cgbWFueSBwb3NzaWJsZSBwb3NpdGlvbnMgZm9yIHRoaXMgaXRlbSB0aGVyZSBhcmUuXG4gICAgICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBncm91cENvdW50OyBpKysgKSB7XG4gICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgYmlnZ2VyIHZhbHVlIGZvciBlYWNoIHBsYWNlIGl0IGNvdWxkIGZpdC5cbiAgICAgICAgICAgICAgICBncm91cFlbaV0gPSBhcnJheU1heCggdGhpcy5wb3NpdGlvbnMuc2xpY2UoIGksIGkgKyBjb2x1bW5TcGFuICkgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGdyb3VwWTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIEZpbmQgaW5kZXggb2Ygc2hvcnQgY29sdW1uLCB0aGUgZmlyc3QgZnJvbSB0aGUgbGVmdCB3aGVyZSB0aGlzIGl0ZW0gd2lsbCBnby5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXJyYXkuPG51bWJlcj59IHBvc2l0aW9ucyBUaGUgYXJyYXkgdG8gc2VhcmNoIGZvciB0aGUgc21hbGxlc3QgbnVtYmVyLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBidWZmZXIgT3B0aW9uYWwgYnVmZmVyIHdoaWNoIGlzIHZlcnkgdXNlZnVsIHdoZW4gdGhlIGhlaWdodFxuICAgICAqICAgICBpcyBhIHBlcmNlbnRhZ2Ugb2YgdGhlIHdpZHRoLlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gSW5kZXggb2YgdGhlIHNob3J0IGNvbHVtbi5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9nZXRTaG9ydENvbHVtbiA9IGZ1bmN0aW9uKCBwb3NpdGlvbnMsIGJ1ZmZlciApIHtcbiAgICAgICAgdmFyIG1pblBvc2l0aW9uID0gYXJyYXlNaW4oIHBvc2l0aW9ucyApO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcG9zaXRpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoIHBvc2l0aW9uc1tpXSA+PSBtaW5Qb3NpdGlvbiAtIGJ1ZmZlciAmJiBwb3NpdGlvbnNbaV0gPD0gbWluUG9zaXRpb24gKyBidWZmZXIgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogSGlkZXMgdGhlIGVsZW1lbnRzIHRoYXQgZG9uJ3QgbWF0Y2ggb3VyIGZpbHRlci5cbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJGNvbGxlY3Rpb24galF1ZXJ5IGNvbGxlY3Rpb24gdG8gc2hyaW5rLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX3NocmluayA9IGZ1bmN0aW9uKCAkY29sbGVjdGlvbiApIHtcbiAgICAgICAgdmFyICRjb25jZWFsZWQgPSAkY29sbGVjdGlvbiB8fCB0aGlzLl9nZXRDb25jZWFsZWRJdGVtcygpO1xuXG4gICAgICAgIGVhY2goJGNvbmNlYWxlZCwgZnVuY3Rpb24oIGl0ZW0gKSB7XG4gICAgICAgICAgICB2YXIgJGl0ZW0gPSAkKGl0ZW0pO1xuICAgICAgICAgICAgdmFyIGl0ZW1EYXRhID0gJGl0ZW0uZGF0YSgpO1xuXG4gICAgICAgICAgICAvLyBDb250aW51aW5nIHdvdWxkIGFkZCBhIHRyYW5zaXRpb25lbmQgZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGVsZW1lbnQsIGJ1dFxuICAgICAgICAgICAgLy8gdGhhdCBsaXN0ZW5lciB3b3VsZCBub3QgZXhlY3V0ZSBiZWNhdXNlIHRoZSB0cmFuc2Zvcm0gYW5kIG9wYWNpdHkgd291bGRcbiAgICAgICAgICAgIC8vIHN0YXkgdGhlIHNhbWUuXG4gICAgICAgICAgICBpZiAoIGl0ZW1EYXRhLnNjYWxlID09PSBDT05DRUFMRURfU0NBTEUgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpdGVtRGF0YS5zY2FsZSA9IENPTkNFQUxFRF9TQ0FMRTtcblxuICAgICAgICAgICAgdGhpcy5zdHlsZVF1ZXVlLnB1c2goe1xuICAgICAgICAgICAgICAgICRpdGVtOiAkaXRlbSxcbiAgICAgICAgICAgICAgICBwb2ludDogaXRlbURhdGEucG9pbnQsXG4gICAgICAgICAgICAgICAgc2NhbGUgOiBDT05DRUFMRURfU0NBTEUsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICRpdGVtLmNzcyggJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBSZXNpemUgaGFuZGxlci5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9vblJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBJZiBzaHVmZmxlIGlzIGRpc2FibGVkLCBkZXN0cm95ZWQsIGRvbid0IGRvIGFueXRoaW5nXG4gICAgICAgIGlmICggIXRoaXMuZW5hYmxlZCB8fCB0aGlzLmRlc3Ryb3llZCApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdpbGwgbmVlZCB0byBjaGVjayBoZWlnaHQgaW4gdGhlIGZ1dHVyZSBpZiBpdCdzIGxheWVkIG91dCBob3Jpem9udGFseVxuICAgICAgICB2YXIgY29udGFpbmVyV2lkdGggPSBTaHVmZmxlLl9nZXRPdXRlcldpZHRoKCB0aGlzLmVsZW1lbnQgKTtcblxuICAgICAgICAvLyBjb250YWluZXJXaWR0aCBoYXNuJ3QgY2hhbmdlZCwgZG9uJ3QgZG8gYW55dGhpbmdcbiAgICAgICAgaWYgKCBjb250YWluZXJXaWR0aCA9PT0gdGhpcy5jb250YWluZXJXaWR0aCApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBzdHlsZXMgZm9yIGVpdGhlciBqUXVlcnkgYW5pbWF0ZSBvciB0cmFuc2l0aW9uLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIFRyYW5zaXRpb24gb3B0aW9ucy5cbiAgICAgKiBAcmV0dXJuIHshT2JqZWN0fSBUcmFuc2Zvcm1zIGZvciB0cmFuc2l0aW9ucywgbGVmdC90b3AgZm9yIGFuaW1hdGUuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fZ2V0U3R5bGVzRm9yVHJhbnNpdGlvbiA9IGZ1bmN0aW9uKCBvcHRzICkge1xuICAgICAgICB2YXIgc3R5bGVzID0ge1xuICAgICAgICAgICAgb3BhY2l0eTogb3B0cy5vcGFjaXR5XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCB0aGlzLnN1cHBvcnRlZCApIHtcbiAgICAgICAgICAgIHN0eWxlc1sgVFJBTlNGT1JNIF0gPSBTaHVmZmxlLl9nZXRJdGVtVHJhbnNmb3JtU3RyaW5nKCBvcHRzLnBvaW50LCBvcHRzLnNjYWxlICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdHlsZXMubGVmdCA9IG9wdHMucG9pbnQueDtcbiAgICAgICAgICAgIHN0eWxlcy50b3AgPSBvcHRzLnBvaW50Lnk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc3R5bGVzO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFRyYW5zaXRpb25zIGFuIGl0ZW0gaW4gdGhlIGdyaWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIG9wdGlvbnMuXG4gICAgICogQHBhcmFtIHtqUXVlcnl9IG9wdHMuJGl0ZW0galF1ZXJ5IG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgaXRlbS5cbiAgICAgKiBAcGFyYW0ge1BvaW50fSBvcHRzLnBvaW50IEEgcG9pbnQgb2JqZWN0IHdpdGggdGhlIHggYW5kIHkgY29vcmRpbmF0ZXMuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG9wdHMuc2NhbGUgQW1vdW50IHRvIHNjYWxlIHRoZSBpdGVtLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvcHRzLm9wYWNpdHkgT3BhY2l0eSBvZiB0aGUgaXRlbS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcHRzLmNhbGxiYWNrIENvbXBsZXRlIGZ1bmN0aW9uIGZvciB0aGUgYW5pbWF0aW9uLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG9wdHMuY2FsbGZyb250IEZ1bmN0aW9uIHRvIGNhbGwgYmVmb3JlIHRyYW5zaXRpb25pbmcuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fdHJhbnNpdGlvbiA9IGZ1bmN0aW9uKCBvcHRzICkge1xuICAgICAgICB2YXIgc3R5bGVzID0gdGhpcy5fZ2V0U3R5bGVzRm9yVHJhbnNpdGlvbiggb3B0cyApO1xuICAgICAgICB0aGlzLl9zdGFydEl0ZW1BbmltYXRpb24oIG9wdHMuJGl0ZW0sIHN0eWxlcywgb3B0cy5jYWxsZnJvbnQgfHwgJC5ub29wLCBvcHRzLmNhbGxiYWNrIHx8ICQubm9vcCApO1xuICAgIH07XG5cblxuICAgIFNodWZmbGUucHJvdG90eXBlLl9zdGFydEl0ZW1BbmltYXRpb24gPSBmdW5jdGlvbiggJGl0ZW0sIHN0eWxlcywgY2FsbGZyb250LCBjYWxsYmFjayApIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgLy8gVHJhbnNpdGlvbiBlbmQgaGFuZGxlciByZW1vdmVzIGl0cyBsaXN0ZW5lci5cbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlVHJhbnNpdGlvbkVuZCggZXZ0ICkge1xuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoaXMgZXZlbnQgaGFuZGxlciBoYXMgbm90IGJ1YmJsZWQgdXAgZnJvbSBhIGNoaWxkLlxuICAgICAgICAgICAgaWYgKCBldnQudGFyZ2V0ID09PSBldnQuY3VycmVudFRhcmdldCApIHtcbiAgICAgICAgICAgICAgICAkKCBldnQudGFyZ2V0ICkub2ZmKCBUUkFOU0lUSU9ORU5ELCBoYW5kbGVUcmFuc2l0aW9uRW5kICk7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3JlbW92ZVRyYW5zaXRpb25SZWZlcmVuY2UocmVmZXJlbmNlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHJlZmVyZW5jZSA9IHtcbiAgICAgICAgICAgICRlbGVtZW50OiAkaXRlbSxcbiAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZVRyYW5zaXRpb25FbmRcbiAgICAgICAgfTtcblxuICAgICAgICBjYWxsZnJvbnQoKTtcblxuICAgICAgICAvLyBUcmFuc2l0aW9ucyBhcmUgbm90IHNldCB1bnRpbCBzaHVmZmxlIGhhcyBsb2FkZWQgdG8gYXZvaWQgdGhlIGluaXRpYWwgdHJhbnNpdGlvbi5cbiAgICAgICAgaWYgKCAhdGhpcy5pbml0aWFsaXplZCApIHtcbiAgICAgICAgICAgICRpdGVtLmNzcyggc3R5bGVzICk7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXNlIENTUyBUcmFuc2Zvcm1zIGlmIHdlIGhhdmUgdGhlbVxuICAgICAgICBpZiAoIHRoaXMuc3VwcG9ydGVkICkge1xuICAgICAgICAgICAgJGl0ZW0uY3NzKCBzdHlsZXMgKTtcbiAgICAgICAgICAgICRpdGVtLm9uKCBUUkFOU0lUSU9ORU5ELCBoYW5kbGVUcmFuc2l0aW9uRW5kICk7XG4gICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9ucy5wdXNoKHJlZmVyZW5jZSk7XG5cbiAgICAgICAgICAgIC8vIFVzZSBqUXVlcnkgdG8gYW5pbWF0ZSBsZWZ0L3RvcFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gU2F2ZSB0aGUgZGVmZXJyZWQgb2JqZWN0IHdoaWNoIGpRdWVyeSByZXR1cm5zLlxuICAgICAgICAgICAgdmFyIGFuaW0gPSAkaXRlbS5zdG9wKCB0cnVlICkuYW5pbWF0ZSggc3R5bGVzLCB0aGlzLnNwZWVkLCAnc3dpbmcnLCBjYWxsYmFjayApO1xuICAgICAgICAgICAgLy8gUHVzaCB0aGUgYW5pbWF0aW9uIHRvIHRoZSBsaXN0IG9mIHBlbmRpbmcgYW5pbWF0aW9ucy5cbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnMucHVzaCggYW5pbS5wcm9taXNlKCkgKTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgdGhlIHN0eWxlcyBnYXRoZXJlZCBpbiB0aGUgc3R5bGUgcXVldWUuIFRoaXMgYXBwbGllcyBzdHlsZXMgdG8gZWxlbWVudHMsXG4gICAgICogdHJpZ2dlcmluZyB0cmFuc2l0aW9ucy5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IG5vTGF5b3V0IFdoZXRoZXIgdG8gdHJpZ2dlciBhIGxheW91dCBldmVudC5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl9wcm9jZXNzU3R5bGVRdWV1ZSA9IGZ1bmN0aW9uKCBub0xheW91dCApIHtcbiAgICAgICAgaWYgKCB0aGlzLmlzVHJhbnNpdGlvbmluZyApIHtcbiAgICAgICAgICAgIHRoaXMuX2NhbmNlbE1vdmVtZW50KCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgJHRyYW5zaXRpb25zID0gJCgpO1xuXG4gICAgICAgIC8vIEl0ZXJhdGUgb3ZlciB0aGUgcXVldWUgYW5kIGtlZXAgdHJhY2sgb2Ygb25lcyB0aGF0IHVzZSB0cmFuc2l0aW9ucy5cbiAgICAgICAgZWFjaCh0aGlzLnN0eWxlUXVldWUsIGZ1bmN0aW9uKCB0cmFuc2l0aW9uT2JqICkge1xuICAgICAgICAgICAgaWYgKCB0cmFuc2l0aW9uT2JqLnNraXBUcmFuc2l0aW9uICkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0eWxlSW1tZWRpYXRlbHkoIHRyYW5zaXRpb25PYmogKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHRyYW5zaXRpb25zID0gJHRyYW5zaXRpb25zLmFkZCggdHJhbnNpdGlvbk9iai4kaXRlbSApO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb24oIHRyYW5zaXRpb25PYmogKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG5cblxuICAgICAgICBpZiAoICR0cmFuc2l0aW9ucy5sZW5ndGggPiAwICYmIHRoaXMuaW5pdGlhbGl6ZWQgJiYgdGhpcy5zcGVlZCA+IDAgKSB7XG4gICAgICAgICAgICAvLyBTZXQgZmxhZyB0aGF0IHNodWZmbGUgaXMgY3VycmVudGx5IGluIG1vdGlvbi5cbiAgICAgICAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgaWYgKCB0aGlzLnN1cHBvcnRlZCApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl93aGVuQ29sbGVjdGlvbkRvbmUoICR0cmFuc2l0aW9ucywgVFJBTlNJVElPTkVORCwgdGhpcy5fbW92ZW1lbnRGaW5pc2hlZCApO1xuXG4gICAgICAgICAgICAgICAgLy8gVGhlIF90cmFuc2l0aW9uIGZ1bmN0aW9uIGFwcGVuZHMgYSBwcm9taXNlIHRvIHRoZSBhbmltYXRpb25zIGFycmF5LlxuICAgICAgICAgICAgICAgIC8vIFdoZW4gdGhleSdyZSBhbGwgY29tcGxldGUsIGRvIHRoaW5ncy5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fd2hlbkFuaW1hdGlvbnNEb25lKCB0aGlzLl9tb3ZlbWVudEZpbmlzaGVkICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEEgY2FsbCB0byBsYXlvdXQgaGFwcGVuZWQsIGJ1dCBub25lIG9mIHRoZSBuZXdseSBmaWx0ZXJlZCBpdGVtcyB3aWxsXG4gICAgICAgICAgICAvLyBjaGFuZ2UgcG9zaXRpb24uIEFzeW5jaHJvbm91c2x5IGZpcmUgdGhlIGNhbGxiYWNrIGhlcmUuXG4gICAgICAgIH0gZWxzZSBpZiAoICFub0xheW91dCApIHtcbiAgICAgICAgICAgIGRlZmVyKCB0aGlzLl9sYXlvdXRFbmQsIHRoaXMgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlbW92ZSBldmVyeXRoaW5nIGluIHRoZSBzdHlsZSBxdWV1ZVxuICAgICAgICB0aGlzLnN0eWxlUXVldWUubGVuZ3RoID0gMDtcbiAgICB9O1xuXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX2NhbmNlbE1vdmVtZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLnN1cHBvcnRlZCkge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSB0cmFuc2l0aW9uIGVuZCBldmVudCBmb3IgZWFjaCBsaXN0ZW5lci5cbiAgICAgICAgICAgIGVhY2godGhpcy5fdHJhbnNpdGlvbnMsIGZ1bmN0aW9uKCB0cmFuc2l0aW9uICkge1xuICAgICAgICAgICAgICAgIHRyYW5zaXRpb24uJGVsZW1lbnQub2ZmKCBUUkFOU0lUSU9ORU5ELCB0cmFuc2l0aW9uLmhhbmRsZXIgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRXZlbiB3aGVuIGBzdG9wYCBpcyBjYWxsZWQgb24gdGhlIGpRdWVyeSBhbmltYXRpb24sIGl0cyBwcm9taXNlIHdpbGxcbiAgICAgICAgICAgIC8vIHN0aWxsIGJlIHJlc29sdmVkLiBTaW5jZSBpdCBjYW5ub3QgYmUgZGV0ZXJtaW5lIGZyb20gd2l0aGluIHRoYXQgY2FsbGJhY2tcbiAgICAgICAgICAgIC8vIHdoZXRoZXIgdGhlIGFuaW1hdGlvbiB3YXMgc3RvcHBlZCBvciBub3QsIGEgZmxhZyBpcyBzZXQgaGVyZSB0byBkaXN0aW5ndWlzaFxuICAgICAgICAgICAgLy8gYmV0d2VlbiB0aGUgdHdvIHN0YXRlcy5cbiAgICAgICAgICAgIHRoaXMuX2lzTW92ZW1lbnRDYW5jZWxlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLiRpdGVtcy5zdG9wKHRydWUpO1xuICAgICAgICAgICAgdGhpcy5faXNNb3ZlbWVudENhbmNlbGVkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXNldCB0aGUgYXJyYXkuXG4gICAgICAgIHRoaXMuX3RyYW5zaXRpb25zLmxlbmd0aCA9IDA7XG5cbiAgICAgICAgLy8gU2hvdyBpdCdzIG5vIGxvbmdlciBhY3RpdmUuXG4gICAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7XG4gICAgfTtcblxuICAgIFNodWZmbGUucHJvdG90eXBlLl9yZW1vdmVUcmFuc2l0aW9uUmVmZXJlbmNlID0gZnVuY3Rpb24ocmVmKSB7XG4gICAgICAgIHZhciBpbmRleEluQXJyYXkgPSAkLmluQXJyYXkocmVmLCB0aGlzLl90cmFuc2l0aW9ucyk7XG4gICAgICAgIGlmIChpbmRleEluQXJyYXkgPiAtMSkge1xuICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbnMuc3BsaWNlKGluZGV4SW5BcnJheSwgMSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBBcHBseSBzdHlsZXMgd2l0aG91dCBhIHRyYW5zaXRpb24uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdHMgVHJhbnNpdGlvbnMgb3B0aW9ucyBvYmplY3QuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fc3R5bGVJbW1lZGlhdGVseSA9IGZ1bmN0aW9uKCBvcHRzICkge1xuICAgICAgICBTaHVmZmxlLl9za2lwVHJhbnNpdGlvbihvcHRzLiRpdGVtWzBdLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG9wdHMuJGl0ZW0uY3NzKCB0aGlzLl9nZXRTdHlsZXNGb3JUcmFuc2l0aW9uKCBvcHRzICkgKTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfTtcblxuICAgIFNodWZmbGUucHJvdG90eXBlLl9tb3ZlbWVudEZpbmlzaGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2xheW91dEVuZCgpO1xuICAgIH07XG5cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fbGF5b3V0RW5kID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuX2ZpcmUoIFNodWZmbGUuRXZlbnRUeXBlLkxBWU9VVCApO1xuICAgIH07XG5cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fYWRkSXRlbXMgPSBmdW5jdGlvbiggJG5ld0l0ZW1zLCBhZGRUb0VuZCwgaXNTZXF1ZW50aWFsICkge1xuICAgICAgICAvLyBBZGQgY2xhc3NlcyBhbmQgc2V0IGluaXRpYWwgcG9zaXRpb25zLlxuICAgICAgICB0aGlzLl9pbml0SXRlbXMoICRuZXdJdGVtcyApO1xuXG4gICAgICAgIC8vIEFkZCB0cmFuc2l0aW9uIHRvIGVhY2ggaXRlbS5cbiAgICAgICAgdGhpcy5fc2V0VHJhbnNpdGlvbnMoICRuZXdJdGVtcyApO1xuXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgbGlzdCBvZlxuICAgICAgICB0aGlzLiRpdGVtcyA9IHRoaXMuX2dldEl0ZW1zKCk7XG5cbiAgICAgICAgLy8gU2hyaW5rIGFsbCBpdGVtcyAod2l0aG91dCB0cmFuc2l0aW9ucykuXG4gICAgICAgIHRoaXMuX3NocmluayggJG5ld0l0ZW1zICk7XG4gICAgICAgIGVhY2godGhpcy5zdHlsZVF1ZXVlLCBmdW5jdGlvbiggdHJhbnNpdGlvbk9iaiApIHtcbiAgICAgICAgICAgIHRyYW5zaXRpb25PYmouc2tpcFRyYW5zaXRpb24gPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBBcHBseSBzaHJpbmsgcG9zaXRpb25zLCBidXQgZG8gbm90IGNhdXNlIGEgbGF5b3V0IGV2ZW50LlxuICAgICAgICB0aGlzLl9wcm9jZXNzU3R5bGVRdWV1ZSggdHJ1ZSApO1xuXG4gICAgICAgIGlmICggYWRkVG9FbmQgKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRJdGVtc1RvRW5kKCAkbmV3SXRlbXMsIGlzU2VxdWVudGlhbCApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zaHVmZmxlKCB0aGlzLmxhc3RGaWx0ZXIgKTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIFNodWZmbGUucHJvdG90eXBlLl9hZGRJdGVtc1RvRW5kID0gZnVuY3Rpb24oICRuZXdJdGVtcywgaXNTZXF1ZW50aWFsICkge1xuICAgICAgICAvLyBHZXQgb25lcyB0aGF0IHBhc3NlZCB0aGUgY3VycmVudCBmaWx0ZXJcbiAgICAgICAgdmFyICRwYXNzZWQgPSB0aGlzLl9maWx0ZXIoIG51bGwsICRuZXdJdGVtcyApO1xuICAgICAgICB2YXIgcGFzc2VkID0gJHBhc3NlZC5nZXQoKTtcblxuICAgICAgICAvLyBIb3cgbWFueSBmaWx0ZXJlZCBlbGVtZW50cz9cbiAgICAgICAgdGhpcy5fdXBkYXRlSXRlbUNvdW50KCk7XG5cbiAgICAgICAgdGhpcy5fbGF5b3V0KCBwYXNzZWQsIHRydWUgKTtcblxuICAgICAgICBpZiAoIGlzU2VxdWVudGlhbCAmJiB0aGlzLnN1cHBvcnRlZCApIHtcbiAgICAgICAgICAgIHRoaXMuX3NldFNlcXVlbnRpYWxEZWxheSggcGFzc2VkICk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9yZXZlYWxBcHBlbmRlZCggcGFzc2VkICk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlcnMgYXBwZW5kZWQgZWxlbWVudHMgdG8gZmFkZSBpbi5cbiAgICAgKiBAcGFyYW0ge0FycmF5TGlrZS48RWxlbWVudD59ICRuZXdGaWx0ZXJlZEl0ZW1zIENvbGxlY3Rpb24gb2YgZWxlbWVudHMuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5fcmV2ZWFsQXBwZW5kZWQgPSBmdW5jdGlvbiggbmV3RmlsdGVyZWRJdGVtcyApIHtcbiAgICAgICAgZGVmZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBlYWNoKG5ld0ZpbHRlcmVkSXRlbXMsIGZ1bmN0aW9uKCBlbCApIHtcbiAgICAgICAgICAgICAgICB2YXIgJGl0ZW0gPSAkKCBlbCApO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb24oe1xuICAgICAgICAgICAgICAgICAgICAkaXRlbTogJGl0ZW0sXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgICAgIHBvaW50OiAkaXRlbS5kYXRhKCdwb2ludCcpLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZTogREVGQVVMVF9TQ0FMRVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgICAgIHRoaXMuX3doZW5Db2xsZWN0aW9uRG9uZSgkKG5ld0ZpbHRlcmVkSXRlbXMpLCBUUkFOU0lUSU9ORU5ELCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKG5ld0ZpbHRlcmVkSXRlbXMpLmNzcyggVFJBTlNJVElPTl9ERUxBWSwgJzBtcycgKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlbWVudEZpbmlzaGVkKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgdGhpcywgdGhpcy5yZXZlYWxBcHBlbmRlZERlbGF5KTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlIGEgZnVuY3Rpb24gd2hlbiBhbiBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQgZm9yIGV2ZXJ5IGl0ZW0gaW4gYSBjb2xsZWN0aW9uLlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkY29sbGVjdGlvbiBDb2xsZWN0aW9uIG9mIGVsZW1lbnRzLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWUgRXZlbnQgdG8gbGlzdGVuIGZvci5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayB0byBleGVjdXRlIHdoZW4gdGhleSdyZSBkb25lLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUuX3doZW5Db2xsZWN0aW9uRG9uZSA9IGZ1bmN0aW9uKCAkY29sbGVjdGlvbiwgZXZlbnROYW1lLCBjYWxsYmFjayApIHtcbiAgICAgICAgdmFyIGRvbmUgPSAwO1xuICAgICAgICB2YXIgaXRlbXMgPSAkY29sbGVjdGlvbi5sZW5ndGg7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVFdmVudE5hbWUoIGV2dCApIHtcbiAgICAgICAgICAgIGlmICggZXZ0LnRhcmdldCA9PT0gZXZ0LmN1cnJlbnRUYXJnZXQgKSB7XG4gICAgICAgICAgICAgICAgJCggZXZ0LnRhcmdldCApLm9mZiggZXZlbnROYW1lLCBoYW5kbGVFdmVudE5hbWUgKTtcbiAgICAgICAgICAgICAgICBkb25lKys7XG5cbiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIGNhbGxiYWNrIGlmIGFsbCBpdGVtcyBoYXZlIGVtaXR0ZWQgdGhlIGNvcnJlY3QgZXZlbnQuXG4gICAgICAgICAgICAgICAgaWYgKCBkb25lID09PSBpdGVtcyApIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcmVtb3ZlVHJhbnNpdGlvblJlZmVyZW5jZShyZWZlcmVuY2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKCBzZWxmICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHJlZmVyZW5jZSA9IHtcbiAgICAgICAgICAgICRlbGVtZW50OiAkY29sbGVjdGlvbixcbiAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZUV2ZW50TmFtZVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEJpbmQgdGhlIGV2ZW50IHRvIGFsbCBpdGVtcy5cbiAgICAgICAgJGNvbGxlY3Rpb24ub24oIGV2ZW50TmFtZSwgaGFuZGxlRXZlbnROYW1lICk7XG5cbiAgICAgICAgLy8gS2VlcCB0cmFjayBvZiB0cmFuc2l0aW9uZW5kIGV2ZW50cyBzbyB0aGV5IGNhbiBiZSByZW1vdmVkLlxuICAgICAgICB0aGlzLl90cmFuc2l0aW9ucy5wdXNoKHJlZmVyZW5jZSk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBhIGNhbGxiYWNrIGFmdGVyIGpRdWVyeSBgYW5pbWF0ZWAgZm9yIGEgY29sbGVjdGlvbiBoYXMgZmluaXNoZWQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gZXhlY3V0ZSB3aGVuIHRoZXkncmUgZG9uZS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLl93aGVuQW5pbWF0aW9uc0RvbmUgPSBmdW5jdGlvbiggY2FsbGJhY2sgKSB7XG4gICAgICAgICQud2hlbi5hcHBseSggbnVsbCwgdGhpcy5fYW5pbWF0aW9ucyApLmFsd2F5cyggJC5wcm94eSggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLl9hbmltYXRpb25zLmxlbmd0aCA9IDA7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2lzTW92ZW1lbnRDYW5jZWxlZCkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoIHRoaXMgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyApKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBQdWJsaWMgTWV0aG9kc1xuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogVGhlIG1hZ2ljLiBUaGlzIGlzIHdoYXQgbWFrZXMgdGhlIHBsdWdpbiAnc2h1ZmZsZSdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xGdW5jdGlvbn0gW2NhdGVnb3J5XSBDYXRlZ29yeSB0byBmaWx0ZXIgYnkuIENhbiBiZSBhIGZ1bmN0aW9uXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtzb3J0T2JqXSBBIHNvcnQgb2JqZWN0IHdoaWNoIGNhbiBzb3J0IHRoZSBmaWx0ZXJlZCBzZXRcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5zaHVmZmxlID0gZnVuY3Rpb24oIGNhdGVnb3J5LCBzb3J0T2JqICkge1xuICAgICAgICBpZiAoICF0aGlzLmVuYWJsZWQgKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoICFjYXRlZ29yeSApIHtcbiAgICAgICAgICAgIGNhdGVnb3J5ID0gQUxMX0lURU1TO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZmlsdGVyKCBjYXRlZ29yeSApO1xuXG4gICAgICAgIC8vIEhvdyBtYW55IGZpbHRlcmVkIGVsZW1lbnRzP1xuICAgICAgICB0aGlzLl91cGRhdGVJdGVtQ291bnQoKTtcblxuICAgICAgICAvLyBTaHJpbmsgZWFjaCBjb25jZWFsZWQgaXRlbVxuICAgICAgICB0aGlzLl9zaHJpbmsoKTtcblxuICAgICAgICAvLyBVcGRhdGUgdHJhbnNmb3JtcyBvbiAuZmlsdGVyZWQgZWxlbWVudHMgc28gdGhleSB3aWxsIGFuaW1hdGUgdG8gdGhlaXIgbmV3IHBvc2l0aW9uc1xuICAgICAgICB0aGlzLnNvcnQoIHNvcnRPYmogKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSAuZmlsdGVyZWQgZWxlbWVudHMsIHNvcnRzIHRoZW0sIGFuZCBwYXNzZXMgdGhlbSB0byBsYXlvdXQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdHMgdGhlIG9wdGlvbnMgb2JqZWN0IGZvciB0aGUgc29ydGVkIHBsdWdpblxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbiggb3B0cyApIHtcbiAgICAgICAgaWYgKCB0aGlzLmVuYWJsZWQgKSB7XG4gICAgICAgICAgICB0aGlzLl9yZXNldENvbHMoKTtcblxuICAgICAgICAgICAgdmFyIHNvcnRPcHRpb25zID0gb3B0cyB8fCB0aGlzLmxhc3RTb3J0O1xuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5fZ2V0RmlsdGVyZWRJdGVtcygpLnNvcnRlZCggc29ydE9wdGlvbnMgKTtcblxuICAgICAgICAgICAgdGhpcy5fbGF5b3V0KCBpdGVtcyApO1xuXG4gICAgICAgICAgICB0aGlzLmxhc3RTb3J0ID0gc29ydE9wdGlvbnM7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBSZXBvc2l0aW9uIGV2ZXJ5dGhpbmcuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBpc09ubHlMYXlvdXQgSWYgdHJ1ZSwgY29sdW1uIGFuZCBndXR0ZXIgd2lkdGhzIHdvbid0IGJlXG4gICAgICogICAgIHJlY2FsY3VsYXRlZC5cbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiggaXNPbmx5TGF5b3V0ICkge1xuICAgICAgICBpZiAoIHRoaXMuZW5hYmxlZCApIHtcblxuICAgICAgICAgICAgaWYgKCAhaXNPbmx5TGF5b3V0ICkge1xuICAgICAgICAgICAgICAgIC8vIEdldCB1cGRhdGVkIGNvbENvdW50XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0Q29sdW1ucygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMYXlvdXQgaXRlbXNcbiAgICAgICAgICAgIHRoaXMuc29ydCgpO1xuICAgICAgICB9XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogVXNlIHRoaXMgaW5zdGVhZCBvZiBgdXBkYXRlKClgIGlmIHlvdSBkb24ndCBuZWVkIHRoZSBjb2x1bW5zIGFuZCBndXR0ZXJzIHVwZGF0ZWRcbiAgICAgKiBNYXliZSBhbiBpbWFnZSBpbnNpZGUgYHNodWZmbGVgIGxvYWRlZCAoYW5kIG5vdyBoYXMgYSBoZWlnaHQpLCB3aGljaCBtZWFucyBjYWxjdWxhdGlvbnNcbiAgICAgKiBjb3VsZCBiZSBvZmYuXG4gICAgICovXG4gICAgU2h1ZmZsZS5wcm90b3R5cGUubGF5b3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMudXBkYXRlKCB0cnVlICk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogTmV3IGl0ZW1zIGhhdmUgYmVlbiBhcHBlbmRlZCB0byBzaHVmZmxlLiBGYWRlIHRoZW0gaW4gc2VxdWVudGlhbGx5XG4gICAgICogQHBhcmFtIHtqUXVlcnl9ICRuZXdJdGVtcyBqUXVlcnkgY29sbGVjdGlvbiBvZiBuZXcgaXRlbXNcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFthZGRUb0VuZD1mYWxzZV0gSWYgdHJ1ZSwgbmV3IGl0ZW1zIHdpbGwgYmUgYWRkZWQgdG8gdGhlIGVuZCAvIGJvdHRvbVxuICAgICAqICAgICBvZiB0aGUgaXRlbXMuIElmIG5vdCB0cnVlLCBpdGVtcyB3aWxsIGJlIG1peGVkIGluIHdpdGggdGhlIGN1cnJlbnQgc29ydCBvcmRlci5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc1NlcXVlbnRpYWw9dHJ1ZV0gSWYgZmFsc2UsIG5ldyBpdGVtcyB3b24ndCBzZXF1ZW50aWFsbHkgZmFkZSBpblxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLmFwcGVuZGVkID0gZnVuY3Rpb24oICRuZXdJdGVtcywgYWRkVG9FbmQsIGlzU2VxdWVudGlhbCApIHtcbiAgICAgICAgdGhpcy5fYWRkSXRlbXMoICRuZXdJdGVtcywgYWRkVG9FbmQgPT09IHRydWUsIGlzU2VxdWVudGlhbCAhPT0gZmFsc2UgKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBEaXNhYmxlcyBzaHVmZmxlIGZyb20gdXBkYXRpbmcgZGltZW5zaW9ucyBhbmQgbGF5b3V0IG9uIHJlc2l6ZVxuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogRW5hYmxlcyBzaHVmZmxlIGFnYWluXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbaXNVcGRhdGVMYXlvdXQ9dHJ1ZV0gaWYgdW5kZWZpbmVkLCBzaHVmZmxlIHdpbGwgdXBkYXRlIGNvbHVtbnMgYW5kIGd1dHRlcnNcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbiggaXNVcGRhdGVMYXlvdXQgKSB7XG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGlmICggaXNVcGRhdGVMYXlvdXQgIT09IGZhbHNlICkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSAxIG9yIG1vcmUgc2h1ZmZsZSBpdGVtc1xuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkY29sbGVjdGlvbiBBIGpRdWVyeSBvYmplY3QgY29udGFpbmluZyBvbmUgb3IgbW9yZSBlbGVtZW50IGluIHNodWZmbGVcbiAgICAgKiBAcmV0dXJuIHtTaHVmZmxlfSBUaGUgc2h1ZmZsZSBvYmplY3RcbiAgICAgKi9cbiAgICBTaHVmZmxlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiggJGNvbGxlY3Rpb24gKSB7XG5cbiAgICAgICAgLy8gSWYgdGhpcyBpc24ndCBhIGpxdWVyeSBvYmplY3QsIGV4aXRcbiAgICAgICAgaWYgKCAhJGNvbGxlY3Rpb24ubGVuZ3RoIHx8ICEkY29sbGVjdGlvbi5qcXVlcnkgKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVSZW1vdmVkKCkge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjb2xsZWN0aW9uIGluIHRoZSBjYWxsYmFja1xuICAgICAgICAgICAgJGNvbGxlY3Rpb24ucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGluZ3Mgbm93IHRoYXQgZWxlbWVudHMgaGF2ZSBiZWVuIHJlbW92ZWQuXG4gICAgICAgICAgICB0aGlzLiRpdGVtcyA9IHRoaXMuX2dldEl0ZW1zKCk7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVJdGVtQ291bnQoKTtcblxuICAgICAgICAgICAgdGhpcy5fZmlyZSggU2h1ZmZsZS5FdmVudFR5cGUuUkVNT1ZFRCwgWyAkY29sbGVjdGlvbiwgdGhpcyBdICk7XG5cbiAgICAgICAgICAgIC8vIExldCBpdCBnZXQgZ2FyYmFnZSBjb2xsZWN0ZWRcbiAgICAgICAgICAgICRjb2xsZWN0aW9uID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhpZGUgY29sbGVjdGlvbiBmaXJzdC5cbiAgICAgICAgdGhpcy5fdG9nZ2xlRmlsdGVyQ2xhc3NlcyggJCgpLCAkY29sbGVjdGlvbiApO1xuICAgICAgICB0aGlzLl9zaHJpbmsoICRjb2xsZWN0aW9uICk7XG5cbiAgICAgICAgdGhpcy5zb3J0KCk7XG5cbiAgICAgICAgdGhpcy4kZWwub25lKCBTaHVmZmxlLkV2ZW50VHlwZS5MQVlPVVQgKyAnLicgKyBTSFVGRkxFLCAkLnByb3h5KCBoYW5kbGVSZW1vdmVkLCB0aGlzICkgKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95cyBzaHVmZmxlLCByZW1vdmVzIGV2ZW50cywgc3R5bGVzLCBhbmQgY2xhc3Nlc1xuICAgICAqL1xuICAgIFNodWZmbGUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBzaHVmZmxlIGluc3RhbmNlIG9uIHRoZSBwYWdlLFxuICAgICAgICAvLyByZW1vdmluZyB0aGUgcmVzaXplIGhhbmRsZXIgZnJvbSB0aGUgd2luZG93IHdvdWxkIHJlbW92ZSB0aGVtXG4gICAgICAgIC8vIGFsbC4gVGhpcyBpcyB3aHkgYSB1bmlxdWUgdmFsdWUgaXMgbmVlZGVkLlxuICAgICAgICAkd2luZG93Lm9mZignLicgKyB0aGlzLnVuaXF1ZSk7XG5cbiAgICAgICAgLy8gUmVzZXQgY29udGFpbmVyIHN0eWxlc1xuICAgICAgICB0aGlzLiRlbFxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCBTSFVGRkxFIClcbiAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdzdHlsZScpXG4gICAgICAgICAgICAucmVtb3ZlRGF0YSggU0hVRkZMRSApO1xuXG4gICAgICAgIC8vIFJlc2V0IGluZGl2aWR1YWwgaXRlbSBzdHlsZXNcbiAgICAgICAgdGhpcy4kaXRlbXNcbiAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdzdHlsZScpXG4gICAgICAgICAgICAucmVtb3ZlRGF0YSgncG9pbnQnKVxuICAgICAgICAgICAgLnJlbW92ZURhdGEoJ3NjYWxlJylcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhbXG4gICAgICAgICAgICAgICAgU2h1ZmZsZS5DbGFzc05hbWUuQ09OQ0VBTEVELFxuICAgICAgICAgICAgICAgIFNodWZmbGUuQ2xhc3NOYW1lLkZJTFRFUkVELFxuICAgICAgICAgICAgICAgIFNodWZmbGUuQ2xhc3NOYW1lLlNIVUZGTEVfSVRFTVxuICAgICAgICAgICAgXS5qb2luKCcgJykpO1xuXG4gICAgICAgIC8vIE51bGwgRE9NIHJlZmVyZW5jZXNcbiAgICAgICAgdGhpcy4kaXRlbXMgPSBudWxsO1xuICAgICAgICB0aGlzLiRlbCA9IG51bGw7XG4gICAgICAgIHRoaXMuc2l6ZXIgPSBudWxsO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICAgICAgICB0aGlzLl90cmFuc2l0aW9ucyA9IG51bGw7XG5cbiAgICAgICAgLy8gU2V0IGEgZmxhZyBzbyBpZiBhIGRlYm91bmNlZCByZXNpemUgaGFzIGJlZW4gdHJpZ2dlcmVkLFxuICAgICAgICAvLyBpdCBjYW4gZmlyc3QgY2hlY2sgaWYgaXQgaXMgYWN0dWFsbHkgZGVzdHJveWVkIGFuZCBub3QgZG9pbmcgYW55dGhpbmdcbiAgICAgICAgdGhpcy5kZXN0cm95ZWQgPSB0cnVlO1xuICAgIH07XG5cblxuLy8gUGx1Z2luIGRlZmluaXRpb25cbiAgICAkLmZuLnNodWZmbGUgPSBmdW5jdGlvbiggb3B0cyApIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggYXJndW1lbnRzLCAxICk7XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKCB0aGlzICk7XG4gICAgICAgICAgICB2YXIgc2h1ZmZsZSA9ICR0aGlzLmRhdGEoIFNIVUZGTEUgKTtcblxuICAgICAgICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhIHN0b3JlZCBzaHVmZmxlLCBtYWtlIGEgbmV3IG9uZSBhbmQgc2F2ZSBpdFxuICAgICAgICAgICAgaWYgKCAhc2h1ZmZsZSApIHtcbiAgICAgICAgICAgICAgICBzaHVmZmxlID0gbmV3IFNodWZmbGUoIHRoaXMsIG9wdHMgKTtcbiAgICAgICAgICAgICAgICAkdGhpcy5kYXRhKCBTSFVGRkxFLCBzaHVmZmxlICk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2Ygb3B0cyA9PT0gJ3N0cmluZycgJiYgc2h1ZmZsZVsgb3B0cyBdICkge1xuICAgICAgICAgICAgICAgIHNodWZmbGVbIG9wdHMgXS5hcHBseSggc2h1ZmZsZSwgYXJncyApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG5cbi8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzk2Mjg5MC8zNzM0MjJcbiAgICBmdW5jdGlvbiByYW5kb21pemUoIGFycmF5ICkge1xuICAgICAgICB2YXIgdG1wLCBjdXJyZW50O1xuICAgICAgICB2YXIgdG9wID0gYXJyYXkubGVuZ3RoO1xuXG4gICAgICAgIGlmICggIXRvcCApIHtcbiAgICAgICAgICAgIHJldHVybiBhcnJheTtcbiAgICAgICAgfVxuXG4gICAgICAgIHdoaWxlICggLS10b3AgKSB7XG4gICAgICAgICAgICBjdXJyZW50ID0gTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqICh0b3AgKyAxKSApO1xuICAgICAgICAgICAgdG1wID0gYXJyYXlbIGN1cnJlbnQgXTtcbiAgICAgICAgICAgIGFycmF5WyBjdXJyZW50IF0gPSBhcnJheVsgdG9wIF07XG4gICAgICAgICAgICBhcnJheVsgdG9wIF0gPSB0bXA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxuXG5cbi8vIFlvdSBjYW4gcmV0dXJuIGB1bmRlZmluZWRgIGZyb20gdGhlIGBieWAgZnVuY3Rpb24gdG8gcmV2ZXJ0IHRvIERPTSBvcmRlclxuLy8gVGhpcyBwbHVnaW4gZG9lcyBOT1QgcmV0dXJuIGEgalF1ZXJ5IG9iamVjdC4gSXQgcmV0dXJucyBhIHBsYWluIGFycmF5IGJlY2F1c2Vcbi8vIGpRdWVyeSBzb3J0cyBldmVyeXRoaW5nIGluIERPTSBvcmRlci5cbiAgICAkLmZuLnNvcnRlZCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG9wdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5zb3J0ZWQuZGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgICAgICB2YXIgYXJyID0gdGhpcy5nZXQoKTtcbiAgICAgICAgdmFyIHJldmVydCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICggIWFyci5sZW5ndGggKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIG9wdHMucmFuZG9taXplICkge1xuICAgICAgICAgICAgcmV0dXJuIHJhbmRvbWl6ZSggYXJyICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTb3J0IHRoZSBlbGVtZW50cyBieSB0aGUgb3B0cy5ieSBmdW5jdGlvbi5cbiAgICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBvcHRzLmJ5LCBkZWZhdWx0IHRvIERPTSBvcmRlclxuICAgICAgICBpZiAoICQuaXNGdW5jdGlvbiggb3B0cy5ieSApICkge1xuICAgICAgICAgICAgYXJyLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuXG4gICAgICAgICAgICAgICAgLy8gRXhpdCBlYXJseSBpZiB3ZSBhbHJlYWR5IGtub3cgd2Ugd2FudCB0byByZXZlcnRcbiAgICAgICAgICAgICAgICBpZiAoIHJldmVydCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHZhbEEgPSBvcHRzLmJ5KCQoYSkpO1xuICAgICAgICAgICAgICAgIHZhciB2YWxCID0gb3B0cy5ieSgkKGIpKTtcblxuICAgICAgICAgICAgICAgIC8vIElmIGJvdGggdmFsdWVzIGFyZSB1bmRlZmluZWQsIHVzZSB0aGUgRE9NIG9yZGVyXG4gICAgICAgICAgICAgICAgaWYgKCB2YWxBID09PSB1bmRlZmluZWQgJiYgdmFsQiA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgICAgICByZXZlcnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIHZhbEEgPCB2YWxCIHx8IHZhbEEgPT09ICdzb3J0Rmlyc3QnIHx8IHZhbEIgPT09ICdzb3J0TGFzdCcgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIHZhbEEgPiB2YWxCIHx8IHZhbEEgPT09ICdzb3J0TGFzdCcgfHwgdmFsQiA9PT0gJ3NvcnRGaXJzdCcgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXZlcnQgdG8gdGhlIG9yaWdpbmFsIGFycmF5IGlmIG5lY2Vzc2FyeVxuICAgICAgICBpZiAoIHJldmVydCApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCBvcHRzLnJldmVyc2UgKSB7XG4gICAgICAgICAgICBhcnIucmV2ZXJzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFycjtcbiAgICB9O1xuXG5cbiAgICAkLmZuLnNvcnRlZC5kZWZhdWx0cyA9IHtcbiAgICAgICAgcmV2ZXJzZTogZmFsc2UsIC8vIFVzZSBhcnJheS5yZXZlcnNlKCkgdG8gcmV2ZXJzZSB0aGUgcmVzdWx0c1xuICAgICAgICBieTogbnVsbCwgLy8gU29ydGluZyBmdW5jdGlvblxuICAgICAgICByYW5kb21pemU6IGZhbHNlIC8vIElmIHRydWUsIHRoaXMgd2lsbCBza2lwIHRoZSBzb3J0aW5nIGFuZCByZXR1cm4gYSByYW5kb21pemVkIG9yZGVyIGluIHRoZSBhcnJheVxuICAgIH07XG5cbiAgICByZXR1cm4gU2h1ZmZsZTtcblxufSk7XG4iLCIvKlxuICAgICBfIF8gICAgICBfICAgICAgIF9cbiBfX198IChfKSBfX198IHwgX18gIChfKV9fX1xuLyBfX3wgfCB8LyBfX3wgfC8gLyAgfCAvIF9ffFxuXFxfXyBcXCB8IHwgKF9ffCAgIDwgXyB8IFxcX18gXFxcbnxfX18vX3xffFxcX19ffF98XFxfKF8pLyB8X19fL1xuICAgICAgICAgICAgICAgICAgIHxfXy9cblxuIFZlcnNpb246IDEuNi4wXG4gIEF1dGhvcjogS2VuIFdoZWVsZXJcbiBXZWJzaXRlOiBodHRwOi8va2Vud2hlZWxlci5naXRodWIuaW9cbiAgICBEb2NzOiBodHRwOi8va2Vud2hlZWxlci5naXRodWIuaW8vc2xpY2tcbiAgICBSZXBvOiBodHRwOi8vZ2l0aHViLmNvbS9rZW53aGVlbGVyL3NsaWNrXG4gIElzc3VlczogaHR0cDovL2dpdGh1Yi5jb20va2Vud2hlZWxlci9zbGljay9pc3N1ZXNcblxuICovXG4vKiBnbG9iYWwgd2luZG93LCBkb2N1bWVudCwgZGVmaW5lLCBqUXVlcnksIHNldEludGVydmFsLCBjbGVhckludGVydmFsICovXG4oZnVuY3Rpb24oZmFjdG9yeSkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIGRlZmluZShbJ2pxdWVyeSddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnanF1ZXJ5JykpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGZhY3RvcnkoalF1ZXJ5KTtcbiAgICB9XG5cbn0oZnVuY3Rpb24oJCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICB2YXIgU2xpY2sgPSB3aW5kb3cuU2xpY2sgfHwge307XG5cbiAgICBTbGljayA9IChmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgaW5zdGFuY2VVaWQgPSAwO1xuXG4gICAgICAgIGZ1bmN0aW9uIFNsaWNrKGVsZW1lbnQsIHNldHRpbmdzKSB7XG5cbiAgICAgICAgICAgIHZhciBfID0gdGhpcywgZGF0YVNldHRpbmdzO1xuXG4gICAgICAgICAgICBfLmRlZmF1bHRzID0ge1xuICAgICAgICAgICAgICAgIGFjY2Vzc2liaWxpdHk6IHRydWUsXG4gICAgICAgICAgICAgICAgYWRhcHRpdmVIZWlnaHQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGFwcGVuZEFycm93czogJChlbGVtZW50KSxcbiAgICAgICAgICAgICAgICBhcHBlbmREb3RzOiAkKGVsZW1lbnQpLFxuICAgICAgICAgICAgICAgIGFycm93czogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhc05hdkZvcjogbnVsbCxcbiAgICAgICAgICAgICAgICBwcmV2QXJyb3c6ICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBkYXRhLXJvbGU9XCJub25lXCIgY2xhc3M9XCJzbGljay1wcmV2XCIgYXJpYS1sYWJlbD1cIlByZXZpb3VzXCIgdGFiaW5kZXg9XCIwXCIgcm9sZT1cImJ1dHRvblwiPlByZXZpb3VzPC9idXR0b24+JyxcbiAgICAgICAgICAgICAgICBuZXh0QXJyb3c6ICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBkYXRhLXJvbGU9XCJub25lXCIgY2xhc3M9XCJzbGljay1uZXh0XCIgYXJpYS1sYWJlbD1cIk5leHRcIiB0YWJpbmRleD1cIjBcIiByb2xlPVwiYnV0dG9uXCI+TmV4dDwvYnV0dG9uPicsXG4gICAgICAgICAgICAgICAgYXV0b3BsYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGF1dG9wbGF5U3BlZWQ6IDMwMDAsXG4gICAgICAgICAgICAgICAgY2VudGVyTW9kZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VudGVyUGFkZGluZzogJzUwcHgnLFxuICAgICAgICAgICAgICAgIGNzc0Vhc2U6ICdlYXNlJyxcbiAgICAgICAgICAgICAgICBjdXN0b21QYWdpbmc6IGZ1bmN0aW9uKHNsaWRlciwgaSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJCgnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgZGF0YS1yb2xlPVwibm9uZVwiIHJvbGU9XCJidXR0b25cIiB0YWJpbmRleD1cIjBcIiAvPicpLnRleHQoaSArIDEpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZG90czogZmFsc2UsXG4gICAgICAgICAgICAgICAgZG90c0NsYXNzOiAnc2xpY2stZG90cycsXG4gICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVhc2luZzogJ2xpbmVhcicsXG4gICAgICAgICAgICAgICAgZWRnZUZyaWN0aW9uOiAwLjM1LFxuICAgICAgICAgICAgICAgIGZhZGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGZvY3VzT25TZWxlY3Q6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGluZmluaXRlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGluaXRpYWxTbGlkZTogMCxcbiAgICAgICAgICAgICAgICBsYXp5TG9hZDogJ29uZGVtYW5kJyxcbiAgICAgICAgICAgICAgICBtb2JpbGVGaXJzdDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcGF1c2VPbkhvdmVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBhdXNlT25Gb2N1czogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwYXVzZU9uRG90c0hvdmVyOiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXNwb25kVG86ICd3aW5kb3cnLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IG51bGwsXG4gICAgICAgICAgICAgICAgcm93czogMSxcbiAgICAgICAgICAgICAgICBydGw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNsaWRlOiAnJyxcbiAgICAgICAgICAgICAgICBzbGlkZXNQZXJSb3c6IDEsXG4gICAgICAgICAgICAgICAgc2xpZGVzVG9TaG93OiAxLFxuICAgICAgICAgICAgICAgIHNsaWRlc1RvU2Nyb2xsOiAxLFxuICAgICAgICAgICAgICAgIHNwZWVkOiA1MDAsXG4gICAgICAgICAgICAgICAgc3dpcGU6IHRydWUsXG4gICAgICAgICAgICAgICAgc3dpcGVUb1NsaWRlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB0b3VjaE1vdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgdG91Y2hUaHJlc2hvbGQ6IDUsXG4gICAgICAgICAgICAgICAgdXNlQ1NTOiB0cnVlLFxuICAgICAgICAgICAgICAgIHVzZVRyYW5zZm9ybTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB2YXJpYWJsZVdpZHRoOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB2ZXJ0aWNhbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdmVydGljYWxTd2lwaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB3YWl0Rm9yQW5pbWF0ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB6SW5kZXg6IDEwMDBcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIF8uaW5pdGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkcmFnZ2luZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgYXV0b1BsYXlUaW1lcjogbnVsbCxcbiAgICAgICAgICAgICAgICBjdXJyZW50RGlyZWN0aW9uOiAwLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRMZWZ0OiBudWxsLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRTbGlkZTogMCxcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IDEsXG4gICAgICAgICAgICAgICAgJGRvdHM6IG51bGwsXG4gICAgICAgICAgICAgICAgbGlzdFdpZHRoOiBudWxsLFxuICAgICAgICAgICAgICAgIGxpc3RIZWlnaHQ6IG51bGwsXG4gICAgICAgICAgICAgICAgbG9hZEluZGV4OiAwLFxuICAgICAgICAgICAgICAgICRuZXh0QXJyb3c6IG51bGwsXG4gICAgICAgICAgICAgICAgJHByZXZBcnJvdzogbnVsbCxcbiAgICAgICAgICAgICAgICBzbGlkZUNvdW50OiBudWxsLFxuICAgICAgICAgICAgICAgIHNsaWRlV2lkdGg6IG51bGwsXG4gICAgICAgICAgICAgICAgJHNsaWRlVHJhY2s6IG51bGwsXG4gICAgICAgICAgICAgICAgJHNsaWRlczogbnVsbCxcbiAgICAgICAgICAgICAgICBzbGlkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzbGlkZU9mZnNldDogMCxcbiAgICAgICAgICAgICAgICBzd2lwZUxlZnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgJGxpc3Q6IG51bGwsXG4gICAgICAgICAgICAgICAgdG91Y2hPYmplY3Q6IHt9LFxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybXNFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bnNsaWNrZWQ6IGZhbHNlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkLmV4dGVuZChfLCBfLmluaXRpYWxzKTtcblxuICAgICAgICAgICAgXy5hY3RpdmVCcmVha3BvaW50ID0gbnVsbDtcbiAgICAgICAgICAgIF8uYW5pbVR5cGUgPSBudWxsO1xuICAgICAgICAgICAgXy5hbmltUHJvcCA9IG51bGw7XG4gICAgICAgICAgICBfLmJyZWFrcG9pbnRzID0gW107XG4gICAgICAgICAgICBfLmJyZWFrcG9pbnRTZXR0aW5ncyA9IFtdO1xuICAgICAgICAgICAgXy5jc3NUcmFuc2l0aW9ucyA9IGZhbHNlO1xuICAgICAgICAgICAgXy5mb2N1c3NlZCA9IGZhbHNlO1xuICAgICAgICAgICAgXy5pbnRlcnJ1cHRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgXy5oaWRkZW4gPSAnaGlkZGVuJztcbiAgICAgICAgICAgIF8ucGF1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIF8ucG9zaXRpb25Qcm9wID0gbnVsbDtcbiAgICAgICAgICAgIF8ucmVzcG9uZFRvID0gbnVsbDtcbiAgICAgICAgICAgIF8ucm93Q291bnQgPSAxO1xuICAgICAgICAgICAgXy5zaG91bGRDbGljayA9IHRydWU7XG4gICAgICAgICAgICBfLiRzbGlkZXIgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgXy4kc2xpZGVzQ2FjaGUgPSBudWxsO1xuICAgICAgICAgICAgXy50cmFuc2Zvcm1UeXBlID0gbnVsbDtcbiAgICAgICAgICAgIF8udHJhbnNpdGlvblR5cGUgPSBudWxsO1xuICAgICAgICAgICAgXy52aXNpYmlsaXR5Q2hhbmdlID0gJ3Zpc2liaWxpdHljaGFuZ2UnO1xuICAgICAgICAgICAgXy53aW5kb3dXaWR0aCA9IDA7XG4gICAgICAgICAgICBfLndpbmRvd1RpbWVyID0gbnVsbDtcblxuICAgICAgICAgICAgZGF0YVNldHRpbmdzID0gJChlbGVtZW50KS5kYXRhKCdzbGljaycpIHx8IHt9O1xuXG4gICAgICAgICAgICBfLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgXy5kZWZhdWx0cywgc2V0dGluZ3MsIGRhdGFTZXR0aW5ncyk7XG5cbiAgICAgICAgICAgIF8uY3VycmVudFNsaWRlID0gXy5vcHRpb25zLmluaXRpYWxTbGlkZTtcblxuICAgICAgICAgICAgXy5vcmlnaW5hbFNldHRpbmdzID0gXy5vcHRpb25zO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50Lm1vekhpZGRlbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBfLmhpZGRlbiA9ICdtb3pIaWRkZW4nO1xuICAgICAgICAgICAgICAgIF8udmlzaWJpbGl0eUNoYW5nZSA9ICdtb3p2aXNpYmlsaXR5Y2hhbmdlJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRvY3VtZW50LndlYmtpdEhpZGRlbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBfLmhpZGRlbiA9ICd3ZWJraXRIaWRkZW4nO1xuICAgICAgICAgICAgICAgIF8udmlzaWJpbGl0eUNoYW5nZSA9ICd3ZWJraXR2aXNpYmlsaXR5Y2hhbmdlJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgXy5hdXRvUGxheSA9ICQucHJveHkoXy5hdXRvUGxheSwgXyk7XG4gICAgICAgICAgICBfLmF1dG9QbGF5Q2xlYXIgPSAkLnByb3h5KF8uYXV0b1BsYXlDbGVhciwgXyk7XG4gICAgICAgICAgICBfLmF1dG9QbGF5SXRlcmF0b3IgPSAkLnByb3h5KF8uYXV0b1BsYXlJdGVyYXRvciwgXyk7XG4gICAgICAgICAgICBfLmNoYW5nZVNsaWRlID0gJC5wcm94eShfLmNoYW5nZVNsaWRlLCBfKTtcbiAgICAgICAgICAgIF8uY2xpY2tIYW5kbGVyID0gJC5wcm94eShfLmNsaWNrSGFuZGxlciwgXyk7XG4gICAgICAgICAgICBfLnNlbGVjdEhhbmRsZXIgPSAkLnByb3h5KF8uc2VsZWN0SGFuZGxlciwgXyk7XG4gICAgICAgICAgICBfLnNldFBvc2l0aW9uID0gJC5wcm94eShfLnNldFBvc2l0aW9uLCBfKTtcbiAgICAgICAgICAgIF8uc3dpcGVIYW5kbGVyID0gJC5wcm94eShfLnN3aXBlSGFuZGxlciwgXyk7XG4gICAgICAgICAgICBfLmRyYWdIYW5kbGVyID0gJC5wcm94eShfLmRyYWdIYW5kbGVyLCBfKTtcbiAgICAgICAgICAgIF8ua2V5SGFuZGxlciA9ICQucHJveHkoXy5rZXlIYW5kbGVyLCBfKTtcblxuICAgICAgICAgICAgXy5pbnN0YW5jZVVpZCA9IGluc3RhbmNlVWlkKys7XG5cbiAgICAgICAgICAgIC8vIEEgc2ltcGxlIHdheSB0byBjaGVjayBmb3IgSFRNTCBzdHJpbmdzXG4gICAgICAgICAgICAvLyBTdHJpY3QgSFRNTCByZWNvZ25pdGlvbiAobXVzdCBzdGFydCB3aXRoIDwpXG4gICAgICAgICAgICAvLyBFeHRyYWN0ZWQgZnJvbSBqUXVlcnkgdjEuMTEgc291cmNlXG4gICAgICAgICAgICBfLmh0bWxFeHByID0gL14oPzpcXHMqKDxbXFx3XFxXXSs+KVtePl0qKSQvO1xuXG5cbiAgICAgICAgICAgIF8ucmVnaXN0ZXJCcmVha3BvaW50cygpO1xuICAgICAgICAgICAgXy5pbml0KHRydWUpO1xuXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gU2xpY2s7XG5cbiAgICB9KCkpO1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmFjdGl2YXRlQURBID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLiRzbGlkZVRyYWNrLmZpbmQoJy5zbGljay1hY3RpdmUnKS5hdHRyKHtcbiAgICAgICAgICAgICdhcmlhLWhpZGRlbic6ICdmYWxzZSdcbiAgICAgICAgfSkuZmluZCgnYSwgaW5wdXQsIGJ1dHRvbiwgc2VsZWN0JykuYXR0cih7XG4gICAgICAgICAgICAndGFiaW5kZXgnOiAnMCdcbiAgICAgICAgfSk7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmFkZFNsaWRlID0gU2xpY2sucHJvdG90eXBlLnNsaWNrQWRkID0gZnVuY3Rpb24obWFya3VwLCBpbmRleCwgYWRkQmVmb3JlKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIGlmICh0eXBlb2YoaW5kZXgpID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIGFkZEJlZm9yZSA9IGluZGV4O1xuICAgICAgICAgICAgaW5kZXggPSBudWxsO1xuICAgICAgICB9IGVsc2UgaWYgKGluZGV4IDwgMCB8fCAoaW5kZXggPj0gXy5zbGlkZUNvdW50KSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgXy51bmxvYWQoKTtcblxuICAgICAgICBpZiAodHlwZW9mKGluZGV4KSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCAmJiBfLiRzbGlkZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgJChtYXJrdXApLmFwcGVuZFRvKF8uJHNsaWRlVHJhY2spO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChhZGRCZWZvcmUpIHtcbiAgICAgICAgICAgICAgICAkKG1hcmt1cCkuaW5zZXJ0QmVmb3JlKF8uJHNsaWRlcy5lcShpbmRleCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKG1hcmt1cCkuaW5zZXJ0QWZ0ZXIoXy4kc2xpZGVzLmVxKGluZGV4KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoYWRkQmVmb3JlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgJChtYXJrdXApLnByZXBlbmRUbyhfLiRzbGlkZVRyYWNrKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJChtYXJrdXApLmFwcGVuZFRvKF8uJHNsaWRlVHJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgXy4kc2xpZGVzID0gXy4kc2xpZGVUcmFjay5jaGlsZHJlbih0aGlzLm9wdGlvbnMuc2xpZGUpO1xuXG4gICAgICAgIF8uJHNsaWRlVHJhY2suY2hpbGRyZW4odGhpcy5vcHRpb25zLnNsaWRlKS5kZXRhY2goKTtcblxuICAgICAgICBfLiRzbGlkZVRyYWNrLmFwcGVuZChfLiRzbGlkZXMpO1xuXG4gICAgICAgIF8uJHNsaWRlcy5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAkKGVsZW1lbnQpLmF0dHIoJ2RhdGEtc2xpY2staW5kZXgnLCBpbmRleCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF8uJHNsaWRlc0NhY2hlID0gXy4kc2xpZGVzO1xuXG4gICAgICAgIF8ucmVpbml0KCk7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmFuaW1hdGVIZWlnaHQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuICAgICAgICBpZiAoXy5vcHRpb25zLnNsaWRlc1RvU2hvdyA9PT0gMSAmJiBfLm9wdGlvbnMuYWRhcHRpdmVIZWlnaHQgPT09IHRydWUgJiYgXy5vcHRpb25zLnZlcnRpY2FsID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdmFyIHRhcmdldEhlaWdodCA9IF8uJHNsaWRlcy5lcShfLmN1cnJlbnRTbGlkZSkub3V0ZXJIZWlnaHQodHJ1ZSk7XG4gICAgICAgICAgICBfLiRsaXN0LmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIGhlaWdodDogdGFyZ2V0SGVpZ2h0XG4gICAgICAgICAgICB9LCBfLm9wdGlvbnMuc3BlZWQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5hbmltYXRlU2xpZGUgPSBmdW5jdGlvbih0YXJnZXRMZWZ0LCBjYWxsYmFjaykge1xuXG4gICAgICAgIHZhciBhbmltUHJvcHMgPSB7fSxcbiAgICAgICAgICAgIF8gPSB0aGlzO1xuXG4gICAgICAgIF8uYW5pbWF0ZUhlaWdodCgpO1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMucnRsID09PSB0cnVlICYmIF8ub3B0aW9ucy52ZXJ0aWNhbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRhcmdldExlZnQgPSAtdGFyZ2V0TGVmdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXy50cmFuc2Zvcm1zRW5hYmxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChfLm9wdGlvbnMudmVydGljYWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogdGFyZ2V0TGVmdFxuICAgICAgICAgICAgICAgIH0sIF8ub3B0aW9ucy5zcGVlZCwgXy5vcHRpb25zLmVhc2luZywgY2FsbGJhY2spO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfLiRzbGlkZVRyYWNrLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IHRhcmdldExlZnRcbiAgICAgICAgICAgICAgICB9LCBfLm9wdGlvbnMuc3BlZWQsIF8ub3B0aW9ucy5lYXNpbmcsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICBpZiAoXy5jc3NUcmFuc2l0aW9ucyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5vcHRpb25zLnJ0bCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBfLmN1cnJlbnRMZWZ0ID0gLShfLmN1cnJlbnRMZWZ0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJCh7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1TdGFydDogXy5jdXJyZW50TGVmdFxuICAgICAgICAgICAgICAgIH0pLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBhbmltU3RhcnQ6IHRhcmdldExlZnRcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBfLm9wdGlvbnMuc3BlZWQsXG4gICAgICAgICAgICAgICAgICAgIGVhc2luZzogXy5vcHRpb25zLmVhc2luZyxcbiAgICAgICAgICAgICAgICAgICAgc3RlcDogZnVuY3Rpb24obm93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub3cgPSBNYXRoLmNlaWwobm93KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLm9wdGlvbnMudmVydGljYWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbVByb3BzW18uYW5pbVR5cGVdID0gJ3RyYW5zbGF0ZSgnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93ICsgJ3B4LCAwcHgpJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLiRzbGlkZVRyYWNrLmNzcyhhbmltUHJvcHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltUHJvcHNbXy5hbmltVHlwZV0gPSAndHJhbnNsYXRlKDBweCwnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm93ICsgJ3B4KSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5jc3MoYW5pbVByb3BzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBfLmFwcGx5VHJhbnNpdGlvbigpO1xuICAgICAgICAgICAgICAgIHRhcmdldExlZnQgPSBNYXRoLmNlaWwodGFyZ2V0TGVmdCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoXy5vcHRpb25zLnZlcnRpY2FsID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBhbmltUHJvcHNbXy5hbmltVHlwZV0gPSAndHJhbnNsYXRlM2QoJyArIHRhcmdldExlZnQgKyAncHgsIDBweCwgMHB4KSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYW5pbVByb3BzW18uYW5pbVR5cGVdID0gJ3RyYW5zbGF0ZTNkKDBweCwnICsgdGFyZ2V0TGVmdCArICdweCwgMHB4KSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF8uJHNsaWRlVHJhY2suY3NzKGFuaW1Qcm9wcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgXy5kaXNhYmxlVHJhbnNpdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIF8ub3B0aW9ucy5zcGVlZCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5nZXROYXZUYXJnZXQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXMsXG4gICAgICAgICAgICBhc05hdkZvciA9IF8ub3B0aW9ucy5hc05hdkZvcjtcblxuICAgICAgICBpZiAoIGFzTmF2Rm9yICYmIGFzTmF2Rm9yICE9PSBudWxsICkge1xuICAgICAgICAgICAgYXNOYXZGb3IgPSAkKGFzTmF2Rm9yKS5ub3QoXy4kc2xpZGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhc05hdkZvcjtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuYXNOYXZGb3IgPSBmdW5jdGlvbihpbmRleCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIGFzTmF2Rm9yID0gXy5nZXROYXZUYXJnZXQoKTtcblxuICAgICAgICBpZiAoIGFzTmF2Rm9yICE9PSBudWxsICYmIHR5cGVvZiBhc05hdkZvciA9PT0gJ29iamVjdCcgKSB7XG4gICAgICAgICAgICBhc05hdkZvci5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKHRoaXMpLnNsaWNrKCdnZXRTbGljaycpO1xuICAgICAgICAgICAgICAgIGlmKCF0YXJnZXQudW5zbGlja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5zbGlkZUhhbmRsZXIoaW5kZXgsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmFwcGx5VHJhbnNpdGlvbiA9IGZ1bmN0aW9uKHNsaWRlKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLFxuICAgICAgICAgICAgdHJhbnNpdGlvbiA9IHt9O1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuZmFkZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRyYW5zaXRpb25bXy50cmFuc2l0aW9uVHlwZV0gPSBfLnRyYW5zZm9ybVR5cGUgKyAnICcgKyBfLm9wdGlvbnMuc3BlZWQgKyAnbXMgJyArIF8ub3B0aW9ucy5jc3NFYXNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdHJhbnNpdGlvbltfLnRyYW5zaXRpb25UeXBlXSA9ICdvcGFjaXR5ICcgKyBfLm9wdGlvbnMuc3BlZWQgKyAnbXMgJyArIF8ub3B0aW9ucy5jc3NFYXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5mYWRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5jc3ModHJhbnNpdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfLiRzbGlkZXMuZXEoc2xpZGUpLmNzcyh0cmFuc2l0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5hdXRvUGxheSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLmF1dG9QbGF5Q2xlYXIoKTtcblxuICAgICAgICBpZiAoIF8uc2xpZGVDb3VudCA+IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgKSB7XG4gICAgICAgICAgICBfLmF1dG9QbGF5VGltZXIgPSBzZXRJbnRlcnZhbCggXy5hdXRvUGxheUl0ZXJhdG9yLCBfLm9wdGlvbnMuYXV0b3BsYXlTcGVlZCApO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmF1dG9QbGF5Q2xlYXIgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKF8uYXV0b1BsYXlUaW1lcikge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChfLmF1dG9QbGF5VGltZXIpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmF1dG9QbGF5SXRlcmF0b3IgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXMsXG4gICAgICAgICAgICBzbGlkZVRvID0gXy5jdXJyZW50U2xpZGUgKyBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGw7XG5cbiAgICAgICAgaWYgKCAhXy5wYXVzZWQgJiYgIV8uaW50ZXJydXB0ZWQgJiYgIV8uZm9jdXNzZWQgKSB7XG5cbiAgICAgICAgICAgIGlmICggXy5vcHRpb25zLmluZmluaXRlID09PSBmYWxzZSApIHtcblxuICAgICAgICAgICAgICAgIGlmICggXy5kaXJlY3Rpb24gPT09IDEgJiYgKCBfLmN1cnJlbnRTbGlkZSArIDEgKSA9PT0gKCBfLnNsaWRlQ291bnQgLSAxICkpIHtcbiAgICAgICAgICAgICAgICAgICAgXy5kaXJlY3Rpb24gPSAwO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCBfLmRpcmVjdGlvbiA9PT0gMCApIHtcblxuICAgICAgICAgICAgICAgICAgICBzbGlkZVRvID0gXy5jdXJyZW50U2xpZGUgLSBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGw7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfLmN1cnJlbnRTbGlkZSAtIDEgPT09IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmRpcmVjdGlvbiA9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfLnNsaWRlSGFuZGxlciggc2xpZGVUbyApO1xuXG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuYnVpbGRBcnJvd3MgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5hcnJvd3MgPT09IHRydWUgKSB7XG5cbiAgICAgICAgICAgIF8uJHByZXZBcnJvdyA9ICQoXy5vcHRpb25zLnByZXZBcnJvdykuYWRkQ2xhc3MoJ3NsaWNrLWFycm93Jyk7XG4gICAgICAgICAgICBfLiRuZXh0QXJyb3cgPSAkKF8ub3B0aW9ucy5uZXh0QXJyb3cpLmFkZENsYXNzKCdzbGljay1hcnJvdycpO1xuXG4gICAgICAgICAgICBpZiggXy5zbGlkZUNvdW50ID4gXy5vcHRpb25zLnNsaWRlc1RvU2hvdyApIHtcblxuICAgICAgICAgICAgICAgIF8uJHByZXZBcnJvdy5yZW1vdmVDbGFzcygnc2xpY2staGlkZGVuJykucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4gdGFiaW5kZXgnKTtcbiAgICAgICAgICAgICAgICBfLiRuZXh0QXJyb3cucmVtb3ZlQ2xhc3MoJ3NsaWNrLWhpZGRlbicpLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuIHRhYmluZGV4Jyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoXy5odG1sRXhwci50ZXN0KF8ub3B0aW9ucy5wcmV2QXJyb3cpKSB7XG4gICAgICAgICAgICAgICAgICAgIF8uJHByZXZBcnJvdy5wcmVwZW5kVG8oXy5vcHRpb25zLmFwcGVuZEFycm93cyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKF8uaHRtbEV4cHIudGVzdChfLm9wdGlvbnMubmV4dEFycm93KSkge1xuICAgICAgICAgICAgICAgICAgICBfLiRuZXh0QXJyb3cuYXBwZW5kVG8oXy5vcHRpb25zLmFwcGVuZEFycm93cyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKF8ub3B0aW9ucy5pbmZpbml0ZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBfLiRwcmV2QXJyb3dcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnc2xpY2stZGlzYWJsZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCAndHJ1ZScpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIF8uJHByZXZBcnJvdy5hZGQoIF8uJG5leHRBcnJvdyApXG5cbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdzbGljay1oaWRkZW4nKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICAnYXJpYS1kaXNhYmxlZCc6ICd0cnVlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICd0YWJpbmRleCc6ICctMSdcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmJ1aWxkRG90cyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIGksIGRvdDtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmRvdHMgPT09IHRydWUgJiYgXy5zbGlkZUNvdW50ID4gXy5vcHRpb25zLnNsaWRlc1RvU2hvdykge1xuXG4gICAgICAgICAgICBfLiRzbGlkZXIuYWRkQ2xhc3MoJ3NsaWNrLWRvdHRlZCcpO1xuXG4gICAgICAgICAgICBkb3QgPSAkKCc8dWwgLz4nKS5hZGRDbGFzcyhfLm9wdGlvbnMuZG90c0NsYXNzKTtcblxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8PSBfLmdldERvdENvdW50KCk7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgIGRvdC5hcHBlbmQoJCgnPGxpIC8+JykuYXBwZW5kKF8ub3B0aW9ucy5jdXN0b21QYWdpbmcuY2FsbCh0aGlzLCBfLCBpKSkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBfLiRkb3RzID0gZG90LmFwcGVuZFRvKF8ub3B0aW9ucy5hcHBlbmREb3RzKTtcblxuICAgICAgICAgICAgXy4kZG90cy5maW5kKCdsaScpLmZpcnN0KCkuYWRkQ2xhc3MoJ3NsaWNrLWFjdGl2ZScpLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5idWlsZE91dCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLiRzbGlkZXMgPVxuICAgICAgICAgICAgXy4kc2xpZGVyXG4gICAgICAgICAgICAgICAgLmNoaWxkcmVuKCBfLm9wdGlvbnMuc2xpZGUgKyAnOm5vdCguc2xpY2stY2xvbmVkKScpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCdzbGljay1zbGlkZScpO1xuXG4gICAgICAgIF8uc2xpZGVDb3VudCA9IF8uJHNsaWRlcy5sZW5ndGg7XG5cbiAgICAgICAgXy4kc2xpZGVzLmVhY2goZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICQoZWxlbWVudClcbiAgICAgICAgICAgICAgICAuYXR0cignZGF0YS1zbGljay1pbmRleCcsIGluZGV4KVxuICAgICAgICAgICAgICAgIC5kYXRhKCdvcmlnaW5hbFN0eWxpbmcnLCAkKGVsZW1lbnQpLmF0dHIoJ3N0eWxlJykgfHwgJycpO1xuICAgICAgICB9KTtcblxuICAgICAgICBfLiRzbGlkZXIuYWRkQ2xhc3MoJ3NsaWNrLXNsaWRlcicpO1xuXG4gICAgICAgIF8uJHNsaWRlVHJhY2sgPSAoXy5zbGlkZUNvdW50ID09PSAwKSA/XG4gICAgICAgICAgICAkKCc8ZGl2IGNsYXNzPVwic2xpY2stdHJhY2tcIi8+JykuYXBwZW5kVG8oXy4kc2xpZGVyKSA6XG4gICAgICAgICAgICBfLiRzbGlkZXMud3JhcEFsbCgnPGRpdiBjbGFzcz1cInNsaWNrLXRyYWNrXCIvPicpLnBhcmVudCgpO1xuXG4gICAgICAgIF8uJGxpc3QgPSBfLiRzbGlkZVRyYWNrLndyYXAoXG4gICAgICAgICAgICAnPGRpdiBhcmlhLWxpdmU9XCJwb2xpdGVcIiBjbGFzcz1cInNsaWNrLWxpc3RcIi8+JykucGFyZW50KCk7XG4gICAgICAgIF8uJHNsaWRlVHJhY2suY3NzKCdvcGFjaXR5JywgMCk7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5jZW50ZXJNb2RlID09PSB0cnVlIHx8IF8ub3B0aW9ucy5zd2lwZVRvU2xpZGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCA9IDE7XG4gICAgICAgIH1cblxuICAgICAgICAkKCdpbWdbZGF0YS1sYXp5XScsIF8uJHNsaWRlcikubm90KCdbc3JjXScpLmFkZENsYXNzKCdzbGljay1sb2FkaW5nJyk7XG5cbiAgICAgICAgXy5zZXR1cEluZmluaXRlKCk7XG5cbiAgICAgICAgXy5idWlsZEFycm93cygpO1xuXG4gICAgICAgIF8uYnVpbGREb3RzKCk7XG5cbiAgICAgICAgXy51cGRhdGVEb3RzKCk7XG5cblxuICAgICAgICBfLnNldFNsaWRlQ2xhc3Nlcyh0eXBlb2YgXy5jdXJyZW50U2xpZGUgPT09ICdudW1iZXInID8gXy5jdXJyZW50U2xpZGUgOiAwKTtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmRyYWdnYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgXy4kbGlzdC5hZGRDbGFzcygnZHJhZ2dhYmxlJyk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuYnVpbGRSb3dzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLCBhLCBiLCBjLCBuZXdTbGlkZXMsIG51bU9mU2xpZGVzLCBvcmlnaW5hbFNsaWRlcyxzbGlkZXNQZXJTZWN0aW9uO1xuXG4gICAgICAgIG5ld1NsaWRlcyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgb3JpZ2luYWxTbGlkZXMgPSBfLiRzbGlkZXIuY2hpbGRyZW4oKTtcblxuICAgICAgICBpZihfLm9wdGlvbnMucm93cyA+IDEpIHtcblxuICAgICAgICAgICAgc2xpZGVzUGVyU2VjdGlvbiA9IF8ub3B0aW9ucy5zbGlkZXNQZXJSb3cgKiBfLm9wdGlvbnMucm93cztcbiAgICAgICAgICAgIG51bU9mU2xpZGVzID0gTWF0aC5jZWlsKFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsU2xpZGVzLmxlbmd0aCAvIHNsaWRlc1BlclNlY3Rpb25cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGZvcihhID0gMDsgYSA8IG51bU9mU2xpZGVzOyBhKyspe1xuICAgICAgICAgICAgICAgIHZhciBzbGlkZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgIGZvcihiID0gMDsgYiA8IF8ub3B0aW9ucy5yb3dzOyBiKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgICAgICBmb3IoYyA9IDA7IGMgPCBfLm9wdGlvbnMuc2xpZGVzUGVyUm93OyBjKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAoYSAqIHNsaWRlc1BlclNlY3Rpb24gKyAoKGIgKiBfLm9wdGlvbnMuc2xpZGVzUGVyUm93KSArIGMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbFNsaWRlcy5nZXQodGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZChvcmlnaW5hbFNsaWRlcy5nZXQodGFyZ2V0KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2xpZGUuYXBwZW5kQ2hpbGQocm93KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmV3U2xpZGVzLmFwcGVuZENoaWxkKHNsaWRlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgXy4kc2xpZGVyLmVtcHR5KCkuYXBwZW5kKG5ld1NsaWRlcyk7XG4gICAgICAgICAgICBfLiRzbGlkZXIuY2hpbGRyZW4oKS5jaGlsZHJlbigpLmNoaWxkcmVuKClcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJzooMTAwIC8gXy5vcHRpb25zLnNsaWRlc1BlclJvdykgKyAnJScsXG4gICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzogJ2lubGluZS1ibG9jaydcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmNoZWNrUmVzcG9uc2l2ZSA9IGZ1bmN0aW9uKGluaXRpYWwsIGZvcmNlVXBkYXRlKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLFxuICAgICAgICAgICAgYnJlYWtwb2ludCwgdGFyZ2V0QnJlYWtwb2ludCwgcmVzcG9uZFRvV2lkdGgsIHRyaWdnZXJCcmVha3BvaW50ID0gZmFsc2U7XG4gICAgICAgIHZhciBzbGlkZXJXaWR0aCA9IF8uJHNsaWRlci53aWR0aCgpO1xuICAgICAgICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCAkKHdpbmRvdykud2lkdGgoKTtcblxuICAgICAgICBpZiAoXy5yZXNwb25kVG8gPT09ICd3aW5kb3cnKSB7XG4gICAgICAgICAgICByZXNwb25kVG9XaWR0aCA9IHdpbmRvd1dpZHRoO1xuICAgICAgICB9IGVsc2UgaWYgKF8ucmVzcG9uZFRvID09PSAnc2xpZGVyJykge1xuICAgICAgICAgICAgcmVzcG9uZFRvV2lkdGggPSBzbGlkZXJXaWR0aDtcbiAgICAgICAgfSBlbHNlIGlmIChfLnJlc3BvbmRUbyA9PT0gJ21pbicpIHtcbiAgICAgICAgICAgIHJlc3BvbmRUb1dpZHRoID0gTWF0aC5taW4od2luZG93V2lkdGgsIHNsaWRlcldpZHRoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggXy5vcHRpb25zLnJlc3BvbnNpdmUgJiZcbiAgICAgICAgICAgIF8ub3B0aW9ucy5yZXNwb25zaXZlLmxlbmd0aCAmJlxuICAgICAgICAgICAgXy5vcHRpb25zLnJlc3BvbnNpdmUgIT09IG51bGwpIHtcblxuICAgICAgICAgICAgdGFyZ2V0QnJlYWtwb2ludCA9IG51bGw7XG5cbiAgICAgICAgICAgIGZvciAoYnJlYWtwb2ludCBpbiBfLmJyZWFrcG9pbnRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8uYnJlYWtwb2ludHMuaGFzT3duUHJvcGVydHkoYnJlYWtwb2ludCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF8ub3JpZ2luYWxTZXR0aW5ncy5tb2JpbGVGaXJzdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25kVG9XaWR0aCA8IF8uYnJlYWtwb2ludHNbYnJlYWtwb2ludF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRCcmVha3BvaW50ID0gXy5icmVha3BvaW50c1ticmVha3BvaW50XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25kVG9XaWR0aCA+IF8uYnJlYWtwb2ludHNbYnJlYWtwb2ludF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRCcmVha3BvaW50ID0gXy5icmVha3BvaW50c1ticmVha3BvaW50XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRhcmdldEJyZWFrcG9pbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5hY3RpdmVCcmVha3BvaW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRCcmVha3BvaW50ICE9PSBfLmFjdGl2ZUJyZWFrcG9pbnQgfHwgZm9yY2VVcGRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uYWN0aXZlQnJlYWtwb2ludCA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0QnJlYWtwb2ludDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLmJyZWFrcG9pbnRTZXR0aW5nc1t0YXJnZXRCcmVha3BvaW50XSA9PT0gJ3Vuc2xpY2snKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy51bnNsaWNrKHRhcmdldEJyZWFrcG9pbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgXy5vcmlnaW5hbFNldHRpbmdzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmJyZWFrcG9pbnRTZXR0aW5nc1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldEJyZWFrcG9pbnRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmN1cnJlbnRTbGlkZSA9IF8ub3B0aW9ucy5pbml0aWFsU2xpZGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8ucmVmcmVzaChpbml0aWFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJCcmVha3BvaW50ID0gdGFyZ2V0QnJlYWtwb2ludDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF8uYWN0aXZlQnJlYWtwb2ludCA9IHRhcmdldEJyZWFrcG9pbnQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfLmJyZWFrcG9pbnRTZXR0aW5nc1t0YXJnZXRCcmVha3BvaW50XSA9PT0gJ3Vuc2xpY2snKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLnVuc2xpY2sodGFyZ2V0QnJlYWtwb2ludCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgXy5vcmlnaW5hbFNldHRpbmdzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uYnJlYWtwb2ludFNldHRpbmdzW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRCcmVha3BvaW50XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uY3VycmVudFNsaWRlID0gXy5vcHRpb25zLmluaXRpYWxTbGlkZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF8ucmVmcmVzaChpbml0aWFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyQnJlYWtwb2ludCA9IHRhcmdldEJyZWFrcG9pbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5hY3RpdmVCcmVha3BvaW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIF8uYWN0aXZlQnJlYWtwb2ludCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIF8ub3B0aW9ucyA9IF8ub3JpZ2luYWxTZXR0aW5ncztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uY3VycmVudFNsaWRlID0gXy5vcHRpb25zLmluaXRpYWxTbGlkZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfLnJlZnJlc2goaW5pdGlhbCk7XG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXJCcmVha3BvaW50ID0gdGFyZ2V0QnJlYWtwb2ludDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG9ubHkgdHJpZ2dlciBicmVha3BvaW50cyBkdXJpbmcgYW4gYWN0dWFsIGJyZWFrLiBub3Qgb24gaW5pdGlhbGl6ZS5cbiAgICAgICAgICAgIGlmKCAhaW5pdGlhbCAmJiB0cmlnZ2VyQnJlYWtwb2ludCAhPT0gZmFsc2UgKSB7XG4gICAgICAgICAgICAgICAgXy4kc2xpZGVyLnRyaWdnZXIoJ2JyZWFrcG9pbnQnLCBbXywgdHJpZ2dlckJyZWFrcG9pbnRdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5jaGFuZ2VTbGlkZSA9IGZ1bmN0aW9uKGV2ZW50LCBkb250QW5pbWF0ZSkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgICR0YXJnZXQgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLFxuICAgICAgICAgICAgaW5kZXhPZmZzZXQsIHNsaWRlT2Zmc2V0LCB1bmV2ZW5PZmZzZXQ7XG5cbiAgICAgICAgLy8gSWYgdGFyZ2V0IGlzIGEgbGluaywgcHJldmVudCBkZWZhdWx0IGFjdGlvbi5cbiAgICAgICAgaWYoJHRhcmdldC5pcygnYScpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdGFyZ2V0IGlzIG5vdCB0aGUgPGxpPiBlbGVtZW50IChpZTogYSBjaGlsZCksIGZpbmQgdGhlIDxsaT4uXG4gICAgICAgIGlmKCEkdGFyZ2V0LmlzKCdsaScpKSB7XG4gICAgICAgICAgICAkdGFyZ2V0ID0gJHRhcmdldC5jbG9zZXN0KCdsaScpO1xuICAgICAgICB9XG5cbiAgICAgICAgdW5ldmVuT2Zmc2V0ID0gKF8uc2xpZGVDb3VudCAlIF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCAhPT0gMCk7XG4gICAgICAgIGluZGV4T2Zmc2V0ID0gdW5ldmVuT2Zmc2V0ID8gMCA6IChfLnNsaWRlQ291bnQgLSBfLmN1cnJlbnRTbGlkZSkgJSBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGw7XG5cbiAgICAgICAgc3dpdGNoIChldmVudC5kYXRhLm1lc3NhZ2UpIHtcblxuICAgICAgICAgICAgY2FzZSAncHJldmlvdXMnOlxuICAgICAgICAgICAgICAgIHNsaWRlT2Zmc2V0ID0gaW5kZXhPZmZzZXQgPT09IDAgPyBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGwgOiBfLm9wdGlvbnMuc2xpZGVzVG9TaG93IC0gaW5kZXhPZmZzZXQ7XG4gICAgICAgICAgICAgICAgaWYgKF8uc2xpZGVDb3VudCA+IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpIHtcbiAgICAgICAgICAgICAgICAgICAgXy5zbGlkZUhhbmRsZXIoXy5jdXJyZW50U2xpZGUgLSBzbGlkZU9mZnNldCwgZmFsc2UsIGRvbnRBbmltYXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ25leHQnOlxuICAgICAgICAgICAgICAgIHNsaWRlT2Zmc2V0ID0gaW5kZXhPZmZzZXQgPT09IDAgPyBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGwgOiBpbmRleE9mZnNldDtcbiAgICAgICAgICAgICAgICBpZiAoXy5zbGlkZUNvdW50ID4gXy5vcHRpb25zLnNsaWRlc1RvU2hvdykge1xuICAgICAgICAgICAgICAgICAgICBfLnNsaWRlSGFuZGxlcihfLmN1cnJlbnRTbGlkZSArIHNsaWRlT2Zmc2V0LCBmYWxzZSwgZG9udEFuaW1hdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnaW5kZXgnOlxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGV2ZW50LmRhdGEuaW5kZXggPT09IDAgPyAwIDpcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZGF0YS5pbmRleCB8fCAkdGFyZ2V0LmluZGV4KCkgKiBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGw7XG5cbiAgICAgICAgICAgICAgICBfLnNsaWRlSGFuZGxlcihfLmNoZWNrTmF2aWdhYmxlKGluZGV4KSwgZmFsc2UsIGRvbnRBbmltYXRlKTtcbiAgICAgICAgICAgICAgICAkdGFyZ2V0LmNoaWxkcmVuKCkudHJpZ2dlcignZm9jdXMnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuY2hlY2tOYXZpZ2FibGUgPSBmdW5jdGlvbihpbmRleCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIG5hdmlnYWJsZXMsIHByZXZOYXZpZ2FibGU7XG5cbiAgICAgICAgbmF2aWdhYmxlcyA9IF8uZ2V0TmF2aWdhYmxlSW5kZXhlcygpO1xuICAgICAgICBwcmV2TmF2aWdhYmxlID0gMDtcbiAgICAgICAgaWYgKGluZGV4ID4gbmF2aWdhYmxlc1tuYXZpZ2FibGVzLmxlbmd0aCAtIDFdKSB7XG4gICAgICAgICAgICBpbmRleCA9IG5hdmlnYWJsZXNbbmF2aWdhYmxlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAodmFyIG4gaW4gbmF2aWdhYmxlcykge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IG5hdmlnYWJsZXNbbl0pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBwcmV2TmF2aWdhYmxlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJldk5hdmlnYWJsZSA9IG5hdmlnYWJsZXNbbl07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5jbGVhblVwRXZlbnRzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuZG90cyAmJiBfLiRkb3RzICE9PSBudWxsKSB7XG5cbiAgICAgICAgICAgICQoJ2xpJywgXy4kZG90cylcbiAgICAgICAgICAgICAgICAub2ZmKCdjbGljay5zbGljaycsIF8uY2hhbmdlU2xpZGUpXG4gICAgICAgICAgICAgICAgLm9mZignbW91c2VlbnRlci5zbGljaycsICQucHJveHkoXy5pbnRlcnJ1cHQsIF8sIHRydWUpKVxuICAgICAgICAgICAgICAgIC5vZmYoJ21vdXNlbGVhdmUuc2xpY2snLCAkLnByb3h5KF8uaW50ZXJydXB0LCBfLCBmYWxzZSkpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBfLiRzbGlkZXIub2ZmKCdmb2N1cy5zbGljayBibHVyLnNsaWNrJyk7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5hcnJvd3MgPT09IHRydWUgJiYgXy5zbGlkZUNvdW50ID4gXy5vcHRpb25zLnNsaWRlc1RvU2hvdykge1xuICAgICAgICAgICAgXy4kcHJldkFycm93ICYmIF8uJHByZXZBcnJvdy5vZmYoJ2NsaWNrLnNsaWNrJywgXy5jaGFuZ2VTbGlkZSk7XG4gICAgICAgICAgICBfLiRuZXh0QXJyb3cgJiYgXy4kbmV4dEFycm93Lm9mZignY2xpY2suc2xpY2snLCBfLmNoYW5nZVNsaWRlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8uJGxpc3Qub2ZmKCd0b3VjaHN0YXJ0LnNsaWNrIG1vdXNlZG93bi5zbGljaycsIF8uc3dpcGVIYW5kbGVyKTtcbiAgICAgICAgXy4kbGlzdC5vZmYoJ3RvdWNobW92ZS5zbGljayBtb3VzZW1vdmUuc2xpY2snLCBfLnN3aXBlSGFuZGxlcik7XG4gICAgICAgIF8uJGxpc3Qub2ZmKCd0b3VjaGVuZC5zbGljayBtb3VzZXVwLnNsaWNrJywgXy5zd2lwZUhhbmRsZXIpO1xuICAgICAgICBfLiRsaXN0Lm9mZigndG91Y2hjYW5jZWwuc2xpY2sgbW91c2VsZWF2ZS5zbGljaycsIF8uc3dpcGVIYW5kbGVyKTtcblxuICAgICAgICBfLiRsaXN0Lm9mZignY2xpY2suc2xpY2snLCBfLmNsaWNrSGFuZGxlcik7XG5cbiAgICAgICAgJChkb2N1bWVudCkub2ZmKF8udmlzaWJpbGl0eUNoYW5nZSwgXy52aXNpYmlsaXR5KTtcblxuICAgICAgICBfLmNsZWFuVXBTbGlkZUV2ZW50cygpO1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuYWNjZXNzaWJpbGl0eSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgXy4kbGlzdC5vZmYoJ2tleWRvd24uc2xpY2snLCBfLmtleUhhbmRsZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5mb2N1c09uU2VsZWN0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAkKF8uJHNsaWRlVHJhY2spLmNoaWxkcmVuKCkub2ZmKCdjbGljay5zbGljaycsIF8uc2VsZWN0SGFuZGxlcik7XG4gICAgICAgIH1cblxuICAgICAgICAkKHdpbmRvdykub2ZmKCdvcmllbnRhdGlvbmNoYW5nZS5zbGljay5zbGljay0nICsgXy5pbnN0YW5jZVVpZCwgXy5vcmllbnRhdGlvbkNoYW5nZSk7XG5cbiAgICAgICAgJCh3aW5kb3cpLm9mZigncmVzaXplLnNsaWNrLnNsaWNrLScgKyBfLmluc3RhbmNlVWlkLCBfLnJlc2l6ZSk7XG5cbiAgICAgICAgJCgnW2RyYWdnYWJsZSE9dHJ1ZV0nLCBfLiRzbGlkZVRyYWNrKS5vZmYoJ2RyYWdzdGFydCcsIF8ucHJldmVudERlZmF1bHQpO1xuXG4gICAgICAgICQod2luZG93KS5vZmYoJ2xvYWQuc2xpY2suc2xpY2stJyArIF8uaW5zdGFuY2VVaWQsIF8uc2V0UG9zaXRpb24pO1xuICAgICAgICAkKGRvY3VtZW50KS5vZmYoJ3JlYWR5LnNsaWNrLnNsaWNrLScgKyBfLmluc3RhbmNlVWlkLCBfLnNldFBvc2l0aW9uKTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuY2xlYW5VcFNsaWRlRXZlbnRzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIF8uJGxpc3Qub2ZmKCdtb3VzZWVudGVyLnNsaWNrJywgJC5wcm94eShfLmludGVycnVwdCwgXywgdHJ1ZSkpO1xuICAgICAgICBfLiRsaXN0Lm9mZignbW91c2VsZWF2ZS5zbGljaycsICQucHJveHkoXy5pbnRlcnJ1cHQsIF8sIGZhbHNlKSk7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmNsZWFuVXBSb3dzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLCBvcmlnaW5hbFNsaWRlcztcblxuICAgICAgICBpZihfLm9wdGlvbnMucm93cyA+IDEpIHtcbiAgICAgICAgICAgIG9yaWdpbmFsU2xpZGVzID0gXy4kc2xpZGVzLmNoaWxkcmVuKCkuY2hpbGRyZW4oKTtcbiAgICAgICAgICAgIG9yaWdpbmFsU2xpZGVzLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG4gICAgICAgICAgICBfLiRzbGlkZXIuZW1wdHkoKS5hcHBlbmQob3JpZ2luYWxTbGlkZXMpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIGlmIChfLnNob3VsZENsaWNrID09PSBmYWxzZSkge1xuICAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKHJlZnJlc2gpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgXy5hdXRvUGxheUNsZWFyKCk7XG5cbiAgICAgICAgXy50b3VjaE9iamVjdCA9IHt9O1xuXG4gICAgICAgIF8uY2xlYW5VcEV2ZW50cygpO1xuXG4gICAgICAgICQoJy5zbGljay1jbG9uZWQnLCBfLiRzbGlkZXIpLmRldGFjaCgpO1xuXG4gICAgICAgIGlmIChfLiRkb3RzKSB7XG4gICAgICAgICAgICBfLiRkb3RzLnJlbW92ZSgpO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAoIF8uJHByZXZBcnJvdyAmJiBfLiRwcmV2QXJyb3cubGVuZ3RoICkge1xuXG4gICAgICAgICAgICBfLiRwcmV2QXJyb3dcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3NsaWNrLWRpc2FibGVkIHNsaWNrLWFycm93IHNsaWNrLWhpZGRlbicpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuIGFyaWEtZGlzYWJsZWQgdGFiaW5kZXgnKVxuICAgICAgICAgICAgICAgIC5jc3MoJ2Rpc3BsYXknLCcnKTtcblxuICAgICAgICAgICAgaWYgKCBfLmh0bWxFeHByLnRlc3QoIF8ub3B0aW9ucy5wcmV2QXJyb3cgKSkge1xuICAgICAgICAgICAgICAgIF8uJHByZXZBcnJvdy5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggXy4kbmV4dEFycm93ICYmIF8uJG5leHRBcnJvdy5sZW5ndGggKSB7XG5cbiAgICAgICAgICAgIF8uJG5leHRBcnJvd1xuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnc2xpY2stZGlzYWJsZWQgc2xpY2stYXJyb3cgc2xpY2staGlkZGVuJylcbiAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cignYXJpYS1oaWRkZW4gYXJpYS1kaXNhYmxlZCB0YWJpbmRleCcpXG4gICAgICAgICAgICAgICAgLmNzcygnZGlzcGxheScsJycpO1xuXG4gICAgICAgICAgICBpZiAoIF8uaHRtbEV4cHIudGVzdCggXy5vcHRpb25zLm5leHRBcnJvdyApKSB7XG4gICAgICAgICAgICAgICAgXy4kbmV4dEFycm93LnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmIChfLiRzbGlkZXMpIHtcblxuICAgICAgICAgICAgXy4kc2xpZGVzXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdzbGljay1zbGlkZSBzbGljay1hY3RpdmUgc2xpY2stY2VudGVyIHNsaWNrLXZpc2libGUgc2xpY2stY3VycmVudCcpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJylcbiAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cignZGF0YS1zbGljay1pbmRleCcpXG4gICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCdzdHlsZScsICQodGhpcykuZGF0YSgnb3JpZ2luYWxTdHlsaW5nJykpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBfLiRzbGlkZVRyYWNrLmNoaWxkcmVuKHRoaXMub3B0aW9ucy5zbGlkZSkuZGV0YWNoKCk7XG5cbiAgICAgICAgICAgIF8uJHNsaWRlVHJhY2suZGV0YWNoKCk7XG5cbiAgICAgICAgICAgIF8uJGxpc3QuZGV0YWNoKCk7XG5cbiAgICAgICAgICAgIF8uJHNsaWRlci5hcHBlbmQoXy4kc2xpZGVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8uY2xlYW5VcFJvd3MoKTtcblxuICAgICAgICBfLiRzbGlkZXIucmVtb3ZlQ2xhc3MoJ3NsaWNrLXNsaWRlcicpO1xuICAgICAgICBfLiRzbGlkZXIucmVtb3ZlQ2xhc3MoJ3NsaWNrLWluaXRpYWxpemVkJyk7XG4gICAgICAgIF8uJHNsaWRlci5yZW1vdmVDbGFzcygnc2xpY2stZG90dGVkJyk7XG5cbiAgICAgICAgXy51bnNsaWNrZWQgPSB0cnVlO1xuXG4gICAgICAgIGlmKCFyZWZyZXNoKSB7XG4gICAgICAgICAgICBfLiRzbGlkZXIudHJpZ2dlcignZGVzdHJveScsIFtfXSk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuZGlzYWJsZVRyYW5zaXRpb24gPSBmdW5jdGlvbihzbGlkZSkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIHRyYW5zaXRpb24gPSB7fTtcblxuICAgICAgICB0cmFuc2l0aW9uW18udHJhbnNpdGlvblR5cGVdID0gJyc7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5mYWRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5jc3ModHJhbnNpdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfLiRzbGlkZXMuZXEoc2xpZGUpLmNzcyh0cmFuc2l0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5mYWRlU2xpZGUgPSBmdW5jdGlvbihzbGlkZUluZGV4LCBjYWxsYmFjaykge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiAoXy5jc3NUcmFuc2l0aW9ucyA9PT0gZmFsc2UpIHtcblxuICAgICAgICAgICAgXy4kc2xpZGVzLmVxKHNsaWRlSW5kZXgpLmNzcyh7XG4gICAgICAgICAgICAgICAgekluZGV4OiBfLm9wdGlvbnMuekluZGV4XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgXy4kc2xpZGVzLmVxKHNsaWRlSW5kZXgpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgIH0sIF8ub3B0aW9ucy5zcGVlZCwgXy5vcHRpb25zLmVhc2luZywgY2FsbGJhY2spO1xuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIF8uYXBwbHlUcmFuc2l0aW9uKHNsaWRlSW5kZXgpO1xuXG4gICAgICAgICAgICBfLiRzbGlkZXMuZXEoc2xpZGVJbmRleCkuY3NzKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICAgIHpJbmRleDogXy5vcHRpb25zLnpJbmRleFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5kaXNhYmxlVHJhbnNpdGlvbihzbGlkZUluZGV4KTtcblxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKCk7XG4gICAgICAgICAgICAgICAgfSwgXy5vcHRpb25zLnNwZWVkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmZhZGVTbGlkZU91dCA9IGZ1bmN0aW9uKHNsaWRlSW5kZXgpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKF8uY3NzVHJhbnNpdGlvbnMgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICAgIF8uJHNsaWRlcy5lcShzbGlkZUluZGV4KS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgIHpJbmRleDogXy5vcHRpb25zLnpJbmRleCAtIDJcbiAgICAgICAgICAgIH0sIF8ub3B0aW9ucy5zcGVlZCwgXy5vcHRpb25zLmVhc2luZyk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgXy5hcHBseVRyYW5zaXRpb24oc2xpZGVJbmRleCk7XG5cbiAgICAgICAgICAgIF8uJHNsaWRlcy5lcShzbGlkZUluZGV4KS5jc3Moe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgekluZGV4OiBfLm9wdGlvbnMuekluZGV4IC0gMlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5maWx0ZXJTbGlkZXMgPSBTbGljay5wcm90b3R5cGUuc2xpY2tGaWx0ZXIgPSBmdW5jdGlvbihmaWx0ZXIpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKGZpbHRlciAhPT0gbnVsbCkge1xuXG4gICAgICAgICAgICBfLiRzbGlkZXNDYWNoZSA9IF8uJHNsaWRlcztcblxuICAgICAgICAgICAgXy51bmxvYWQoKTtcblxuICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5jaGlsZHJlbih0aGlzLm9wdGlvbnMuc2xpZGUpLmRldGFjaCgpO1xuXG4gICAgICAgICAgICBfLiRzbGlkZXNDYWNoZS5maWx0ZXIoZmlsdGVyKS5hcHBlbmRUbyhfLiRzbGlkZVRyYWNrKTtcblxuICAgICAgICAgICAgXy5yZWluaXQoKTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmZvY3VzSGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLiRzbGlkZXJcbiAgICAgICAgICAgIC5vZmYoJ2ZvY3VzLnNsaWNrIGJsdXIuc2xpY2snKVxuICAgICAgICAgICAgLm9uKCdmb2N1cy5zbGljayBibHVyLnNsaWNrJyxcbiAgICAgICAgICAgICAgICAnKjpub3QoLnNsaWNrLWFycm93KScsIGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdmFyICRzZiA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBpZiggXy5vcHRpb25zLnBhdXNlT25Gb2N1cyApIHtcbiAgICAgICAgICAgICAgICAgICAgXy5mb2N1c3NlZCA9ICRzZi5pcygnOmZvY3VzJyk7XG4gICAgICAgICAgICAgICAgICAgIF8uYXV0b1BsYXkoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sIDApO1xuXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuZ2V0Q3VycmVudCA9IFNsaWNrLnByb3RvdHlwZS5zbGlja0N1cnJlbnRTbGlkZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcbiAgICAgICAgcmV0dXJuIF8uY3VycmVudFNsaWRlO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5nZXREb3RDb3VudCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICB2YXIgYnJlYWtQb2ludCA9IDA7XG4gICAgICAgIHZhciBjb3VudGVyID0gMDtcbiAgICAgICAgdmFyIHBhZ2VyUXR5ID0gMDtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmluZmluaXRlID09PSB0cnVlKSB7XG4gICAgICAgICAgICB3aGlsZSAoYnJlYWtQb2ludCA8IF8uc2xpZGVDb3VudCkge1xuICAgICAgICAgICAgICAgICsrcGFnZXJRdHk7XG4gICAgICAgICAgICAgICAgYnJlYWtQb2ludCA9IGNvdW50ZXIgKyBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGw7XG4gICAgICAgICAgICAgICAgY291bnRlciArPSBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGwgPD0gXy5vcHRpb25zLnNsaWRlc1RvU2hvdyA/IF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCA6IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3c7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoXy5vcHRpb25zLmNlbnRlck1vZGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHBhZ2VyUXR5ID0gXy5zbGlkZUNvdW50O1xuICAgICAgICB9IGVsc2UgaWYoIV8ub3B0aW9ucy5hc05hdkZvcikge1xuICAgICAgICAgICAgcGFnZXJRdHkgPSAxICsgTWF0aC5jZWlsKChfLnNsaWRlQ291bnQgLSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSAvIF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCk7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIHdoaWxlIChicmVha1BvaW50IDwgXy5zbGlkZUNvdW50KSB7XG4gICAgICAgICAgICAgICAgKytwYWdlclF0eTtcbiAgICAgICAgICAgICAgICBicmVha1BvaW50ID0gY291bnRlciArIF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbDtcbiAgICAgICAgICAgICAgICBjb3VudGVyICs9IF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCA8PSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93ID8gXy5vcHRpb25zLnNsaWRlc1RvU2Nyb2xsIDogXy5vcHRpb25zLnNsaWRlc1RvU2hvdztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwYWdlclF0eSAtIDE7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmdldExlZnQgPSBmdW5jdGlvbihzbGlkZUluZGV4KSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLFxuICAgICAgICAgICAgdGFyZ2V0TGVmdCxcbiAgICAgICAgICAgIHZlcnRpY2FsSGVpZ2h0LFxuICAgICAgICAgICAgdmVydGljYWxPZmZzZXQgPSAwLFxuICAgICAgICAgICAgdGFyZ2V0U2xpZGU7XG5cbiAgICAgICAgXy5zbGlkZU9mZnNldCA9IDA7XG4gICAgICAgIHZlcnRpY2FsSGVpZ2h0ID0gXy4kc2xpZGVzLmZpcnN0KCkub3V0ZXJIZWlnaHQodHJ1ZSk7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5pbmZpbml0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKF8uc2xpZGVDb3VudCA+IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpIHtcbiAgICAgICAgICAgICAgICBfLnNsaWRlT2Zmc2V0ID0gKF8uc2xpZGVXaWR0aCAqIF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpICogLTE7XG4gICAgICAgICAgICAgICAgdmVydGljYWxPZmZzZXQgPSAodmVydGljYWxIZWlnaHQgKiBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSAqIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKF8uc2xpZGVDb3VudCAlIF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIGlmIChzbGlkZUluZGV4ICsgXy5vcHRpb25zLnNsaWRlc1RvU2Nyb2xsID4gXy5zbGlkZUNvdW50ICYmIF8uc2xpZGVDb3VudCA+IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNsaWRlSW5kZXggPiBfLnNsaWRlQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uc2xpZGVPZmZzZXQgPSAoKF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgLSAoc2xpZGVJbmRleCAtIF8uc2xpZGVDb3VudCkpICogXy5zbGlkZVdpZHRoKSAqIC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGljYWxPZmZzZXQgPSAoKF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgLSAoc2xpZGVJbmRleCAtIF8uc2xpZGVDb3VudCkpICogdmVydGljYWxIZWlnaHQpICogLTE7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLnNsaWRlT2Zmc2V0ID0gKChfLnNsaWRlQ291bnQgJSBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGwpICogXy5zbGlkZVdpZHRoKSAqIC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGljYWxPZmZzZXQgPSAoKF8uc2xpZGVDb3VudCAlIF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCkgKiB2ZXJ0aWNhbEhlaWdodCkgKiAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChzbGlkZUluZGV4ICsgXy5vcHRpb25zLnNsaWRlc1RvU2hvdyA+IF8uc2xpZGVDb3VudCkge1xuICAgICAgICAgICAgICAgIF8uc2xpZGVPZmZzZXQgPSAoKHNsaWRlSW5kZXggKyBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSAtIF8uc2xpZGVDb3VudCkgKiBfLnNsaWRlV2lkdGg7XG4gICAgICAgICAgICAgICAgdmVydGljYWxPZmZzZXQgPSAoKHNsaWRlSW5kZXggKyBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSAtIF8uc2xpZGVDb3VudCkgKiB2ZXJ0aWNhbEhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLnNsaWRlQ291bnQgPD0gXy5vcHRpb25zLnNsaWRlc1RvU2hvdykge1xuICAgICAgICAgICAgXy5zbGlkZU9mZnNldCA9IDA7XG4gICAgICAgICAgICB2ZXJ0aWNhbE9mZnNldCA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXy5vcHRpb25zLmNlbnRlck1vZGUgPT09IHRydWUgJiYgXy5vcHRpb25zLmluZmluaXRlID09PSB0cnVlKSB7XG4gICAgICAgICAgICBfLnNsaWRlT2Zmc2V0ICs9IF8uc2xpZGVXaWR0aCAqIE1hdGguZmxvb3IoXy5vcHRpb25zLnNsaWRlc1RvU2hvdyAvIDIpIC0gXy5zbGlkZVdpZHRoO1xuICAgICAgICB9IGVsc2UgaWYgKF8ub3B0aW9ucy5jZW50ZXJNb2RlID09PSB0cnVlKSB7XG4gICAgICAgICAgICBfLnNsaWRlT2Zmc2V0ID0gMDtcbiAgICAgICAgICAgIF8uc2xpZGVPZmZzZXQgKz0gXy5zbGlkZVdpZHRoICogTWF0aC5mbG9vcihfLm9wdGlvbnMuc2xpZGVzVG9TaG93IC8gMik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXy5vcHRpb25zLnZlcnRpY2FsID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGFyZ2V0TGVmdCA9ICgoc2xpZGVJbmRleCAqIF8uc2xpZGVXaWR0aCkgKiAtMSkgKyBfLnNsaWRlT2Zmc2V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0TGVmdCA9ICgoc2xpZGVJbmRleCAqIHZlcnRpY2FsSGVpZ2h0KSAqIC0xKSArIHZlcnRpY2FsT2Zmc2V0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy52YXJpYWJsZVdpZHRoID09PSB0cnVlKSB7XG5cbiAgICAgICAgICAgIGlmIChfLnNsaWRlQ291bnQgPD0gXy5vcHRpb25zLnNsaWRlc1RvU2hvdyB8fCBfLm9wdGlvbnMuaW5maW5pdGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0U2xpZGUgPSBfLiRzbGlkZVRyYWNrLmNoaWxkcmVuKCcuc2xpY2stc2xpZGUnKS5lcShzbGlkZUluZGV4KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0U2xpZGUgPSBfLiRzbGlkZVRyYWNrLmNoaWxkcmVuKCcuc2xpY2stc2xpZGUnKS5lcShzbGlkZUluZGV4ICsgXy5vcHRpb25zLnNsaWRlc1RvU2hvdyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChfLm9wdGlvbnMucnRsID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldFNsaWRlWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldExlZnQgPSAoXy4kc2xpZGVUcmFjay53aWR0aCgpIC0gdGFyZ2V0U2xpZGVbMF0ub2Zmc2V0TGVmdCAtIHRhcmdldFNsaWRlLndpZHRoKCkpICogLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TGVmdCA9ICAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0TGVmdCA9IHRhcmdldFNsaWRlWzBdID8gdGFyZ2V0U2xpZGVbMF0ub2Zmc2V0TGVmdCAqIC0xIDogMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKF8ub3B0aW9ucy5jZW50ZXJNb2RlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8uc2xpZGVDb3VudCA8PSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93IHx8IF8ub3B0aW9ucy5pbmZpbml0ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0U2xpZGUgPSBfLiRzbGlkZVRyYWNrLmNoaWxkcmVuKCcuc2xpY2stc2xpZGUnKS5lcShzbGlkZUluZGV4KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRTbGlkZSA9IF8uJHNsaWRlVHJhY2suY2hpbGRyZW4oJy5zbGljay1zbGlkZScpLmVxKHNsaWRlSW5kZXggKyBfLm9wdGlvbnMuc2xpZGVzVG9TaG93ICsgMSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKF8ub3B0aW9ucy5ydGwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldFNsaWRlWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRMZWZ0ID0gKF8uJHNsaWRlVHJhY2sud2lkdGgoKSAtIHRhcmdldFNsaWRlWzBdLm9mZnNldExlZnQgLSB0YXJnZXRTbGlkZS53aWR0aCgpKSAqIC0xO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TGVmdCA9ICAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TGVmdCA9IHRhcmdldFNsaWRlWzBdID8gdGFyZ2V0U2xpZGVbMF0ub2Zmc2V0TGVmdCAqIC0xIDogMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0YXJnZXRMZWZ0ICs9IChfLiRsaXN0LndpZHRoKCkgLSB0YXJnZXRTbGlkZS5vdXRlcldpZHRoKCkpIC8gMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YXJnZXRMZWZ0O1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5nZXRPcHRpb24gPSBTbGljay5wcm90b3R5cGUuc2xpY2tHZXRPcHRpb24gPSBmdW5jdGlvbihvcHRpb24pIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIF8ub3B0aW9uc1tvcHRpb25dO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5nZXROYXZpZ2FibGVJbmRleGVzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLFxuICAgICAgICAgICAgYnJlYWtQb2ludCA9IDAsXG4gICAgICAgICAgICBjb3VudGVyID0gMCxcbiAgICAgICAgICAgIGluZGV4ZXMgPSBbXSxcbiAgICAgICAgICAgIG1heDtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmluZmluaXRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgbWF4ID0gXy5zbGlkZUNvdW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnJlYWtQb2ludCA9IF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCAqIC0xO1xuICAgICAgICAgICAgY291bnRlciA9IF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCAqIC0xO1xuICAgICAgICAgICAgbWF4ID0gXy5zbGlkZUNvdW50ICogMjtcbiAgICAgICAgfVxuXG4gICAgICAgIHdoaWxlIChicmVha1BvaW50IDwgbWF4KSB7XG4gICAgICAgICAgICBpbmRleGVzLnB1c2goYnJlYWtQb2ludCk7XG4gICAgICAgICAgICBicmVha1BvaW50ID0gY291bnRlciArIF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbDtcbiAgICAgICAgICAgIGNvdW50ZXIgKz0gXy5vcHRpb25zLnNsaWRlc1RvU2Nyb2xsIDw9IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgPyBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGwgOiBfLm9wdGlvbnMuc2xpZGVzVG9TaG93O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGluZGV4ZXM7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmdldFNsaWNrID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmdldFNsaWRlQ291bnQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXMsXG4gICAgICAgICAgICBzbGlkZXNUcmF2ZXJzZWQsIHN3aXBlZFNsaWRlLCBjZW50ZXJPZmZzZXQ7XG5cbiAgICAgICAgY2VudGVyT2Zmc2V0ID0gXy5vcHRpb25zLmNlbnRlck1vZGUgPT09IHRydWUgPyBfLnNsaWRlV2lkdGggKiBNYXRoLmZsb29yKF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgLyAyKSA6IDA7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5zd2lwZVRvU2xpZGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIF8uJHNsaWRlVHJhY2suZmluZCgnLnNsaWNrLXNsaWRlJykuZWFjaChmdW5jdGlvbihpbmRleCwgc2xpZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2xpZGUub2Zmc2V0TGVmdCAtIGNlbnRlck9mZnNldCArICgkKHNsaWRlKS5vdXRlcldpZHRoKCkgLyAyKSA+IChfLnN3aXBlTGVmdCAqIC0xKSkge1xuICAgICAgICAgICAgICAgICAgICBzd2lwZWRTbGlkZSA9IHNsaWRlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNsaWRlc1RyYXZlcnNlZCA9IE1hdGguYWJzKCQoc3dpcGVkU2xpZGUpLmF0dHIoJ2RhdGEtc2xpY2staW5kZXgnKSAtIF8uY3VycmVudFNsaWRlKSB8fCAxO1xuXG4gICAgICAgICAgICByZXR1cm4gc2xpZGVzVHJhdmVyc2VkO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXy5vcHRpb25zLnNsaWRlc1RvU2Nyb2xsO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmdvVG8gPSBTbGljay5wcm90b3R5cGUuc2xpY2tHb1RvID0gZnVuY3Rpb24oc2xpZGUsIGRvbnRBbmltYXRlKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIF8uY2hhbmdlU2xpZGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdpbmRleCcsXG4gICAgICAgICAgICAgICAgaW5kZXg6IHBhcnNlSW50KHNsaWRlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBkb250QW5pbWF0ZSk7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihjcmVhdGlvbikge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiAoISQoXy4kc2xpZGVyKS5oYXNDbGFzcygnc2xpY2staW5pdGlhbGl6ZWQnKSkge1xuXG4gICAgICAgICAgICAkKF8uJHNsaWRlcikuYWRkQ2xhc3MoJ3NsaWNrLWluaXRpYWxpemVkJyk7XG5cbiAgICAgICAgICAgIF8uYnVpbGRSb3dzKCk7XG4gICAgICAgICAgICBfLmJ1aWxkT3V0KCk7XG4gICAgICAgICAgICBfLnNldFByb3BzKCk7XG4gICAgICAgICAgICBfLnN0YXJ0TG9hZCgpO1xuICAgICAgICAgICAgXy5sb2FkU2xpZGVyKCk7XG4gICAgICAgICAgICBfLmluaXRpYWxpemVFdmVudHMoKTtcbiAgICAgICAgICAgIF8udXBkYXRlQXJyb3dzKCk7XG4gICAgICAgICAgICBfLnVwZGF0ZURvdHMoKTtcbiAgICAgICAgICAgIF8uY2hlY2tSZXNwb25zaXZlKHRydWUpO1xuICAgICAgICAgICAgXy5mb2N1c0hhbmRsZXIoKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNyZWF0aW9uKSB7XG4gICAgICAgICAgICBfLiRzbGlkZXIudHJpZ2dlcignaW5pdCcsIFtfXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXy5vcHRpb25zLmFjY2Vzc2liaWxpdHkgPT09IHRydWUpIHtcbiAgICAgICAgICAgIF8uaW5pdEFEQSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCBfLm9wdGlvbnMuYXV0b3BsYXkgKSB7XG5cbiAgICAgICAgICAgIF8ucGF1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICBfLmF1dG9QbGF5KCk7XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5pbml0QURBID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBfID0gdGhpcztcbiAgICAgICAgXy4kc2xpZGVzLmFkZChfLiRzbGlkZVRyYWNrLmZpbmQoJy5zbGljay1jbG9uZWQnKSkuYXR0cih7XG4gICAgICAgICAgICAnYXJpYS1oaWRkZW4nOiAndHJ1ZScsXG4gICAgICAgICAgICAndGFiaW5kZXgnOiAnLTEnXG4gICAgICAgIH0pLmZpbmQoJ2EsIGlucHV0LCBidXR0b24sIHNlbGVjdCcpLmF0dHIoe1xuICAgICAgICAgICAgJ3RhYmluZGV4JzogJy0xJ1xuICAgICAgICB9KTtcblxuICAgICAgICBfLiRzbGlkZVRyYWNrLmF0dHIoJ3JvbGUnLCAnbGlzdGJveCcpO1xuXG4gICAgICAgIF8uJHNsaWRlcy5ub3QoXy4kc2xpZGVUcmFjay5maW5kKCcuc2xpY2stY2xvbmVkJykpLmVhY2goZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgJCh0aGlzKS5hdHRyKHtcbiAgICAgICAgICAgICAgICAncm9sZSc6ICdvcHRpb24nLFxuICAgICAgICAgICAgICAgICdhcmlhLWRlc2NyaWJlZGJ5JzogJ3NsaWNrLXNsaWRlJyArIF8uaW5zdGFuY2VVaWQgKyBpICsgJydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoXy4kZG90cyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgXy4kZG90cy5hdHRyKCdyb2xlJywgJ3RhYmxpc3QnKS5maW5kKCdsaScpLmVhY2goZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICdyb2xlJzogJ3ByZXNlbnRhdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICdhcmlhLXNlbGVjdGVkJzogJ2ZhbHNlJyxcbiAgICAgICAgICAgICAgICAgICAgJ2FyaWEtY29udHJvbHMnOiAnbmF2aWdhdGlvbicgKyBfLmluc3RhbmNlVWlkICsgaSArICcnLFxuICAgICAgICAgICAgICAgICAgICAnaWQnOiAnc2xpY2stc2xpZGUnICsgXy5pbnN0YW5jZVVpZCArIGkgKyAnJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuZmlyc3QoKS5hdHRyKCdhcmlhLXNlbGVjdGVkJywgJ3RydWUnKS5lbmQoKVxuICAgICAgICAgICAgICAgIC5maW5kKCdidXR0b24nKS5hdHRyKCdyb2xlJywgJ2J1dHRvbicpLmVuZCgpXG4gICAgICAgICAgICAgICAgLmNsb3Nlc3QoJ2RpdicpLmF0dHIoJ3JvbGUnLCAndG9vbGJhcicpO1xuICAgICAgICB9XG4gICAgICAgIF8uYWN0aXZhdGVBREEoKTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuaW5pdEFycm93RXZlbnRzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuYXJyb3dzID09PSB0cnVlICYmIF8uc2xpZGVDb3VudCA+IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpIHtcbiAgICAgICAgICAgIF8uJHByZXZBcnJvd1xuICAgICAgICAgICAgICAgLm9mZignY2xpY2suc2xpY2snKVxuICAgICAgICAgICAgICAgLm9uKCdjbGljay5zbGljaycsIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3ByZXZpb3VzJ1xuICAgICAgICAgICAgICAgfSwgXy5jaGFuZ2VTbGlkZSk7XG4gICAgICAgICAgICBfLiRuZXh0QXJyb3dcbiAgICAgICAgICAgICAgIC5vZmYoJ2NsaWNrLnNsaWNrJylcbiAgICAgICAgICAgICAgIC5vbignY2xpY2suc2xpY2snLCB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICduZXh0J1xuICAgICAgICAgICAgICAgfSwgXy5jaGFuZ2VTbGlkZSk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuaW5pdERvdEV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmRvdHMgPT09IHRydWUgJiYgXy5zbGlkZUNvdW50ID4gXy5vcHRpb25zLnNsaWRlc1RvU2hvdykge1xuICAgICAgICAgICAgJCgnbGknLCBfLiRkb3RzKS5vbignY2xpY2suc2xpY2snLCB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ2luZGV4J1xuICAgICAgICAgICAgfSwgXy5jaGFuZ2VTbGlkZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIF8ub3B0aW9ucy5kb3RzID09PSB0cnVlICYmIF8ub3B0aW9ucy5wYXVzZU9uRG90c0hvdmVyID09PSB0cnVlICkge1xuXG4gICAgICAgICAgICAkKCdsaScsIF8uJGRvdHMpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWVudGVyLnNsaWNrJywgJC5wcm94eShfLmludGVycnVwdCwgXywgdHJ1ZSkpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlLnNsaWNrJywgJC5wcm94eShfLmludGVycnVwdCwgXywgZmFsc2UpKTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmluaXRTbGlkZUV2ZW50cyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiAoIF8ub3B0aW9ucy5wYXVzZU9uSG92ZXIgKSB7XG5cbiAgICAgICAgICAgIF8uJGxpc3Qub24oJ21vdXNlZW50ZXIuc2xpY2snLCAkLnByb3h5KF8uaW50ZXJydXB0LCBfLCB0cnVlKSk7XG4gICAgICAgICAgICBfLiRsaXN0Lm9uKCdtb3VzZWxlYXZlLnNsaWNrJywgJC5wcm94eShfLmludGVycnVwdCwgXywgZmFsc2UpKTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmluaXRpYWxpemVFdmVudHMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgXy5pbml0QXJyb3dFdmVudHMoKTtcblxuICAgICAgICBfLmluaXREb3RFdmVudHMoKTtcbiAgICAgICAgXy5pbml0U2xpZGVFdmVudHMoKTtcblxuICAgICAgICBfLiRsaXN0Lm9uKCd0b3VjaHN0YXJ0LnNsaWNrIG1vdXNlZG93bi5zbGljaycsIHtcbiAgICAgICAgICAgIGFjdGlvbjogJ3N0YXJ0J1xuICAgICAgICB9LCBfLnN3aXBlSGFuZGxlcik7XG4gICAgICAgIF8uJGxpc3Qub24oJ3RvdWNobW92ZS5zbGljayBtb3VzZW1vdmUuc2xpY2snLCB7XG4gICAgICAgICAgICBhY3Rpb246ICdtb3ZlJ1xuICAgICAgICB9LCBfLnN3aXBlSGFuZGxlcik7XG4gICAgICAgIF8uJGxpc3Qub24oJ3RvdWNoZW5kLnNsaWNrIG1vdXNldXAuc2xpY2snLCB7XG4gICAgICAgICAgICBhY3Rpb246ICdlbmQnXG4gICAgICAgIH0sIF8uc3dpcGVIYW5kbGVyKTtcbiAgICAgICAgXy4kbGlzdC5vbigndG91Y2hjYW5jZWwuc2xpY2sgbW91c2VsZWF2ZS5zbGljaycsIHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2VuZCdcbiAgICAgICAgfSwgXy5zd2lwZUhhbmRsZXIpO1xuXG4gICAgICAgIF8uJGxpc3Qub24oJ2NsaWNrLnNsaWNrJywgXy5jbGlja0hhbmRsZXIpO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKF8udmlzaWJpbGl0eUNoYW5nZSwgJC5wcm94eShfLnZpc2liaWxpdHksIF8pKTtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmFjY2Vzc2liaWxpdHkgPT09IHRydWUpIHtcbiAgICAgICAgICAgIF8uJGxpc3Qub24oJ2tleWRvd24uc2xpY2snLCBfLmtleUhhbmRsZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5mb2N1c09uU2VsZWN0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAkKF8uJHNsaWRlVHJhY2spLmNoaWxkcmVuKCkub24oJ2NsaWNrLnNsaWNrJywgXy5zZWxlY3RIYW5kbGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQod2luZG93KS5vbignb3JpZW50YXRpb25jaGFuZ2Uuc2xpY2suc2xpY2stJyArIF8uaW5zdGFuY2VVaWQsICQucHJveHkoXy5vcmllbnRhdGlvbkNoYW5nZSwgXykpO1xuXG4gICAgICAgICQod2luZG93KS5vbigncmVzaXplLnNsaWNrLnNsaWNrLScgKyBfLmluc3RhbmNlVWlkLCAkLnByb3h5KF8ucmVzaXplLCBfKSk7XG5cbiAgICAgICAgJCgnW2RyYWdnYWJsZSE9dHJ1ZV0nLCBfLiRzbGlkZVRyYWNrKS5vbignZHJhZ3N0YXJ0JywgXy5wcmV2ZW50RGVmYXVsdCk7XG5cbiAgICAgICAgJCh3aW5kb3cpLm9uKCdsb2FkLnNsaWNrLnNsaWNrLScgKyBfLmluc3RhbmNlVWlkLCBfLnNldFBvc2l0aW9uKTtcbiAgICAgICAgJChkb2N1bWVudCkub24oJ3JlYWR5LnNsaWNrLnNsaWNrLScgKyBfLmluc3RhbmNlVWlkLCBfLnNldFBvc2l0aW9uKTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuaW5pdFVJID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuYXJyb3dzID09PSB0cnVlICYmIF8uc2xpZGVDb3VudCA+IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpIHtcblxuICAgICAgICAgICAgXy4kcHJldkFycm93LnNob3coKTtcbiAgICAgICAgICAgIF8uJG5leHRBcnJvdy5zaG93KCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuZG90cyA9PT0gdHJ1ZSAmJiBfLnNsaWRlQ291bnQgPiBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSB7XG5cbiAgICAgICAgICAgIF8uJGRvdHMuc2hvdygpO1xuXG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUua2V5SGFuZGxlciA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuICAgICAgICAgLy9Eb250IHNsaWRlIGlmIHRoZSBjdXJzb3IgaXMgaW5zaWRlIHRoZSBmb3JtIGZpZWxkcyBhbmQgYXJyb3cga2V5cyBhcmUgcHJlc3NlZFxuICAgICAgICBpZighZXZlbnQudGFyZ2V0LnRhZ05hbWUubWF0Y2goJ1RFWFRBUkVBfElOUFVUfFNFTEVDVCcpKSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzcgJiYgXy5vcHRpb25zLmFjY2Vzc2liaWxpdHkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBfLmNoYW5nZVNsaWRlKHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXy5vcHRpb25zLnJ0bCA9PT0gdHJ1ZSA/ICduZXh0JyA6ICAncHJldmlvdXMnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzkgJiYgXy5vcHRpb25zLmFjY2Vzc2liaWxpdHkgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBfLmNoYW5nZVNsaWRlKHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXy5vcHRpb25zLnJ0bCA9PT0gdHJ1ZSA/ICdwcmV2aW91cycgOiAnbmV4dCdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmxhenlMb2FkID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLFxuICAgICAgICAgICAgbG9hZFJhbmdlLCBjbG9uZVJhbmdlLCByYW5nZVN0YXJ0LCByYW5nZUVuZDtcblxuICAgICAgICBmdW5jdGlvbiBsb2FkSW1hZ2VzKGltYWdlc1Njb3BlKSB7XG5cbiAgICAgICAgICAgICQoJ2ltZ1tkYXRhLWxhenldJywgaW1hZ2VzU2NvcGUpLmVhY2goZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZVNvdXJjZSA9ICQodGhpcykuYXR0cignZGF0YS1sYXp5JyksXG4gICAgICAgICAgICAgICAgICAgIGltYWdlVG9Mb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG5cbiAgICAgICAgICAgICAgICBpbWFnZVRvTG9hZC5vbmxvYWQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICBpbWFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEwMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3NyYycsIGltYWdlU291cmNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgMjAwLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ2RhdGEtbGF6eScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdzbGljay1sb2FkaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uJHNsaWRlci50cmlnZ2VyKCdsYXp5TG9hZGVkJywgW18sIGltYWdlLCBpbWFnZVNvdXJjZV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgaW1hZ2VUb0xvYWQub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGltYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQXR0ciggJ2RhdGEtbGF6eScgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCAnc2xpY2stbG9hZGluZycgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCAnc2xpY2stbGF6eWxvYWQtZXJyb3InICk7XG5cbiAgICAgICAgICAgICAgICAgICAgXy4kc2xpZGVyLnRyaWdnZXIoJ2xhenlMb2FkRXJyb3InLCBbIF8sIGltYWdlLCBpbWFnZVNvdXJjZSBdKTtcblxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBpbWFnZVRvTG9hZC5zcmMgPSBpbWFnZVNvdXJjZTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuY2VudGVyTW9kZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKF8ub3B0aW9ucy5pbmZpbml0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJhbmdlU3RhcnQgPSBfLmN1cnJlbnRTbGlkZSArIChfLm9wdGlvbnMuc2xpZGVzVG9TaG93IC8gMiArIDEpO1xuICAgICAgICAgICAgICAgIHJhbmdlRW5kID0gcmFuZ2VTdGFydCArIF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgKyAyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByYW5nZVN0YXJ0ID0gTWF0aC5tYXgoMCwgXy5jdXJyZW50U2xpZGUgLSAoXy5vcHRpb25zLnNsaWRlc1RvU2hvdyAvIDIgKyAxKSk7XG4gICAgICAgICAgICAgICAgcmFuZ2VFbmQgPSAyICsgKF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgLyAyICsgMSkgKyBfLmN1cnJlbnRTbGlkZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJhbmdlU3RhcnQgPSBfLm9wdGlvbnMuaW5maW5pdGUgPyBfLm9wdGlvbnMuc2xpZGVzVG9TaG93ICsgXy5jdXJyZW50U2xpZGUgOiBfLmN1cnJlbnRTbGlkZTtcbiAgICAgICAgICAgIHJhbmdlRW5kID0gTWF0aC5jZWlsKHJhbmdlU3RhcnQgKyBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KTtcbiAgICAgICAgICAgIGlmIChfLm9wdGlvbnMuZmFkZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChyYW5nZVN0YXJ0ID4gMCkgcmFuZ2VTdGFydC0tO1xuICAgICAgICAgICAgICAgIGlmIChyYW5nZUVuZCA8PSBfLnNsaWRlQ291bnQpIHJhbmdlRW5kKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsb2FkUmFuZ2UgPSBfLiRzbGlkZXIuZmluZCgnLnNsaWNrLXNsaWRlJykuc2xpY2UocmFuZ2VTdGFydCwgcmFuZ2VFbmQpO1xuICAgICAgICBsb2FkSW1hZ2VzKGxvYWRSYW5nZSk7XG5cbiAgICAgICAgaWYgKF8uc2xpZGVDb3VudCA8PSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSB7XG4gICAgICAgICAgICBjbG9uZVJhbmdlID0gXy4kc2xpZGVyLmZpbmQoJy5zbGljay1zbGlkZScpO1xuICAgICAgICAgICAgbG9hZEltYWdlcyhjbG9uZVJhbmdlKTtcbiAgICAgICAgfSBlbHNlXG4gICAgICAgIGlmIChfLmN1cnJlbnRTbGlkZSA+PSBfLnNsaWRlQ291bnQgLSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSB7XG4gICAgICAgICAgICBjbG9uZVJhbmdlID0gXy4kc2xpZGVyLmZpbmQoJy5zbGljay1jbG9uZWQnKS5zbGljZSgwLCBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KTtcbiAgICAgICAgICAgIGxvYWRJbWFnZXMoY2xvbmVSYW5nZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoXy5jdXJyZW50U2xpZGUgPT09IDApIHtcbiAgICAgICAgICAgIGNsb25lUmFuZ2UgPSBfLiRzbGlkZXIuZmluZCgnLnNsaWNrLWNsb25lZCcpLnNsaWNlKF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgKiAtMSk7XG4gICAgICAgICAgICBsb2FkSW1hZ2VzKGNsb25lUmFuZ2UpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLmxvYWRTbGlkZXIgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgXy5zZXRQb3NpdGlvbigpO1xuXG4gICAgICAgIF8uJHNsaWRlVHJhY2suY3NzKHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgfSk7XG5cbiAgICAgICAgXy4kc2xpZGVyLnJlbW92ZUNsYXNzKCdzbGljay1sb2FkaW5nJyk7XG5cbiAgICAgICAgXy5pbml0VUkoKTtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmxhenlMb2FkID09PSAncHJvZ3Jlc3NpdmUnKSB7XG4gICAgICAgICAgICBfLnByb2dyZXNzaXZlTGF6eUxvYWQoKTtcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5uZXh0ID0gU2xpY2sucHJvdG90eXBlLnNsaWNrTmV4dCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLmNoYW5nZVNsaWRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnbmV4dCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLm9yaWVudGF0aW9uQ2hhbmdlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIF8uY2hlY2tSZXNwb25zaXZlKCk7XG4gICAgICAgIF8uc2V0UG9zaXRpb24oKTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUucGF1c2UgPSBTbGljay5wcm90b3R5cGUuc2xpY2tQYXVzZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLmF1dG9QbGF5Q2xlYXIoKTtcbiAgICAgICAgXy5wYXVzZWQgPSB0cnVlO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5wbGF5ID0gU2xpY2sucHJvdG90eXBlLnNsaWNrUGxheSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLmF1dG9QbGF5KCk7XG4gICAgICAgIF8ub3B0aW9ucy5hdXRvcGxheSA9IHRydWU7XG4gICAgICAgIF8ucGF1c2VkID0gZmFsc2U7XG4gICAgICAgIF8uZm9jdXNzZWQgPSBmYWxzZTtcbiAgICAgICAgXy5pbnRlcnJ1cHRlZCA9IGZhbHNlO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5wb3N0U2xpZGUgPSBmdW5jdGlvbihpbmRleCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiggIV8udW5zbGlja2VkICkge1xuXG4gICAgICAgICAgICBfLiRzbGlkZXIudHJpZ2dlcignYWZ0ZXJDaGFuZ2UnLCBbXywgaW5kZXhdKTtcblxuICAgICAgICAgICAgXy5hbmltYXRpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgXy5zZXRQb3NpdGlvbigpO1xuXG4gICAgICAgICAgICBfLnN3aXBlTGVmdCA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmICggXy5vcHRpb25zLmF1dG9wbGF5ICkge1xuICAgICAgICAgICAgICAgIF8uYXV0b1BsYXkoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKF8ub3B0aW9ucy5hY2Nlc3NpYmlsaXR5ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgXy5pbml0QURBKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5wcmV2ID0gU2xpY2sucHJvdG90eXBlLnNsaWNrUHJldiA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLmNoYW5nZVNsaWRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAncHJldmlvdXMnXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5wcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUucHJvZ3Jlc3NpdmVMYXp5TG9hZCA9IGZ1bmN0aW9uKCB0cnlDb3VudCApIHtcblxuICAgICAgICB0cnlDb3VudCA9IHRyeUNvdW50IHx8IDE7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLFxuICAgICAgICAgICAgJGltZ3NUb0xvYWQgPSAkKCAnaW1nW2RhdGEtbGF6eV0nLCBfLiRzbGlkZXIgKSxcbiAgICAgICAgICAgIGltYWdlLFxuICAgICAgICAgICAgaW1hZ2VTb3VyY2UsXG4gICAgICAgICAgICBpbWFnZVRvTG9hZDtcblxuICAgICAgICBpZiAoICRpbWdzVG9Mb2FkLmxlbmd0aCApIHtcblxuICAgICAgICAgICAgaW1hZ2UgPSAkaW1nc1RvTG9hZC5maXJzdCgpO1xuICAgICAgICAgICAgaW1hZ2VTb3VyY2UgPSBpbWFnZS5hdHRyKCdkYXRhLWxhenknKTtcbiAgICAgICAgICAgIGltYWdlVG9Mb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG5cbiAgICAgICAgICAgIGltYWdlVG9Mb2FkLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoICdzcmMnLCBpbWFnZVNvdXJjZSApXG4gICAgICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdkYXRhLWxhenknKVxuICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3NsaWNrLWxvYWRpbmcnKTtcblxuICAgICAgICAgICAgICAgIGlmICggXy5vcHRpb25zLmFkYXB0aXZlSGVpZ2h0ID09PSB0cnVlICkge1xuICAgICAgICAgICAgICAgICAgICBfLnNldFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgXy4kc2xpZGVyLnRyaWdnZXIoJ2xhenlMb2FkZWQnLCBbIF8sIGltYWdlLCBpbWFnZVNvdXJjZSBdKTtcbiAgICAgICAgICAgICAgICBfLnByb2dyZXNzaXZlTGF6eUxvYWQoKTtcblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaW1hZ2VUb0xvYWQub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCB0cnlDb3VudCA8IDMgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIHRyeSB0byBsb2FkIHRoZSBpbWFnZSAzIHRpbWVzLFxuICAgICAgICAgICAgICAgICAgICAgKiBsZWF2ZSBhIHNsaWdodCBkZWxheSBzbyB3ZSBkb24ndCBnZXRcbiAgICAgICAgICAgICAgICAgICAgICogc2VydmVycyBibG9ja2luZyB0aGUgcmVxdWVzdC5cbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5wcm9ncmVzc2l2ZUxhenlMb2FkKCB0cnlDb3VudCArIDEgKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgNTAwICk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGltYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQXR0ciggJ2RhdGEtbGF6eScgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCAnc2xpY2stbG9hZGluZycgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCAnc2xpY2stbGF6eWxvYWQtZXJyb3InICk7XG5cbiAgICAgICAgICAgICAgICAgICAgXy4kc2xpZGVyLnRyaWdnZXIoJ2xhenlMb2FkRXJyb3InLCBbIF8sIGltYWdlLCBpbWFnZVNvdXJjZSBdKTtcblxuICAgICAgICAgICAgICAgICAgICBfLnByb2dyZXNzaXZlTGF6eUxvYWQoKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaW1hZ2VUb0xvYWQuc3JjID0gaW1hZ2VTb3VyY2U7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgXy4kc2xpZGVyLnRyaWdnZXIoJ2FsbEltYWdlc0xvYWRlZCcsIFsgXyBdKTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiggaW5pdGlhbGl6aW5nICkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcywgY3VycmVudFNsaWRlLCBsYXN0VmlzaWJsZUluZGV4O1xuXG4gICAgICAgIGxhc3RWaXNpYmxlSW5kZXggPSBfLnNsaWRlQ291bnQgLSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93O1xuXG4gICAgICAgIC8vIGluIG5vbi1pbmZpbml0ZSBzbGlkZXJzLCB3ZSBkb24ndCB3YW50IHRvIGdvIHBhc3QgdGhlXG4gICAgICAgIC8vIGxhc3QgdmlzaWJsZSBpbmRleC5cbiAgICAgICAgaWYoICFfLm9wdGlvbnMuaW5maW5pdGUgJiYgKCBfLmN1cnJlbnRTbGlkZSA+IGxhc3RWaXNpYmxlSW5kZXggKSkge1xuICAgICAgICAgICAgXy5jdXJyZW50U2xpZGUgPSBsYXN0VmlzaWJsZUluZGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgbGVzcyBzbGlkZXMgdGhhbiB0byBzaG93LCBnbyB0byBzdGFydC5cbiAgICAgICAgaWYgKCBfLnNsaWRlQ291bnQgPD0gXy5vcHRpb25zLnNsaWRlc1RvU2hvdyApIHtcbiAgICAgICAgICAgIF8uY3VycmVudFNsaWRlID0gMDtcblxuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudFNsaWRlID0gXy5jdXJyZW50U2xpZGU7XG5cbiAgICAgICAgXy5kZXN0cm95KHRydWUpO1xuXG4gICAgICAgICQuZXh0ZW5kKF8sIF8uaW5pdGlhbHMsIHsgY3VycmVudFNsaWRlOiBjdXJyZW50U2xpZGUgfSk7XG5cbiAgICAgICAgXy5pbml0KCk7XG5cbiAgICAgICAgaWYoICFpbml0aWFsaXppbmcgKSB7XG5cbiAgICAgICAgICAgIF8uY2hhbmdlU2xpZGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2luZGV4JyxcbiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGN1cnJlbnRTbGlkZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZhbHNlKTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnJlZ2lzdGVyQnJlYWtwb2ludHMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXMsIGJyZWFrcG9pbnQsIGN1cnJlbnRCcmVha3BvaW50LCBsLFxuICAgICAgICAgICAgcmVzcG9uc2l2ZVNldHRpbmdzID0gXy5vcHRpb25zLnJlc3BvbnNpdmUgfHwgbnVsbDtcblxuICAgICAgICBpZiAoICQudHlwZShyZXNwb25zaXZlU2V0dGluZ3MpID09PSAnYXJyYXknICYmIHJlc3BvbnNpdmVTZXR0aW5ncy5sZW5ndGggKSB7XG5cbiAgICAgICAgICAgIF8ucmVzcG9uZFRvID0gXy5vcHRpb25zLnJlc3BvbmRUbyB8fCAnd2luZG93JztcblxuICAgICAgICAgICAgZm9yICggYnJlYWtwb2ludCBpbiByZXNwb25zaXZlU2V0dGluZ3MgKSB7XG5cbiAgICAgICAgICAgICAgICBsID0gXy5icmVha3BvaW50cy5sZW5ndGgtMTtcbiAgICAgICAgICAgICAgICBjdXJyZW50QnJlYWtwb2ludCA9IHJlc3BvbnNpdmVTZXR0aW5nc1ticmVha3BvaW50XS5icmVha3BvaW50O1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNpdmVTZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eShicmVha3BvaW50KSkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhyb3VnaCB0aGUgYnJlYWtwb2ludHMgYW5kIGN1dCBvdXQgYW55IGV4aXN0aW5nXG4gICAgICAgICAgICAgICAgICAgIC8vIG9uZXMgd2l0aCB0aGUgc2FtZSBicmVha3BvaW50IG51bWJlciwgd2UgZG9uJ3Qgd2FudCBkdXBlcy5cbiAgICAgICAgICAgICAgICAgICAgd2hpbGUoIGwgPj0gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBfLmJyZWFrcG9pbnRzW2xdICYmIF8uYnJlYWtwb2ludHNbbF0gPT09IGN1cnJlbnRCcmVha3BvaW50ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uYnJlYWtwb2ludHMuc3BsaWNlKGwsMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsLS07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBfLmJyZWFrcG9pbnRzLnB1c2goY3VycmVudEJyZWFrcG9pbnQpO1xuICAgICAgICAgICAgICAgICAgICBfLmJyZWFrcG9pbnRTZXR0aW5nc1tjdXJyZW50QnJlYWtwb2ludF0gPSByZXNwb25zaXZlU2V0dGluZ3NbYnJlYWtwb2ludF0uc2V0dGluZ3M7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgXy5icmVha3BvaW50cy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKCBfLm9wdGlvbnMubW9iaWxlRmlyc3QgKSA/IGEtYiA6IGItYTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUucmVpbml0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIF8uJHNsaWRlcyA9XG4gICAgICAgICAgICBfLiRzbGlkZVRyYWNrXG4gICAgICAgICAgICAgICAgLmNoaWxkcmVuKF8ub3B0aW9ucy5zbGlkZSlcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3NsaWNrLXNsaWRlJyk7XG5cbiAgICAgICAgXy5zbGlkZUNvdW50ID0gXy4kc2xpZGVzLmxlbmd0aDtcblxuICAgICAgICBpZiAoXy5jdXJyZW50U2xpZGUgPj0gXy5zbGlkZUNvdW50ICYmIF8uY3VycmVudFNsaWRlICE9PSAwKSB7XG4gICAgICAgICAgICBfLmN1cnJlbnRTbGlkZSA9IF8uY3VycmVudFNsaWRlIC0gXy5vcHRpb25zLnNsaWRlc1RvU2Nyb2xsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF8uc2xpZGVDb3VudCA8PSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSB7XG4gICAgICAgICAgICBfLmN1cnJlbnRTbGlkZSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBfLnJlZ2lzdGVyQnJlYWtwb2ludHMoKTtcblxuICAgICAgICBfLnNldFByb3BzKCk7XG4gICAgICAgIF8uc2V0dXBJbmZpbml0ZSgpO1xuICAgICAgICBfLmJ1aWxkQXJyb3dzKCk7XG4gICAgICAgIF8udXBkYXRlQXJyb3dzKCk7XG4gICAgICAgIF8uaW5pdEFycm93RXZlbnRzKCk7XG4gICAgICAgIF8uYnVpbGREb3RzKCk7XG4gICAgICAgIF8udXBkYXRlRG90cygpO1xuICAgICAgICBfLmluaXREb3RFdmVudHMoKTtcbiAgICAgICAgXy5jbGVhblVwU2xpZGVFdmVudHMoKTtcbiAgICAgICAgXy5pbml0U2xpZGVFdmVudHMoKTtcblxuICAgICAgICBfLmNoZWNrUmVzcG9uc2l2ZShmYWxzZSwgdHJ1ZSk7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5mb2N1c09uU2VsZWN0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAkKF8uJHNsaWRlVHJhY2spLmNoaWxkcmVuKCkub24oJ2NsaWNrLnNsaWNrJywgXy5zZWxlY3RIYW5kbGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8uc2V0U2xpZGVDbGFzc2VzKHR5cGVvZiBfLmN1cnJlbnRTbGlkZSA9PT0gJ251bWJlcicgPyBfLmN1cnJlbnRTbGlkZSA6IDApO1xuXG4gICAgICAgIF8uc2V0UG9zaXRpb24oKTtcbiAgICAgICAgXy5mb2N1c0hhbmRsZXIoKTtcblxuICAgICAgICBfLnBhdXNlZCA9ICFfLm9wdGlvbnMuYXV0b3BsYXk7XG4gICAgICAgIF8uYXV0b1BsYXkoKTtcblxuICAgICAgICBfLiRzbGlkZXIudHJpZ2dlcigncmVJbml0JywgW19dKTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSAhPT0gXy53aW5kb3dXaWR0aCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KF8ud2luZG93RGVsYXkpO1xuICAgICAgICAgICAgXy53aW5kb3dEZWxheSA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF8ud2luZG93V2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcbiAgICAgICAgICAgICAgICBfLmNoZWNrUmVzcG9uc2l2ZSgpO1xuICAgICAgICAgICAgICAgIGlmKCAhXy51bnNsaWNrZWQgKSB7IF8uc2V0UG9zaXRpb24oKTsgfVxuICAgICAgICAgICAgfSwgNTApO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5yZW1vdmVTbGlkZSA9IFNsaWNrLnByb3RvdHlwZS5zbGlja1JlbW92ZSA9IGZ1bmN0aW9uKGluZGV4LCByZW1vdmVCZWZvcmUsIHJlbW92ZUFsbCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiAodHlwZW9mKGluZGV4KSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICByZW1vdmVCZWZvcmUgPSBpbmRleDtcbiAgICAgICAgICAgIGluZGV4ID0gcmVtb3ZlQmVmb3JlID09PSB0cnVlID8gMCA6IF8uc2xpZGVDb3VudCAtIDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbmRleCA9IHJlbW92ZUJlZm9yZSA9PT0gdHJ1ZSA/IC0taW5kZXggOiBpbmRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLnNsaWRlQ291bnQgPCAxIHx8IGluZGV4IDwgMCB8fCBpbmRleCA+IF8uc2xpZGVDb3VudCAtIDEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8udW5sb2FkKCk7XG5cbiAgICAgICAgaWYgKHJlbW92ZUFsbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5jaGlsZHJlbigpLnJlbW92ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5jaGlsZHJlbih0aGlzLm9wdGlvbnMuc2xpZGUpLmVxKGluZGV4KS5yZW1vdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8uJHNsaWRlcyA9IF8uJHNsaWRlVHJhY2suY2hpbGRyZW4odGhpcy5vcHRpb25zLnNsaWRlKTtcblxuICAgICAgICBfLiRzbGlkZVRyYWNrLmNoaWxkcmVuKHRoaXMub3B0aW9ucy5zbGlkZSkuZGV0YWNoKCk7XG5cbiAgICAgICAgXy4kc2xpZGVUcmFjay5hcHBlbmQoXy4kc2xpZGVzKTtcblxuICAgICAgICBfLiRzbGlkZXNDYWNoZSA9IF8uJHNsaWRlcztcblxuICAgICAgICBfLnJlaW5pdCgpO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5zZXRDU1MgPSBmdW5jdGlvbihwb3NpdGlvbikge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIHBvc2l0aW9uUHJvcHMgPSB7fSxcbiAgICAgICAgICAgIHgsIHk7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5ydGwgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHBvc2l0aW9uID0gLXBvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICAgIHggPSBfLnBvc2l0aW9uUHJvcCA9PSAnbGVmdCcgPyBNYXRoLmNlaWwocG9zaXRpb24pICsgJ3B4JyA6ICcwcHgnO1xuICAgICAgICB5ID0gXy5wb3NpdGlvblByb3AgPT0gJ3RvcCcgPyBNYXRoLmNlaWwocG9zaXRpb24pICsgJ3B4JyA6ICcwcHgnO1xuXG4gICAgICAgIHBvc2l0aW9uUHJvcHNbXy5wb3NpdGlvblByb3BdID0gcG9zaXRpb247XG5cbiAgICAgICAgaWYgKF8udHJhbnNmb3Jtc0VuYWJsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBfLiRzbGlkZVRyYWNrLmNzcyhwb3NpdGlvblByb3BzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBvc2l0aW9uUHJvcHMgPSB7fTtcbiAgICAgICAgICAgIGlmIChfLmNzc1RyYW5zaXRpb25zID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uUHJvcHNbXy5hbmltVHlwZV0gPSAndHJhbnNsYXRlKCcgKyB4ICsgJywgJyArIHkgKyAnKSc7XG4gICAgICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5jc3MocG9zaXRpb25Qcm9wcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uUHJvcHNbXy5hbmltVHlwZV0gPSAndHJhbnNsYXRlM2QoJyArIHggKyAnLCAnICsgeSArICcsIDBweCknO1xuICAgICAgICAgICAgICAgIF8uJHNsaWRlVHJhY2suY3NzKHBvc2l0aW9uUHJvcHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnNldERpbWVuc2lvbnMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy52ZXJ0aWNhbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChfLm9wdGlvbnMuY2VudGVyTW9kZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIF8uJGxpc3QuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogKCcwcHggJyArIF8ub3B0aW9ucy5jZW50ZXJQYWRkaW5nKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgXy4kbGlzdC5oZWlnaHQoXy4kc2xpZGVzLmZpcnN0KCkub3V0ZXJIZWlnaHQodHJ1ZSkgKiBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KTtcbiAgICAgICAgICAgIGlmIChfLm9wdGlvbnMuY2VudGVyTW9kZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIF8uJGxpc3QuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogKF8ub3B0aW9ucy5jZW50ZXJQYWRkaW5nICsgJyAwcHgnKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgXy5saXN0V2lkdGggPSBfLiRsaXN0LndpZHRoKCk7XG4gICAgICAgIF8ubGlzdEhlaWdodCA9IF8uJGxpc3QuaGVpZ2h0KCk7XG5cblxuICAgICAgICBpZiAoXy5vcHRpb25zLnZlcnRpY2FsID09PSBmYWxzZSAmJiBfLm9wdGlvbnMudmFyaWFibGVXaWR0aCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIF8uc2xpZGVXaWR0aCA9IE1hdGguY2VpbChfLmxpc3RXaWR0aCAvIF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpO1xuICAgICAgICAgICAgXy4kc2xpZGVUcmFjay53aWR0aChNYXRoLmNlaWwoKF8uc2xpZGVXaWR0aCAqIF8uJHNsaWRlVHJhY2suY2hpbGRyZW4oJy5zbGljay1zbGlkZScpLmxlbmd0aCkpKTtcblxuICAgICAgICB9IGVsc2UgaWYgKF8ub3B0aW9ucy52YXJpYWJsZVdpZHRoID09PSB0cnVlKSB7XG4gICAgICAgICAgICBfLiRzbGlkZVRyYWNrLndpZHRoKDUwMDAgKiBfLnNsaWRlQ291bnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgXy5zbGlkZVdpZHRoID0gTWF0aC5jZWlsKF8ubGlzdFdpZHRoKTtcbiAgICAgICAgICAgIF8uJHNsaWRlVHJhY2suaGVpZ2h0KE1hdGguY2VpbCgoXy4kc2xpZGVzLmZpcnN0KCkub3V0ZXJIZWlnaHQodHJ1ZSkgKiBfLiRzbGlkZVRyYWNrLmNoaWxkcmVuKCcuc2xpY2stc2xpZGUnKS5sZW5ndGgpKSk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgb2Zmc2V0ID0gXy4kc2xpZGVzLmZpcnN0KCkub3V0ZXJXaWR0aCh0cnVlKSAtIF8uJHNsaWRlcy5maXJzdCgpLndpZHRoKCk7XG4gICAgICAgIGlmIChfLm9wdGlvbnMudmFyaWFibGVXaWR0aCA9PT0gZmFsc2UpIF8uJHNsaWRlVHJhY2suY2hpbGRyZW4oJy5zbGljay1zbGlkZScpLndpZHRoKF8uc2xpZGVXaWR0aCAtIG9mZnNldCk7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnNldEZhZGUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXMsXG4gICAgICAgICAgICB0YXJnZXRMZWZ0O1xuXG4gICAgICAgIF8uJHNsaWRlcy5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICB0YXJnZXRMZWZ0ID0gKF8uc2xpZGVXaWR0aCAqIGluZGV4KSAqIC0xO1xuICAgICAgICAgICAgaWYgKF8ub3B0aW9ucy5ydGwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgICAgICAgICAgICAgICAgICByaWdodDogdGFyZ2V0TGVmdCxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IF8ub3B0aW9ucy56SW5kZXggLSAyLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoZWxlbWVudCkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRhcmdldExlZnQsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiBfLm9wdGlvbnMuekluZGV4IC0gMixcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBfLiRzbGlkZXMuZXEoXy5jdXJyZW50U2xpZGUpLmNzcyh7XG4gICAgICAgICAgICB6SW5kZXg6IF8ub3B0aW9ucy56SW5kZXggLSAxLFxuICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICB9KTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuc2V0SGVpZ2h0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuc2xpZGVzVG9TaG93ID09PSAxICYmIF8ub3B0aW9ucy5hZGFwdGl2ZUhlaWdodCA9PT0gdHJ1ZSAmJiBfLm9wdGlvbnMudmVydGljYWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0SGVpZ2h0ID0gXy4kc2xpZGVzLmVxKF8uY3VycmVudFNsaWRlKS5vdXRlckhlaWdodCh0cnVlKTtcbiAgICAgICAgICAgIF8uJGxpc3QuY3NzKCdoZWlnaHQnLCB0YXJnZXRIZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnNldE9wdGlvbiA9XG4gICAgU2xpY2sucHJvdG90eXBlLnNsaWNrU2V0T3B0aW9uID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGFjY2VwdHMgYXJndW1lbnRzIGluIGZvcm1hdCBvZjpcbiAgICAgICAgICpcbiAgICAgICAgICogIC0gZm9yIGNoYW5naW5nIGEgc2luZ2xlIG9wdGlvbidzIHZhbHVlOlxuICAgICAgICAgKiAgICAgLnNsaWNrKFwic2V0T3B0aW9uXCIsIG9wdGlvbiwgdmFsdWUsIHJlZnJlc2ggKVxuICAgICAgICAgKlxuICAgICAgICAgKiAgLSBmb3IgY2hhbmdpbmcgYSBzZXQgb2YgcmVzcG9uc2l2ZSBvcHRpb25zOlxuICAgICAgICAgKiAgICAgLnNsaWNrKFwic2V0T3B0aW9uXCIsICdyZXNwb25zaXZlJywgW3t9LCAuLi5dLCByZWZyZXNoIClcbiAgICAgICAgICpcbiAgICAgICAgICogIC0gZm9yIHVwZGF0aW5nIG11bHRpcGxlIHZhbHVlcyBhdCBvbmNlIChub3QgcmVzcG9uc2l2ZSlcbiAgICAgICAgICogICAgIC5zbGljayhcInNldE9wdGlvblwiLCB7ICdvcHRpb24nOiB2YWx1ZSwgLi4uIH0sIHJlZnJlc2ggKVxuICAgICAgICAgKi9cblxuICAgICAgICB2YXIgXyA9IHRoaXMsIGwsIGl0ZW0sIG9wdGlvbiwgdmFsdWUsIHJlZnJlc2ggPSBmYWxzZSwgdHlwZTtcblxuICAgICAgICBpZiggJC50eXBlKCBhcmd1bWVudHNbMF0gKSA9PT0gJ29iamVjdCcgKSB7XG5cbiAgICAgICAgICAgIG9wdGlvbiA9ICBhcmd1bWVudHNbMF07XG4gICAgICAgICAgICByZWZyZXNoID0gYXJndW1lbnRzWzFdO1xuICAgICAgICAgICAgdHlwZSA9ICdtdWx0aXBsZSc7XG5cbiAgICAgICAgfSBlbHNlIGlmICggJC50eXBlKCBhcmd1bWVudHNbMF0gKSA9PT0gJ3N0cmluZycgKSB7XG5cbiAgICAgICAgICAgIG9wdGlvbiA9ICBhcmd1bWVudHNbMF07XG4gICAgICAgICAgICB2YWx1ZSA9IGFyZ3VtZW50c1sxXTtcbiAgICAgICAgICAgIHJlZnJlc2ggPSBhcmd1bWVudHNbMl07XG5cbiAgICAgICAgICAgIGlmICggYXJndW1lbnRzWzBdID09PSAncmVzcG9uc2l2ZScgJiYgJC50eXBlKCBhcmd1bWVudHNbMV0gKSA9PT0gJ2FycmF5JyApIHtcblxuICAgICAgICAgICAgICAgIHR5cGUgPSAncmVzcG9uc2l2ZSc7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIHR5cGVvZiBhcmd1bWVudHNbMV0gIT09ICd1bmRlZmluZWQnICkge1xuXG4gICAgICAgICAgICAgICAgdHlwZSA9ICdzaW5nbGUnO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggdHlwZSA9PT0gJ3NpbmdsZScgKSB7XG5cbiAgICAgICAgICAgIF8ub3B0aW9uc1tvcHRpb25dID0gdmFsdWU7XG5cblxuICAgICAgICB9IGVsc2UgaWYgKCB0eXBlID09PSAnbXVsdGlwbGUnICkge1xuXG4gICAgICAgICAgICAkLmVhY2goIG9wdGlvbiAsIGZ1bmN0aW9uKCBvcHQsIHZhbCApIHtcblxuICAgICAgICAgICAgICAgIF8ub3B0aW9uc1tvcHRdID0gdmFsO1xuXG4gICAgICAgICAgICB9KTtcblxuXG4gICAgICAgIH0gZWxzZSBpZiAoIHR5cGUgPT09ICdyZXNwb25zaXZlJyApIHtcblxuICAgICAgICAgICAgZm9yICggaXRlbSBpbiB2YWx1ZSApIHtcblxuICAgICAgICAgICAgICAgIGlmKCAkLnR5cGUoIF8ub3B0aW9ucy5yZXNwb25zaXZlICkgIT09ICdhcnJheScgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5vcHRpb25zLnJlc3BvbnNpdmUgPSBbIHZhbHVlW2l0ZW1dIF07XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGwgPSBfLm9wdGlvbnMucmVzcG9uc2l2ZS5sZW5ndGgtMTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggdGhlIHJlc3BvbnNpdmUgb2JqZWN0IGFuZCBzcGxpY2Ugb3V0IGR1cGxpY2F0ZXMuXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlKCBsID49IDAgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBfLm9wdGlvbnMucmVzcG9uc2l2ZVtsXS5icmVha3BvaW50ID09PSB2YWx1ZVtpdGVtXS5icmVha3BvaW50ICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5vcHRpb25zLnJlc3BvbnNpdmUuc3BsaWNlKGwsMSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgbC0tO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBfLm9wdGlvbnMucmVzcG9uc2l2ZS5wdXNoKCB2YWx1ZVtpdGVtXSApO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggcmVmcmVzaCApIHtcblxuICAgICAgICAgICAgXy51bmxvYWQoKTtcbiAgICAgICAgICAgIF8ucmVpbml0KCk7XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5zZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBfLnNldERpbWVuc2lvbnMoKTtcblxuICAgICAgICBfLnNldEhlaWdodCgpO1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuZmFkZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIF8uc2V0Q1NTKF8uZ2V0TGVmdChfLmN1cnJlbnRTbGlkZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgXy5zZXRGYWRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBfLiRzbGlkZXIudHJpZ2dlcignc2V0UG9zaXRpb24nLCBbX10pO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5zZXRQcm9wcyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIGJvZHlTdHlsZSA9IGRvY3VtZW50LmJvZHkuc3R5bGU7XG5cbiAgICAgICAgXy5wb3NpdGlvblByb3AgPSBfLm9wdGlvbnMudmVydGljYWwgPT09IHRydWUgPyAndG9wJyA6ICdsZWZ0JztcblxuICAgICAgICBpZiAoXy5wb3NpdGlvblByb3AgPT09ICd0b3AnKSB7XG4gICAgICAgICAgICBfLiRzbGlkZXIuYWRkQ2xhc3MoJ3NsaWNrLXZlcnRpY2FsJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfLiRzbGlkZXIucmVtb3ZlQ2xhc3MoJ3NsaWNrLXZlcnRpY2FsJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYm9keVN0eWxlLldlYmtpdFRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCB8fFxuICAgICAgICAgICAgYm9keVN0eWxlLk1velRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCB8fFxuICAgICAgICAgICAgYm9keVN0eWxlLm1zVHJhbnNpdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoXy5vcHRpb25zLnVzZUNTUyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIF8uY3NzVHJhbnNpdGlvbnMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCBfLm9wdGlvbnMuZmFkZSApIHtcbiAgICAgICAgICAgIGlmICggdHlwZW9mIF8ub3B0aW9ucy56SW5kZXggPT09ICdudW1iZXInICkge1xuICAgICAgICAgICAgICAgIGlmKCBfLm9wdGlvbnMuekluZGV4IDwgMyApIHtcbiAgICAgICAgICAgICAgICAgICAgXy5vcHRpb25zLnpJbmRleCA9IDM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfLm9wdGlvbnMuekluZGV4ID0gXy5kZWZhdWx0cy56SW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYm9keVN0eWxlLk9UcmFuc2Zvcm0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgXy5hbmltVHlwZSA9ICdPVHJhbnNmb3JtJztcbiAgICAgICAgICAgIF8udHJhbnNmb3JtVHlwZSA9ICctby10cmFuc2Zvcm0nO1xuICAgICAgICAgICAgXy50cmFuc2l0aW9uVHlwZSA9ICdPVHJhbnNpdGlvbic7XG4gICAgICAgICAgICBpZiAoYm9keVN0eWxlLnBlcnNwZWN0aXZlUHJvcGVydHkgPT09IHVuZGVmaW5lZCAmJiBib2R5U3R5bGUud2Via2l0UGVyc3BlY3RpdmUgPT09IHVuZGVmaW5lZCkgXy5hbmltVHlwZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChib2R5U3R5bGUuTW96VHJhbnNmb3JtICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIF8uYW5pbVR5cGUgPSAnTW96VHJhbnNmb3JtJztcbiAgICAgICAgICAgIF8udHJhbnNmb3JtVHlwZSA9ICctbW96LXRyYW5zZm9ybSc7XG4gICAgICAgICAgICBfLnRyYW5zaXRpb25UeXBlID0gJ01velRyYW5zaXRpb24nO1xuICAgICAgICAgICAgaWYgKGJvZHlTdHlsZS5wZXJzcGVjdGl2ZVByb3BlcnR5ID09PSB1bmRlZmluZWQgJiYgYm9keVN0eWxlLk1velBlcnNwZWN0aXZlID09PSB1bmRlZmluZWQpIF8uYW5pbVR5cGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYm9keVN0eWxlLndlYmtpdFRyYW5zZm9ybSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBfLmFuaW1UeXBlID0gJ3dlYmtpdFRyYW5zZm9ybSc7XG4gICAgICAgICAgICBfLnRyYW5zZm9ybVR5cGUgPSAnLXdlYmtpdC10cmFuc2Zvcm0nO1xuICAgICAgICAgICAgXy50cmFuc2l0aW9uVHlwZSA9ICd3ZWJraXRUcmFuc2l0aW9uJztcbiAgICAgICAgICAgIGlmIChib2R5U3R5bGUucGVyc3BlY3RpdmVQcm9wZXJ0eSA9PT0gdW5kZWZpbmVkICYmIGJvZHlTdHlsZS53ZWJraXRQZXJzcGVjdGl2ZSA9PT0gdW5kZWZpbmVkKSBfLmFuaW1UeXBlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJvZHlTdHlsZS5tc1RyYW5zZm9ybSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBfLmFuaW1UeXBlID0gJ21zVHJhbnNmb3JtJztcbiAgICAgICAgICAgIF8udHJhbnNmb3JtVHlwZSA9ICctbXMtdHJhbnNmb3JtJztcbiAgICAgICAgICAgIF8udHJhbnNpdGlvblR5cGUgPSAnbXNUcmFuc2l0aW9uJztcbiAgICAgICAgICAgIGlmIChib2R5U3R5bGUubXNUcmFuc2Zvcm0gPT09IHVuZGVmaW5lZCkgXy5hbmltVHlwZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChib2R5U3R5bGUudHJhbnNmb3JtICE9PSB1bmRlZmluZWQgJiYgXy5hbmltVHlwZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIF8uYW5pbVR5cGUgPSAndHJhbnNmb3JtJztcbiAgICAgICAgICAgIF8udHJhbnNmb3JtVHlwZSA9ICd0cmFuc2Zvcm0nO1xuICAgICAgICAgICAgXy50cmFuc2l0aW9uVHlwZSA9ICd0cmFuc2l0aW9uJztcbiAgICAgICAgfVxuICAgICAgICBfLnRyYW5zZm9ybXNFbmFibGVkID0gXy5vcHRpb25zLnVzZVRyYW5zZm9ybSAmJiAoXy5hbmltVHlwZSAhPT0gbnVsbCAmJiBfLmFuaW1UeXBlICE9PSBmYWxzZSk7XG4gICAgfTtcblxuXG4gICAgU2xpY2sucHJvdG90eXBlLnNldFNsaWRlQ2xhc3NlcyA9IGZ1bmN0aW9uKGluZGV4KSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzLFxuICAgICAgICAgICAgY2VudGVyT2Zmc2V0LCBhbGxTbGlkZXMsIGluZGV4T2Zmc2V0LCByZW1haW5kZXI7XG5cbiAgICAgICAgYWxsU2xpZGVzID0gXy4kc2xpZGVyXG4gICAgICAgICAgICAuZmluZCgnLnNsaWNrLXNsaWRlJylcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnc2xpY2stYWN0aXZlIHNsaWNrLWNlbnRlciBzbGljay1jdXJyZW50JylcbiAgICAgICAgICAgIC5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG5cbiAgICAgICAgXy4kc2xpZGVzXG4gICAgICAgICAgICAuZXEoaW5kZXgpXG4gICAgICAgICAgICAuYWRkQ2xhc3MoJ3NsaWNrLWN1cnJlbnQnKTtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmNlbnRlck1vZGUgPT09IHRydWUpIHtcblxuICAgICAgICAgICAgY2VudGVyT2Zmc2V0ID0gTWF0aC5mbG9vcihfLm9wdGlvbnMuc2xpZGVzVG9TaG93IC8gMik7XG5cbiAgICAgICAgICAgIGlmIChfLm9wdGlvbnMuaW5maW5pdGUgPT09IHRydWUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSBjZW50ZXJPZmZzZXQgJiYgaW5kZXggPD0gKF8uc2xpZGVDb3VudCAtIDEpIC0gY2VudGVyT2Zmc2V0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgXy4kc2xpZGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoaW5kZXggLSBjZW50ZXJPZmZzZXQsIGluZGV4ICsgY2VudGVyT2Zmc2V0ICsgMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnc2xpY2stYWN0aXZlJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBpbmRleE9mZnNldCA9IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgKyBpbmRleDtcbiAgICAgICAgICAgICAgICAgICAgYWxsU2xpZGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoaW5kZXhPZmZzZXQgLSBjZW50ZXJPZmZzZXQgKyAxLCBpbmRleE9mZnNldCArIGNlbnRlck9mZnNldCArIDIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3NsaWNrLWFjdGl2ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGFsbFNsaWRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgLmVxKGFsbFNsaWRlcy5sZW5ndGggLSAxIC0gXy5vcHRpb25zLnNsaWRlc1RvU2hvdylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnc2xpY2stY2VudGVyJyk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09PSBfLnNsaWRlQ291bnQgLSAxKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYWxsU2xpZGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXEoXy5vcHRpb25zLnNsaWRlc1RvU2hvdylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnc2xpY2stY2VudGVyJyk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgXy4kc2xpZGVzXG4gICAgICAgICAgICAgICAgLmVxKGluZGV4KVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnc2xpY2stY2VudGVyJyk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgaWYgKGluZGV4ID49IDAgJiYgaW5kZXggPD0gKF8uc2xpZGVDb3VudCAtIF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpKSB7XG5cbiAgICAgICAgICAgICAgICBfLiRzbGlkZXNcbiAgICAgICAgICAgICAgICAgICAgLnNsaWNlKGluZGV4LCBpbmRleCArIF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnc2xpY2stYWN0aXZlJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxsU2xpZGVzLmxlbmd0aCA8PSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSB7XG5cbiAgICAgICAgICAgICAgICBhbGxTbGlkZXNcbiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdzbGljay1hY3RpdmUnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHJlbWFpbmRlciA9IF8uc2xpZGVDb3VudCAlIF8ub3B0aW9ucy5zbGlkZXNUb1Nob3c7XG4gICAgICAgICAgICAgICAgaW5kZXhPZmZzZXQgPSBfLm9wdGlvbnMuaW5maW5pdGUgPT09IHRydWUgPyBfLm9wdGlvbnMuc2xpZGVzVG9TaG93ICsgaW5kZXggOiBpbmRleDtcblxuICAgICAgICAgICAgICAgIGlmIChfLm9wdGlvbnMuc2xpZGVzVG9TaG93ID09IF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCAmJiAoXy5zbGlkZUNvdW50IC0gaW5kZXgpIDwgXy5vcHRpb25zLnNsaWRlc1RvU2hvdykge1xuXG4gICAgICAgICAgICAgICAgICAgIGFsbFNsaWRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgLnNsaWNlKGluZGV4T2Zmc2V0IC0gKF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgLSByZW1haW5kZXIpLCBpbmRleE9mZnNldCArIHJlbWFpbmRlcilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnc2xpY2stYWN0aXZlJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBhbGxTbGlkZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zbGljZShpbmRleE9mZnNldCwgaW5kZXhPZmZzZXQgKyBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdzbGljay1hY3RpdmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy5sYXp5TG9hZCA9PT0gJ29uZGVtYW5kJykge1xuICAgICAgICAgICAgXy5sYXp5TG9hZCgpO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnNldHVwSW5maW5pdGUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXMsXG4gICAgICAgICAgICBpLCBzbGlkZUluZGV4LCBpbmZpbml0ZUNvdW50O1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuZmFkZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgXy5vcHRpb25zLmNlbnRlck1vZGUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuaW5maW5pdGUgPT09IHRydWUgJiYgXy5vcHRpb25zLmZhZGUgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICAgIHNsaWRlSW5kZXggPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoXy5zbGlkZUNvdW50ID4gXy5vcHRpb25zLnNsaWRlc1RvU2hvdykge1xuXG4gICAgICAgICAgICAgICAgaWYgKF8ub3B0aW9ucy5jZW50ZXJNb2RlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZmluaXRlQ291bnQgPSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93ICsgMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpbmZpbml0ZUNvdW50ID0gXy5vcHRpb25zLnNsaWRlc1RvU2hvdztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBfLnNsaWRlQ291bnQ7IGkgPiAoXy5zbGlkZUNvdW50IC1cbiAgICAgICAgICAgICAgICAgICAgICAgIGluZmluaXRlQ291bnQpOyBpIC09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVJbmRleCA9IGkgLSAxO1xuICAgICAgICAgICAgICAgICAgICAkKF8uJHNsaWRlc1tzbGlkZUluZGV4XSkuY2xvbmUodHJ1ZSkuYXR0cignaWQnLCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkYXRhLXNsaWNrLWluZGV4Jywgc2xpZGVJbmRleCAtIF8uc2xpZGVDb3VudClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wcmVwZW5kVG8oXy4kc2xpZGVUcmFjaykuYWRkQ2xhc3MoJ3NsaWNrLWNsb25lZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaW5maW5pdGVDb3VudDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlSW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgICAkKF8uJHNsaWRlc1tzbGlkZUluZGV4XSkuY2xvbmUodHJ1ZSkuYXR0cignaWQnLCAnJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkYXRhLXNsaWNrLWluZGV4Jywgc2xpZGVJbmRleCArIF8uc2xpZGVDb3VudClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhfLiRzbGlkZVRyYWNrKS5hZGRDbGFzcygnc2xpY2stY2xvbmVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF8uJHNsaWRlVHJhY2suZmluZCgnLnNsaWNrLWNsb25lZCcpLmZpbmQoJ1tpZF0nKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2lkJywgJycpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5pbnRlcnJ1cHQgPSBmdW5jdGlvbiggdG9nZ2xlICkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiggIXRvZ2dsZSApIHtcbiAgICAgICAgICAgIF8uYXV0b1BsYXkoKTtcbiAgICAgICAgfVxuICAgICAgICBfLmludGVycnVwdGVkID0gdG9nZ2xlO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5zZWxlY3RIYW5kbGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgdmFyIHRhcmdldEVsZW1lbnQgPVxuICAgICAgICAgICAgJChldmVudC50YXJnZXQpLmlzKCcuc2xpY2stc2xpZGUnKSA/XG4gICAgICAgICAgICAgICAgJChldmVudC50YXJnZXQpIDpcbiAgICAgICAgICAgICAgICAkKGV2ZW50LnRhcmdldCkucGFyZW50cygnLnNsaWNrLXNsaWRlJyk7XG5cbiAgICAgICAgdmFyIGluZGV4ID0gcGFyc2VJbnQodGFyZ2V0RWxlbWVudC5hdHRyKCdkYXRhLXNsaWNrLWluZGV4JykpO1xuXG4gICAgICAgIGlmICghaW5kZXgpIGluZGV4ID0gMDtcblxuICAgICAgICBpZiAoXy5zbGlkZUNvdW50IDw9IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpIHtcblxuICAgICAgICAgICAgXy5zZXRTbGlkZUNsYXNzZXMoaW5kZXgpO1xuICAgICAgICAgICAgXy5hc05hdkZvcihpbmRleCk7XG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgfVxuXG4gICAgICAgIF8uc2xpZGVIYW5kbGVyKGluZGV4KTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuc2xpZGVIYW5kbGVyID0gZnVuY3Rpb24oaW5kZXgsIHN5bmMsIGRvbnRBbmltYXRlKSB7XG5cbiAgICAgICAgdmFyIHRhcmdldFNsaWRlLCBhbmltU2xpZGUsIG9sZFNsaWRlLCBzbGlkZUxlZnQsIHRhcmdldExlZnQgPSBudWxsLFxuICAgICAgICAgICAgXyA9IHRoaXMsIG5hdlRhcmdldDtcblxuICAgICAgICBzeW5jID0gc3luYyB8fCBmYWxzZTtcblxuICAgICAgICBpZiAoXy5hbmltYXRpbmcgPT09IHRydWUgJiYgXy5vcHRpb25zLndhaXRGb3JBbmltYXRlID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXy5vcHRpb25zLmZhZGUgPT09IHRydWUgJiYgXy5jdXJyZW50U2xpZGUgPT09IGluZGV4KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXy5zbGlkZUNvdW50IDw9IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzeW5jID09PSBmYWxzZSkge1xuICAgICAgICAgICAgXy5hc05hdkZvcihpbmRleCk7XG4gICAgICAgIH1cblxuICAgICAgICB0YXJnZXRTbGlkZSA9IGluZGV4O1xuICAgICAgICB0YXJnZXRMZWZ0ID0gXy5nZXRMZWZ0KHRhcmdldFNsaWRlKTtcbiAgICAgICAgc2xpZGVMZWZ0ID0gXy5nZXRMZWZ0KF8uY3VycmVudFNsaWRlKTtcblxuICAgICAgICBfLmN1cnJlbnRMZWZ0ID0gXy5zd2lwZUxlZnQgPT09IG51bGwgPyBzbGlkZUxlZnQgOiBfLnN3aXBlTGVmdDtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmluZmluaXRlID09PSBmYWxzZSAmJiBfLm9wdGlvbnMuY2VudGVyTW9kZSA9PT0gZmFsc2UgJiYgKGluZGV4IDwgMCB8fCBpbmRleCA+IF8uZ2V0RG90Q291bnQoKSAqIF8ub3B0aW9ucy5zbGlkZXNUb1Njcm9sbCkpIHtcbiAgICAgICAgICAgIGlmIChfLm9wdGlvbnMuZmFkZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRTbGlkZSA9IF8uY3VycmVudFNsaWRlO1xuICAgICAgICAgICAgICAgIGlmIChkb250QW5pbWF0ZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBfLmFuaW1hdGVTbGlkZShzbGlkZUxlZnQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5wb3N0U2xpZGUodGFyZ2V0U2xpZGUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfLnBvc3RTbGlkZSh0YXJnZXRTbGlkZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2UgaWYgKF8ub3B0aW9ucy5pbmZpbml0ZSA9PT0gZmFsc2UgJiYgXy5vcHRpb25zLmNlbnRlck1vZGUgPT09IHRydWUgJiYgKGluZGV4IDwgMCB8fCBpbmRleCA+IChfLnNsaWRlQ291bnQgLSBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGwpKSkge1xuICAgICAgICAgICAgaWYgKF8ub3B0aW9ucy5mYWRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRhcmdldFNsaWRlID0gXy5jdXJyZW50U2xpZGU7XG4gICAgICAgICAgICAgICAgaWYgKGRvbnRBbmltYXRlICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIF8uYW5pbWF0ZVNsaWRlKHNsaWRlTGVmdCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLnBvc3RTbGlkZSh0YXJnZXRTbGlkZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF8ucG9zdFNsaWRlKHRhcmdldFNsaWRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIF8ub3B0aW9ucy5hdXRvcGxheSApIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoXy5hdXRvUGxheVRpbWVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0YXJnZXRTbGlkZSA8IDApIHtcbiAgICAgICAgICAgIGlmIChfLnNsaWRlQ291bnQgJSBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGwgIT09IDApIHtcbiAgICAgICAgICAgICAgICBhbmltU2xpZGUgPSBfLnNsaWRlQ291bnQgLSAoXy5zbGlkZUNvdW50ICUgXy5vcHRpb25zLnNsaWRlc1RvU2Nyb2xsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYW5pbVNsaWRlID0gXy5zbGlkZUNvdW50ICsgdGFyZ2V0U2xpZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0U2xpZGUgPj0gXy5zbGlkZUNvdW50KSB7XG4gICAgICAgICAgICBpZiAoXy5zbGlkZUNvdW50ICUgXy5vcHRpb25zLnNsaWRlc1RvU2Nyb2xsICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgYW5pbVNsaWRlID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYW5pbVNsaWRlID0gdGFyZ2V0U2xpZGUgLSBfLnNsaWRlQ291bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhbmltU2xpZGUgPSB0YXJnZXRTbGlkZTtcbiAgICAgICAgfVxuXG4gICAgICAgIF8uYW5pbWF0aW5nID0gdHJ1ZTtcblxuICAgICAgICBfLiRzbGlkZXIudHJpZ2dlcignYmVmb3JlQ2hhbmdlJywgW18sIF8uY3VycmVudFNsaWRlLCBhbmltU2xpZGVdKTtcblxuICAgICAgICBvbGRTbGlkZSA9IF8uY3VycmVudFNsaWRlO1xuICAgICAgICBfLmN1cnJlbnRTbGlkZSA9IGFuaW1TbGlkZTtcblxuICAgICAgICBfLnNldFNsaWRlQ2xhc3NlcyhfLmN1cnJlbnRTbGlkZSk7XG5cbiAgICAgICAgaWYgKCBfLm9wdGlvbnMuYXNOYXZGb3IgKSB7XG5cbiAgICAgICAgICAgIG5hdlRhcmdldCA9IF8uZ2V0TmF2VGFyZ2V0KCk7XG4gICAgICAgICAgICBuYXZUYXJnZXQgPSBuYXZUYXJnZXQuc2xpY2soJ2dldFNsaWNrJyk7XG5cbiAgICAgICAgICAgIGlmICggbmF2VGFyZ2V0LnNsaWRlQ291bnQgPD0gbmF2VGFyZ2V0Lm9wdGlvbnMuc2xpZGVzVG9TaG93ICkge1xuICAgICAgICAgICAgICAgIG5hdlRhcmdldC5zZXRTbGlkZUNsYXNzZXMoXy5jdXJyZW50U2xpZGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgICAgICBfLnVwZGF0ZURvdHMoKTtcbiAgICAgICAgXy51cGRhdGVBcnJvd3MoKTtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmZhZGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGlmIChkb250QW5pbWF0ZSAhPT0gdHJ1ZSkge1xuXG4gICAgICAgICAgICAgICAgXy5mYWRlU2xpZGVPdXQob2xkU2xpZGUpO1xuXG4gICAgICAgICAgICAgICAgXy5mYWRlU2xpZGUoYW5pbVNsaWRlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgXy5wb3N0U2xpZGUoYW5pbVNsaWRlKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBfLnBvc3RTbGlkZShhbmltU2xpZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXy5hbmltYXRlSGVpZ2h0KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZG9udEFuaW1hdGUgIT09IHRydWUpIHtcbiAgICAgICAgICAgIF8uYW5pbWF0ZVNsaWRlKHRhcmdldExlZnQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF8ucG9zdFNsaWRlKGFuaW1TbGlkZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF8ucG9zdFNsaWRlKGFuaW1TbGlkZSk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuc3RhcnRMb2FkID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIF8gPSB0aGlzO1xuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuYXJyb3dzID09PSB0cnVlICYmIF8uc2xpZGVDb3VudCA+IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cpIHtcblxuICAgICAgICAgICAgXy4kcHJldkFycm93LmhpZGUoKTtcbiAgICAgICAgICAgIF8uJG5leHRBcnJvdy5oaWRlKCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLm9wdGlvbnMuZG90cyA9PT0gdHJ1ZSAmJiBfLnNsaWRlQ291bnQgPiBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSB7XG5cbiAgICAgICAgICAgIF8uJGRvdHMuaGlkZSgpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBfLiRzbGlkZXIuYWRkQ2xhc3MoJ3NsaWNrLWxvYWRpbmcnKTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuc3dpcGVEaXJlY3Rpb24gPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgeERpc3QsIHlEaXN0LCByLCBzd2lwZUFuZ2xlLCBfID0gdGhpcztcblxuICAgICAgICB4RGlzdCA9IF8udG91Y2hPYmplY3Quc3RhcnRYIC0gXy50b3VjaE9iamVjdC5jdXJYO1xuICAgICAgICB5RGlzdCA9IF8udG91Y2hPYmplY3Quc3RhcnRZIC0gXy50b3VjaE9iamVjdC5jdXJZO1xuICAgICAgICByID0gTWF0aC5hdGFuMih5RGlzdCwgeERpc3QpO1xuXG4gICAgICAgIHN3aXBlQW5nbGUgPSBNYXRoLnJvdW5kKHIgKiAxODAgLyBNYXRoLlBJKTtcbiAgICAgICAgaWYgKHN3aXBlQW5nbGUgPCAwKSB7XG4gICAgICAgICAgICBzd2lwZUFuZ2xlID0gMzYwIC0gTWF0aC5hYnMoc3dpcGVBbmdsZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKHN3aXBlQW5nbGUgPD0gNDUpICYmIChzd2lwZUFuZ2xlID49IDApKSB7XG4gICAgICAgICAgICByZXR1cm4gKF8ub3B0aW9ucy5ydGwgPT09IGZhbHNlID8gJ2xlZnQnIDogJ3JpZ2h0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChzd2lwZUFuZ2xlIDw9IDM2MCkgJiYgKHN3aXBlQW5nbGUgPj0gMzE1KSkge1xuICAgICAgICAgICAgcmV0dXJuIChfLm9wdGlvbnMucnRsID09PSBmYWxzZSA/ICdsZWZ0JyA6ICdyaWdodCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoc3dpcGVBbmdsZSA+PSAxMzUpICYmIChzd2lwZUFuZ2xlIDw9IDIyNSkpIHtcbiAgICAgICAgICAgIHJldHVybiAoXy5vcHRpb25zLnJ0bCA9PT0gZmFsc2UgPyAncmlnaHQnIDogJ2xlZnQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXy5vcHRpb25zLnZlcnRpY2FsU3dpcGluZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKChzd2lwZUFuZ2xlID49IDM1KSAmJiAoc3dpcGVBbmdsZSA8PSAxMzUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdkb3duJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICd1cCc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJ3ZlcnRpY2FsJztcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuc3dpcGVFbmQgPSBmdW5jdGlvbihldmVudCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIHNsaWRlQ291bnQsXG4gICAgICAgICAgICBkaXJlY3Rpb247XG5cbiAgICAgICAgXy5kcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICBfLmludGVycnVwdGVkID0gZmFsc2U7XG4gICAgICAgIF8uc2hvdWxkQ2xpY2sgPSAoIF8udG91Y2hPYmplY3Quc3dpcGVMZW5ndGggPiAxMCApID8gZmFsc2UgOiB0cnVlO1xuXG4gICAgICAgIGlmICggXy50b3VjaE9iamVjdC5jdXJYID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIF8udG91Y2hPYmplY3QuZWRnZUhpdCA9PT0gdHJ1ZSApIHtcbiAgICAgICAgICAgIF8uJHNsaWRlci50cmlnZ2VyKCdlZGdlJywgW18sIF8uc3dpcGVEaXJlY3Rpb24oKSBdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggXy50b3VjaE9iamVjdC5zd2lwZUxlbmd0aCA+PSBfLnRvdWNoT2JqZWN0Lm1pblN3aXBlICkge1xuXG4gICAgICAgICAgICBkaXJlY3Rpb24gPSBfLnN3aXBlRGlyZWN0aW9uKCk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAoIGRpcmVjdGlvbiApIHtcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Rvd24nOlxuXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlQ291bnQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgXy5vcHRpb25zLnN3aXBlVG9TbGlkZSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5jaGVja05hdmlnYWJsZSggXy5jdXJyZW50U2xpZGUgKyBfLmdldFNsaWRlQ291bnQoKSApIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmN1cnJlbnRTbGlkZSArIF8uZ2V0U2xpZGVDb3VudCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIF8uY3VycmVudERpcmVjdGlvbiA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgY2FzZSAndXAnOlxuXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlQ291bnQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgXy5vcHRpb25zLnN3aXBlVG9TbGlkZSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5jaGVja05hdmlnYWJsZSggXy5jdXJyZW50U2xpZGUgLSBfLmdldFNsaWRlQ291bnQoKSApIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmN1cnJlbnRTbGlkZSAtIF8uZ2V0U2xpZGVDb3VudCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIF8uY3VycmVudERpcmVjdGlvbiA9IDE7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuXG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoIGRpcmVjdGlvbiAhPSAndmVydGljYWwnICkge1xuXG4gICAgICAgICAgICAgICAgXy5zbGlkZUhhbmRsZXIoIHNsaWRlQ291bnQgKTtcbiAgICAgICAgICAgICAgICBfLnRvdWNoT2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgXy4kc2xpZGVyLnRyaWdnZXIoJ3N3aXBlJywgW18sIGRpcmVjdGlvbiBdKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGlmICggXy50b3VjaE9iamVjdC5zdGFydFggIT09IF8udG91Y2hPYmplY3QuY3VyWCApIHtcblxuICAgICAgICAgICAgICAgIF8uc2xpZGVIYW5kbGVyKCBfLmN1cnJlbnRTbGlkZSApO1xuICAgICAgICAgICAgICAgIF8udG91Y2hPYmplY3QgPSB7fTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUuc3dpcGVIYW5kbGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKChfLm9wdGlvbnMuc3dpcGUgPT09IGZhbHNlKSB8fCAoJ29udG91Y2hlbmQnIGluIGRvY3VtZW50ICYmIF8ub3B0aW9ucy5zd2lwZSA9PT0gZmFsc2UpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAoXy5vcHRpb25zLmRyYWdnYWJsZSA9PT0gZmFsc2UgJiYgZXZlbnQudHlwZS5pbmRleE9mKCdtb3VzZScpICE9PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgXy50b3VjaE9iamVjdC5maW5nZXJDb3VudCA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQgJiYgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzICE9PSB1bmRlZmluZWQgP1xuICAgICAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzLmxlbmd0aCA6IDE7XG5cbiAgICAgICAgXy50b3VjaE9iamVjdC5taW5Td2lwZSA9IF8ubGlzdFdpZHRoIC8gXy5vcHRpb25zXG4gICAgICAgICAgICAudG91Y2hUaHJlc2hvbGQ7XG5cbiAgICAgICAgaWYgKF8ub3B0aW9ucy52ZXJ0aWNhbFN3aXBpbmcgPT09IHRydWUpIHtcbiAgICAgICAgICAgIF8udG91Y2hPYmplY3QubWluU3dpcGUgPSBfLmxpc3RIZWlnaHQgLyBfLm9wdGlvbnNcbiAgICAgICAgICAgICAgICAudG91Y2hUaHJlc2hvbGQ7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKGV2ZW50LmRhdGEuYWN0aW9uKSB7XG5cbiAgICAgICAgICAgIGNhc2UgJ3N0YXJ0JzpcbiAgICAgICAgICAgICAgICBfLnN3aXBlU3RhcnQoZXZlbnQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdtb3ZlJzpcbiAgICAgICAgICAgICAgICBfLnN3aXBlTW92ZShldmVudCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2VuZCc6XG4gICAgICAgICAgICAgICAgXy5zd2lwZUVuZChldmVudCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5zd2lwZU1vdmUgPSBmdW5jdGlvbihldmVudCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIGVkZ2VXYXNIaXQgPSBmYWxzZSxcbiAgICAgICAgICAgIGN1ckxlZnQsIHN3aXBlRGlyZWN0aW9uLCBzd2lwZUxlbmd0aCwgcG9zaXRpb25PZmZzZXQsIHRvdWNoZXM7XG5cbiAgICAgICAgdG91Y2hlcyA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQgIT09IHVuZGVmaW5lZCA/IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlcyA6IG51bGw7XG5cbiAgICAgICAgaWYgKCFfLmRyYWdnaW5nIHx8IHRvdWNoZXMgJiYgdG91Y2hlcy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGN1ckxlZnQgPSBfLmdldExlZnQoXy5jdXJyZW50U2xpZGUpO1xuXG4gICAgICAgIF8udG91Y2hPYmplY3QuY3VyWCA9IHRvdWNoZXMgIT09IHVuZGVmaW5lZCA/IHRvdWNoZXNbMF0ucGFnZVggOiBldmVudC5jbGllbnRYO1xuICAgICAgICBfLnRvdWNoT2JqZWN0LmN1clkgPSB0b3VjaGVzICE9PSB1bmRlZmluZWQgPyB0b3VjaGVzWzBdLnBhZ2VZIDogZXZlbnQuY2xpZW50WTtcblxuICAgICAgICBfLnRvdWNoT2JqZWN0LnN3aXBlTGVuZ3RoID0gTWF0aC5yb3VuZChNYXRoLnNxcnQoXG4gICAgICAgICAgICBNYXRoLnBvdyhfLnRvdWNoT2JqZWN0LmN1clggLSBfLnRvdWNoT2JqZWN0LnN0YXJ0WCwgMikpKTtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLnZlcnRpY2FsU3dpcGluZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgXy50b3VjaE9iamVjdC5zd2lwZUxlbmd0aCA9IE1hdGgucm91bmQoTWF0aC5zcXJ0KFxuICAgICAgICAgICAgICAgIE1hdGgucG93KF8udG91Y2hPYmplY3QuY3VyWSAtIF8udG91Y2hPYmplY3Quc3RhcnRZLCAyKSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpcGVEaXJlY3Rpb24gPSBfLnN3aXBlRGlyZWN0aW9uKCk7XG5cbiAgICAgICAgaWYgKHN3aXBlRGlyZWN0aW9uID09PSAndmVydGljYWwnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXZlbnQub3JpZ2luYWxFdmVudCAhPT0gdW5kZWZpbmVkICYmIF8udG91Y2hPYmplY3Quc3dpcGVMZW5ndGggPiA0KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcG9zaXRpb25PZmZzZXQgPSAoXy5vcHRpb25zLnJ0bCA9PT0gZmFsc2UgPyAxIDogLTEpICogKF8udG91Y2hPYmplY3QuY3VyWCA+IF8udG91Y2hPYmplY3Quc3RhcnRYID8gMSA6IC0xKTtcbiAgICAgICAgaWYgKF8ub3B0aW9ucy52ZXJ0aWNhbFN3aXBpbmcgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHBvc2l0aW9uT2Zmc2V0ID0gXy50b3VjaE9iamVjdC5jdXJZID4gXy50b3VjaE9iamVjdC5zdGFydFkgPyAxIDogLTE7XG4gICAgICAgIH1cblxuXG4gICAgICAgIHN3aXBlTGVuZ3RoID0gXy50b3VjaE9iamVjdC5zd2lwZUxlbmd0aDtcblxuICAgICAgICBfLnRvdWNoT2JqZWN0LmVkZ2VIaXQgPSBmYWxzZTtcblxuICAgICAgICBpZiAoXy5vcHRpb25zLmluZmluaXRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgaWYgKChfLmN1cnJlbnRTbGlkZSA9PT0gMCAmJiBzd2lwZURpcmVjdGlvbiA9PT0gJ3JpZ2h0JykgfHwgKF8uY3VycmVudFNsaWRlID49IF8uZ2V0RG90Q291bnQoKSAmJiBzd2lwZURpcmVjdGlvbiA9PT0gJ2xlZnQnKSkge1xuICAgICAgICAgICAgICAgIHN3aXBlTGVuZ3RoID0gXy50b3VjaE9iamVjdC5zd2lwZUxlbmd0aCAqIF8ub3B0aW9ucy5lZGdlRnJpY3Rpb247XG4gICAgICAgICAgICAgICAgXy50b3VjaE9iamVjdC5lZGdlSGl0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLm9wdGlvbnMudmVydGljYWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBfLnN3aXBlTGVmdCA9IGN1ckxlZnQgKyBzd2lwZUxlbmd0aCAqIHBvc2l0aW9uT2Zmc2V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgXy5zd2lwZUxlZnQgPSBjdXJMZWZ0ICsgKHN3aXBlTGVuZ3RoICogKF8uJGxpc3QuaGVpZ2h0KCkgLyBfLmxpc3RXaWR0aCkpICogcG9zaXRpb25PZmZzZXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF8ub3B0aW9ucy52ZXJ0aWNhbFN3aXBpbmcgPT09IHRydWUpIHtcbiAgICAgICAgICAgIF8uc3dpcGVMZWZ0ID0gY3VyTGVmdCArIHN3aXBlTGVuZ3RoICogcG9zaXRpb25PZmZzZXQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXy5vcHRpb25zLmZhZGUgPT09IHRydWUgfHwgXy5vcHRpb25zLnRvdWNoTW92ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLmFuaW1hdGluZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgXy5zd2lwZUxlZnQgPSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgXy5zZXRDU1MoXy5zd2lwZUxlZnQpO1xuXG4gICAgfTtcblxuICAgIFNsaWNrLnByb3RvdHlwZS5zd2lwZVN0YXJ0ID0gZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXMsXG4gICAgICAgICAgICB0b3VjaGVzO1xuXG4gICAgICAgIF8uaW50ZXJydXB0ZWQgPSB0cnVlO1xuXG4gICAgICAgIGlmIChfLnRvdWNoT2JqZWN0LmZpbmdlckNvdW50ICE9PSAxIHx8IF8uc2xpZGVDb3VudCA8PSBfLm9wdGlvbnMuc2xpZGVzVG9TaG93KSB7XG4gICAgICAgICAgICBfLnRvdWNoT2JqZWN0ID0ge307XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXZlbnQub3JpZ2luYWxFdmVudCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0b3VjaGVzID0gZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgXy50b3VjaE9iamVjdC5zdGFydFggPSBfLnRvdWNoT2JqZWN0LmN1clggPSB0b3VjaGVzICE9PSB1bmRlZmluZWQgPyB0b3VjaGVzLnBhZ2VYIDogZXZlbnQuY2xpZW50WDtcbiAgICAgICAgXy50b3VjaE9iamVjdC5zdGFydFkgPSBfLnRvdWNoT2JqZWN0LmN1clkgPSB0b3VjaGVzICE9PSB1bmRlZmluZWQgPyB0b3VjaGVzLnBhZ2VZIDogZXZlbnQuY2xpZW50WTtcblxuICAgICAgICBfLmRyYWdnaW5nID0gdHJ1ZTtcblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUudW5maWx0ZXJTbGlkZXMgPSBTbGljay5wcm90b3R5cGUuc2xpY2tVbmZpbHRlciA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiAoXy4kc2xpZGVzQ2FjaGUgIT09IG51bGwpIHtcblxuICAgICAgICAgICAgXy51bmxvYWQoKTtcblxuICAgICAgICAgICAgXy4kc2xpZGVUcmFjay5jaGlsZHJlbih0aGlzLm9wdGlvbnMuc2xpZGUpLmRldGFjaCgpO1xuXG4gICAgICAgICAgICBfLiRzbGlkZXNDYWNoZS5hcHBlbmRUbyhfLiRzbGlkZVRyYWNrKTtcblxuICAgICAgICAgICAgXy5yZWluaXQoKTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnVubG9hZCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICAkKCcuc2xpY2stY2xvbmVkJywgXy4kc2xpZGVyKS5yZW1vdmUoKTtcblxuICAgICAgICBpZiAoXy4kZG90cykge1xuICAgICAgICAgICAgXy4kZG90cy5yZW1vdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLiRwcmV2QXJyb3cgJiYgXy5odG1sRXhwci50ZXN0KF8ub3B0aW9ucy5wcmV2QXJyb3cpKSB7XG4gICAgICAgICAgICBfLiRwcmV2QXJyb3cucmVtb3ZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXy4kbmV4dEFycm93ICYmIF8uaHRtbEV4cHIudGVzdChfLm9wdGlvbnMubmV4dEFycm93KSkge1xuICAgICAgICAgICAgXy4kbmV4dEFycm93LnJlbW92ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgXy4kc2xpZGVzXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3NsaWNrLXNsaWRlIHNsaWNrLWFjdGl2ZSBzbGljay12aXNpYmxlIHNsaWNrLWN1cnJlbnQnKVxuICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKVxuICAgICAgICAgICAgLmNzcygnd2lkdGgnLCAnJyk7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnVuc2xpY2sgPSBmdW5jdGlvbihmcm9tQnJlYWtwb2ludCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcbiAgICAgICAgXy4kc2xpZGVyLnRyaWdnZXIoJ3Vuc2xpY2snLCBbXywgZnJvbUJyZWFrcG9pbnRdKTtcbiAgICAgICAgXy5kZXN0cm95KCk7XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnVwZGF0ZUFycm93cyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcyxcbiAgICAgICAgICAgIGNlbnRlck9mZnNldDtcblxuICAgICAgICBjZW50ZXJPZmZzZXQgPSBNYXRoLmZsb29yKF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgLyAyKTtcblxuICAgICAgICBpZiAoIF8ub3B0aW9ucy5hcnJvd3MgPT09IHRydWUgJiZcbiAgICAgICAgICAgIF8uc2xpZGVDb3VudCA+IF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgJiZcbiAgICAgICAgICAgICFfLm9wdGlvbnMuaW5maW5pdGUgKSB7XG5cbiAgICAgICAgICAgIF8uJHByZXZBcnJvdy5yZW1vdmVDbGFzcygnc2xpY2stZGlzYWJsZWQnKS5hdHRyKCdhcmlhLWRpc2FibGVkJywgJ2ZhbHNlJyk7XG4gICAgICAgICAgICBfLiRuZXh0QXJyb3cucmVtb3ZlQ2xhc3MoJ3NsaWNrLWRpc2FibGVkJykuYXR0cignYXJpYS1kaXNhYmxlZCcsICdmYWxzZScpO1xuXG4gICAgICAgICAgICBpZiAoXy5jdXJyZW50U2xpZGUgPT09IDApIHtcblxuICAgICAgICAgICAgICAgIF8uJHByZXZBcnJvdy5hZGRDbGFzcygnc2xpY2stZGlzYWJsZWQnKS5hdHRyKCdhcmlhLWRpc2FibGVkJywgJ3RydWUnKTtcbiAgICAgICAgICAgICAgICBfLiRuZXh0QXJyb3cucmVtb3ZlQ2xhc3MoJ3NsaWNrLWRpc2FibGVkJykuYXR0cignYXJpYS1kaXNhYmxlZCcsICdmYWxzZScpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKF8uY3VycmVudFNsaWRlID49IF8uc2xpZGVDb3VudCAtIF8ub3B0aW9ucy5zbGlkZXNUb1Nob3cgJiYgXy5vcHRpb25zLmNlbnRlck1vZGUgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICAgICAgICBfLiRuZXh0QXJyb3cuYWRkQ2xhc3MoJ3NsaWNrLWRpc2FibGVkJykuYXR0cignYXJpYS1kaXNhYmxlZCcsICd0cnVlJyk7XG4gICAgICAgICAgICAgICAgXy4kcHJldkFycm93LnJlbW92ZUNsYXNzKCdzbGljay1kaXNhYmxlZCcpLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCAnZmFsc2UnKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChfLmN1cnJlbnRTbGlkZSA+PSBfLnNsaWRlQ291bnQgLSAxICYmIF8ub3B0aW9ucy5jZW50ZXJNb2RlID09PSB0cnVlKSB7XG5cbiAgICAgICAgICAgICAgICBfLiRuZXh0QXJyb3cuYWRkQ2xhc3MoJ3NsaWNrLWRpc2FibGVkJykuYXR0cignYXJpYS1kaXNhYmxlZCcsICd0cnVlJyk7XG4gICAgICAgICAgICAgICAgXy4kcHJldkFycm93LnJlbW92ZUNsYXNzKCdzbGljay1kaXNhYmxlZCcpLmF0dHIoJ2FyaWEtZGlzYWJsZWQnLCAnZmFsc2UnKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICBTbGljay5wcm90b3R5cGUudXBkYXRlRG90cyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBfID0gdGhpcztcblxuICAgICAgICBpZiAoXy4kZG90cyAhPT0gbnVsbCkge1xuXG4gICAgICAgICAgICBfLiRkb3RzXG4gICAgICAgICAgICAgICAgLmZpbmQoJ2xpJylcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3NsaWNrLWFjdGl2ZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcblxuICAgICAgICAgICAgXy4kZG90c1xuICAgICAgICAgICAgICAgIC5maW5kKCdsaScpXG4gICAgICAgICAgICAgICAgLmVxKE1hdGguZmxvb3IoXy5jdXJyZW50U2xpZGUgLyBfLm9wdGlvbnMuc2xpZGVzVG9TY3JvbGwpKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnc2xpY2stYWN0aXZlJylcbiAgICAgICAgICAgICAgICAuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgU2xpY2sucHJvdG90eXBlLnZpc2liaWxpdHkgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgXyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCBfLm9wdGlvbnMuYXV0b3BsYXkgKSB7XG5cbiAgICAgICAgICAgIGlmICggZG9jdW1lbnRbXy5oaWRkZW5dICkge1xuXG4gICAgICAgICAgICAgICAgXy5pbnRlcnJ1cHRlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBfLmludGVycnVwdGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgJC5mbi5zbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgXyA9IHRoaXMsXG4gICAgICAgICAgICBvcHQgPSBhcmd1bWVudHNbMF0sXG4gICAgICAgICAgICBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICAgICAgICAgIGwgPSBfLmxlbmd0aCxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICByZXQ7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0ID09ICdvYmplY3QnIHx8IHR5cGVvZiBvcHQgPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgX1tpXS5zbGljayA9IG5ldyBTbGljayhfW2ldLCBvcHQpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJldCA9IF9baV0uc2xpY2tbb3B0XS5hcHBseShfW2ldLnNsaWNrLCBhcmdzKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmV0ICE9ICd1bmRlZmluZWQnKSByZXR1cm4gcmV0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfO1xuICAgIH07XG5cbn0pKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS45LjJcblxuLyoqXG4gQGxpY2Vuc2UgU3RpY2t5LWtpdCB2MS4xLjIgfCBXVEZQTCB8IExlYWYgQ29yY29yYW4gMjAxNSB8IGh0dHA6Ly9sZWFmby5uZXRcbiAqL1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgdmFyICQsIHdpbjtcblxuICAgICQgPSB0aGlzLmpRdWVyeSB8fCB3aW5kb3cualF1ZXJ5O1xuXG4gICAgd2luID0gJCh3aW5kb3cpO1xuXG4gICAgJC5mbi5zdGlja19pbl9wYXJlbnQgPSBmdW5jdGlvbihvcHRzKSB7XG4gICAgICAgIHZhciBkb2MsIGVsbSwgZW5hYmxlX2JvdHRvbWluZywgZm4sIGksIGlubmVyX3Njcm9sbGluZywgbGVuLCBtYW51YWxfc3BhY2VyLCBvZmZzZXRfdG9wLCBwYXJlbnRfc2VsZWN0b3IsIHJlY2FsY19ldmVyeSwgc3RpY2t5X2NsYXNzO1xuICAgICAgICBpZiAob3B0cyA9PSBudWxsKSB7XG4gICAgICAgICAgICBvcHRzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgc3RpY2t5X2NsYXNzID0gb3B0cy5zdGlja3lfY2xhc3MsIGlubmVyX3Njcm9sbGluZyA9IG9wdHMuaW5uZXJfc2Nyb2xsaW5nLCByZWNhbGNfZXZlcnkgPSBvcHRzLnJlY2FsY19ldmVyeSwgcGFyZW50X3NlbGVjdG9yID0gb3B0cy5wYXJlbnQsIG9mZnNldF90b3AgPSBvcHRzLm9mZnNldF90b3AsIG1hbnVhbF9zcGFjZXIgPSBvcHRzLnNwYWNlciwgZW5hYmxlX2JvdHRvbWluZyA9IG9wdHMuYm90dG9taW5nO1xuICAgICAgICBpZiAob2Zmc2V0X3RvcCA9PSBudWxsKSB7XG4gICAgICAgICAgICBvZmZzZXRfdG9wID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFyZW50X3NlbGVjdG9yID09IG51bGwpIHtcbiAgICAgICAgICAgIHBhcmVudF9zZWxlY3RvciA9IHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaW5uZXJfc2Nyb2xsaW5nID09IG51bGwpIHtcbiAgICAgICAgICAgIGlubmVyX3Njcm9sbGluZyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0aWNreV9jbGFzcyA9PSBudWxsKSB7XG4gICAgICAgICAgICBzdGlja3lfY2xhc3MgPSBcImlzX3N0dWNrXCI7XG4gICAgICAgIH1cbiAgICAgICAgZG9jID0gJChkb2N1bWVudCk7XG4gICAgICAgIGlmIChlbmFibGVfYm90dG9taW5nID09IG51bGwpIHtcbiAgICAgICAgICAgIGVuYWJsZV9ib3R0b21pbmcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGZuID0gZnVuY3Rpb24oZWxtLCBwYWRkaW5nX2JvdHRvbSwgcGFyZW50X3RvcCwgcGFyZW50X2hlaWdodCwgdG9wLCBoZWlnaHQsIGVsX2Zsb2F0LCBkZXRhY2hlZCkge1xuICAgICAgICAgICAgdmFyIGJvdHRvbWVkLCBkZXRhY2gsIGZpeGVkLCBsYXN0X3BvcywgbGFzdF9zY3JvbGxfaGVpZ2h0LCBvZmZzZXQsIHBhcmVudCwgcmVjYWxjLCByZWNhbGNfYW5kX3RpY2ssIHJlY2FsY19jb3VudGVyLCBzcGFjZXIsIHRpY2s7XG4gICAgICAgICAgICBpZiAoZWxtLmRhdGEoXCJzdGlja3lfa2l0XCIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxtLmRhdGEoXCJzdGlja3lfa2l0XCIsIHRydWUpO1xuICAgICAgICAgICAgbGFzdF9zY3JvbGxfaGVpZ2h0ID0gZG9jLmhlaWdodCgpO1xuICAgICAgICAgICAgcGFyZW50ID0gZWxtLnBhcmVudCgpO1xuICAgICAgICAgICAgaWYgKHBhcmVudF9zZWxlY3RvciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LmNsb3Nlc3QocGFyZW50X3NlbGVjdG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcGFyZW50Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRocm93IFwiZmFpbGVkIHRvIGZpbmQgc3RpY2sgcGFyZW50XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaXhlZCA9IGZhbHNlO1xuICAgICAgICAgICAgYm90dG9tZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHNwYWNlciA9IG1hbnVhbF9zcGFjZXIgIT0gbnVsbCA/IG1hbnVhbF9zcGFjZXIgJiYgZWxtLmNsb3Nlc3QobWFudWFsX3NwYWNlcikgOiAkKFwiPGRpdiAvPlwiKTtcbiAgICAgICAgICAgIGlmIChzcGFjZXIpIHtcbiAgICAgICAgICAgICAgICBzcGFjZXIuY3NzKCdwb3NpdGlvbicsIGVsbS5jc3MoJ3Bvc2l0aW9uJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVjYWxjID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJvcmRlcl90b3AsIHBhZGRpbmdfdG9wLCByZXN0b3JlO1xuICAgICAgICAgICAgICAgIGlmIChkZXRhY2hlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxhc3Rfc2Nyb2xsX2hlaWdodCA9IGRvYy5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICBib3JkZXJfdG9wID0gcGFyc2VJbnQocGFyZW50LmNzcyhcImJvcmRlci10b3Atd2lkdGhcIiksIDEwKTtcbiAgICAgICAgICAgICAgICBwYWRkaW5nX3RvcCA9IHBhcnNlSW50KHBhcmVudC5jc3MoXCJwYWRkaW5nLXRvcFwiKSwgMTApO1xuICAgICAgICAgICAgICAgIHBhZGRpbmdfYm90dG9tID0gcGFyc2VJbnQocGFyZW50LmNzcyhcInBhZGRpbmctYm90dG9tXCIpLCAxMCk7XG4gICAgICAgICAgICAgICAgcGFyZW50X3RvcCA9IHBhcmVudC5vZmZzZXQoKS50b3AgKyBib3JkZXJfdG9wICsgcGFkZGluZ190b3A7XG4gICAgICAgICAgICAgICAgcGFyZW50X2hlaWdodCA9IHBhcmVudC5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICBpZiAoZml4ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZml4ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYm90dG9tZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hbnVhbF9zcGFjZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxtLmluc2VydEFmdGVyKHNwYWNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzcGFjZXIuZGV0YWNoKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxtLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tOiBcIlwiXG4gICAgICAgICAgICAgICAgICAgIH0pLnJlbW92ZUNsYXNzKHN0aWNreV9jbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3RvcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0b3AgPSBlbG0ub2Zmc2V0KCkudG9wIC0gKHBhcnNlSW50KGVsbS5jc3MoXCJtYXJnaW4tdG9wXCIpLCAxMCkgfHwgMCkgLSBvZmZzZXRfdG9wO1xuICAgICAgICAgICAgICAgIGhlaWdodCA9IGVsbS5vdXRlckhlaWdodCh0cnVlKTtcbiAgICAgICAgICAgICAgICBlbF9mbG9hdCA9IGVsbS5jc3MoXCJmbG9hdFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoc3BhY2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYWNlci5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGVsbS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBlbG0uY3NzKFwiZGlzcGxheVwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmVydGljYWwtYWxpZ25cIjogZWxtLmNzcyhcInZlcnRpY2FsLWFsaWduXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJmbG9hdFwiOiBlbF9mbG9hdFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlc3RvcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmVjYWxjKCk7XG4gICAgICAgICAgICBpZiAoaGVpZ2h0ID09PSBwYXJlbnRfaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFzdF9wb3MgPSB2b2lkIDA7XG4gICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXRfdG9wO1xuICAgICAgICAgICAgcmVjYWxjX2NvdW50ZXIgPSByZWNhbGNfZXZlcnk7XG4gICAgICAgICAgICB0aWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNzcywgZGVsdGEsIHJlY2FsY2VkLCBzY3JvbGwsIHdpbGxfYm90dG9tLCB3aW5faGVpZ2h0O1xuICAgICAgICAgICAgICAgIGlmIChkZXRhY2hlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlY2FsY2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKHJlY2FsY19jb3VudGVyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVjYWxjX2NvdW50ZXIgLT0gMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY2FsY19jb3VudGVyIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2FsY19jb3VudGVyID0gcmVjYWxjX2V2ZXJ5O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjYWxjKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWNhbGNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyZWNhbGNlZCAmJiBkb2MuaGVpZ2h0KCkgIT09IGxhc3Rfc2Nyb2xsX2hlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICByZWNhbGMoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVjYWxjZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzY3JvbGwgPSB3aW4uc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICAgICAgaWYgKGxhc3RfcG9zICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsdGEgPSBzY3JvbGwgLSBsYXN0X3BvcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGFzdF9wb3MgPSBzY3JvbGw7XG4gICAgICAgICAgICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbmFibGVfYm90dG9taW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWxsX2JvdHRvbSA9IHNjcm9sbCArIGhlaWdodCArIG9mZnNldCA+IHBhcmVudF9oZWlnaHQgKyBwYXJlbnRfdG9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJvdHRvbWVkICYmICF3aWxsX2JvdHRvbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbWVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxtLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcImZpeGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbTogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50cmlnZ2VyKFwic3RpY2t5X2tpdDp1bmJvdHRvbVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsIDwgdG9wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaXhlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0X3RvcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYW51YWxfc3BhY2VyID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxfZmxvYXQgPT09IFwibGVmdFwiIHx8IGVsX2Zsb2F0ID09PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxtLmluc2VydEFmdGVyKHNwYWNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYWNlci5kZXRhY2goKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNzcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IFwiXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBlbG0uY3NzKGNzcykucmVtb3ZlQ2xhc3Moc3RpY2t5X2NsYXNzKS50cmlnZ2VyKFwic3RpY2t5X2tpdDp1bnN0aWNrXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbm5lcl9zY3JvbGxpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbl9oZWlnaHQgPSB3aW4uaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGVpZ2h0ICsgb2Zmc2V0X3RvcCA+IHdpbl9oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWJvdHRvbWVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCAtPSBkZWx0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gTWF0aC5tYXgod2luX2hlaWdodCAtIGhlaWdodCwgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gTWF0aC5taW4ob2Zmc2V0X3RvcCwgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbG0uY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IG9mZnNldCArIFwicHhcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2Nyb2xsID4gdG9wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaXhlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IFwiZml4ZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IG9mZnNldFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzcy53aWR0aCA9IGVsbS5jc3MoXCJib3gtc2l6aW5nXCIpID09PSBcImJvcmRlci1ib3hcIiA/IGVsbS5vdXRlcldpZHRoKCkgKyBcInB4XCIgOiBlbG0ud2lkdGgoKSArIFwicHhcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsbS5jc3MoY3NzKS5hZGRDbGFzcyhzdGlja3lfY2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hbnVhbF9zcGFjZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsbS5hZnRlcihzcGFjZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbF9mbG9hdCA9PT0gXCJsZWZ0XCIgfHwgZWxfZmxvYXQgPT09IFwicmlnaHRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFjZXIuYXBwZW5kKGVsbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxtLnRyaWdnZXIoXCJzdGlja3lfa2l0OnN0aWNrXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChmaXhlZCAmJiBlbmFibGVfYm90dG9taW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWxsX2JvdHRvbSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWxsX2JvdHRvbSA9IHNjcm9sbCArIGhlaWdodCArIG9mZnNldCA+IHBhcmVudF9oZWlnaHQgKyBwYXJlbnRfdG9wO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghYm90dG9tZWQgJiYgd2lsbF9ib3R0b20pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuY3NzKFwicG9zaXRpb25cIikgPT09IFwic3RhdGljXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IFwicmVsYXRpdmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsbS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tOiBwYWRkaW5nX2JvdHRvbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IFwiYXV0b1wiXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50cmlnZ2VyKFwic3RpY2t5X2tpdDpib3R0b21cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmVjYWxjX2FuZF90aWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmVjYWxjKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRpY2soKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkZXRhY2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkZXRhY2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgd2luLm9mZihcInRvdWNobW92ZVwiLCB0aWNrKTtcbiAgICAgICAgICAgICAgICB3aW4ub2ZmKFwic2Nyb2xsXCIsIHRpY2spO1xuICAgICAgICAgICAgICAgIHdpbi5vZmYoXCJyZXNpemVcIiwgcmVjYWxjX2FuZF90aWNrKTtcbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLm9mZihcInN0aWNreV9raXQ6cmVjYWxjXCIsIHJlY2FsY19hbmRfdGljayk7XG4gICAgICAgICAgICAgICAgZWxtLm9mZihcInN0aWNreV9raXQ6ZGV0YWNoXCIsIGRldGFjaCk7XG4gICAgICAgICAgICAgICAgZWxtLnJlbW92ZURhdGEoXCJzdGlja3lfa2l0XCIpO1xuICAgICAgICAgICAgICAgIGVsbS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgYm90dG9tOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICB0b3A6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiBcIlwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcGFyZW50LnBvc2l0aW9uKFwicG9zaXRpb25cIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYW51YWxfc3BhY2VyID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbF9mbG9hdCA9PT0gXCJsZWZ0XCIgfHwgZWxfZmxvYXQgPT09IFwicmlnaHRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsbS5pbnNlcnRBZnRlcihzcGFjZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2VyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbG0ucmVtb3ZlQ2xhc3Moc3RpY2t5X2NsYXNzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgd2luLm9uKFwidG91Y2htb3ZlXCIsIHRpY2spO1xuICAgICAgICAgICAgd2luLm9uKFwic2Nyb2xsXCIsIHRpY2spO1xuICAgICAgICAgICAgd2luLm9uKFwicmVzaXplXCIsIHJlY2FsY19hbmRfdGljayk7XG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLm9uKFwic3RpY2t5X2tpdDpyZWNhbGNcIiwgcmVjYWxjX2FuZF90aWNrKTtcbiAgICAgICAgICAgIGVsbS5vbihcInN0aWNreV9raXQ6ZGV0YWNoXCIsIGRldGFjaCk7XG4gICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dCh0aWNrLCAwKTtcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gdGhpcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgZWxtID0gdGhpc1tpXTtcbiAgICAgICAgICAgIGZuKCQoZWxtKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxufSkuY2FsbCh0aGlzKTsiLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICoganF1ZXJ5LXNpbXBsZS10ZXh0LXJvdGF0b3IuanMgdjFcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMyBQZXRlIFJvandvbmdzdXJpeWEuXG4gKiBodHRwOi8vd3d3LnRoZXBldGVkZXNpZ24uY29tXG4gKlxuICogQSB2ZXJ5IHNpbXBsZSBhbmQgbGlnaHQgd2VpZ2h0IGpRdWVyeSBwbHVnaW4gdGhhdFxuICogYWxsb3dzIHlvdSB0byByb3RhdGUgbXVsdGlwbGUgdGV4dCB3aXRob3V0IGNoYW5naW5nXG4gKiB0aGUgbGF5b3V0XG4gKiBodHRwczovL2dpdGh1Yi5jb20vcGVhY2hhbmFuci9zaW1wbGUtdGV4dC1yb3RhdG9yXG4gKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG4hZnVuY3Rpb24oJCl7XG5cbiAgICB2YXIgZGVmYXVsdHMgPSB7XG4gICAgICAgIGFuaW1hdGlvbjogXCJkaXNzb2x2ZVwiLFxuICAgICAgICBzZXBhcmF0b3I6IFwiLFwiLFxuICAgICAgICBzcGVlZDogMjAwMFxuICAgIH07XG5cbiAgICAkLmZ4LnN0ZXAudGV4dFNoYWRvd0JsdXIgPSBmdW5jdGlvbihmeCkge1xuICAgICAgICAkKGZ4LmVsZW0pLnByb3AoJ3RleHRTaGFkb3dCbHVyJywgZngubm93KS5jc3Moe3RleHRTaGFkb3c6ICcwIDAgJyArIE1hdGguZmxvb3IoZngubm93KSArICdweCBibGFjayd9KTtcbiAgICB9O1xuXG4gICAgJC5mbi50ZXh0cm90YXRvciA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcyk7XG4gICAgICAgICAgICB2YXIgYXJyYXkgPSBbXTtcbiAgICAgICAgICAgICQuZWFjaChlbC50ZXh0KCkuc3BsaXQoc2V0dGluZ3Muc2VwYXJhdG9yKSwgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGFycmF5LnB1c2godmFsdWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlbC50ZXh0KGFycmF5WzBdKTtcblxuICAgICAgICAgICAgLy8gYW5pbWF0aW9uIG9wdGlvblxuICAgICAgICAgICAgdmFyIHJvdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoc2V0dGluZ3MuYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Rpc3NvbHZlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRTaGFkb3dCbHVyOjIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDUwMCAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gJC5pbkFycmF5KGVsLnRleHQoKSwgYXJyYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKChpbmRleCArIDEpID09IGFycmF5Lmxlbmd0aCkgaW5kZXggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC50ZXh0KGFycmF5W2luZGV4ICsgMV0pLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0U2hhZG93Qmx1cjowLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTAwICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZsaXAnOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZWwuZmluZChcIi5iYWNrXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5odG1sKGVsLmZpbmQoXCIuYmFja1wiKS5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5pdGlhbCA9IGVsLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9ICQuaW5BcnJheShpbml0aWFsLCBhcnJheSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigoaW5kZXggKyAxKSA9PSBhcnJheS5sZW5ndGgpIGluZGV4ID0gLTE7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmh0bWwoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiPHNwYW4gY2xhc3M9J2Zyb250Jz5cIiArIGluaXRpYWwgKyBcIjwvc3Bhbj5cIikuYXBwZW5kVG8oZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxzcGFuIGNsYXNzPSdiYWNrJz5cIiArIGFycmF5W2luZGV4ICsgMV0gKyBcIjwvc3Bhbj5cIikuYXBwZW5kVG8oZWwpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXdpZHRoID0gTWF0aC5tYXgoZWwuZmluZCgnLmJhY2snKS5vdXRlcldpZHRoKCksIGVsLmZpbmQoJy5mcm9udCcpLm91dGVyV2lkdGgoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5maW5kKCcuYmFjaywgLmZyb250JykuY3NzKCdtaW4td2lkdGgnLCBtd2lkdGgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC53cmFwSW5uZXIoXCI8c3BhbiBjbGFzcz0ncm90YXRpbmcnIC8+XCIpLmZpbmQoXCIucm90YXRpbmdcIikuaGlkZSgpLmFkZENsYXNzKFwiZmxpcFwiKS5zaG93KCkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi13ZWJraXQtdHJhbnNmb3JtXCI6IFwiIHJvdGF0ZVkoLTE4MGRlZylcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi1tb3otdHJhbnNmb3JtXCI6IFwiIHJvdGF0ZVkoLTE4MGRlZylcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi1vLXRyYW5zZm9ybVwiOiBcIiByb3RhdGVZKC0xODBkZWcpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2Zvcm1cIjogXCIgcm90YXRlWSgtMTgwZGVnKVwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZmxpcFVwJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsLmZpbmQoXCIuYmFja1wiKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuaHRtbChlbC5maW5kKFwiLmJhY2tcIikuaHRtbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluaXRpYWwgPSBlbC50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAkLmluQXJyYXkoaW5pdGlhbCwgYXJyYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoKGluZGV4ICsgMSkgPT0gYXJyYXkubGVuZ3RoKSBpbmRleCA9IC0xO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5odG1sKFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxzcGFuIGNsYXNzPSdmcm9udCc+XCIgKyBpbml0aWFsICsgXCI8L3NwYW4+XCIpLmFwcGVuZFRvKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCI8c3BhbiBjbGFzcz0nYmFjayc+XCIgKyBhcnJheVtpbmRleCArIDFdICsgXCI8L3NwYW4+XCIpLmFwcGVuZFRvKGVsKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG13aWR0aCA9IE1hdGgubWF4KGVsLmZpbmQoJy5iYWNrJykub3V0ZXJXaWR0aCgpLCBlbC5maW5kKCcuZnJvbnQnKS5vdXRlcldpZHRoKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmluZCgnLmJhY2ssIC5mcm9udCcpLmNzcygnbWluLXdpZHRoJywgbXdpZHRoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZWwud3JhcElubmVyKFwiPHNwYW4gY2xhc3M9J3JvdGF0aW5nJyAvPlwiKS5maW5kKFwiLnJvdGF0aW5nXCIpLmhpZGUoKS5hZGRDbGFzcyhcImZsaXAgdXBcIikuc2hvdygpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItd2Via2l0LXRyYW5zZm9ybVwiOiBcIiByb3RhdGVYKC0xODBkZWcpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItbW96LXRyYW5zZm9ybVwiOiBcIiByb3RhdGVYKC0xODBkZWcpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItby10cmFuc2Zvcm1cIjogXCIgcm90YXRlWCgtMTgwZGVnKVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHJhbnNmb3JtXCI6IFwiIHJvdGF0ZVgoLTE4MGRlZylcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZsaXBDdWJlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsLmZpbmQoXCIuYmFja1wiKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuaHRtbChlbC5maW5kKFwiLmJhY2tcIikuaHRtbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluaXRpYWwgPSBlbC50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAkLmluQXJyYXkoaW5pdGlhbCwgYXJyYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoKGluZGV4ICsgMSkgPT0gYXJyYXkubGVuZ3RoKSBpbmRleCA9IC0xO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5odG1sKFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxzcGFuIGNsYXNzPSdmcm9udCc+XCIgKyBpbml0aWFsICsgXCI8L3NwYW4+XCIpLmFwcGVuZFRvKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCI8c3BhbiBjbGFzcz0nYmFjayc+XCIgKyBhcnJheVtpbmRleCArIDFdICsgXCI8L3NwYW4+XCIpLmFwcGVuZFRvKGVsKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG13aWR0aCA9IE1hdGgubWF4KGVsLmZpbmQoJy5iYWNrJykub3V0ZXJXaWR0aCgpLCBlbC5maW5kKCcuZnJvbnQnKS5vdXRlcldpZHRoKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmluZCgnLmJhY2ssIC5mcm9udCcpLmNzcygnbWluLXdpZHRoJywgbXdpZHRoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZWwud3JhcElubmVyKFwiPHNwYW4gY2xhc3M9J3JvdGF0aW5nJyAvPlwiKS5maW5kKFwiLnJvdGF0aW5nXCIpLmhpZGUoKS5hZGRDbGFzcyhcImZsaXAgY3ViZVwiKS5zaG93KCkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi13ZWJraXQtdHJhbnNmb3JtXCI6IFwiIHJvdGF0ZVkoMTgwZGVnKVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLW1vei10cmFuc2Zvcm1cIjogXCIgcm90YXRlWSgxODBkZWcpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItby10cmFuc2Zvcm1cIjogXCIgcm90YXRlWSgxODBkZWcpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2Zvcm1cIjogXCIgcm90YXRlWSgxODBkZWcpXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlICdmbGlwQ3ViZVVwJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsLmZpbmQoXCIuYmFja1wiKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuaHRtbChlbC5maW5kKFwiLmJhY2tcIikuaHRtbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluaXRpYWwgPSBlbC50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAkLmluQXJyYXkoaW5pdGlhbCwgYXJyYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoKGluZGV4ICsgMSkgPT0gYXJyYXkubGVuZ3RoKSBpbmRleCA9IC0xO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5odG1sKFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIjxzcGFuIGNsYXNzPSdmcm9udCc+XCIgKyBpbml0aWFsICsgXCI8L3NwYW4+XCIpLmFwcGVuZFRvKGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCI8c3BhbiBjbGFzcz0nYmFjayc+XCIgKyBhcnJheVtpbmRleCArIDFdICsgXCI8L3NwYW4+XCIpLmFwcGVuZFRvKGVsKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG13aWR0aCA9IE1hdGgubWF4KGVsLmZpbmQoJy5iYWNrJykub3V0ZXJXaWR0aCgpLCBlbC5maW5kKCcuZnJvbnQnKS5vdXRlcldpZHRoKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuZmluZCgnLmJhY2ssIC5mcm9udCcpLmNzcygnbWluLXdpZHRoJywgbXdpZHRoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZWwud3JhcElubmVyKFwiPHNwYW4gY2xhc3M9J3JvdGF0aW5nJyAvPlwiKS5maW5kKFwiLnJvdGF0aW5nXCIpLmhpZGUoKS5hZGRDbGFzcyhcImZsaXAgY3ViZSB1cFwiKS5zaG93KCkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi13ZWJraXQtdHJhbnNmb3JtXCI6IFwiIHJvdGF0ZVgoMTgwZGVnKVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLW1vei10cmFuc2Zvcm1cIjogXCIgcm90YXRlWCgxODBkZWcpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItby10cmFuc2Zvcm1cIjogXCIgcm90YXRlWCgxODBkZWcpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2Zvcm1cIjogXCIgcm90YXRlWCgxODBkZWcpXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzcGluJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsLmZpbmQoXCIucm90YXRpbmdcIikubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLmh0bWwoZWwuZmluZChcIi5yb3RhdGluZ1wiKS5odG1sKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSAkLmluQXJyYXkoZWwudGV4dCgpLCBhcnJheSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigoaW5kZXggKyAxKSA9PSBhcnJheS5sZW5ndGgpIGluZGV4ID0gLTE7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLndyYXBJbm5lcihcIjxzcGFuIGNsYXNzPSdyb3RhdGluZyBzcGluJyAvPlwiKS5maW5kKFwiLnJvdGF0aW5nXCIpLmhpZGUoKS50ZXh0KGFycmF5W2luZGV4ICsgMV0pLnNob3coKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLXdlYmtpdC10cmFuc2Zvcm1cIjogXCIgcm90YXRlKDApIHNjYWxlKDEpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCItbW96LXRyYW5zZm9ybVwiOiBcInJvdGF0ZSgwKSBzY2FsZSgxKVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLW8tdHJhbnNmb3JtXCI6IFwicm90YXRlKDApIHNjYWxlKDEpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmFuc2Zvcm1cIjogXCJyb3RhdGUoMCkgc2NhbGUoMSlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlICdmYWRlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmZhZGVPdXQoc2V0dGluZ3Muc3BlZWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gJC5pbkFycmF5KGVsLnRleHQoKSwgYXJyYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKChpbmRleCArIDEpID09IGFycmF5Lmxlbmd0aCkgaW5kZXggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC50ZXh0KGFycmF5W2luZGV4ICsgMV0pLmZhZGVJbihzZXR0aW5ncy5zcGVlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGlmIChlbC5maW5kKCcuYmFjaywgLmZyb250JykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgLy8gICAgIHZhciBtd2lkdGggPSBNYXRoLm1heChlbC5maW5kKCcuYmFjaycpLm91dGVyV2lkdGgoKSwgZWwuZmluZCgnLmZyb250Jykub3V0ZXJXaWR0aCgpKTtcbiAgICAgICAgICAgICAgICAvLyAgICAgZWwuZmluZCgnLmJhY2ssIC5mcm9udCcpLmNzcygnbWluLXdpZHRoJywgbXdpZHRoKTtcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2V0SW50ZXJ2YWwocm90YXRlLCBzZXR0aW5ncy5zcGVlZCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbn0od2luZG93LmpRdWVyeSk7XG5cbiIsIi8qIFdlYiBGb250IExvYWRlciB2MS42LjI4IC0gKGMpIEFkb2JlIFN5c3RlbXMsIEdvb2dsZS4gTGljZW5zZTogQXBhY2hlIDIuMCAqLyhmdW5jdGlvbigpe2Z1bmN0aW9uIGFhKGEsYixjKXtyZXR1cm4gYS5jYWxsLmFwcGx5KGEuYmluZCxhcmd1bWVudHMpfWZ1bmN0aW9uIGJhKGEsYixjKXtpZighYSl0aHJvdyBFcnJvcigpO2lmKDI8YXJndW1lbnRzLmxlbmd0aCl7dmFyIGQ9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBmdW5jdGlvbigpe3ZhciBjPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7QXJyYXkucHJvdG90eXBlLnVuc2hpZnQuYXBwbHkoYyxkKTtyZXR1cm4gYS5hcHBseShiLGMpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShiLGFyZ3VtZW50cyl9fWZ1bmN0aW9uIHAoYSxiLGMpe3A9RnVuY3Rpb24ucHJvdG90eXBlLmJpbmQmJi0xIT1GdW5jdGlvbi5wcm90b3R5cGUuYmluZC50b1N0cmluZygpLmluZGV4T2YoXCJuYXRpdmUgY29kZVwiKT9hYTpiYTtyZXR1cm4gcC5hcHBseShudWxsLGFyZ3VtZW50cyl9dmFyIHE9RGF0ZS5ub3d8fGZ1bmN0aW9uKCl7cmV0dXJuK25ldyBEYXRlfTtmdW5jdGlvbiBjYShhLGIpe3RoaXMuYT1hO3RoaXMubz1ifHxhO3RoaXMuYz10aGlzLm8uZG9jdW1lbnR9dmFyIGRhPSEhd2luZG93LkZvbnRGYWNlO2Z1bmN0aW9uIHQoYSxiLGMsZCl7Yj1hLmMuY3JlYXRlRWxlbWVudChiKTtpZihjKWZvcih2YXIgZSBpbiBjKWMuaGFzT3duUHJvcGVydHkoZSkmJihcInN0eWxlXCI9PWU/Yi5zdHlsZS5jc3NUZXh0PWNbZV06Yi5zZXRBdHRyaWJ1dGUoZSxjW2VdKSk7ZCYmYi5hcHBlbmRDaGlsZChhLmMuY3JlYXRlVGV4dE5vZGUoZCkpO3JldHVybiBifWZ1bmN0aW9uIHUoYSxiLGMpe2E9YS5jLmdldEVsZW1lbnRzQnlUYWdOYW1lKGIpWzBdO2F8fChhPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7YS5pbnNlcnRCZWZvcmUoYyxhLmxhc3RDaGlsZCl9ZnVuY3Rpb24gdihhKXthLnBhcmVudE5vZGUmJmEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhKX1cbiAgICBmdW5jdGlvbiB3KGEsYixjKXtiPWJ8fFtdO2M9Y3x8W107Zm9yKHZhciBkPWEuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLyksZT0wO2U8Yi5sZW5ndGg7ZSs9MSl7Zm9yKHZhciBmPSExLGc9MDtnPGQubGVuZ3RoO2crPTEpaWYoYltlXT09PWRbZ10pe2Y9ITA7YnJlYWt9Znx8ZC5wdXNoKGJbZV0pfWI9W107Zm9yKGU9MDtlPGQubGVuZ3RoO2UrPTEpe2Y9ITE7Zm9yKGc9MDtnPGMubGVuZ3RoO2crPTEpaWYoZFtlXT09PWNbZ10pe2Y9ITA7YnJlYWt9Znx8Yi5wdXNoKGRbZV0pfWEuY2xhc3NOYW1lPWIuam9pbihcIiBcIikucmVwbGFjZSgvXFxzKy9nLFwiIFwiKS5yZXBsYWNlKC9eXFxzK3xcXHMrJC8sXCJcIil9ZnVuY3Rpb24geShhLGIpe2Zvcih2YXIgYz1hLmNsYXNzTmFtZS5zcGxpdCgvXFxzKy8pLGQ9MCxlPWMubGVuZ3RoO2Q8ZTtkKyspaWYoY1tkXT09YilyZXR1cm4hMDtyZXR1cm4hMX1cbiAgICBmdW5jdGlvbiBlYShhKXtyZXR1cm4gYS5vLmxvY2F0aW9uLmhvc3RuYW1lfHxhLmEubG9jYXRpb24uaG9zdG5hbWV9ZnVuY3Rpb24geihhLGIsYyl7ZnVuY3Rpb24gZCgpe20mJmUmJmYmJihtKGcpLG09bnVsbCl9Yj10KGEsXCJsaW5rXCIse3JlbDpcInN0eWxlc2hlZXRcIixocmVmOmIsbWVkaWE6XCJhbGxcIn0pO3ZhciBlPSExLGY9ITAsZz1udWxsLG09Y3x8bnVsbDtkYT8oYi5vbmxvYWQ9ZnVuY3Rpb24oKXtlPSEwO2QoKX0sYi5vbmVycm9yPWZ1bmN0aW9uKCl7ZT0hMDtnPUVycm9yKFwiU3R5bGVzaGVldCBmYWlsZWQgdG8gbG9hZFwiKTtkKCl9KTpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZT0hMDtkKCl9LDApO3UoYSxcImhlYWRcIixiKX1cbiAgICBmdW5jdGlvbiBBKGEsYixjLGQpe3ZhciBlPWEuYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF07aWYoZSl7dmFyIGY9dChhLFwic2NyaXB0XCIse3NyYzpifSksZz0hMTtmLm9ubG9hZD1mLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2d8fHRoaXMucmVhZHlTdGF0ZSYmXCJsb2FkZWRcIiE9dGhpcy5yZWFkeVN0YXRlJiZcImNvbXBsZXRlXCIhPXRoaXMucmVhZHlTdGF0ZXx8KGc9ITAsYyYmYyhudWxsKSxmLm9ubG9hZD1mLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLFwiSEVBRFwiPT1mLnBhcmVudE5vZGUudGFnTmFtZSYmZS5yZW1vdmVDaGlsZChmKSl9O2UuYXBwZW5kQ2hpbGQoZik7c2V0VGltZW91dChmdW5jdGlvbigpe2d8fChnPSEwLGMmJmMoRXJyb3IoXCJTY3JpcHQgbG9hZCB0aW1lb3V0XCIpKSl9LGR8fDVFMyk7cmV0dXJuIGZ9cmV0dXJuIG51bGx9O2Z1bmN0aW9uIEIoKXt0aGlzLmE9MDt0aGlzLmM9bnVsbH1mdW5jdGlvbiBDKGEpe2EuYSsrO3JldHVybiBmdW5jdGlvbigpe2EuYS0tO0QoYSl9fWZ1bmN0aW9uIEUoYSxiKXthLmM9YjtEKGEpfWZ1bmN0aW9uIEQoYSl7MD09YS5hJiZhLmMmJihhLmMoKSxhLmM9bnVsbCl9O2Z1bmN0aW9uIEYoYSl7dGhpcy5hPWF8fFwiLVwifUYucHJvdG90eXBlLmM9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPVtdLGM9MDtjPGFyZ3VtZW50cy5sZW5ndGg7YysrKWIucHVzaChhcmd1bWVudHNbY10ucmVwbGFjZSgvW1xcV19dKy9nLFwiXCIpLnRvTG93ZXJDYXNlKCkpO3JldHVybiBiLmpvaW4odGhpcy5hKX07ZnVuY3Rpb24gRyhhLGIpe3RoaXMuYz1hO3RoaXMuZj00O3RoaXMuYT1cIm5cIjt2YXIgYz0oYnx8XCJuNFwiKS5tYXRjaCgvXihbbmlvXSkoWzEtOV0pJC9pKTtjJiYodGhpcy5hPWNbMV0sdGhpcy5mPXBhcnNlSW50KGNbMl0sMTApKX1mdW5jdGlvbiBmYShhKXtyZXR1cm4gSChhKStcIiBcIisoYS5mK1wiMDBcIikrXCIgMzAwcHggXCIrSShhLmMpfWZ1bmN0aW9uIEkoYSl7dmFyIGI9W107YT1hLnNwbGl0KC8sXFxzKi8pO2Zvcih2YXIgYz0wO2M8YS5sZW5ndGg7YysrKXt2YXIgZD1hW2NdLnJlcGxhY2UoL1snXCJdL2csXCJcIik7LTEhPWQuaW5kZXhPZihcIiBcIil8fC9eXFxkLy50ZXN0KGQpP2IucHVzaChcIidcIitkK1wiJ1wiKTpiLnB1c2goZCl9cmV0dXJuIGIuam9pbihcIixcIil9ZnVuY3Rpb24gSihhKXtyZXR1cm4gYS5hK2EuZn1mdW5jdGlvbiBIKGEpe3ZhciBiPVwibm9ybWFsXCI7XCJvXCI9PT1hLmE/Yj1cIm9ibGlxdWVcIjpcImlcIj09PWEuYSYmKGI9XCJpdGFsaWNcIik7cmV0dXJuIGJ9XG4gICAgZnVuY3Rpb24gZ2EoYSl7dmFyIGI9NCxjPVwiblwiLGQ9bnVsbDthJiYoKGQ9YS5tYXRjaCgvKG5vcm1hbHxvYmxpcXVlfGl0YWxpYykvaSkpJiZkWzFdJiYoYz1kWzFdLnN1YnN0cigwLDEpLnRvTG93ZXJDYXNlKCkpLChkPWEubWF0Y2goLyhbMS05XTAwfG5vcm1hbHxib2xkKS9pKSkmJmRbMV0mJigvYm9sZC9pLnRlc3QoZFsxXSk/Yj03Oi9bMS05XTAwLy50ZXN0KGRbMV0pJiYoYj1wYXJzZUludChkWzFdLnN1YnN0cigwLDEpLDEwKSkpKTtyZXR1cm4gYytifTtmdW5jdGlvbiBoYShhLGIpe3RoaXMuYz1hO3RoaXMuZj1hLm8uZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O3RoaXMuaD1iO3RoaXMuYT1uZXcgRihcIi1cIik7dGhpcy5qPSExIT09Yi5ldmVudHM7dGhpcy5nPSExIT09Yi5jbGFzc2VzfWZ1bmN0aW9uIGlhKGEpe2EuZyYmdyhhLmYsW2EuYS5jKFwid2ZcIixcImxvYWRpbmdcIildKTtLKGEsXCJsb2FkaW5nXCIpfWZ1bmN0aW9uIEwoYSl7aWYoYS5nKXt2YXIgYj15KGEuZixhLmEuYyhcIndmXCIsXCJhY3RpdmVcIikpLGM9W10sZD1bYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKV07Ynx8Yy5wdXNoKGEuYS5jKFwid2ZcIixcImluYWN0aXZlXCIpKTt3KGEuZixjLGQpfUsoYSxcImluYWN0aXZlXCIpfWZ1bmN0aW9uIEsoYSxiLGMpe2lmKGEuaiYmYS5oW2JdKWlmKGMpYS5oW2JdKGMuYyxKKGMpKTtlbHNlIGEuaFtiXSgpfTtmdW5jdGlvbiBqYSgpe3RoaXMuYz17fX1mdW5jdGlvbiBrYShhLGIsYyl7dmFyIGQ9W10sZTtmb3IoZSBpbiBiKWlmKGIuaGFzT3duUHJvcGVydHkoZSkpe3ZhciBmPWEuY1tlXTtmJiZkLnB1c2goZihiW2VdLGMpKX1yZXR1cm4gZH07ZnVuY3Rpb24gTShhLGIpe3RoaXMuYz1hO3RoaXMuZj1iO3RoaXMuYT10KHRoaXMuYyxcInNwYW5cIix7XCJhcmlhLWhpZGRlblwiOlwidHJ1ZVwifSx0aGlzLmYpfWZ1bmN0aW9uIE4oYSl7dShhLmMsXCJib2R5XCIsYS5hKX1mdW5jdGlvbiBPKGEpe3JldHVyblwiZGlzcGxheTpibG9jaztwb3NpdGlvbjphYnNvbHV0ZTt0b3A6LTk5OTlweDtsZWZ0Oi05OTk5cHg7Zm9udC1zaXplOjMwMHB4O3dpZHRoOmF1dG87aGVpZ2h0OmF1dG87bGluZS1oZWlnaHQ6bm9ybWFsO21hcmdpbjowO3BhZGRpbmc6MDtmb250LXZhcmlhbnQ6bm9ybWFsO3doaXRlLXNwYWNlOm5vd3JhcDtmb250LWZhbWlseTpcIitJKGEuYykrXCI7XCIrKFwiZm9udC1zdHlsZTpcIitIKGEpK1wiO2ZvbnQtd2VpZ2h0OlwiKyhhLmYrXCIwMFwiKStcIjtcIil9O2Z1bmN0aW9uIFAoYSxiLGMsZCxlLGYpe3RoaXMuZz1hO3RoaXMuaj1iO3RoaXMuYT1kO3RoaXMuYz1jO3RoaXMuZj1lfHwzRTM7dGhpcy5oPWZ8fHZvaWQgMH1QLnByb3RvdHlwZS5zdGFydD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuYy5vLmRvY3VtZW50LGI9dGhpcyxjPXEoKSxkPW5ldyBQcm9taXNlKGZ1bmN0aW9uKGQsZSl7ZnVuY3Rpb24gZigpe3EoKS1jPj1iLmY/ZSgpOmEuZm9udHMubG9hZChmYShiLmEpLGIuaCkudGhlbihmdW5jdGlvbihhKXsxPD1hLmxlbmd0aD9kKCk6c2V0VGltZW91dChmLDI1KX0sZnVuY3Rpb24oKXtlKCl9KX1mKCl9KSxlPW51bGwsZj1uZXcgUHJvbWlzZShmdW5jdGlvbihhLGQpe2U9c2V0VGltZW91dChkLGIuZil9KTtQcm9taXNlLnJhY2UoW2YsZF0pLnRoZW4oZnVuY3Rpb24oKXtlJiYoY2xlYXJUaW1lb3V0KGUpLGU9bnVsbCk7Yi5nKGIuYSl9LGZ1bmN0aW9uKCl7Yi5qKGIuYSl9KX07ZnVuY3Rpb24gUShhLGIsYyxkLGUsZixnKXt0aGlzLnY9YTt0aGlzLkI9Yjt0aGlzLmM9Yzt0aGlzLmE9ZDt0aGlzLnM9Z3x8XCJCRVNic3d5XCI7dGhpcy5mPXt9O3RoaXMudz1lfHwzRTM7dGhpcy51PWZ8fG51bGw7dGhpcy5tPXRoaXMuaj10aGlzLmg9dGhpcy5nPW51bGw7dGhpcy5nPW5ldyBNKHRoaXMuYyx0aGlzLnMpO3RoaXMuaD1uZXcgTSh0aGlzLmMsdGhpcy5zKTt0aGlzLmo9bmV3IE0odGhpcy5jLHRoaXMucyk7dGhpcy5tPW5ldyBNKHRoaXMuYyx0aGlzLnMpO2E9bmV3IEcodGhpcy5hLmMrXCIsc2VyaWZcIixKKHRoaXMuYSkpO2E9TyhhKTt0aGlzLmcuYS5zdHlsZS5jc3NUZXh0PWE7YT1uZXcgRyh0aGlzLmEuYytcIixzYW5zLXNlcmlmXCIsSih0aGlzLmEpKTthPU8oYSk7dGhpcy5oLmEuc3R5bGUuY3NzVGV4dD1hO2E9bmV3IEcoXCJzZXJpZlwiLEoodGhpcy5hKSk7YT1PKGEpO3RoaXMuai5hLnN0eWxlLmNzc1RleHQ9YTthPW5ldyBHKFwic2Fucy1zZXJpZlwiLEoodGhpcy5hKSk7YT1cbiAgICAgICAgTyhhKTt0aGlzLm0uYS5zdHlsZS5jc3NUZXh0PWE7Tih0aGlzLmcpO04odGhpcy5oKTtOKHRoaXMuaik7Tih0aGlzLm0pfXZhciBSPXtEOlwic2VyaWZcIixDOlwic2Fucy1zZXJpZlwifSxTPW51bGw7ZnVuY3Rpb24gVCgpe2lmKG51bGw9PT1TKXt2YXIgYT0vQXBwbGVXZWJLaXRcXC8oWzAtOV0rKSg/OlxcLihbMC05XSspKS8uZXhlYyh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7Uz0hIWEmJig1MzY+cGFyc2VJbnQoYVsxXSwxMCl8fDUzNj09PXBhcnNlSW50KGFbMV0sMTApJiYxMT49cGFyc2VJbnQoYVsyXSwxMCkpfXJldHVybiBTfVEucHJvdG90eXBlLnN0YXJ0PWZ1bmN0aW9uKCl7dGhpcy5mLnNlcmlmPXRoaXMuai5hLm9mZnNldFdpZHRoO3RoaXMuZltcInNhbnMtc2VyaWZcIl09dGhpcy5tLmEub2Zmc2V0V2lkdGg7dGhpcy5BPXEoKTtVKHRoaXMpfTtcbiAgICBmdW5jdGlvbiBsYShhLGIsYyl7Zm9yKHZhciBkIGluIFIpaWYoUi5oYXNPd25Qcm9wZXJ0eShkKSYmYj09PWEuZltSW2RdXSYmYz09PWEuZltSW2RdXSlyZXR1cm4hMDtyZXR1cm4hMX1mdW5jdGlvbiBVKGEpe3ZhciBiPWEuZy5hLm9mZnNldFdpZHRoLGM9YS5oLmEub2Zmc2V0V2lkdGgsZDsoZD1iPT09YS5mLnNlcmlmJiZjPT09YS5mW1wic2Fucy1zZXJpZlwiXSl8fChkPVQoKSYmbGEoYSxiLGMpKTtkP3EoKS1hLkE+PWEudz9UKCkmJmxhKGEsYixjKSYmKG51bGw9PT1hLnV8fGEudS5oYXNPd25Qcm9wZXJ0eShhLmEuYykpP1YoYSxhLnYpOlYoYSxhLkIpOm1hKGEpOlYoYSxhLnYpfWZ1bmN0aW9uIG1hKGEpe3NldFRpbWVvdXQocChmdW5jdGlvbigpe1UodGhpcyl9LGEpLDUwKX1mdW5jdGlvbiBWKGEsYil7c2V0VGltZW91dChwKGZ1bmN0aW9uKCl7dih0aGlzLmcuYSk7dih0aGlzLmguYSk7dih0aGlzLmouYSk7dih0aGlzLm0uYSk7Yih0aGlzLmEpfSxhKSwwKX07ZnVuY3Rpb24gVyhhLGIsYyl7dGhpcy5jPWE7dGhpcy5hPWI7dGhpcy5mPTA7dGhpcy5tPXRoaXMuaj0hMTt0aGlzLnM9Y312YXIgWD1udWxsO1cucHJvdG90eXBlLmc9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hO2IuZyYmdyhiLmYsW2IuYS5jKFwid2ZcIixhLmMsSihhKS50b1N0cmluZygpLFwiYWN0aXZlXCIpXSxbYi5hLmMoXCJ3ZlwiLGEuYyxKKGEpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpLGIuYS5jKFwid2ZcIixhLmMsSihhKS50b1N0cmluZygpLFwiaW5hY3RpdmVcIildKTtLKGIsXCJmb250YWN0aXZlXCIsYSk7dGhpcy5tPSEwO25hKHRoaXMpfTtcbiAgICBXLnByb3RvdHlwZS5oPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYTtpZihiLmcpe3ZhciBjPXkoYi5mLGIuYS5jKFwid2ZcIixhLmMsSihhKS50b1N0cmluZygpLFwiYWN0aXZlXCIpKSxkPVtdLGU9W2IuYS5jKFwid2ZcIixhLmMsSihhKS50b1N0cmluZygpLFwibG9hZGluZ1wiKV07Y3x8ZC5wdXNoKGIuYS5jKFwid2ZcIixhLmMsSihhKS50b1N0cmluZygpLFwiaW5hY3RpdmVcIikpO3coYi5mLGQsZSl9SyhiLFwiZm9udGluYWN0aXZlXCIsYSk7bmEodGhpcyl9O2Z1bmN0aW9uIG5hKGEpezA9PS0tYS5mJiZhLmomJihhLm0/KGE9YS5hLGEuZyYmdyhhLmYsW2EuYS5jKFwid2ZcIixcImFjdGl2ZVwiKV0sW2EuYS5jKFwid2ZcIixcImxvYWRpbmdcIiksYS5hLmMoXCJ3ZlwiLFwiaW5hY3RpdmVcIildKSxLKGEsXCJhY3RpdmVcIikpOkwoYS5hKSl9O2Z1bmN0aW9uIG9hKGEpe3RoaXMuaj1hO3RoaXMuYT1uZXcgamE7dGhpcy5oPTA7dGhpcy5mPXRoaXMuZz0hMH1vYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt0aGlzLmM9bmV3IGNhKHRoaXMuaixhLmNvbnRleHR8fHRoaXMuaik7dGhpcy5nPSExIT09YS5ldmVudHM7dGhpcy5mPSExIT09YS5jbGFzc2VzO3BhKHRoaXMsbmV3IGhhKHRoaXMuYyxhKSxhKX07XG4gICAgZnVuY3Rpb24gcWEoYSxiLGMsZCxlKXt2YXIgZj0wPT0tLWEuaDsoYS5mfHxhLmcpJiZzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dmFyIGE9ZXx8bnVsbCxtPWR8fG51bGx8fHt9O2lmKDA9PT1jLmxlbmd0aCYmZilMKGIuYSk7ZWxzZXtiLmYrPWMubGVuZ3RoO2YmJihiLmo9Zik7dmFyIGgsbD1bXTtmb3IoaD0wO2g8Yy5sZW5ndGg7aCsrKXt2YXIgaz1jW2hdLG49bVtrLmNdLHI9Yi5hLHg9aztyLmcmJncoci5mLFtyLmEuYyhcIndmXCIseC5jLEooeCkudG9TdHJpbmcoKSxcImxvYWRpbmdcIildKTtLKHIsXCJmb250bG9hZGluZ1wiLHgpO3I9bnVsbDtpZihudWxsPT09WClpZih3aW5kb3cuRm9udEZhY2Upe3ZhciB4PS9HZWNrby4qRmlyZWZveFxcLyhcXGQrKS8uZXhlYyh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCkseGE9L09TIFguKlZlcnNpb25cXC8xMFxcLi4qU2FmYXJpLy5leGVjKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSYmL0FwcGxlLy5leGVjKHdpbmRvdy5uYXZpZ2F0b3IudmVuZG9yKTtcbiAgICAgICAgWD14PzQyPHBhcnNlSW50KHhbMV0sMTApOnhhPyExOiEwfWVsc2UgWD0hMTtYP3I9bmV3IFAocChiLmcsYikscChiLmgsYiksYi5jLGssYi5zLG4pOnI9bmV3IFEocChiLmcsYikscChiLmgsYiksYi5jLGssYi5zLGEsbik7bC5wdXNoKHIpfWZvcihoPTA7aDxsLmxlbmd0aDtoKyspbFtoXS5zdGFydCgpfX0sMCl9ZnVuY3Rpb24gcGEoYSxiLGMpe3ZhciBkPVtdLGU9Yy50aW1lb3V0O2lhKGIpO3ZhciBkPWthKGEuYSxjLGEuYyksZj1uZXcgVyhhLmMsYixlKTthLmg9ZC5sZW5ndGg7Yj0wO2ZvcihjPWQubGVuZ3RoO2I8YztiKyspZFtiXS5sb2FkKGZ1bmN0aW9uKGIsZCxjKXtxYShhLGYsYixkLGMpfSl9O2Z1bmN0aW9uIHJhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9XG4gICAgcmEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe2lmKGZbXCJfX210aV9mbnRMc3RcIitkXSl7dmFyIGM9ZltcIl9fbXRpX2ZudExzdFwiK2RdKCksZT1bXSxoO2lmKGMpZm9yKHZhciBsPTA7bDxjLmxlbmd0aDtsKyspe3ZhciBrPWNbbF0uZm9udGZhbWlseTt2b2lkIDAhPWNbbF0uZm9udFN0eWxlJiZ2b2lkIDAhPWNbbF0uZm9udFdlaWdodD8oaD1jW2xdLmZvbnRTdHlsZStjW2xdLmZvbnRXZWlnaHQsZS5wdXNoKG5ldyBHKGssaCkpKTplLnB1c2gobmV3IEcoaykpfWEoZSl9ZWxzZSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YigpfSw1MCl9dmFyIGM9dGhpcyxkPWMuYS5wcm9qZWN0SWQsZT1jLmEudmVyc2lvbjtpZihkKXt2YXIgZj1jLmMubztBKHRoaXMuYywoYy5hLmFwaXx8XCJodHRwczovL2Zhc3QuZm9udHMubmV0L2pzYXBpXCIpK1wiL1wiK2QrXCIuanNcIisoZT9cIj92PVwiK2U6XCJcIiksZnVuY3Rpb24oZSl7ZT9hKFtdKTooZltcIl9fTW9ub3R5cGVDb25maWd1cmF0aW9uX19cIitcbiAgICBkXT1mdW5jdGlvbigpe3JldHVybiBjLmF9LGIoKSl9KS5pZD1cIl9fTW9ub3R5cGVBUElTY3JpcHRfX1wiK2R9ZWxzZSBhKFtdKX07ZnVuY3Rpb24gc2EoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn1zYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYixjLGQ9dGhpcy5hLnVybHN8fFtdLGU9dGhpcy5hLmZhbWlsaWVzfHxbXSxmPXRoaXMuYS50ZXN0U3RyaW5nc3x8e30sZz1uZXcgQjtiPTA7Zm9yKGM9ZC5sZW5ndGg7YjxjO2IrKyl6KHRoaXMuYyxkW2JdLEMoZykpO3ZhciBtPVtdO2I9MDtmb3IoYz1lLmxlbmd0aDtiPGM7YisrKWlmKGQ9ZVtiXS5zcGxpdChcIjpcIiksZFsxXSlmb3IodmFyIGg9ZFsxXS5zcGxpdChcIixcIiksbD0wO2w8aC5sZW5ndGg7bCs9MSltLnB1c2gobmV3IEcoZFswXSxoW2xdKSk7ZWxzZSBtLnB1c2gobmV3IEcoZFswXSkpO0UoZyxmdW5jdGlvbigpe2EobSxmKX0pfTtmdW5jdGlvbiB0YShhLGIpe2E/dGhpcy5jPWE6dGhpcy5jPXVhO3RoaXMuYT1bXTt0aGlzLmY9W107dGhpcy5nPWJ8fFwiXCJ9dmFyIHVhPVwiaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3NcIjtmdW5jdGlvbiB2YShhLGIpe2Zvcih2YXIgYz1iLmxlbmd0aCxkPTA7ZDxjO2QrKyl7dmFyIGU9YltkXS5zcGxpdChcIjpcIik7Mz09ZS5sZW5ndGgmJmEuZi5wdXNoKGUucG9wKCkpO3ZhciBmPVwiXCI7Mj09ZS5sZW5ndGgmJlwiXCIhPWVbMV0mJihmPVwiOlwiKTthLmEucHVzaChlLmpvaW4oZikpfX1cbiAgICBmdW5jdGlvbiB3YShhKXtpZigwPT1hLmEubGVuZ3RoKXRocm93IEVycm9yKFwiTm8gZm9udHMgdG8gbG9hZCFcIik7aWYoLTEhPWEuYy5pbmRleE9mKFwia2l0PVwiKSlyZXR1cm4gYS5jO2Zvcih2YXIgYj1hLmEubGVuZ3RoLGM9W10sZD0wO2Q8YjtkKyspYy5wdXNoKGEuYVtkXS5yZXBsYWNlKC8gL2csXCIrXCIpKTtiPWEuYytcIj9mYW1pbHk9XCIrYy5qb2luKFwiJTdDXCIpOzA8YS5mLmxlbmd0aCYmKGIrPVwiJnN1YnNldD1cIithLmYuam9pbihcIixcIikpOzA8YS5nLmxlbmd0aCYmKGIrPVwiJnRleHQ9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGEuZykpO3JldHVybiBifTtmdW5jdGlvbiB5YShhKXt0aGlzLmY9YTt0aGlzLmE9W107dGhpcy5jPXt9fVxuICAgIHZhciB6YT17bGF0aW46XCJCRVNic3d5XCIsXCJsYXRpbi1leHRcIjpcIlxcdTAwZTdcXHUwMGY2XFx1MDBmY1xcdTAxMWZcXHUwMTVmXCIsY3lyaWxsaWM6XCJcXHUwNDM5XFx1MDQ0ZlxcdTA0MTZcIixncmVlazpcIlxcdTAzYjFcXHUwM2IyXFx1MDNhM1wiLGtobWVyOlwiXFx1MTc4MFxcdTE3ODFcXHUxNzgyXCIsSGFudW1hbjpcIlxcdTE3ODBcXHUxNzgxXFx1MTc4MlwifSxBYT17dGhpbjpcIjFcIixleHRyYWxpZ2h0OlwiMlwiLFwiZXh0cmEtbGlnaHRcIjpcIjJcIix1bHRyYWxpZ2h0OlwiMlwiLFwidWx0cmEtbGlnaHRcIjpcIjJcIixsaWdodDpcIjNcIixyZWd1bGFyOlwiNFwiLGJvb2s6XCI0XCIsbWVkaXVtOlwiNVwiLFwic2VtaS1ib2xkXCI6XCI2XCIsc2VtaWJvbGQ6XCI2XCIsXCJkZW1pLWJvbGRcIjpcIjZcIixkZW1pYm9sZDpcIjZcIixib2xkOlwiN1wiLFwiZXh0cmEtYm9sZFwiOlwiOFwiLGV4dHJhYm9sZDpcIjhcIixcInVsdHJhLWJvbGRcIjpcIjhcIix1bHRyYWJvbGQ6XCI4XCIsYmxhY2s6XCI5XCIsaGVhdnk6XCI5XCIsbDpcIjNcIixyOlwiNFwiLGI6XCI3XCJ9LEJhPXtpOlwiaVwiLGl0YWxpYzpcImlcIixuOlwiblwiLG5vcm1hbDpcIm5cIn0sXG4gICAgICAgIENhPS9eKHRoaW58KD86KD86ZXh0cmF8dWx0cmEpLT8pP2xpZ2h0fHJlZ3VsYXJ8Ym9va3xtZWRpdW18KD86KD86c2VtaXxkZW1pfGV4dHJhfHVsdHJhKS0/KT9ib2xkfGJsYWNrfGhlYXZ5fGx8cnxifFsxLTldMDApPyhufGl8bm9ybWFsfGl0YWxpYyk/JC87XG4gICAgZnVuY3Rpb24gRGEoYSl7Zm9yKHZhciBiPWEuZi5sZW5ndGgsYz0wO2M8YjtjKyspe3ZhciBkPWEuZltjXS5zcGxpdChcIjpcIiksZT1kWzBdLnJlcGxhY2UoL1xcKy9nLFwiIFwiKSxmPVtcIm40XCJdO2lmKDI8PWQubGVuZ3RoKXt2YXIgZzt2YXIgbT1kWzFdO2c9W107aWYobSlmb3IodmFyIG09bS5zcGxpdChcIixcIiksaD1tLmxlbmd0aCxsPTA7bDxoO2wrKyl7dmFyIGs7az1tW2xdO2lmKGsubWF0Y2goL15bXFx3LV0rJC8pKXt2YXIgbj1DYS5leGVjKGsudG9Mb3dlckNhc2UoKSk7aWYobnVsbD09bilrPVwiXCI7ZWxzZXtrPW5bMl07az1udWxsPT1rfHxcIlwiPT1rP1wiblwiOkJhW2tdO249blsxXTtpZihudWxsPT1ufHxcIlwiPT1uKW49XCI0XCI7ZWxzZSB2YXIgcj1BYVtuXSxuPXI/cjppc05hTihuKT9cIjRcIjpuLnN1YnN0cigwLDEpO2s9W2ssbl0uam9pbihcIlwiKX19ZWxzZSBrPVwiXCI7ayYmZy5wdXNoKGspfTA8Zy5sZW5ndGgmJihmPWcpOzM9PWQubGVuZ3RoJiYoZD1kWzJdLGc9W10sZD1kP2Quc3BsaXQoXCIsXCIpOlxuICAgICAgICBnLDA8ZC5sZW5ndGgmJihkPXphW2RbMF1dKSYmKGEuY1tlXT1kKSl9YS5jW2VdfHwoZD16YVtlXSkmJihhLmNbZV09ZCk7Zm9yKGQ9MDtkPGYubGVuZ3RoO2QrPTEpYS5hLnB1c2gobmV3IEcoZSxmW2RdKSl9fTtmdW5jdGlvbiBFYShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifXZhciBGYT17QXJpbW86ITAsQ291c2luZTohMCxUaW5vczohMH07RWEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IEIsYz10aGlzLmMsZD1uZXcgdGEodGhpcy5hLmFwaSx0aGlzLmEudGV4dCksZT10aGlzLmEuZmFtaWxpZXM7dmEoZCxlKTt2YXIgZj1uZXcgeWEoZSk7RGEoZik7eihjLHdhKGQpLEMoYikpO0UoYixmdW5jdGlvbigpe2EoZi5hLGYuYyxGYSl9KX07ZnVuY3Rpb24gR2EoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn1HYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmEuaWQsYz10aGlzLmMubztiP0EodGhpcy5jLCh0aGlzLmEuYXBpfHxcImh0dHBzOi8vdXNlLnR5cGVraXQubmV0XCIpK1wiL1wiK2IrXCIuanNcIixmdW5jdGlvbihiKXtpZihiKWEoW10pO2Vsc2UgaWYoYy5UeXBla2l0JiZjLlR5cGVraXQuY29uZmlnJiZjLlR5cGVraXQuY29uZmlnLmZuKXtiPWMuVHlwZWtpdC5jb25maWcuZm47Zm9yKHZhciBlPVtdLGY9MDtmPGIubGVuZ3RoO2YrPTIpZm9yKHZhciBnPWJbZl0sbT1iW2YrMV0saD0wO2g8bS5sZW5ndGg7aCsrKWUucHVzaChuZXcgRyhnLG1baF0pKTt0cnl7Yy5UeXBla2l0LmxvYWQoe2V2ZW50czohMSxjbGFzc2VzOiExLGFzeW5jOiEwfSl9Y2F0Y2gobCl7fWEoZSl9fSwyRTMpOmEoW10pfTtmdW5jdGlvbiBIYShhLGIpe3RoaXMuYz1hO3RoaXMuZj1iO3RoaXMuYT1bXX1IYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmYuaWQsYz10aGlzLmMubyxkPXRoaXM7Yj8oYy5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9ffHwoYy5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9fPXt9KSxjLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX19bYl09ZnVuY3Rpb24oYixjKXtmb3IodmFyIGc9MCxtPWMuZm9udHMubGVuZ3RoO2c8bTsrK2cpe3ZhciBoPWMuZm9udHNbZ107ZC5hLnB1c2gobmV3IEcoaC5uYW1lLGdhKFwiZm9udC13ZWlnaHQ6XCIraC53ZWlnaHQrXCI7Zm9udC1zdHlsZTpcIitoLnN0eWxlKSkpfWEoZC5hKX0sQSh0aGlzLmMsKHRoaXMuZi5hcGl8fFwiaHR0cHM6Ly9mLmZvbnRkZWNrLmNvbS9zL2Nzcy9qcy9cIikrZWEodGhpcy5jKStcIi9cIitiK1wiLmpzXCIsZnVuY3Rpb24oYil7YiYmYShbXSl9KSk6YShbXSl9O3ZhciBZPW5ldyBvYSh3aW5kb3cpO1kuYS5jLmN1c3RvbT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgc2EoYixhKX07WS5hLmMuZm9udGRlY2s9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IEhhKGIsYSl9O1kuYS5jLm1vbm90eXBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyByYShiLGEpfTtZLmEuYy50eXBla2l0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBHYShiLGEpfTtZLmEuYy5nb29nbGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IEVhKGIsYSl9O3ZhciBaPXtsb2FkOnAoWS5sb2FkLFkpfTtcImZ1bmN0aW9uXCI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShmdW5jdGlvbigpe3JldHVybiBafSk6XCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPVo6KHdpbmRvdy5XZWJGb250PVosd2luZG93LldlYkZvbnRDb25maWcmJlkubG9hZCh3aW5kb3cuV2ViRm9udENvbmZpZykpO30oKSk7IiwiKGZ1bmN0aW9uKCkge1xuICAgIHZhciBNdXRhdGlvbk9ic2VydmVyLCBVdGlsLCBXZWFrTWFwLCBnZXRDb21wdXRlZFN0eWxlLCBnZXRDb21wdXRlZFN0eWxlUlgsXG4gICAgICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gICAgICAgIF9faW5kZXhPZiA9IFtdLmluZGV4T2YgfHwgZnVuY3Rpb24oaXRlbSkgeyBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7IGlmIChpIGluIHRoaXMgJiYgdGhpc1tpXSA9PT0gaXRlbSkgcmV0dXJuIGk7IH0gcmV0dXJuIC0xOyB9O1xuXG4gICAgVXRpbCA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgZnVuY3Rpb24gVXRpbCgpIHt9XG5cbiAgICAgICAgVXRpbC5wcm90b3R5cGUuZXh0ZW5kID0gZnVuY3Rpb24oY3VzdG9tLCBkZWZhdWx0cykge1xuICAgICAgICAgICAgdmFyIGtleSwgdmFsdWU7XG4gICAgICAgICAgICBmb3IgKGtleSBpbiBkZWZhdWx0cykge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gZGVmYXVsdHNba2V5XTtcbiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tW2tleV0gPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21ba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjdXN0b207XG4gICAgICAgIH07XG5cbiAgICAgICAgVXRpbC5wcm90b3R5cGUuaXNNb2JpbGUgPSBmdW5jdGlvbihhZ2VudCkge1xuICAgICAgICAgICAgcmV0dXJuIC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8QmxhY2tCZXJyeXxJRU1vYmlsZXxPcGVyYSBNaW5pL2kudGVzdChhZ2VudCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgVXRpbC5wcm90b3R5cGUuYWRkRXZlbnQgPSBmdW5jdGlvbihlbGVtLCBldmVudCwgZm4pIHtcbiAgICAgICAgICAgIGlmIChlbGVtLmFkZEV2ZW50TGlzdGVuZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGZuLCBmYWxzZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0uYXR0YWNoRXZlbnQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmF0dGFjaEV2ZW50KFwib25cIiArIGV2ZW50LCBmbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtW2V2ZW50XSA9IGZuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFV0aWwucHJvdG90eXBlLnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24oZWxlbSwgZXZlbnQsIGZuKSB7XG4gICAgICAgICAgICBpZiAoZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBmbiwgZmFsc2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtLmRldGFjaEV2ZW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5kZXRhY2hFdmVudChcIm9uXCIgKyBldmVudCwgZm4pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVsZXRlIGVsZW1bZXZlbnRdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFV0aWwucHJvdG90eXBlLmlubmVySGVpZ2h0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoJ2lubmVySGVpZ2h0JyBpbiB3aW5kb3cpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gVXRpbDtcblxuICAgIH0pKCk7XG5cbiAgICBXZWFrTWFwID0gdGhpcy5XZWFrTWFwIHx8IHRoaXMuTW96V2Vha01hcCB8fCAoV2Vha01hcCA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIFdlYWtNYXAoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5rZXlzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgV2Vha01hcC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGksIGl0ZW0sIF9pLCBfbGVuLCBfcmVmO1xuICAgICAgICAgICAgICAgIF9yZWYgPSB0aGlzLmtleXM7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgaSA9ICsrX2kpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IF9yZWZbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtID09PSBrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFdlYWtNYXAucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSwgaXRlbSwgX2ksIF9sZW4sIF9yZWY7XG4gICAgICAgICAgICAgICAgX3JlZiA9IHRoaXMua2V5cztcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBpID0gKytfaSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtID0gX3JlZltpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gPT09IGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZXNbaV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmtleXMucHVzaChrZXkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiBXZWFrTWFwO1xuXG4gICAgICAgIH0pKCkpO1xuXG4gICAgTXV0YXRpb25PYnNlcnZlciA9IHRoaXMuTXV0YXRpb25PYnNlcnZlciB8fCB0aGlzLldlYmtpdE11dGF0aW9uT2JzZXJ2ZXIgfHwgdGhpcy5Nb3pNdXRhdGlvbk9ic2VydmVyIHx8IChNdXRhdGlvbk9ic2VydmVyID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZnVuY3Rpb24gTXV0YXRpb25PYnNlcnZlcigpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09IFwidW5kZWZpbmVkXCIgJiYgY29uc29sZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ011dGF0aW9uT2JzZXJ2ZXIgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXIuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb25zb2xlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignV09XLmpzIGNhbm5vdCBkZXRlY3QgZG9tIG11dGF0aW9ucywgcGxlYXNlIGNhbGwgLnN5bmMoKSBhZnRlciBsb2FkaW5nIG5ldyBjb250ZW50LicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgTXV0YXRpb25PYnNlcnZlci5ub3RTdXBwb3J0ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBNdXRhdGlvbk9ic2VydmVyLnByb3RvdHlwZS5vYnNlcnZlID0gZnVuY3Rpb24oKSB7fTtcblxuICAgICAgICAgICAgcmV0dXJuIE11dGF0aW9uT2JzZXJ2ZXI7XG5cbiAgICAgICAgfSkoKSk7XG5cbiAgICBnZXRDb21wdXRlZFN0eWxlID0gdGhpcy5nZXRDb21wdXRlZFN0eWxlIHx8IGZ1bmN0aW9uKGVsLCBwc2V1ZG8pIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0UHJvcGVydHlWYWx1ZSA9IGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgICAgICAgICAgICB2YXIgX3JlZjtcbiAgICAgICAgICAgICAgICBpZiAocHJvcCA9PT0gJ2Zsb2F0Jykge1xuICAgICAgICAgICAgICAgICAgICBwcm9wID0gJ3N0eWxlRmxvYXQnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZ2V0Q29tcHV0ZWRTdHlsZVJYLnRlc3QocHJvcCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcC5yZXBsYWNlKGdldENvbXB1dGVkU3R5bGVSWCwgZnVuY3Rpb24oXywgX2NoYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY2hhci50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICgoX3JlZiA9IGVsLmN1cnJlbnRTdHlsZSkgIT0gbnVsbCA/IF9yZWZbcHJvcF0gOiB2b2lkIDApIHx8IG51bGw7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH07XG5cbiAgICBnZXRDb21wdXRlZFN0eWxlUlggPSAvKFxcLShbYS16XSl7MX0pL2c7XG5cbiAgICB0aGlzLldPVyA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgV09XLnByb3RvdHlwZS5kZWZhdWx0cyA9IHtcbiAgICAgICAgICAgIGJveENsYXNzOiAnd293JyxcbiAgICAgICAgICAgIGFuaW1hdGVDbGFzczogJ2FuaW1hdGVkJyxcbiAgICAgICAgICAgIG9mZnNldDogMCxcbiAgICAgICAgICAgIG1vYmlsZTogdHJ1ZSxcbiAgICAgICAgICAgIGxpdmU6IHRydWUsXG4gICAgICAgICAgICBjYWxsYmFjazogbnVsbFxuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIFdPVyhvcHRpb25zKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zY3JvbGxDYWxsYmFjayA9IF9fYmluZCh0aGlzLnNjcm9sbENhbGxiYWNrLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsSGFuZGxlciA9IF9fYmluZCh0aGlzLnNjcm9sbEhhbmRsZXIsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5zdGFydCA9IF9fYmluZCh0aGlzLnN0YXJ0LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5jb25maWcgPSB0aGlzLnV0aWwoKS5leHRlbmQob3B0aW9ucywgdGhpcy5kZWZhdWx0cyk7XG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbk5hbWVDYWNoZSA9IG5ldyBXZWFrTWFwKCk7XG4gICAgICAgIH1cblxuICAgICAgICBXT1cucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBfcmVmO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICAgICAgICAgIGlmICgoX3JlZiA9IGRvY3VtZW50LnJlYWR5U3RhdGUpID09PSBcImludGVyYWN0aXZlXCIgfHwgX3JlZiA9PT0gXCJjb21wbGV0ZVwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnV0aWwoKS5hZGRFdmVudChkb2N1bWVudCwgJ0RPTUNvbnRlbnRMb2FkZWQnLCB0aGlzLnN0YXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmlzaGVkID0gW107XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGJveCwgX2ksIF9sZW4sIF9yZWY7XG4gICAgICAgICAgICB0aGlzLnN0b3BwZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuYm94ZXMgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0cztcbiAgICAgICAgICAgICAgICBfcmVmID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuXCIgKyB0aGlzLmNvbmZpZy5ib3hDbGFzcyk7XG4gICAgICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgYm94ID0gX3JlZltfaV07XG4gICAgICAgICAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goYm94KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuYWxsID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICAgICAgICAgICAgX3JlZiA9IHRoaXMuYm94ZXM7XG4gICAgICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgYm94ID0gX3JlZltfaV07XG4gICAgICAgICAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goYm94KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmJveGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpc2FibGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldFN0eWxlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3JlZiA9IHRoaXMuYm94ZXM7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYm94ID0gX3JlZltfaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3R5bGUoYm94LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51dGlsKCkuYWRkRXZlbnQod2luZG93LCAnc2Nyb2xsJywgdGhpcy5zY3JvbGxIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnV0aWwoKS5hZGRFdmVudCh3aW5kb3csICdyZXNpemUnLCB0aGlzLnNjcm9sbEhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLnNjcm9sbENhbGxiYWNrLCA1MCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5jb25maWcubGl2ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTXV0YXRpb25PYnNlcnZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHJlY29yZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub2RlLCByZWNvcmQsIF9qLCBfbGVuMSwgX3Jlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gcmVjb3Jkcy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmQgPSByZWNvcmRzW19qXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9rLCBfbGVuMiwgX3JlZjEsIF9yZXN1bHRzMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3JlZjEgPSByZWNvcmQuYWRkZWROb2RlcyB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3Jlc3VsdHMxID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoX2sgPSAwLCBfbGVuMiA9IF9yZWYxLmxlbmd0aDsgX2sgPCBfbGVuMjsgX2srKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IF9yZWYxW19rXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKHRoaXMuZG9TeW5jKG5vZGUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3Jlc3VsdHMxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhbGwoX3RoaXMpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KSh0aGlzKSkub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc3VidHJlZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFdPVy5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5zdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMudXRpbCgpLnJlbW92ZUV2ZW50KHdpbmRvdywgJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsSGFuZGxlcik7XG4gICAgICAgICAgICB0aGlzLnV0aWwoKS5yZW1vdmVFdmVudCh3aW5kb3csICdyZXNpemUnLCB0aGlzLnNjcm9sbEhhbmRsZXIpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW50ZXJ2YWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFdPVy5wcm90b3R5cGUuc3luYyA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChNdXRhdGlvbk9ic2VydmVyLm5vdFN1cHBvcnRlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvU3luYyh0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFdPVy5wcm90b3R5cGUuZG9TeW5jID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIGJveCwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5ub2RlVHlwZSAhPT0gMSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGUgfHwgZWxlbWVudDtcbiAgICAgICAgICAgIF9yZWYgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuXCIgKyB0aGlzLmNvbmZpZy5ib3hDbGFzcyk7XG4gICAgICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgYm94ID0gX3JlZltfaV07XG4gICAgICAgICAgICAgICAgaWYgKF9faW5kZXhPZi5jYWxsKHRoaXMuYWxsLCBib3gpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJveGVzLnB1c2goYm94KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGwucHVzaChib3gpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdG9wcGVkIHx8IHRoaXMuZGlzYWJsZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldFN0eWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U3R5bGUoYm94LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMuc2Nyb2xsZWQgPSB0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICB9O1xuXG4gICAgICAgIFdPVy5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKGJveCkge1xuICAgICAgICAgICAgdGhpcy5hcHBseVN0eWxlKGJveCk7XG4gICAgICAgICAgICBib3guY2xhc3NOYW1lID0gXCJcIiArIGJveC5jbGFzc05hbWUgKyBcIiBcIiArIHRoaXMuY29uZmlnLmFuaW1hdGVDbGFzcztcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5jYWxsYmFjayAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmNhbGxiYWNrKGJveCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5hcHBseVN0eWxlID0gZnVuY3Rpb24oYm94LCBoaWRkZW4pIHtcbiAgICAgICAgICAgIHZhciBkZWxheSwgZHVyYXRpb24sIGl0ZXJhdGlvbjtcbiAgICAgICAgICAgIGR1cmF0aW9uID0gYm94LmdldEF0dHJpYnV0ZSgnZGF0YS13b3ctZHVyYXRpb24nKTtcbiAgICAgICAgICAgIGRlbGF5ID0gYm94LmdldEF0dHJpYnV0ZSgnZGF0YS13b3ctZGVsYXknKTtcbiAgICAgICAgICAgIGl0ZXJhdGlvbiA9IGJveC5nZXRBdHRyaWJ1dGUoJ2RhdGEtd293LWl0ZXJhdGlvbicpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZSgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jdXN0b21TdHlsZShib3gsIGhpZGRlbiwgZHVyYXRpb24sIGRlbGF5LCBpdGVyYXRpb24pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSh0aGlzKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5hbmltYXRlID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCdyZXF1ZXN0QW5pbWF0aW9uRnJhbWUnIGluIHdpbmRvdykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKCk7XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5yZXNldFN0eWxlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgYm94LCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICAgICAgICBfcmVmID0gdGhpcy5ib3hlcztcbiAgICAgICAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgICAgICBib3ggPSBfcmVmW19pXTtcbiAgICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKGJveC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgICAgfTtcblxuICAgICAgICBXT1cucHJvdG90eXBlLmN1c3RvbVN0eWxlID0gZnVuY3Rpb24oYm94LCBoaWRkZW4sIGR1cmF0aW9uLCBkZWxheSwgaXRlcmF0aW9uKSB7XG4gICAgICAgICAgICBpZiAoaGlkZGVuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZUFuaW1hdGlvbk5hbWUoYm94KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJveC5zdHlsZS52aXNpYmlsaXR5ID0gaGlkZGVuID8gJ2hpZGRlbicgOiAndmlzaWJsZSc7XG4gICAgICAgICAgICBpZiAoZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZlbmRvclNldChib3guc3R5bGUsIHtcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uRHVyYXRpb246IGR1cmF0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGVsYXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZlbmRvclNldChib3guc3R5bGUsIHtcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uRGVsYXk6IGRlbGF5XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXRlcmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52ZW5kb3JTZXQoYm94LnN0eWxlLCB7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiBpdGVyYXRpb25cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudmVuZG9yU2V0KGJveC5zdHlsZSwge1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbk5hbWU6IGhpZGRlbiA/ICdub25lJyA6IHRoaXMuY2FjaGVkQW5pbWF0aW9uTmFtZShib3gpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBib3g7XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS52ZW5kb3JzID0gW1wibW96XCIsIFwid2Via2l0XCJdO1xuXG4gICAgICAgIFdPVy5wcm90b3R5cGUudmVuZG9yU2V0ID0gZnVuY3Rpb24oZWxlbSwgcHJvcGVydGllcykge1xuICAgICAgICAgICAgdmFyIG5hbWUsIHZhbHVlLCB2ZW5kb3IsIF9yZXN1bHRzO1xuICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgICAgICAgIGZvciAobmFtZSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBwcm9wZXJ0aWVzW25hbWVdO1xuICAgICAgICAgICAgICAgIGVsZW1bXCJcIiArIG5hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCgoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHMxO1xuICAgICAgICAgICAgICAgICAgICBfcmVmID0gdGhpcy52ZW5kb3JzO1xuICAgICAgICAgICAgICAgICAgICBfcmVzdWx0czEgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2ZW5kb3IgPSBfcmVmW19pXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKGVsZW1bXCJcIiArIHZlbmRvciArIChuYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpKSArIChuYW1lLnN1YnN0cigxKSldID0gdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVzdWx0czE7XG4gICAgICAgICAgICAgICAgfSkuY2FsbCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS52ZW5kb3JDU1MgPSBmdW5jdGlvbihlbGVtLCBwcm9wZXJ0eSkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCwgc3R5bGUsIHZlbmRvciwgX2ksIF9sZW4sIF9yZWY7XG4gICAgICAgICAgICBzdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZWxlbSk7XG4gICAgICAgICAgICByZXN1bHQgPSBzdHlsZS5nZXRQcm9wZXJ0eUNTU1ZhbHVlKHByb3BlcnR5KTtcbiAgICAgICAgICAgIF9yZWYgPSB0aGlzLnZlbmRvcnM7XG4gICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgICAgICB2ZW5kb3IgPSBfcmVmW19pXTtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgfHwgc3R5bGUuZ2V0UHJvcGVydHlDU1NWYWx1ZShcIi1cIiArIHZlbmRvciArIFwiLVwiICsgcHJvcGVydHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICBXT1cucHJvdG90eXBlLmFuaW1hdGlvbk5hbWUgPSBmdW5jdGlvbihib3gpIHtcbiAgICAgICAgICAgIHZhciBhbmltYXRpb25OYW1lO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb25OYW1lID0gdGhpcy52ZW5kb3JDU1MoYm94LCAnYW5pbWF0aW9uLW5hbWUnKS5jc3NUZXh0O1xuICAgICAgICAgICAgfSBjYXRjaCAoX2Vycm9yKSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uTmFtZSA9IGdldENvbXB1dGVkU3R5bGUoYm94KS5nZXRQcm9wZXJ0eVZhbHVlKCdhbmltYXRpb24tbmFtZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGFuaW1hdGlvbk5hbWUgPT09ICdub25lJykge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuaW1hdGlvbk5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5jYWNoZUFuaW1hdGlvbk5hbWUgPSBmdW5jdGlvbihib3gpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGlvbk5hbWVDYWNoZS5zZXQoYm94LCB0aGlzLmFuaW1hdGlvbk5hbWUoYm94KSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5jYWNoZWRBbmltYXRpb25OYW1lID0gZnVuY3Rpb24oYm94KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRpb25OYW1lQ2FjaGUuZ2V0KGJveCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5zY3JvbGxIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zY3JvbGxlZCA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5zY3JvbGxDYWxsYmFjayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGJveDtcbiAgICAgICAgICAgIGlmICh0aGlzLnNjcm9sbGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuYm94ZXMgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIF9yZWYgPSB0aGlzLmJveGVzO1xuICAgICAgICAgICAgICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJveCA9IF9yZWZbX2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoYm94KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlKGJveCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3coYm94KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goYm94KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgICAgICAgICAgICAgfSkuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLmJveGVzLmxlbmd0aCB8fCB0aGlzLmNvbmZpZy5saXZlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFdPVy5wcm90b3R5cGUub2Zmc2V0VG9wID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHRvcDtcbiAgICAgICAgICAgIHdoaWxlIChlbGVtZW50Lm9mZnNldFRvcCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRvcCA9IGVsZW1lbnQub2Zmc2V0VG9wO1xuICAgICAgICAgICAgd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50Lm9mZnNldFBhcmVudCkge1xuICAgICAgICAgICAgICAgIHRvcCArPSBlbGVtZW50Lm9mZnNldFRvcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0b3A7XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5pc1Zpc2libGUgPSBmdW5jdGlvbihib3gpIHtcbiAgICAgICAgICAgIHZhciBib3R0b20sIG9mZnNldCwgdG9wLCB2aWV3Qm90dG9tLCB2aWV3VG9wO1xuICAgICAgICAgICAgb2Zmc2V0ID0gYm94LmdldEF0dHJpYnV0ZSgnZGF0YS13b3ctb2Zmc2V0JykgfHwgdGhpcy5jb25maWcub2Zmc2V0O1xuICAgICAgICAgICAgdmlld1RvcCA9IHdpbmRvdy5wYWdlWU9mZnNldDtcbiAgICAgICAgICAgIHZpZXdCb3R0b20gPSB2aWV3VG9wICsgTWF0aC5taW4odGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCwgdGhpcy51dGlsKCkuaW5uZXJIZWlnaHQoKSkgLSBvZmZzZXQ7XG4gICAgICAgICAgICB0b3AgPSB0aGlzLm9mZnNldFRvcChib3gpO1xuICAgICAgICAgICAgYm90dG9tID0gdG9wICsgYm94LmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgIHJldHVybiB0b3AgPD0gdmlld0JvdHRvbSAmJiBib3R0b20gPj0gdmlld1RvcDtcbiAgICAgICAgfTtcblxuICAgICAgICBXT1cucHJvdG90eXBlLnV0aWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl91dGlsICE9IG51bGwgPyB0aGlzLl91dGlsIDogdGhpcy5fdXRpbCA9IG5ldyBVdGlsKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgV09XLnByb3RvdHlwZS5kaXNhYmxlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLmNvbmZpZy5tb2JpbGUgJiYgdGhpcy51dGlsKCkuaXNNb2JpbGUobmF2aWdhdG9yLnVzZXJBZ2VudCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFdPVztcblxuICAgIH0pKCk7XG5cbn0pLmNhbGwodGhpcyk7XG4iXX0=
